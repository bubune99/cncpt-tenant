{"version":3,"sources":["../src/lib/analytics/types.ts","../src/lib/analytics/index.ts","../src/lib/blog/index.ts","../src/lib/cart/index.ts","../src/lib/discounts/validator.ts","../src/lib/discounts/calculator.ts","../src/lib/discounts/stripe-sync.ts","../src/lib/stripe/index.ts","../src/lib/stripe/types.ts","../src/lib/forms/types.ts","../src/lib/forms/index.ts","../src/lib/inventory/index.ts","../src/lib/media/index.ts","../src/lib/email/templates/base.ts","../src/lib/email/templates/renderer.ts","../src/lib/email/templates/order-confirmation.ts","../src/lib/email/templates/shipping-notification.ts","../src/lib/email/templates/delivery-confirmation.ts","../src/lib/email/templates/refund-notification.ts","../src/lib/email/templates/render.ts","../src/lib/notifications/index.ts","../src/lib/permissions/constants.ts","../src/lib/permissions/index.ts","../src/lib/order-workflows/types.ts","../src/lib/order-workflows/index.ts","../src/lib/plugins/types.ts","../src/lib/plugins/sandbox.ts","../src/lib/plugins/registry.ts","../src/lib/plugins/executor.ts","../src/lib/plugins/primitives/ai.ts","../src/lib/plugins/primitives/analytics.ts","../src/lib/plugins/primitives/blog.ts","../src/lib/plugins/primitives/cart.ts","../src/lib/plugins/primitives/customer.ts","../src/lib/plugins/primitives/discount.ts","../src/lib/plugins/primitives/email.ts","../src/lib/plugins/primitives/giftcard.ts","../src/lib/plugins/primitives/media.ts","../src/lib/plugins/primitives/notification.ts","../src/lib/plugins/primitives/order.ts","../src/lib/plugins/primitives/payment.ts","../src/lib/plugins/primitives/product.ts","../src/lib/plugins/primitives/review.ts","../src/lib/plugins/primitives/shipping.ts","../src/lib/plugins/primitives/wishlist.ts","../src/lib/plugins/primitives/index.ts","../src/lib/plugins/built-in.ts","../src/lib/reviews/index.ts","../src/lib/seo/types.ts","../src/lib/seo/index.ts","../src/lib/site-settings/index.ts","../src/lib/workflows/event-bus.ts","../src/lib/workflows/react-flow.ts","../src/lib/workflows/actions/index.ts","../src/lib/workflows/templates/index.ts","../src/lib/workflows/toggle.ts","../src/lib/shippo/index.ts","../src/lib/shippo/types.ts","../src/lib/dashboard/types.ts","../src/lib/dashboard/index.ts","../src/lib/routes/index.ts"],"sourcesContent":["/**\n * Analytics Types and Configurations\n */\n\n// Analytics provider types\nexport type AnalyticsProvider = 'google' | 'matomo' | 'plausible' | 'umami' | 'custom'\n\n// Analytics settings stored in database\nexport interface AnalyticsSettings {\n  enabled: boolean\n\n  // Google Analytics\n  googleEnabled: boolean\n  googleMeasurementId?: string // G-XXXXXXXXXX\n  googleDebugMode: boolean\n\n  // Matomo\n  matomoEnabled: boolean\n  matomoUrl?: string\n  matomoSiteId?: string\n\n  // Plausible (optional)\n  plausibleEnabled: boolean\n  plausibleDomain?: string\n\n  // Privacy settings\n  respectDoNotTrack: boolean\n  anonymizeIp: boolean\n  cookieConsent: boolean\n}\n\n// Default analytics settings\nexport const DEFAULT_ANALYTICS_SETTINGS: AnalyticsSettings = {\n  enabled: false,\n  googleEnabled: false,\n  googleDebugMode: false,\n  matomoEnabled: false,\n  plausibleEnabled: false,\n  respectDoNotTrack: true,\n  anonymizeIp: true,\n  cookieConsent: true,\n}\n\n// Standard event names\nexport type StandardEventName =\n  | 'page_view'\n  | 'purchase'\n  | 'add_to_cart'\n  | 'remove_from_cart'\n  | 'begin_checkout'\n  | 'view_item'\n  | 'view_item_list'\n  | 'search'\n  | 'sign_up'\n  | 'login'\n  | 'share'\n  | 'generate_lead'\n  | 'add_payment_info'\n  | 'add_shipping_info'\n  | 'select_item'\n  | 'select_promotion'\n  | 'view_promotion'\n  | 'refund'\n\n// Custom event\nexport interface AnalyticsEvent {\n  name: string\n  params?: Record<string, string | number | boolean | undefined>\n}\n\n// E-commerce item\nexport interface EcommerceItem {\n  item_id: string\n  item_name: string\n  item_brand?: string\n  item_category?: string\n  item_variant?: string\n  price?: number\n  quantity?: number\n  currency?: string\n}\n\n// Purchase event data\nexport interface PurchaseEventData {\n  transaction_id: string\n  value: number\n  currency: string\n  tax?: number\n  shipping?: number\n  coupon?: string\n  items: EcommerceItem[]\n}\n\n// Page view data\nexport interface PageViewData {\n  page_title?: string\n  page_location?: string\n  page_path?: string\n}\n\n// User properties\nexport interface UserProperties {\n  user_id?: string\n  user_type?: string\n  [key: string]: string | number | boolean | undefined\n}\n\n// Consent categories\nexport interface ConsentSettings {\n  analytics_storage: 'granted' | 'denied'\n  ad_storage: 'granted' | 'denied'\n  ad_user_data: 'granted' | 'denied'\n  ad_personalization: 'granted' | 'denied'\n  functionality_storage: 'granted' | 'denied'\n  personalization_storage: 'granted' | 'denied'\n  security_storage: 'granted' // Always granted\n}\n\n// Default consent (privacy-first)\nexport const DEFAULT_CONSENT: ConsentSettings = {\n  analytics_storage: 'denied',\n  ad_storage: 'denied',\n  ad_user_data: 'denied',\n  ad_personalization: 'denied',\n  functionality_storage: 'granted',\n  personalization_storage: 'denied',\n  security_storage: 'granted',\n}\n","/**\n * Analytics Library\n *\n * Provides unified analytics tracking for Google Analytics 4 and Matomo\n */\n\nimport { prisma } from '../db'\nimport type {\n  AnalyticsSettings,\n  AnalyticsEvent,\n  PurchaseEventData,\n  PageViewData,\n  UserProperties,\n  ConsentSettings,\n} from './types'\nimport { DEFAULT_ANALYTICS_SETTINGS } from './types'\n\n// Cache for analytics settings\nlet settingsCache: AnalyticsSettings | null = null\nlet settingsCacheTime = 0\nconst SETTINGS_CACHE_TTL = 60 * 1000 // 1 minute\n\n/**\n * Get analytics settings from database\n */\nexport async function getAnalyticsSettings(): Promise<AnalyticsSettings> {\n  const now = Date.now()\n  if (settingsCache && now - settingsCacheTime < SETTINGS_CACHE_TTL) {\n    return settingsCache\n  }\n\n  const records = await prisma.setting.findMany({\n    where: { key: { startsWith: 'analytics.' } },\n  })\n\n  const settings: AnalyticsSettings = { ...DEFAULT_ANALYTICS_SETTINGS }\n\n  for (const record of records) {\n    const key = record.key.replace('analytics.', '')\n    switch (key) {\n      case 'enabled':\n        settings.enabled = record.value === 'true'\n        break\n      case 'googleEnabled':\n        settings.googleEnabled = record.value === 'true'\n        break\n      case 'googleMeasurementId':\n        settings.googleMeasurementId = record.value\n        break\n      case 'googleDebugMode':\n        settings.googleDebugMode = record.value === 'true'\n        break\n      case 'matomoEnabled':\n        settings.matomoEnabled = record.value === 'true'\n        break\n      case 'matomoUrl':\n        settings.matomoUrl = record.value\n        break\n      case 'matomoSiteId':\n        settings.matomoSiteId = record.value\n        break\n      case 'plausibleEnabled':\n        settings.plausibleEnabled = record.value === 'true'\n        break\n      case 'plausibleDomain':\n        settings.plausibleDomain = record.value\n        break\n      case 'respectDoNotTrack':\n        settings.respectDoNotTrack = record.value === 'true'\n        break\n      case 'anonymizeIp':\n        settings.anonymizeIp = record.value === 'true'\n        break\n      case 'cookieConsent':\n        settings.cookieConsent = record.value === 'true'\n        break\n    }\n  }\n\n  // Fallback to environment variables\n  if (!settings.googleMeasurementId) {\n    settings.googleMeasurementId = process.env.NEXT_PUBLIC_GA_MEASUREMENT_ID\n  }\n  if (!settings.matomoUrl) {\n    settings.matomoUrl = process.env.NEXT_PUBLIC_MATOMO_URL\n  }\n  if (!settings.matomoSiteId) {\n    settings.matomoSiteId = process.env.NEXT_PUBLIC_MATOMO_SITE_ID\n  }\n\n  settingsCache = settings\n  settingsCacheTime = now\n\n  return settings\n}\n\n/**\n * Clear analytics settings cache\n */\nexport function clearAnalyticsSettingsCache(): void {\n  settingsCache = null\n  settingsCacheTime = 0\n}\n\n/**\n * Track an event server-side (stores in database)\n */\nexport async function trackServerEvent(\n  eventName: string,\n  eventData?: Record<string, any>,\n  context?: {\n    sessionId?: string\n    userId?: string\n    pageUrl?: string\n    pageTitle?: string\n    referrer?: string\n    userAgent?: string\n    ipAddress?: string\n  }\n): Promise<void> {\n  try {\n    await prisma.analyticsEvent.create({\n      data: {\n        eventName,\n        eventData: eventData || undefined,\n        sessionId: context?.sessionId,\n        userId: context?.userId,\n        pageUrl: context?.pageUrl,\n        pageTitle: context?.pageTitle,\n        referrer: context?.referrer,\n        userAgent: context?.userAgent,\n        ipAddress: context?.ipAddress,\n      },\n    })\n  } catch (error) {\n    console.error('Failed to track server event:', error)\n  }\n}\n\n/**\n * Track a purchase event\n */\nexport async function trackPurchase(\n  data: PurchaseEventData,\n  context?: {\n    sessionId?: string\n    userId?: string\n  }\n): Promise<void> {\n  await trackServerEvent('purchase', data, context)\n}\n\n/**\n * Get analytics data for dashboard\n */\nexport async function getAnalyticsSummary(\n  startDate: Date,\n  endDate: Date\n): Promise<{\n  pageViews: number\n  uniqueVisitors: number\n  purchases: number\n  revenue: number\n  topPages: Array<{ url: string; views: number }>\n  topReferrers: Array<{ referrer: string; count: number }>\n  eventBreakdown: Array<{ event: string; count: number }>\n}> {\n  // Page views\n  const pageViews = await prisma.analyticsEvent.count({\n    where: {\n      eventName: 'page_view',\n      createdAt: { gte: startDate, lte: endDate },\n    },\n  })\n\n  // Unique visitors (by sessionId)\n  const uniqueVisitors = await prisma.analyticsEvent.groupBy({\n    by: ['sessionId'],\n    where: {\n      sessionId: { not: null },\n      createdAt: { gte: startDate, lte: endDate },\n    },\n  })\n\n  // Purchases and revenue\n  const purchases = await prisma.analyticsEvent.findMany({\n    where: {\n      eventName: 'purchase',\n      createdAt: { gte: startDate, lte: endDate },\n    },\n    select: { eventData: true },\n  })\n\n  const revenue = purchases.reduce((sum: number, p: (typeof purchases)[number]) => {\n    const data = p.eventData as Record<string, unknown> | null\n    const value = typeof data?.value === 'number' ? data.value : 0\n    return sum + value\n  }, 0)\n\n  // Top pages\n  const topPagesRaw = await prisma.analyticsEvent.groupBy({\n    by: ['pageUrl'],\n    where: {\n      eventName: 'page_view',\n      pageUrl: { not: null },\n      createdAt: { gte: startDate, lte: endDate },\n    },\n    _count: { pageUrl: true },\n    orderBy: { _count: { pageUrl: 'desc' } },\n    take: 10,\n  })\n\n  const topPages = topPagesRaw.map((p: (typeof topPagesRaw)[number]) => ({\n    url: p.pageUrl!,\n    views: p._count.pageUrl,\n  }))\n\n  // Top referrers\n  const topReferrersRaw = await prisma.analyticsEvent.groupBy({\n    by: ['referrer'],\n    where: {\n      referrer: { not: null },\n      createdAt: { gte: startDate, lte: endDate },\n    },\n    _count: { referrer: true },\n    orderBy: { _count: { referrer: 'desc' } },\n    take: 10,\n  })\n\n  const topReferrers = topReferrersRaw.map((r: (typeof topReferrersRaw)[number]) => ({\n    referrer: r.referrer!,\n    count: r._count.referrer,\n  }))\n\n  // Event breakdown\n  const eventBreakdownRaw = await prisma.analyticsEvent.groupBy({\n    by: ['eventName'],\n    where: {\n      createdAt: { gte: startDate, lte: endDate },\n    },\n    _count: { eventName: true },\n    orderBy: { _count: { eventName: 'desc' } },\n    take: 20,\n  })\n\n  const eventBreakdown = eventBreakdownRaw.map((e: (typeof eventBreakdownRaw)[number]) => ({\n    event: e.eventName,\n    count: e._count.eventName,\n  }))\n\n  return {\n    pageViews,\n    uniqueVisitors: uniqueVisitors.length,\n    purchases: purchases.length,\n    revenue,\n    topPages,\n    topReferrers,\n    eventBreakdown,\n  }\n}\n\n/**\n * Generate Google Analytics gtag script\n */\nexport function generateGtagScript(measurementId: string, debugMode = false): string {\n  return `\n    window.dataLayer = window.dataLayer || [];\n    function gtag(){dataLayer.push(arguments);}\n    gtag('js', new Date());\n    gtag('config', '${measurementId}'${debugMode ? \", { 'debug_mode': true }\" : ''});\n  `\n}\n\n/**\n * Generate Matomo tracking script\n */\nexport function generateMatomoScript(matomoUrl: string, siteId: string): string {\n  const url = matomoUrl.endsWith('/') ? matomoUrl : `${matomoUrl}/`\n\n  return `\n    var _paq = window._paq = window._paq || [];\n    _paq.push(['trackPageView']);\n    _paq.push(['enableLinkTracking']);\n    (function() {\n      var u=\"${url}\";\n      _paq.push(['setTrackerUrl', u+'matomo.php']);\n      _paq.push(['setSiteId', '${siteId}']);\n      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);\n    })();\n  `\n}\n\nexport * from './types'\n","/**\n * Blog Library\n *\n * Core functions for blog post, category, and tag management\n */\n\nimport { prisma } from '../db'\nimport type { Prisma, PostVisibility } from '@prisma/client'\n\n// ============ SLUG UTILITIES ============\n\nfunction generateSlug(title: string): string {\n  return title\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/(^-|-$)+/g, '')\n}\n\nasync function ensureUniqueSlug(\n  slug: string,\n  type: 'post' | 'category' | 'tag',\n  excludeId?: string\n): Promise<string> {\n  let uniqueSlug = slug\n  let counter = 1\n\n  while (true) {\n    const existing = await (type === 'post'\n      ? prisma.blogPost.findUnique({ where: { slug: uniqueSlug } })\n      : type === 'category'\n      ? prisma.blogCategory.findUnique({ where: { slug: uniqueSlug } })\n      : prisma.blogTag.findUnique({ where: { slug: uniqueSlug } }))\n\n    if (!existing || existing.id === excludeId) {\n      return uniqueSlug\n    }\n\n    uniqueSlug = `${slug}-${counter}`\n    counter++\n  }\n}\n\n// ============ BLOG POSTS ============\n\nexport interface CreatePostInput {\n  title: string\n  slug?: string\n  excerpt?: string\n  content?: object\n  contentHtml?: string\n  puckContent?: object\n  usePuckLayout?: boolean\n  authorId?: string\n  featuredImageId?: string\n  status?: 'DRAFT' | 'PUBLISHED' | 'ARCHIVED' | 'SCHEDULED'\n  visibility?: 'PUBLIC' | 'PRIVATE' | 'PASSWORD_PROTECTED' | 'MEMBERS_ONLY'\n  metaTitle?: string\n  metaDescription?: string\n  canonicalUrl?: string\n  noIndex?: boolean\n  ogTitle?: string\n  ogDescription?: string\n  ogImageId?: string\n  publishedAt?: Date\n  scheduledAt?: Date\n  allowComments?: boolean\n  featured?: boolean\n  pinned?: boolean\n  categoryIds?: string[]\n  tagIds?: string[]\n}\n\nexport interface UpdatePostInput extends Partial<CreatePostInput> {}\n\nexport interface ListPostsOptions {\n  status?: string\n  visibility?: string\n  authorId?: string\n  categoryId?: string\n  tagId?: string\n  featured?: boolean\n  search?: string\n  limit?: number\n  offset?: number\n  orderBy?: 'createdAt' | 'publishedAt' | 'title' | 'viewCount'\n  orderDir?: 'asc' | 'desc'\n}\n\nexport async function createPost(input: CreatePostInput) {\n  const slug = input.slug || generateSlug(input.title)\n  const uniqueSlug = await ensureUniqueSlug(slug, 'post')\n\n  // Calculate word count from HTML content\n  const wordCount = input.contentHtml\n    ? input.contentHtml.replace(/<[^>]*>/g, '').split(/\\s+/).filter(Boolean).length\n    : 0\n\n  // Estimate reading time (200 words per minute)\n  const readingTime = Math.ceil(wordCount / 200)\n\n  const post = await prisma.blogPost.create({\n    data: {\n      title: input.title,\n      slug: uniqueSlug,\n      excerpt: input.excerpt,\n      content: input.content as Prisma.InputJsonValue,\n      contentHtml: input.contentHtml,\n      puckContent: input.puckContent as Prisma.InputJsonValue,\n      usePuckLayout: input.usePuckLayout ?? false,\n      authorId: input.authorId,\n      featuredImageId: input.featuredImageId,\n      status: input.status ?? 'DRAFT',\n      visibility: (input.visibility ?? 'PUBLIC') as PostVisibility,\n      metaTitle: input.metaTitle,\n      metaDescription: input.metaDescription,\n      canonicalUrl: input.canonicalUrl,\n      noIndex: input.noIndex ?? false,\n      ogTitle: input.ogTitle,\n      ogDescription: input.ogDescription,\n      ogImageId: input.ogImageId,\n      publishedAt: input.status === 'PUBLISHED' ? input.publishedAt ?? new Date() : input.publishedAt,\n      scheduledAt: input.scheduledAt,\n      wordCount,\n      readingTime,\n      allowComments: input.allowComments ?? true,\n      featured: input.featured ?? false,\n      pinned: input.pinned ?? false,\n      categories: input.categoryIds?.length\n        ? {\n            create: input.categoryIds.map((categoryId) => ({\n              category: { connect: { id: categoryId } },\n            })),\n          }\n        : undefined,\n      tags: input.tagIds?.length\n        ? {\n            create: input.tagIds.map((tagId) => ({\n              tag: { connect: { id: tagId } },\n            })),\n          }\n        : undefined,\n    },\n    include: {\n      author: {\n        select: { id: true, name: true, email: true },\n      },\n      featuredImage: true,\n      categories: {\n        include: { category: true },\n      },\n      tags: {\n        include: { tag: true },\n      },\n    },\n  })\n\n  return post\n}\n\nexport async function getPost(id: string) {\n  return prisma.blogPost.findUnique({\n    where: { id },\n    include: {\n      author: {\n        select: { id: true, name: true, email: true },\n      },\n      featuredImage: true,\n      ogImage: true,\n      categories: {\n        include: { category: true },\n      },\n      tags: {\n        include: { tag: true },\n      },\n      _count: {\n        select: { comments: true },\n      },\n    },\n  })\n}\n\nexport async function getPostBySlug(slug: string) {\n  return prisma.blogPost.findUnique({\n    where: { slug },\n    include: {\n      author: {\n        select: { id: true, name: true, email: true },\n      },\n      featuredImage: true,\n      ogImage: true,\n      categories: {\n        include: { category: true },\n      },\n      tags: {\n        include: { tag: true },\n      },\n      _count: {\n        select: { comments: true },\n      },\n    },\n  })\n}\n\nexport async function listPosts(options: ListPostsOptions = {}) {\n  const {\n    status,\n    visibility,\n    authorId,\n    categoryId,\n    tagId,\n    featured,\n    search,\n    limit = 20,\n    offset = 0,\n    orderBy = 'createdAt',\n    orderDir = 'desc',\n  } = options\n\n  const where: Prisma.BlogPostWhereInput = {}\n\n  if (status) {\n    where.status = status as any\n  }\n  if (visibility) {\n    where.visibility = visibility as any\n  }\n  if (authorId) {\n    where.authorId = authorId\n  }\n  if (featured !== undefined) {\n    where.featured = featured\n  }\n  if (categoryId) {\n    where.categories = {\n      some: { categoryId },\n    }\n  }\n  if (tagId) {\n    where.tags = {\n      some: { tagId },\n    }\n  }\n  if (search) {\n    where.OR = [\n      { title: { contains: search, mode: 'insensitive' } },\n      { excerpt: { contains: search, mode: 'insensitive' } },\n    ]\n  }\n\n  const [posts, total] = await Promise.all([\n    prisma.blogPost.findMany({\n      where,\n      take: limit,\n      skip: offset,\n      orderBy: { [orderBy]: orderDir },\n      include: {\n        author: {\n          select: { id: true, name: true, email: true },\n        },\n        featuredImage: {\n          select: { id: true, url: true, alt: true },\n        },\n        categories: {\n          include: {\n            category: {\n              select: { id: true, name: true, slug: true },\n            },\n          },\n        },\n        tags: {\n          include: {\n            tag: {\n              select: { id: true, name: true, slug: true },\n            },\n          },\n        },\n      },\n    }),\n    prisma.blogPost.count({ where }),\n  ])\n\n  return { posts, total, limit, offset }\n}\n\nexport async function updatePost(id: string, input: UpdatePostInput) {\n  // Get existing post\n  const existing = await prisma.blogPost.findUnique({\n    where: { id },\n    include: {\n      categories: true,\n      tags: true,\n    },\n  })\n\n  if (!existing) {\n    throw new Error('Post not found')\n  }\n\n  // Handle slug update\n  let slug = existing.slug\n  if (input.slug && input.slug !== existing.slug) {\n    slug = await ensureUniqueSlug(input.slug, 'post', id)\n  }\n\n  // Calculate word count if content changed\n  let wordCount = existing.wordCount\n  let readingTime = existing.readingTime\n  if (input.contentHtml !== undefined) {\n    wordCount = input.contentHtml\n      ? input.contentHtml.replace(/<[^>]*>/g, '').split(/\\s+/).filter(Boolean).length\n      : 0\n    readingTime = Math.ceil(wordCount / 200)\n  }\n\n  // Handle category updates\n  if (input.categoryIds !== undefined) {\n    // Delete existing categories\n    await prisma.blogPostCategory.deleteMany({\n      where: { postId: id },\n    })\n  }\n\n  // Handle tag updates\n  if (input.tagIds !== undefined) {\n    // Delete existing tags\n    await prisma.blogPostTag.deleteMany({\n      where: { postId: id },\n    })\n  }\n\n  const post = await prisma.blogPost.update({\n    where: { id },\n    data: {\n      title: input.title,\n      slug,\n      excerpt: input.excerpt,\n      content: input.content as Prisma.InputJsonValue,\n      contentHtml: input.contentHtml,\n      puckContent: input.puckContent as Prisma.InputJsonValue,\n      usePuckLayout: input.usePuckLayout,\n      authorId: input.authorId,\n      featuredImageId: input.featuredImageId,\n      status: input.status,\n      visibility: input.visibility as PostVisibility | undefined,\n      metaTitle: input.metaTitle,\n      metaDescription: input.metaDescription,\n      canonicalUrl: input.canonicalUrl,\n      noIndex: input.noIndex,\n      ogTitle: input.ogTitle,\n      ogDescription: input.ogDescription,\n      ogImageId: input.ogImageId,\n      publishedAt:\n        input.status === 'PUBLISHED' && !existing.publishedAt\n          ? new Date()\n          : input.publishedAt,\n      scheduledAt: input.scheduledAt,\n      wordCount,\n      readingTime,\n      allowComments: input.allowComments,\n      featured: input.featured,\n      pinned: input.pinned,\n      categories: input.categoryIds?.length\n        ? {\n            create: input.categoryIds.map((categoryId) => ({\n              category: { connect: { id: categoryId } },\n            })),\n          }\n        : undefined,\n      tags: input.tagIds?.length\n        ? {\n            create: input.tagIds.map((tagId) => ({\n              tag: { connect: { id: tagId } },\n            })),\n          }\n        : undefined,\n    },\n    include: {\n      author: {\n        select: { id: true, name: true, email: true },\n      },\n      featuredImage: true,\n      categories: {\n        include: { category: true },\n      },\n      tags: {\n        include: { tag: true },\n      },\n    },\n  })\n\n  return post\n}\n\nexport async function deletePost(id: string) {\n  // Delete related records first\n  await prisma.blogPostCategory.deleteMany({ where: { postId: id } })\n  await prisma.blogPostTag.deleteMany({ where: { postId: id } })\n  await prisma.blogComment.deleteMany({ where: { postId: id } })\n\n  return prisma.blogPost.delete({ where: { id } })\n}\n\nexport async function incrementPostViews(id: string) {\n  return prisma.blogPost.update({\n    where: { id },\n    data: { viewCount: { increment: 1 } },\n  })\n}\n\n// ============ BLOG CATEGORIES ============\n\nexport interface CreateCategoryInput {\n  name: string\n  slug?: string\n  description?: string\n  parentId?: string\n  imageId?: string\n  metaTitle?: string\n  metaDescription?: string\n}\n\nexport interface UpdateCategoryInput extends Partial<CreateCategoryInput> {}\n\nexport async function createCategory(input: CreateCategoryInput) {\n  const slug = input.slug || generateSlug(input.name)\n  const uniqueSlug = await ensureUniqueSlug(slug, 'category')\n\n  return prisma.blogCategory.create({\n    data: {\n      name: input.name,\n      slug: uniqueSlug,\n      description: input.description,\n      parentId: input.parentId,\n      imageId: input.imageId,\n      metaTitle: input.metaTitle,\n      metaDescription: input.metaDescription,\n    },\n    include: {\n      parent: true,\n      children: true,\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function getCategory(id: string) {\n  return prisma.blogCategory.findUnique({\n    where: { id },\n    include: {\n      parent: true,\n      children: true,\n      image: true,\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function getCategoryBySlug(slug: string) {\n  return prisma.blogCategory.findUnique({\n    where: { slug },\n    include: {\n      parent: true,\n      children: true,\n      image: true,\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function listCategories(options: {\n  parentId?: string | null\n  search?: string\n  limit?: number\n  offset?: number\n} = {}) {\n  const { parentId, search, limit = 100, offset = 0 } = options\n\n  const where: Prisma.BlogCategoryWhereInput = {}\n\n  if (parentId !== undefined) {\n    where.parentId = parentId\n  }\n  if (search) {\n    where.name = { contains: search, mode: 'insensitive' }\n  }\n\n  const [categories, total] = await Promise.all([\n    prisma.blogCategory.findMany({\n      where,\n      take: limit,\n      skip: offset,\n      orderBy: { name: 'asc' },\n      include: {\n        parent: {\n          select: { id: true, name: true, slug: true },\n        },\n        children: {\n          select: { id: true, name: true, slug: true },\n        },\n        _count: {\n          select: { posts: true },\n        },\n      },\n    }),\n    prisma.blogCategory.count({ where }),\n  ])\n\n  return { categories, total, limit, offset }\n}\n\nexport async function updateCategory(id: string, input: UpdateCategoryInput) {\n  const existing = await prisma.blogCategory.findUnique({ where: { id } })\n  if (!existing) {\n    throw new Error('Category not found')\n  }\n\n  let slug = existing.slug\n  if (input.slug && input.slug !== existing.slug) {\n    slug = await ensureUniqueSlug(input.slug, 'category', id)\n  }\n\n  return prisma.blogCategory.update({\n    where: { id },\n    data: {\n      name: input.name,\n      slug,\n      description: input.description,\n      parentId: input.parentId,\n      imageId: input.imageId,\n      metaTitle: input.metaTitle,\n      metaDescription: input.metaDescription,\n    },\n    include: {\n      parent: true,\n      children: true,\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function deleteCategory(id: string) {\n  // Check for child categories\n  const children = await prisma.blogCategory.count({ where: { parentId: id } })\n  if (children > 0) {\n    throw new Error('Cannot delete category with child categories')\n  }\n\n  // Delete post associations\n  await prisma.blogPostCategory.deleteMany({ where: { categoryId: id } })\n\n  return prisma.blogCategory.delete({ where: { id } })\n}\n\n// ============ BLOG TAGS ============\n\nexport interface CreateTagInput {\n  name: string\n  slug?: string\n  description?: string\n}\n\nexport interface UpdateTagInput extends Partial<CreateTagInput> {}\n\nexport async function createTag(input: CreateTagInput) {\n  const slug = input.slug || generateSlug(input.name)\n  const uniqueSlug = await ensureUniqueSlug(slug, 'tag')\n\n  return prisma.blogTag.create({\n    data: {\n      name: input.name,\n      slug: uniqueSlug,\n      description: input.description,\n    },\n    include: {\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function getTag(id: string) {\n  return prisma.blogTag.findUnique({\n    where: { id },\n    include: {\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function getTagBySlug(slug: string) {\n  return prisma.blogTag.findUnique({\n    where: { slug },\n    include: {\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function listTags(options: {\n  search?: string\n  limit?: number\n  offset?: number\n} = {}) {\n  const { search, limit = 100, offset = 0 } = options\n\n  const where: Prisma.BlogTagWhereInput = {}\n\n  if (search) {\n    where.name = { contains: search, mode: 'insensitive' }\n  }\n\n  const [tags, total] = await Promise.all([\n    prisma.blogTag.findMany({\n      where,\n      take: limit,\n      skip: offset,\n      orderBy: { name: 'asc' },\n      include: {\n        _count: {\n          select: { posts: true },\n        },\n      },\n    }),\n    prisma.blogTag.count({ where }),\n  ])\n\n  return { tags, total, limit, offset }\n}\n\nexport async function updateTag(id: string, input: UpdateTagInput) {\n  const existing = await prisma.blogTag.findUnique({ where: { id } })\n  if (!existing) {\n    throw new Error('Tag not found')\n  }\n\n  let slug = existing.slug\n  if (input.slug && input.slug !== existing.slug) {\n    slug = await ensureUniqueSlug(input.slug, 'tag', id)\n  }\n\n  return prisma.blogTag.update({\n    where: { id },\n    data: {\n      name: input.name,\n      slug,\n      description: input.description,\n    },\n    include: {\n      _count: {\n        select: { posts: true },\n      },\n    },\n  })\n}\n\nexport async function deleteTag(id: string) {\n  // Delete post associations\n  await prisma.blogPostTag.deleteMany({ where: { tagId: id } })\n\n  return prisma.blogTag.delete({ where: { id } })\n}\n","/**\n * Cart Management Service\n *\n * Handles cart operations including:\n * - Guest and authenticated carts\n * - Item management (add, update, remove)\n * - Discount application\n * - Total calculation\n * - Cart merging on login\n * - Abandonment tracking\n */\n\nimport { prisma } from '../db';\nimport { CartStatus } from '@prisma/client';\n\n// Types\nexport interface CartItemInput {\n  productId: string;\n  variantId?: string | null;\n  quantity: number;\n}\n\nexport interface CartIdentifier {\n  sessionId?: string;\n  userId?: string;\n  cartId?: string;\n}\n\nexport interface CartWithItems {\n  id: string;\n  sessionId: string | null;\n  userId: string | null;\n  email: string | null;\n  status: CartStatus;\n  subtotal: number;\n  discountTotal: number;\n  taxTotal: number;\n  shippingTotal: number;\n  total: number;\n  discountCodeId: string | null;\n  abandonedAt: Date | null;\n  createdAt: Date;\n  updatedAt: Date;\n  items: Array<{\n    id: string;\n    productId: string;\n    variantId: string | null;\n    quantity: number;\n    title: string;\n    variantTitle: string | null;\n    price: number;\n    imageUrl: string | null;\n  }>;\n  discountCode: {\n    id: string;\n    code: string;\n    type: string;\n    value: number;\n  } | null;\n}\n\n/**\n * Get or create a cart by session ID or user ID\n */\nexport async function getOrCreateCart(\n  identifier: CartIdentifier\n): Promise<CartWithItems> {\n  const { sessionId, userId, cartId } = identifier;\n\n  // If cartId provided, fetch directly\n  if (cartId) {\n    const cart = await prisma.cart.findUnique({\n      where: { id: cartId },\n      include: {\n        items: {\n          orderBy: { createdAt: 'asc' },\n        },\n        discountCode: {\n          select: { id: true, code: true, type: true, value: true },\n        },\n      },\n    });\n\n    if (cart && cart.status === CartStatus.ACTIVE) {\n      return cart as CartWithItems;\n    }\n  }\n\n  // Try to find existing cart\n  let cart = await findExistingCart(identifier);\n\n  // Create new cart if none exists\n  if (!cart) {\n    cart = await prisma.cart.create({\n      data: {\n        sessionId: sessionId || null,\n        userId: userId || null,\n        status: CartStatus.ACTIVE,\n      },\n      include: {\n        items: true,\n        discountCode: {\n          select: { id: true, code: true, type: true, value: true },\n        },\n      },\n    });\n  }\n\n  return cart as CartWithItems;\n}\n\n/**\n * Find existing active cart\n */\nasync function findExistingCart(\n  identifier: CartIdentifier\n): Promise<CartWithItems | null> {\n  const { sessionId, userId } = identifier;\n\n  // Prefer user cart over session cart\n  if (userId) {\n    const cart = await prisma.cart.findFirst({\n      where: {\n        userId,\n        status: CartStatus.ACTIVE,\n      },\n      include: {\n        items: {\n          orderBy: { createdAt: 'asc' },\n        },\n        discountCode: {\n          select: { id: true, code: true, type: true, value: true },\n        },\n      },\n    });\n    if (cart) return cart as CartWithItems;\n  }\n\n  // Fall back to session cart\n  if (sessionId) {\n    const cart = await prisma.cart.findUnique({\n      where: { sessionId },\n      include: {\n        items: {\n          orderBy: { createdAt: 'asc' },\n        },\n        discountCode: {\n          select: { id: true, code: true, type: true, value: true },\n        },\n      },\n    });\n    if (cart && cart.status === CartStatus.ACTIVE) {\n      return cart as CartWithItems;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Add item to cart\n */\nexport async function addToCart(\n  cartId: string,\n  item: CartItemInput\n): Promise<CartWithItems> {\n  const { productId, variantId, quantity } = item;\n\n  // Get product/variant info for snapshot\n  const product = await prisma.product.findUnique({\n    where: { id: productId },\n    include: {\n      variants: variantId ? { where: { id: variantId } } : false,\n      images: { take: 1, orderBy: { position: 'asc' }, include: { media: true } },\n    },\n  });\n\n  if (!product) {\n    throw new Error('Product not found');\n  }\n\n  const variant = variantId\n    ? await prisma.productVariant.findUnique({ where: { id: variantId } })\n    : null;\n\n  // Determine price (variant price or product basePrice)\n  const price = variant?.price ?? product.basePrice ?? 0;\n  const title = product.title;\n  const variantTitle = variant?.sku || null;\n  const imageUrl = product.images[0]?.media?.url || null;\n\n  // Check if item already exists in cart\n  const existingItem = await prisma.cartItem.findUnique({\n    where: {\n      cartId_productId_variantId: {\n        cartId,\n        productId,\n        variantId: variantId || '',\n      },\n    },\n  });\n\n  if (existingItem) {\n    // Update quantity\n    await prisma.cartItem.update({\n      where: { id: existingItem.id },\n      data: { quantity: existingItem.quantity + quantity },\n    });\n  } else {\n    // Create new item\n    await prisma.cartItem.create({\n      data: {\n        cartId,\n        productId,\n        variantId,\n        quantity,\n        title,\n        variantTitle,\n        price,\n        imageUrl,\n      },\n    });\n  }\n\n  // Recalculate totals and return updated cart\n  return recalculateCart(cartId);\n}\n\n/**\n * Update item quantity\n */\nexport async function updateCartItem(\n  cartId: string,\n  itemId: string,\n  quantity: number\n): Promise<CartWithItems> {\n  if (quantity <= 0) {\n    return removeFromCart(cartId, itemId);\n  }\n\n  await prisma.cartItem.update({\n    where: { id: itemId, cartId },\n    data: { quantity },\n  });\n\n  return recalculateCart(cartId);\n}\n\n/**\n * Remove item from cart\n */\nexport async function removeFromCart(\n  cartId: string,\n  itemId: string\n): Promise<CartWithItems> {\n  await prisma.cartItem.delete({\n    where: { id: itemId, cartId },\n  });\n\n  return recalculateCart(cartId);\n}\n\n/**\n * Clear all items from cart\n */\nexport async function clearCart(cartId: string): Promise<CartWithItems> {\n  await prisma.cartItem.deleteMany({\n    where: { cartId },\n  });\n\n  return recalculateCart(cartId);\n}\n\n/**\n * Apply discount code to cart\n */\nexport async function applyDiscount(\n  cartId: string,\n  code: string\n): Promise<{ cart: CartWithItems; error?: string }> {\n  // Find discount code\n  const discount = await prisma.discountCode.findUnique({\n    where: { code: code.toUpperCase() },\n  });\n\n  if (!discount) {\n    return {\n      cart: await getCartById(cartId),\n      error: 'Invalid discount code',\n    };\n  }\n\n  // Check if discount is enabled\n  if (!discount.enabled) {\n    return {\n      cart: await getCartById(cartId),\n      error: 'This discount code is no longer active',\n    };\n  }\n\n  // Check date validity\n  const now = new Date();\n  if (discount.startsAt && discount.startsAt > now) {\n    return {\n      cart: await getCartById(cartId),\n      error: 'This discount code is not yet active',\n    };\n  }\n  if (discount.expiresAt && discount.expiresAt < now) {\n    return {\n      cart: await getCartById(cartId),\n      error: 'This discount code has expired',\n    };\n  }\n\n  // Check usage limit\n  if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {\n    return {\n      cart: await getCartById(cartId),\n      error: 'This discount code has reached its usage limit',\n    };\n  }\n\n  // Apply discount to cart\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: { discountCodeId: discount.id },\n  });\n\n  const cart = await recalculateCart(cartId);\n\n  // Check minimum order value\n  if (discount.minOrderValue && cart.subtotal < discount.minOrderValue) {\n    // Remove discount if minimum not met\n    await prisma.cart.update({\n      where: { id: cartId },\n      data: { discountCodeId: null },\n    });\n\n    return {\n      cart: await recalculateCart(cartId),\n      error: `Minimum order value of $${(discount.minOrderValue / 100).toFixed(2)} required`,\n    };\n  }\n\n  return { cart };\n}\n\n/**\n * Remove discount from cart\n */\nexport async function removeDiscount(cartId: string): Promise<CartWithItems> {\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: { discountCodeId: null },\n  });\n\n  return recalculateCart(cartId);\n}\n\n/**\n * Update cart email (for guest abandonment recovery)\n */\nexport async function updateCartEmail(\n  cartId: string,\n  email: string\n): Promise<CartWithItems> {\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: { email },\n  });\n\n  return getCartById(cartId);\n}\n\n/**\n * Merge guest cart into user cart on login\n */\nexport async function mergeCartsOnLogin(\n  sessionId: string,\n  userId: string\n): Promise<CartWithItems | null> {\n  // Find guest cart\n  const guestCart = await prisma.cart.findUnique({\n    where: { sessionId },\n    include: { items: true },\n  });\n\n  if (!guestCart || guestCart.status !== CartStatus.ACTIVE) {\n    // No guest cart to merge, return user's existing cart if any\n    return findExistingCart({ userId });\n  }\n\n  // Find or create user cart\n  let userCart = await prisma.cart.findFirst({\n    where: { userId, status: CartStatus.ACTIVE },\n    include: { items: true },\n  });\n\n  if (!userCart) {\n    // Convert guest cart to user cart\n    await prisma.cart.update({\n      where: { id: guestCart.id },\n      data: {\n        userId,\n        sessionId: null, // Clear session ID\n      },\n    });\n    return getCartById(guestCart.id);\n  }\n\n  // Merge guest items into user cart\n  for (const guestItem of guestCart.items) {\n    const existingItem = userCart.items.find(\n      (item) =>\n        item.productId === guestItem.productId &&\n        item.variantId === guestItem.variantId\n    );\n\n    if (existingItem) {\n      // Update quantity\n      await prisma.cartItem.update({\n        where: { id: existingItem.id },\n        data: { quantity: existingItem.quantity + guestItem.quantity },\n      });\n    } else {\n      // Move item to user cart\n      await prisma.cartItem.update({\n        where: { id: guestItem.id },\n        data: { cartId: userCart.id },\n      });\n    }\n  }\n\n  // Mark guest cart as expired\n  await prisma.cart.update({\n    where: { id: guestCart.id },\n    data: { status: CartStatus.EXPIRED },\n  });\n\n  return recalculateCart(userCart.id);\n}\n\n/**\n * Mark cart as converted (after successful checkout)\n */\nexport async function convertCart(\n  cartId: string,\n  orderId: string\n): Promise<void> {\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: {\n      status: CartStatus.CONVERTED,\n      convertedToOrderId: orderId,\n    },\n  });\n}\n\n/**\n * Get cart by ID\n */\nasync function getCartById(cartId: string): Promise<CartWithItems> {\n  const cart = await prisma.cart.findUnique({\n    where: { id: cartId },\n    include: {\n      items: {\n        orderBy: { createdAt: 'asc' },\n      },\n      discountCode: {\n        select: { id: true, code: true, type: true, value: true },\n      },\n    },\n  });\n\n  if (!cart) {\n    throw new Error('Cart not found');\n  }\n\n  return cart as CartWithItems;\n}\n\n/**\n * Recalculate cart totals\n */\nasync function recalculateCart(cartId: string): Promise<CartWithItems> {\n  const cart = await prisma.cart.findUnique({\n    where: { id: cartId },\n    include: {\n      items: true,\n      discountCode: true,\n    },\n  });\n\n  if (!cart) {\n    throw new Error('Cart not found');\n  }\n\n  // Calculate subtotal\n  const subtotal = cart.items.reduce(\n    (sum, item) => sum + item.price * item.quantity,\n    0\n  );\n\n  // Calculate discount\n  let discountTotal = 0;\n  if (cart.discountCode) {\n    const discount = cart.discountCode;\n    if (discount.type === 'PERCENTAGE') {\n      discountTotal = Math.round(subtotal * (discount.value / 100));\n      // Apply max discount cap if set\n      if (discount.maxDiscount && discountTotal > discount.maxDiscount) {\n        discountTotal = discount.maxDiscount;\n      }\n    } else if (discount.type === 'FIXED') {\n      discountTotal = Math.min(discount.value, subtotal);\n    }\n    // FREE_SHIPPING handled separately\n  }\n\n  // Calculate total (tax and shipping calculated at checkout)\n  const total = Math.max(0, subtotal - discountTotal);\n\n  // Update cart totals\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: {\n      subtotal,\n      discountTotal,\n      total,\n      updatedAt: new Date(),\n    },\n  });\n\n  return getCartById(cartId);\n}\n\n// =============================================================================\n// ABANDONMENT TRACKING\n// =============================================================================\n\n/**\n * Mark carts as abandoned after timeout (called by scheduled job)\n */\nexport async function markAbandonedCarts(\n  timeoutMinutes: number = 60\n): Promise<number> {\n  const cutoffTime = new Date(Date.now() - timeoutMinutes * 60 * 1000);\n\n  const result = await prisma.cart.updateMany({\n    where: {\n      status: CartStatus.ACTIVE,\n      updatedAt: { lt: cutoffTime },\n      abandonedAt: null,\n      items: { some: {} }, // Has at least one item\n    },\n    data: {\n      status: CartStatus.ABANDONED,\n      abandonedAt: new Date(),\n    },\n  });\n\n  return result.count;\n}\n\n/**\n * Get abandoned carts for recovery emails\n */\nexport async function getAbandonedCartsForRecovery(\n  minAgeMinutes: number = 60,\n  maxAgeHours: number = 72\n): Promise<Array<CartWithItems & { email: string }>> {\n  const minAge = new Date(Date.now() - minAgeMinutes * 60 * 1000);\n  const maxAge = new Date(Date.now() - maxAgeHours * 60 * 60 * 1000);\n\n  const carts = await prisma.cart.findMany({\n    where: {\n      status: CartStatus.ABANDONED,\n      abandonedAt: {\n        gte: maxAge,\n        lte: minAge,\n      },\n      recoveryEmailAt: null,\n      email: { not: null },\n    },\n    include: {\n      items: {\n        orderBy: { createdAt: 'asc' },\n      },\n      discountCode: {\n        select: { id: true, code: true, type: true, value: true },\n      },\n    },\n  });\n\n  return carts.filter((cart) => cart.email !== null) as Array<\n    CartWithItems & { email: string }\n  >;\n}\n\n/**\n * Mark recovery email as sent\n */\nexport async function markRecoveryEmailSent(cartId: string): Promise<void> {\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: { recoveryEmailAt: new Date() },\n  });\n}\n\n/**\n * Mark cart as recovered (customer returned)\n */\nexport async function markCartRecovered(cartId: string): Promise<CartWithItems> {\n  await prisma.cart.update({\n    where: { id: cartId },\n    data: {\n      status: CartStatus.ACTIVE,\n      recoveredAt: new Date(),\n    },\n  });\n\n  return getCartById(cartId);\n}\n\n/**\n * Clean up expired carts (called by scheduled job)\n */\nexport async function cleanupExpiredCarts(\n  expiryDays: number = 30\n): Promise<number> {\n  const cutoffTime = new Date(Date.now() - expiryDays * 24 * 60 * 60 * 1000);\n\n  // Delete cart items first (cascade should handle this, but being explicit)\n  await prisma.cartItem.deleteMany({\n    where: {\n      cart: {\n        OR: [\n          { status: CartStatus.EXPIRED },\n          {\n            status: CartStatus.ABANDONED,\n            abandonedAt: { lt: cutoffTime },\n          },\n        ],\n      },\n    },\n  });\n\n  // Delete expired/old abandoned carts\n  const result = await prisma.cart.deleteMany({\n    where: {\n      OR: [\n        { status: CartStatus.EXPIRED },\n        {\n          status: CartStatus.ABANDONED,\n          abandonedAt: { lt: cutoffTime },\n        },\n      ],\n    },\n  });\n\n  return result.count;\n}\n\n/**\n * Get cart statistics for analytics\n */\nexport async function getCartStats(): Promise<{\n  activeCarts: number;\n  abandonedCarts: number;\n  recoveredCarts: number;\n  conversionRate: number;\n  averageCartValue: number;\n}> {\n  const [active, abandoned, recovered, converted, avgValue] = await Promise.all([\n    prisma.cart.count({ where: { status: CartStatus.ACTIVE } }),\n    prisma.cart.count({ where: { status: CartStatus.ABANDONED } }),\n    prisma.cart.count({ where: { recoveredAt: { not: null } } }),\n    prisma.cart.count({ where: { status: CartStatus.CONVERTED } }),\n    prisma.cart.aggregate({\n      where: { status: CartStatus.ACTIVE, total: { gt: 0 } },\n      _avg: { total: true },\n    }),\n  ]);\n\n  const totalWithItems = abandoned + converted + recovered;\n  const conversionRate = totalWithItems > 0 ? (converted / totalWithItems) * 100 : 0;\n\n  return {\n    activeCarts: active,\n    abandonedCarts: abandoned,\n    recoveredCarts: recovered,\n    conversionRate: Math.round(conversionRate * 100) / 100,\n    averageCartValue: avgValue._avg.total || 0,\n  };\n}\n","/**\n * Discount Code Validator\n *\n * Validates discount codes against all business rules\n */\n\nimport { prisma } from '../db';\nimport type { DiscountCode, DiscountUsage } from '@prisma/client';\n\nexport interface ValidationContext {\n  code: string;\n  subtotal: number; // Cart subtotal in cents\n  userId?: string | null;\n  email?: string | null;\n  isFirstOrder?: boolean;\n  items?: Array<{\n    productId: string;\n    categoryIds: string[];\n    quantity: number;\n    price: number; // Price per unit in cents\n    isOnSale?: boolean;\n  }>;\n}\n\nexport interface ValidationResult {\n  valid: boolean;\n  discount: DiscountCode | null;\n  error?: string;\n  errorCode?: ValidationErrorCode;\n}\n\nexport type ValidationErrorCode =\n  | 'NOT_FOUND'\n  | 'DISABLED'\n  | 'EXPIRED'\n  | 'NOT_STARTED'\n  | 'USAGE_LIMIT_REACHED'\n  | 'CUSTOMER_LIMIT_REACHED'\n  | 'MIN_ORDER_NOT_MET'\n  | 'FIRST_ORDER_ONLY'\n  | 'NO_APPLICABLE_ITEMS'\n  | 'EXCLUDED_ITEMS_ONLY';\n\n/**\n * Validate a discount code against all business rules\n */\nexport async function validateDiscountCode(\n  context: ValidationContext\n): Promise<ValidationResult> {\n  const { code, subtotal, userId, email, isFirstOrder, items } = context;\n\n  // 1. Find the discount code\n  const discount = await prisma.discountCode.findUnique({\n    where: { code: code.toUpperCase().trim() },\n  });\n\n  if (!discount) {\n    return {\n      valid: false,\n      discount: null,\n      error: 'Invalid discount code',\n      errorCode: 'NOT_FOUND',\n    };\n  }\n\n  // 2. Check if enabled\n  if (!discount.enabled) {\n    return {\n      valid: false,\n      discount: null,\n      error: 'This discount code is no longer active',\n      errorCode: 'DISABLED',\n    };\n  }\n\n  // 3. Check validity period\n  const now = new Date();\n  if (discount.startsAt > now) {\n    return {\n      valid: false,\n      discount: null,\n      error: 'This discount code is not yet active',\n      errorCode: 'NOT_STARTED',\n    };\n  }\n\n  if (discount.expiresAt && discount.expiresAt < now) {\n    return {\n      valid: false,\n      discount: null,\n      error: 'This discount code has expired',\n      errorCode: 'EXPIRED',\n    };\n  }\n\n  // 4. Check total usage limit\n  if (discount.usageLimit !== null && discount.usageCount >= discount.usageLimit) {\n    return {\n      valid: false,\n      discount: null,\n      error: 'This discount code has reached its usage limit',\n      errorCode: 'USAGE_LIMIT_REACHED',\n    };\n  }\n\n  // 5. Check per-customer limit\n  if (discount.perCustomer !== null && (userId || email)) {\n    const customerUsageCount = await prisma.discountUsage.count({\n      where: {\n        discountCodeId: discount.id,\n        OR: [\n          ...(userId ? [{ userId }] : []),\n          ...(email ? [{ email }] : []),\n        ],\n      },\n    });\n\n    if (customerUsageCount >= discount.perCustomer) {\n      return {\n        valid: false,\n        discount: null,\n        error: 'You have already used this discount code the maximum number of times',\n        errorCode: 'CUSTOMER_LIMIT_REACHED',\n      };\n    }\n  }\n\n  // 6. Check minimum order value\n  if (discount.minOrderValue !== null && subtotal < discount.minOrderValue) {\n    const minAmount = (discount.minOrderValue / 100).toFixed(2);\n    return {\n      valid: false,\n      discount: null,\n      error: `Minimum order of $${minAmount} required for this discount`,\n      errorCode: 'MIN_ORDER_NOT_MET',\n    };\n  }\n\n  // 7. Check first order only\n  if (discount.firstOrderOnly && !isFirstOrder) {\n    return {\n      valid: false,\n      discount: null,\n      error: 'This discount code is only valid for first orders',\n      errorCode: 'FIRST_ORDER_ONLY',\n    };\n  }\n\n  // 8. Check applicability to items (for PRODUCT and CATEGORY apply types)\n  if (items && items.length > 0 && discount.applyTo !== 'ORDER' && discount.applyTo !== 'SHIPPING') {\n    const applicableItems = getApplicableItems(discount, items);\n\n    if (applicableItems.length === 0) {\n      return {\n        valid: false,\n        discount: null,\n        error: 'This discount code does not apply to any items in your cart',\n        errorCode: 'NO_APPLICABLE_ITEMS',\n      };\n    }\n  }\n\n  return {\n    valid: true,\n    discount,\n  };\n}\n\n/**\n * Get items that a discount applies to\n */\nexport function getApplicableItems(\n  discount: DiscountCode,\n  items: Array<{\n    productId: string;\n    categoryIds: string[];\n    quantity: number;\n    price: number;\n    isOnSale?: boolean;\n  }>\n): typeof items {\n  return items.filter((item) => {\n    // Check if item is excluded\n    if (discount.excludeProductIds.includes(item.productId)) {\n      return false;\n    }\n\n    // Check if sale items are excluded\n    if (discount.excludeSaleItems && item.isOnSale) {\n      return false;\n    }\n\n    // For ORDER type, all items apply\n    if (discount.applyTo === 'ORDER') {\n      return true;\n    }\n\n    // For PRODUCT type, check product IDs\n    if (discount.applyTo === 'PRODUCT') {\n      return discount.productIds.length === 0 || discount.productIds.includes(item.productId);\n    }\n\n    // For CATEGORY type, check category IDs\n    if (discount.applyTo === 'CATEGORY') {\n      if (discount.categoryIds.length === 0) return true;\n      return item.categoryIds.some((catId) => discount.categoryIds.includes(catId));\n    }\n\n    // For SHIPPING type, no items apply (discount is on shipping)\n    if (discount.applyTo === 'SHIPPING') {\n      return false;\n    }\n\n    return false;\n  });\n}\n\n/**\n * Check if user is making their first order\n */\nexport async function isFirstOrderForUser(\n  userId?: string | null,\n  email?: string | null\n): Promise<boolean> {\n  if (!userId && !email) {\n    return true; // Guest with no email - assume first order\n  }\n\n  const existingOrders = await prisma.order.count({\n    where: {\n      OR: [\n        ...(userId ? [{ customerId: userId }] : []),\n        ...(email ? [{ email }] : []),\n      ],\n      paymentStatus: 'PAID',\n    },\n  });\n\n  return existingOrders === 0;\n}\n\n/**\n * Record discount usage after order is placed\n */\nexport async function recordDiscountUsage(\n  discountCodeId: string,\n  orderId: string,\n  userId: string | null,\n  email: string,\n  discountAmount: number\n): Promise<DiscountUsage> {\n  // Create usage record and update discount stats in a transaction\n  const [usage] = await prisma.$transaction([\n    prisma.discountUsage.create({\n      data: {\n        discountCodeId,\n        orderId,\n        userId,\n        email,\n        discountAmount,\n      },\n    }),\n    prisma.discountCode.update({\n      where: { id: discountCodeId },\n      data: {\n        usageCount: { increment: 1 },\n        ordersCount: { increment: 1 },\n        revenue: { increment: discountAmount },\n      },\n    }),\n  ]);\n\n  return usage;\n}\n","/**\n * Discount Calculator\n *\n * Calculates discount amounts for carts and orders\n */\n\nimport type { DiscountCode } from '@prisma/client';\nimport { getApplicableItems } from './validator';\n\nexport interface CartItem {\n  productId: string;\n  variantId?: string;\n  categoryIds: string[];\n  name?: string; // Optional - not always provided in validation context\n  quantity: number;\n  price: number; // Price per unit in cents\n  isOnSale?: boolean;\n}\n\nexport interface CartTotals {\n  subtotal: number; // Sum of item prices in cents\n  shippingTotal: number; // Shipping cost in cents\n}\n\nexport interface DiscountCalculation {\n  discountAmount: number; // Total discount in cents\n  discountedSubtotal: number; // Subtotal after discount\n  discountedShipping: number; // Shipping after discount\n  appliedTo: 'order' | 'products' | 'categories' | 'shipping';\n  itemDiscounts: Array<{\n    productId: string;\n    variantId?: string;\n    originalPrice: number;\n    discountAmount: number;\n    finalPrice: number;\n  }>;\n  description: string; // Human-readable discount description\n}\n\n/**\n * Calculate discount amount for a cart\n */\nexport function calculateDiscount(\n  discount: DiscountCode,\n  items: CartItem[],\n  totals: CartTotals\n): DiscountCalculation {\n  const { subtotal, shippingTotal } = totals;\n\n  // Handle FREE_SHIPPING type\n  if (discount.type === 'FREE_SHIPPING') {\n    return {\n      discountAmount: shippingTotal,\n      discountedSubtotal: subtotal,\n      discountedShipping: 0,\n      appliedTo: 'shipping',\n      itemDiscounts: [],\n      description: 'Free Shipping',\n    };\n  }\n\n  // Get applicable items for the discount\n  const applicableItems = discount.applyTo === 'SHIPPING'\n    ? []\n    : getApplicableItems(discount, items);\n\n  // Calculate base amount for discount\n  const applicableSubtotal =\n    discount.applyTo === 'ORDER'\n      ? subtotal\n      : applicableItems.reduce((sum, item) => sum + item.price * item.quantity, 0);\n\n  if (applicableSubtotal === 0) {\n    return {\n      discountAmount: 0,\n      discountedSubtotal: subtotal,\n      discountedShipping: shippingTotal,\n      appliedTo: mapApplyTo(discount.applyTo),\n      itemDiscounts: [],\n      description: 'No applicable items',\n    };\n  }\n\n  // Calculate raw discount amount\n  let rawDiscount = 0;\n  let description = '';\n\n  switch (discount.type) {\n    case 'PERCENTAGE':\n      rawDiscount = Math.floor((applicableSubtotal * discount.value) / 100);\n      description = `${discount.value}% off`;\n      break;\n\n    case 'FIXED':\n      rawDiscount = discount.value;\n      description = `$${(discount.value / 100).toFixed(2)} off`;\n      break;\n\n    case 'BUY_X_GET_Y':\n      // For BUY_X_GET_Y, value represents the discount on Y items\n      // This is a simplified implementation\n      rawDiscount = calculateBuyXGetYDiscount(discount, applicableItems);\n      description = 'Buy X Get Y promotion';\n      break;\n\n    default:\n      rawDiscount = 0;\n      description = 'Unknown discount type';\n  }\n\n  // Apply maximum discount cap\n  let discountAmount = rawDiscount;\n  if (discount.maxDiscount !== null && discountAmount > discount.maxDiscount) {\n    discountAmount = discount.maxDiscount;\n    description += ` (max $${(discount.maxDiscount / 100).toFixed(2)})`;\n  }\n\n  // Ensure discount doesn't exceed applicable amount\n  discountAmount = Math.min(discountAmount, applicableSubtotal);\n\n  // Calculate per-item discounts for display\n  const itemDiscounts = calculateItemDiscounts(\n    discount,\n    applicableItems,\n    discountAmount,\n    applicableSubtotal\n  );\n\n  return {\n    discountAmount,\n    discountedSubtotal: subtotal - discountAmount,\n    discountedShipping: shippingTotal,\n    appliedTo: mapApplyTo(discount.applyTo),\n    itemDiscounts,\n    description,\n  };\n}\n\n/**\n * Calculate BUY_X_GET_Y discount\n * This is a simplified implementation - value represents the discount percentage on Y\n */\nfunction calculateBuyXGetYDiscount(\n  discount: DiscountCode,\n  items: CartItem[]\n): number {\n  // Simple implementation: every 3rd item is discounted by value%\n  // Can be enhanced with more complex BuyX/GetY config\n  let totalDiscount = 0;\n\n  for (const item of items) {\n    const freeItems = Math.floor(item.quantity / 3);\n    const itemDiscount = Math.floor((item.price * freeItems * discount.value) / 100);\n    totalDiscount += itemDiscount;\n  }\n\n  return totalDiscount;\n}\n\n/**\n * Calculate per-item discount breakdown\n */\nfunction calculateItemDiscounts(\n  discount: DiscountCode,\n  applicableItems: CartItem[],\n  totalDiscount: number,\n  applicableSubtotal: number\n): DiscountCalculation['itemDiscounts'] {\n  if (applicableSubtotal === 0) return [];\n\n  return applicableItems.map((item) => {\n    const itemTotal = item.price * item.quantity;\n    // Distribute discount proportionally\n    const itemDiscount = Math.floor((itemTotal / applicableSubtotal) * totalDiscount);\n\n    return {\n      productId: item.productId,\n      variantId: item.variantId,\n      originalPrice: itemTotal,\n      discountAmount: itemDiscount,\n      finalPrice: itemTotal - itemDiscount,\n    };\n  });\n}\n\n/**\n * Map applyTo enum to simplified type\n */\nfunction mapApplyTo(applyTo: string): 'order' | 'products' | 'categories' | 'shipping' {\n  switch (applyTo) {\n    case 'ORDER':\n      return 'order';\n    case 'PRODUCT':\n      return 'products';\n    case 'CATEGORY':\n      return 'categories';\n    case 'SHIPPING':\n      return 'shipping';\n    default:\n      return 'order';\n  }\n}\n\n/**\n * Format discount for display\n */\nexport function formatDiscount(discount: DiscountCode): string {\n  switch (discount.type) {\n    case 'PERCENTAGE':\n      return `${discount.value}% off`;\n    case 'FIXED':\n      return `$${(discount.value / 100).toFixed(2)} off`;\n    case 'FREE_SHIPPING':\n      return 'Free Shipping';\n    case 'BUY_X_GET_Y':\n      return 'Special Promotion';\n    default:\n      return discount.code;\n  }\n}\n\n/**\n * Get discount code summary for display\n */\nexport function getDiscountSummary(discount: DiscountCode): {\n  type: string;\n  value: string;\n  conditions: string[];\n} {\n  const conditions: string[] = [];\n\n  if (discount.minOrderValue) {\n    conditions.push(`Min order: $${(discount.minOrderValue / 100).toFixed(2)}`);\n  }\n\n  if (discount.maxDiscount) {\n    conditions.push(`Max discount: $${(discount.maxDiscount / 100).toFixed(2)}`);\n  }\n\n  if (discount.usageLimit) {\n    conditions.push(`${discount.usageLimit - discount.usageCount} uses remaining`);\n  }\n\n  if (discount.firstOrderOnly) {\n    conditions.push('First order only');\n  }\n\n  if (discount.expiresAt) {\n    const expires = new Date(discount.expiresAt);\n    conditions.push(`Expires: ${expires.toLocaleDateString()}`);\n  }\n\n  if (discount.applyTo === 'PRODUCT' && discount.productIds.length > 0) {\n    conditions.push('Specific products only');\n  }\n\n  if (discount.applyTo === 'CATEGORY' && discount.categoryIds.length > 0) {\n    conditions.push('Specific categories only');\n  }\n\n  if (discount.excludeSaleItems) {\n    conditions.push('Excludes sale items');\n  }\n\n  return {\n    type: discount.type,\n    value: formatDiscount(discount),\n    conditions,\n  };\n}\n\n/**\n * Calculate the final cart total with discount applied\n */\nexport function calculateCartTotals(\n  items: CartItem[],\n  shippingTotal: number,\n  taxRate: number,\n  discount: DiscountCode | null\n): {\n  subtotal: number;\n  discountTotal: number;\n  discountedSubtotal: number;\n  shippingTotal: number;\n  taxTotal: number;\n  total: number;\n  discountDescription: string | null;\n} {\n  const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n\n  let discountTotal = 0;\n  let discountedSubtotal = subtotal;\n  let discountedShipping = shippingTotal;\n  let discountDescription: string | null = null;\n\n  if (discount) {\n    const calculation = calculateDiscount(discount, items, { subtotal, shippingTotal });\n    discountTotal = calculation.discountAmount;\n    discountedSubtotal = calculation.discountedSubtotal;\n    discountedShipping = calculation.discountedShipping;\n    discountDescription = calculation.description;\n  }\n\n  // Calculate tax on discounted subtotal\n  const taxTotal = Math.floor((discountedSubtotal * taxRate) / 100);\n\n  // Final total\n  const total = discountedSubtotal + discountedShipping + taxTotal;\n\n  return {\n    subtotal,\n    discountTotal,\n    discountedSubtotal,\n    shippingTotal: discountedShipping,\n    taxTotal,\n    total,\n    discountDescription,\n  };\n}\n","/**\n * Stripe Discount Sync\n *\n * Syncs discount codes with Stripe coupons and promotion codes\n */\n\nimport Stripe from 'stripe';\nimport { prisma } from '../db';\nimport { getStripeSettings } from '../stripe';\nimport type { DiscountCode, DiscountType } from '@prisma/client';\n\n// Stripe client cache\nlet stripeClient: Stripe | null = null;\n\nasync function getStripeClient(): Promise<Stripe> {\n  const settings = await getStripeSettings();\n\n  const secretKey = settings.secretKey || process.env.STRIPE_SECRET_KEY;\n  if (!secretKey) {\n    throw new Error('Stripe secret key not configured');\n  }\n\n  if (!stripeClient) {\n    stripeClient = new Stripe(secretKey, { apiVersion: '2025-02-24.acacia' });\n  }\n  return stripeClient;\n}\n\n/**\n * Convert our discount type to Stripe coupon params\n */\nfunction mapDiscountToStripeCoupon(discount: DiscountCode): Stripe.CouponCreateParams {\n  const metadata: Record<string, string> = {\n    discountCodeId: discount.id,\n    source: 'nextjs-cms',\n  };\n\n  const params: Stripe.CouponCreateParams = {\n    name: discount.code,\n    metadata,\n  };\n\n  // Map discount type\n  switch (discount.type) {\n    case 'PERCENTAGE':\n      params.percent_off = discount.value;\n      break;\n    case 'FIXED':\n      params.amount_off = discount.value;\n      params.currency = 'usd'; // TODO: Get from settings\n      break;\n    case 'FREE_SHIPPING':\n      // Stripe doesn't have native free shipping coupons\n      // We use a 0% coupon and handle shipping separately\n      params.percent_off = 0;\n      metadata.freeShipping = 'true';\n      break;\n    case 'BUY_X_GET_Y':\n      // BuyXGetY is complex - use percentage for simplicity\n      params.percent_off = discount.value;\n      metadata.buyXGetY = 'true';\n      break;\n  }\n\n  // Set duration\n  if (discount.expiresAt) {\n    params.redeem_by = Math.floor(discount.expiresAt.getTime() / 1000);\n  }\n\n  // Set max redemptions\n  if (discount.usageLimit) {\n    params.max_redemptions = discount.usageLimit;\n  }\n\n  return params;\n}\n\n/**\n * Create a Stripe coupon from a discount code\n */\nexport async function createStripeCoupon(discountId: string): Promise<string> {\n  const stripe = await getStripeClient();\n\n  const discount = await prisma.discountCode.findUnique({\n    where: { id: discountId },\n  });\n\n  if (!discount) {\n    throw new Error('Discount code not found');\n  }\n\n  // Create the coupon\n  const couponParams = mapDiscountToStripeCoupon(discount);\n  const coupon = await stripe.coupons.create(couponParams);\n\n  // Update discount with Stripe coupon ID\n  await prisma.discountCode.update({\n    where: { id: discountId },\n    data: {\n      stripeCouponId: coupon.id,\n      stripeSyncedAt: new Date(),\n    },\n  });\n\n  return coupon.id;\n}\n\n/**\n * Create a Stripe promotion code from a discount code\n * Promotion codes are customer-facing codes that reference coupons\n */\nexport async function createStripePromotionCode(discountId: string): Promise<string> {\n  const stripe = await getStripeClient();\n\n  const discount = await prisma.discountCode.findUnique({\n    where: { id: discountId },\n  });\n\n  if (!discount) {\n    throw new Error('Discount code not found');\n  }\n\n  // Ensure we have a Stripe coupon first\n  let stripeCouponId = discount.stripeCouponId;\n  if (!stripeCouponId) {\n    stripeCouponId = await createStripeCoupon(discountId);\n  }\n\n  // Create promotion code params\n  const promoParams: Stripe.PromotionCodeCreateParams = {\n    coupon: stripeCouponId,\n    code: discount.code,\n    active: discount.enabled,\n    metadata: {\n      discountCodeId: discount.id,\n      source: 'nextjs-cms',\n    },\n  };\n\n  // Set restrictions\n  const restrictions: Stripe.PromotionCodeCreateParams.Restrictions = {};\n\n  if (discount.minOrderValue) {\n    restrictions.minimum_amount = discount.minOrderValue;\n    restrictions.minimum_amount_currency = 'usd';\n  }\n\n  if (discount.firstOrderOnly) {\n    restrictions.first_time_transaction = true;\n  }\n\n  if (Object.keys(restrictions).length > 0) {\n    promoParams.restrictions = restrictions;\n  }\n\n  // Set max redemptions\n  if (discount.usageLimit) {\n    promoParams.max_redemptions = discount.usageLimit;\n  }\n\n  // Set expiration\n  if (discount.expiresAt) {\n    promoParams.expires_at = Math.floor(discount.expiresAt.getTime() / 1000);\n  }\n\n  const promotionCode = await stripe.promotionCodes.create(promoParams);\n\n  // Update discount with Stripe promotion code ID\n  await prisma.discountCode.update({\n    where: { id: discountId },\n    data: {\n      stripePromotionCodeId: promotionCode.id,\n      stripeSyncedAt: new Date(),\n    },\n  });\n\n  return promotionCode.id;\n}\n\n/**\n * Sync a discount code to Stripe (create or update)\n */\nexport async function syncDiscountToStripe(discountId: string): Promise<{\n  couponId: string;\n  promotionCodeId: string;\n}> {\n  const stripe = await getStripeClient();\n\n  const discount = await prisma.discountCode.findUnique({\n    where: { id: discountId },\n  });\n\n  if (!discount) {\n    throw new Error('Discount code not found');\n  }\n\n  if (!discount.stripeSyncEnabled) {\n    throw new Error('Stripe sync is disabled for this discount');\n  }\n\n  let couponId = discount.stripeCouponId;\n  let promotionCodeId = discount.stripePromotionCodeId;\n\n  // Update existing coupon or create new one\n  if (couponId) {\n    try {\n      // Coupons can only update name and metadata\n      await stripe.coupons.update(couponId, {\n        name: discount.code,\n        metadata: {\n          discountCodeId: discount.id,\n          source: 'nextjs-cms',\n          updatedAt: new Date().toISOString(),\n        },\n      });\n    } catch (error) {\n      // Coupon might have been deleted in Stripe - create new one\n      console.log('Stripe coupon not found, creating new one');\n      couponId = await createStripeCoupon(discountId);\n    }\n  } else {\n    couponId = await createStripeCoupon(discountId);\n  }\n\n  // Update existing promotion code or create new one\n  if (promotionCodeId) {\n    try {\n      await stripe.promotionCodes.update(promotionCodeId, {\n        active: discount.enabled,\n        metadata: {\n          discountCodeId: discount.id,\n          source: 'nextjs-cms',\n          updatedAt: new Date().toISOString(),\n        },\n      });\n    } catch (error) {\n      // Promotion code might have been deleted - create new one\n      console.log('Stripe promotion code not found, creating new one');\n      promotionCodeId = await createStripePromotionCode(discountId);\n    }\n  } else {\n    promotionCodeId = await createStripePromotionCode(discountId);\n  }\n\n  // Update sync timestamp\n  await prisma.discountCode.update({\n    where: { id: discountId },\n    data: { stripeSyncedAt: new Date() },\n  });\n\n  return { couponId, promotionCodeId: promotionCodeId! };\n}\n\n/**\n * Delete Stripe coupon and promotion code for a discount\n */\nexport async function deleteStripeDiscount(discountId: string): Promise<void> {\n  const stripe = await getStripeClient();\n\n  const discount = await prisma.discountCode.findUnique({\n    where: { id: discountId },\n  });\n\n  if (!discount) {\n    return;\n  }\n\n  // Deactivate promotion code (can't delete, only deactivate)\n  if (discount.stripePromotionCodeId) {\n    try {\n      await stripe.promotionCodes.update(discount.stripePromotionCodeId, {\n        active: false,\n      });\n    } catch (error) {\n      console.error('Failed to deactivate Stripe promotion code:', error);\n    }\n  }\n\n  // Delete coupon\n  if (discount.stripeCouponId) {\n    try {\n      await stripe.coupons.del(discount.stripeCouponId);\n    } catch (error) {\n      console.error('Failed to delete Stripe coupon:', error);\n    }\n  }\n\n  // Clear Stripe IDs\n  await prisma.discountCode.update({\n    where: { id: discountId },\n    data: {\n      stripeCouponId: null,\n      stripePromotionCodeId: null,\n      stripeSyncedAt: null,\n    },\n  });\n}\n\n/**\n * Toggle promotion code active status in Stripe\n */\nexport async function toggleStripePromotionCode(\n  discountId: string,\n  active: boolean\n): Promise<void> {\n  const stripe = await getStripeClient();\n\n  const discount = await prisma.discountCode.findUnique({\n    where: { id: discountId },\n  });\n\n  if (!discount?.stripePromotionCodeId) {\n    return;\n  }\n\n  await stripe.promotionCodes.update(discount.stripePromotionCodeId, {\n    active,\n  });\n}\n\n/**\n * Import a Stripe coupon/promotion code into our system\n */\nexport async function importFromStripe(promotionCodeId: string): Promise<string> {\n  const stripe = await getStripeClient();\n\n  // Get promotion code with coupon\n  const promotionCode = await stripe.promotionCodes.retrieve(promotionCodeId, {\n    expand: ['coupon'],\n  });\n\n  const coupon = promotionCode.coupon as Stripe.Coupon;\n\n  // Check if already imported\n  const existing = await prisma.discountCode.findFirst({\n    where: {\n      OR: [\n        { stripePromotionCodeId: promotionCodeId },\n        { stripeCouponId: coupon.id },\n        { code: promotionCode.code },\n      ],\n    },\n  });\n\n  if (existing) {\n    throw new Error(`Discount code already exists: ${existing.code}`);\n  }\n\n  // Determine discount type\n  let type: DiscountType = 'PERCENTAGE';\n  let value = 0;\n\n  if (coupon.percent_off) {\n    type = 'PERCENTAGE';\n    value = coupon.percent_off;\n  } else if (coupon.amount_off) {\n    type = 'FIXED';\n    value = coupon.amount_off;\n  }\n\n  // Check metadata for special types\n  if (coupon.metadata?.freeShipping === 'true') {\n    type = 'FREE_SHIPPING';\n  }\n\n  // Create discount code\n  const discount = await prisma.discountCode.create({\n    data: {\n      code: promotionCode.code,\n      description: coupon.name || `Imported from Stripe: ${promotionCode.code}`,\n      type,\n      value,\n      minOrderValue: promotionCode.restrictions?.minimum_amount || null,\n      usageLimit: promotionCode.max_redemptions || null,\n      usageCount: promotionCode.times_redeemed || 0,\n      firstOrderOnly: promotionCode.restrictions?.first_time_transaction || false,\n      startsAt: new Date(),\n      expiresAt: promotionCode.expires_at\n        ? new Date(promotionCode.expires_at * 1000)\n        : null,\n      enabled: promotionCode.active,\n      stripeCouponId: coupon.id,\n      stripePromotionCodeId: promotionCodeId,\n      stripeSyncEnabled: true,\n      stripeSyncedAt: new Date(),\n    },\n  });\n\n  return discount.id;\n}\n\n/**\n * Get Stripe coupons not yet imported\n */\nexport async function listUnimportedStripeCoupons(): Promise<\n  Array<{\n    id: string;\n    name: string | null;\n    percentOff: number | null;\n    amountOff: number | null;\n    currency: string | null;\n    valid: boolean;\n  }>\n> {\n  const stripe = await getStripeClient();\n\n  // Get all coupons from Stripe\n  const coupons = await stripe.coupons.list({ limit: 100 });\n\n  // Get already imported coupon IDs\n  const importedCoupons = await prisma.discountCode.findMany({\n    where: { stripeCouponId: { not: null } },\n    select: { stripeCouponId: true },\n  });\n\n  const importedIds = new Set(importedCoupons.map((d) => d.stripeCouponId));\n\n  // Filter out already imported\n  return coupons.data\n    .filter((c) => !importedIds.has(c.id))\n    .map((c) => ({\n      id: c.id,\n      name: c.name,\n      percentOff: c.percent_off,\n      amountOff: c.amount_off,\n      currency: c.currency,\n      valid: c.valid,\n    }));\n}\n\n/**\n * Validate a promotion code in Stripe\n */\nexport async function validateStripePromotionCode(\n  code: string\n): Promise<{\n  valid: boolean;\n  promotionCodeId?: string;\n  couponId?: string;\n  percentOff?: number;\n  amountOff?: number;\n  error?: string;\n}> {\n  const stripe = await getStripeClient();\n\n  try {\n    // Search for the promotion code\n    const promotionCodes = await stripe.promotionCodes.list({\n      code,\n      active: true,\n      limit: 1,\n    });\n\n    if (promotionCodes.data.length === 0) {\n      return { valid: false, error: 'Promotion code not found' };\n    }\n\n    const promoCode = promotionCodes.data[0];\n    const coupon = promoCode.coupon as Stripe.Coupon;\n\n    if (!coupon.valid) {\n      return { valid: false, error: 'Coupon is no longer valid' };\n    }\n\n    return {\n      valid: true,\n      promotionCodeId: promoCode.id,\n      couponId: coupon.id,\n      percentOff: coupon.percent_off || undefined,\n      amountOff: coupon.amount_off || undefined,\n    };\n  } catch (error) {\n    return {\n      valid: false,\n      error: error instanceof Error ? error.message : 'Validation failed',\n    };\n  }\n}\n","/**\n * Stripe Integration Library\n *\n * Provides payment processing, subscriptions, and billing management\n */\n\nimport Stripe from 'stripe'\nimport { prisma } from '../db'\nimport type {\n  StripeSettings,\n  CreateCheckoutSessionRequest,\n  CreatePaymentIntentRequest,\n  CreateCustomerRequest,\n  CreateSubscriptionRequest,\n  CreateRefundRequest,\n  CheckoutSessionResponse,\n  PaymentIntentResponse,\n  RefundResponse,\n} from './types'\nimport { DEFAULT_STRIPE_SETTINGS } from './types'\n\n// Cache for settings\nlet settingsCache: StripeSettings | null = null\nlet settingsCacheTime = 0\nconst SETTINGS_CACHE_TTL = 60 * 1000 // 1 minute\n\n// Get Stripe client instance\nlet stripeClient: Stripe | null = null\n\nasync function getStripeClient(): Promise<Stripe> {\n  const settings = await getStripeSettings()\n\n  if (!settings.secretKey) {\n    // Fallback to environment variable\n    const envKey = process.env.STRIPE_SECRET_KEY\n    if (!envKey) {\n      throw new Error('Stripe secret key not configured')\n    }\n    if (!stripeClient) {\n      stripeClient = new Stripe(envKey, { apiVersion: '2025-02-24.acacia' })\n    }\n    return stripeClient\n  }\n\n  // Create new client if key changed\n  stripeClient = new Stripe(settings.secretKey, { apiVersion: '2025-02-24.acacia' })\n  return stripeClient\n}\n\n/**\n * Get Stripe settings from database\n */\nexport async function getStripeSettings(): Promise<StripeSettings> {\n  const now = Date.now()\n  if (settingsCache && now - settingsCacheTime < SETTINGS_CACHE_TTL) {\n    return settingsCache\n  }\n\n  const settingRecords = await prisma.setting.findMany({\n    where: {\n      key: { startsWith: 'stripe.' },\n    },\n  })\n\n  const settings: StripeSettings = { ...DEFAULT_STRIPE_SETTINGS }\n\n  for (const record of settingRecords) {\n    const key = record.key.replace('stripe.', '')\n    switch (key) {\n      case 'enabled':\n        settings.enabled = record.value === 'true'\n        break\n      case 'testMode':\n        settings.testMode = record.value === 'true'\n        break\n      case 'secretKey':\n        settings.secretKey = record.value\n        break\n      case 'publishableKey':\n        settings.publishableKey = record.value\n        break\n      case 'webhookSecret':\n        settings.webhookSecret = record.value\n        break\n      case 'currency':\n        settings.currency = record.value\n        break\n      case 'statementDescriptor':\n        settings.statementDescriptor = record.value\n        break\n      case 'supportedPaymentMethods':\n        settings.supportedPaymentMethods = JSON.parse(record.value)\n        break\n      case 'automaticTax':\n        settings.automaticTax = record.value === 'true'\n        break\n      case 'billingAddressCollection':\n        settings.billingAddressCollection = record.value as 'auto' | 'required'\n        break\n    }\n  }\n\n  // Use environment variables as fallback\n  if (!settings.secretKey) {\n    settings.secretKey = process.env.STRIPE_SECRET_KEY\n  }\n  if (!settings.publishableKey) {\n    settings.publishableKey = process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY\n  }\n  if (!settings.webhookSecret) {\n    settings.webhookSecret = process.env.STRIPE_WEBHOOK_SECRET\n  }\n\n  settingsCache = settings\n  settingsCacheTime = now\n\n  return settings\n}\n\n/**\n * Clear settings cache\n */\nexport function clearStripeSettingsCache(): void {\n  settingsCache = null\n  settingsCacheTime = 0\n  stripeClient = null\n}\n\n/**\n * Create a Stripe Checkout Session\n */\nexport async function createCheckoutSession(\n  request: CreateCheckoutSessionRequest\n): Promise<CheckoutSessionResponse> {\n  const stripe = await getStripeClient()\n  const settings = await getStripeSettings()\n\n  const lineItems: Stripe.Checkout.SessionCreateParams.LineItem[] = request.items.map((item) => {\n    // Use existing Stripe price if available\n    if (item.stripePriceId) {\n      return {\n        price: item.stripePriceId,\n        quantity: item.quantity,\n      }\n    }\n\n    // Fall back to inline pricing\n    return {\n      price_data: {\n        currency: settings.currency,\n        product_data: {\n          name: item.name,\n          description: item.description,\n          images: item.images,\n          metadata: item.productId ? { productId: item.productId } : undefined,\n        },\n        unit_amount: item.price,\n      },\n      quantity: item.quantity,\n    }\n  })\n\n  const sessionParams: Stripe.Checkout.SessionCreateParams = {\n    mode: request.mode || 'payment',\n    line_items: lineItems,\n    success_url: request.successUrl,\n    cancel_url: request.cancelUrl,\n    customer_email: request.customerEmail,\n    allow_promotion_codes: request.allowPromotionCodes,\n    billing_address_collection: settings.billingAddressCollection,\n    metadata: {\n      ...request.metadata,\n      orderId: request.orderId || '',\n    },\n  }\n\n  // Add customer if provided\n  if (request.customerId) {\n    sessionParams.customer = request.customerId\n    delete sessionParams.customer_email\n  }\n\n  // Add shipping options\n  if (request.shippingAddressCollection) {\n    sessionParams.shipping_address_collection = {\n      allowed_countries: ['US', 'CA', 'GB', 'AU', 'DE', 'FR'],\n    }\n  }\n\n  if (request.shippingOptions && request.shippingOptions.length > 0) {\n    sessionParams.shipping_options = request.shippingOptions.map((option) => ({\n      shipping_rate_data: {\n        type: 'fixed_amount' as const,\n        fixed_amount: {\n          amount: option.amount,\n          currency: settings.currency,\n        },\n        display_name: option.displayName,\n        delivery_estimate: option.deliveryEstimate,\n      },\n    }))\n  }\n\n  // Enable automatic tax if configured\n  if (settings.automaticTax) {\n    sessionParams.automatic_tax = { enabled: true }\n  }\n\n  // Set payment method types\n  if (settings.supportedPaymentMethods.length > 0) {\n    sessionParams.payment_method_types = settings.supportedPaymentMethods as Stripe.Checkout.SessionCreateParams.PaymentMethodType[]\n  }\n\n  const session = await stripe.checkout.sessions.create(sessionParams)\n\n  return {\n    sessionId: session.id,\n    url: session.url!,\n  }\n}\n\n/**\n * Create a Payment Intent for custom payment flows\n */\nexport async function createPaymentIntent(\n  request: CreatePaymentIntentRequest\n): Promise<PaymentIntentResponse> {\n  const stripe = await getStripeClient()\n  const settings = await getStripeSettings()\n\n  const params: Stripe.PaymentIntentCreateParams = {\n    amount: request.amount,\n    currency: request.currency || settings.currency,\n    capture_method: request.captureMethod || 'automatic',\n    metadata: {\n      ...request.metadata,\n      orderId: request.orderId || '',\n    },\n  }\n\n  if (request.customerId) {\n    params.customer = request.customerId\n  }\n\n  if (request.paymentMethodTypes && request.paymentMethodTypes.length > 0) {\n    params.payment_method_types = request.paymentMethodTypes as string[]\n  } else {\n    params.automatic_payment_methods = { enabled: true }\n  }\n\n  if (settings.statementDescriptor) {\n    params.statement_descriptor = settings.statementDescriptor.substring(0, 22)\n  }\n\n  const paymentIntent = await stripe.paymentIntents.create(params)\n\n  return {\n    paymentIntentId: paymentIntent.id,\n    clientSecret: paymentIntent.client_secret!,\n    status: paymentIntent.status,\n  }\n}\n\n/**\n * Capture a payment intent (for manual capture mode)\n */\nexport async function capturePaymentIntent(\n  paymentIntentId: string,\n  amount?: number\n): Promise<PaymentIntentResponse> {\n  const stripe = await getStripeClient()\n\n  const params: Stripe.PaymentIntentCaptureParams = {}\n  if (amount) {\n    params.amount_to_capture = amount\n  }\n\n  const paymentIntent = await stripe.paymentIntents.capture(paymentIntentId, params)\n\n  return {\n    paymentIntentId: paymentIntent.id,\n    clientSecret: paymentIntent.client_secret!,\n    status: paymentIntent.status,\n  }\n}\n\n/**\n * Cancel a payment intent\n */\nexport async function cancelPaymentIntent(paymentIntentId: string): Promise<void> {\n  const stripe = await getStripeClient()\n  await stripe.paymentIntents.cancel(paymentIntentId)\n}\n\n/**\n * Create or update a Stripe customer\n */\nexport async function createCustomer(request: CreateCustomerRequest): Promise<string> {\n  const stripe = await getStripeClient()\n\n  const params: Stripe.CustomerCreateParams = {\n    email: request.email,\n    name: request.name,\n    phone: request.phone,\n    metadata: request.metadata,\n  }\n\n  if (request.address) {\n    params.address = {\n      line1: request.address.line1,\n      line2: request.address.line2,\n      city: request.address.city,\n      state: request.address.state,\n      postal_code: request.address.postalCode,\n      country: request.address.country,\n    }\n  }\n\n  const customer = await stripe.customers.create(params)\n  return customer.id\n}\n\n/**\n * Get or create a Stripe customer by email\n */\nexport async function getOrCreateCustomer(email: string, name?: string): Promise<string> {\n  const stripe = await getStripeClient()\n\n  // Search for existing customer\n  const customers = await stripe.customers.list({\n    email,\n    limit: 1,\n  })\n\n  if (customers.data.length > 0) {\n    return customers.data[0].id\n  }\n\n  // Create new customer\n  const customer = await stripe.customers.create({\n    email,\n    name,\n  })\n\n  return customer.id\n}\n\n/**\n * Create a subscription\n */\nexport async function createSubscription(\n  request: CreateSubscriptionRequest\n): Promise<{ subscriptionId: string; status: string; clientSecret?: string }> {\n  const stripe = await getStripeClient()\n\n  const params: Stripe.SubscriptionCreateParams = {\n    customer: request.customerId,\n    items: [{ price: request.priceId }],\n    payment_behavior: 'default_incomplete',\n    expand: ['latest_invoice.payment_intent'],\n    metadata: request.metadata,\n  }\n\n  if (request.trialPeriodDays) {\n    params.trial_period_days = request.trialPeriodDays\n  }\n\n  if (request.cancelAtPeriodEnd) {\n    params.cancel_at_period_end = true\n  }\n\n  const subscription = await stripe.subscriptions.create(params)\n\n  // Get client secret for payment\n  const invoice = subscription.latest_invoice as Stripe.Invoice\n  const paymentIntent = invoice?.payment_intent as Stripe.PaymentIntent\n\n  return {\n    subscriptionId: subscription.id,\n    status: subscription.status,\n    clientSecret: paymentIntent?.client_secret || undefined,\n  }\n}\n\n/**\n * Cancel a subscription\n */\nexport async function cancelSubscription(\n  subscriptionId: string,\n  immediately = false\n): Promise<void> {\n  const stripe = await getStripeClient()\n\n  if (immediately) {\n    await stripe.subscriptions.cancel(subscriptionId)\n  } else {\n    await stripe.subscriptions.update(subscriptionId, {\n      cancel_at_period_end: true,\n    })\n  }\n}\n\n/**\n * Create a refund\n */\nexport async function createRefund(request: CreateRefundRequest): Promise<RefundResponse> {\n  const stripe = await getStripeClient()\n\n  const params: Stripe.RefundCreateParams = {\n    payment_intent: request.paymentIntentId,\n    reason: request.reason,\n    metadata: request.metadata,\n  }\n\n  if (request.amount) {\n    params.amount = request.amount\n  }\n\n  const refund = await stripe.refunds.create(params)\n\n  return {\n    refundId: refund.id,\n    status: refund.status!,\n    amount: refund.amount,\n  }\n}\n\n/**\n * Get a checkout session by ID\n */\nexport async function getCheckoutSession(sessionId: string): Promise<Stripe.Checkout.Session> {\n  const stripe = await getStripeClient()\n  return stripe.checkout.sessions.retrieve(sessionId, {\n    expand: ['line_items', 'customer', 'payment_intent'],\n  })\n}\n\n/**\n * Get a payment intent by ID\n */\nexport async function getPaymentIntent(paymentIntentId: string): Promise<Stripe.PaymentIntent> {\n  const stripe = await getStripeClient()\n  return stripe.paymentIntents.retrieve(paymentIntentId)\n}\n\n/**\n * Construct and verify a Stripe webhook event\n */\nexport async function constructWebhookEvent(\n  payload: string | Buffer,\n  signature: string\n): Promise<Stripe.Event> {\n  const stripe = await getStripeClient()\n  const settings = await getStripeSettings()\n\n  const webhookSecret = settings.webhookSecret || process.env.STRIPE_WEBHOOK_SECRET\n\n  if (!webhookSecret) {\n    throw new Error('Stripe webhook secret not configured')\n  }\n\n  return stripe.webhooks.constructEvent(payload, signature, webhookSecret)\n}\n\n/**\n * Create a billing portal session for customer self-service\n */\nexport async function createBillingPortalSession(\n  customerId: string,\n  returnUrl: string\n): Promise<string> {\n  const stripe = await getStripeClient()\n\n  const session = await stripe.billingPortal.sessions.create({\n    customer: customerId,\n    return_url: returnUrl,\n  })\n\n  return session.url\n}\n\n/**\n * List customer payment methods\n */\nexport async function listPaymentMethods(\n  customerId: string,\n  type: 'card' | 'us_bank_account' = 'card'\n): Promise<Stripe.PaymentMethod[]> {\n  const stripe = await getStripeClient()\n\n  const paymentMethods = await stripe.paymentMethods.list({\n    customer: customerId,\n    type,\n  })\n\n  return paymentMethods.data\n}\n\n/**\n * Get customer invoices\n */\nexport async function listInvoices(\n  customerId: string,\n  limit = 10\n): Promise<Stripe.Invoice[]> {\n  const stripe = await getStripeClient()\n\n  const invoices = await stripe.invoices.list({\n    customer: customerId,\n    limit,\n  })\n\n  return invoices.data\n}\n\n/**\n * Retrieve product by ID\n */\nexport async function getProduct(productId: string): Promise<Stripe.Product> {\n  const stripe = await getStripeClient()\n  return stripe.products.retrieve(productId)\n}\n\n/**\n * Create a product in Stripe\n */\nexport async function createProduct(\n  name: string,\n  description?: string,\n  images?: string[],\n  metadata?: Record<string, string>\n): Promise<Stripe.Product> {\n  const stripe = await getStripeClient()\n\n  return stripe.products.create({\n    name,\n    description,\n    images,\n    metadata,\n  })\n}\n\n/**\n * Create a price for a product\n */\nexport async function createPrice(\n  productId: string,\n  unitAmount: number,\n  currency?: string,\n  recurring?: { interval: 'day' | 'week' | 'month' | 'year'; interval_count?: number }\n): Promise<Stripe.Price> {\n  const stripe = await getStripeClient()\n  const settings = await getStripeSettings()\n\n  const params: Stripe.PriceCreateParams = {\n    product: productId,\n    unit_amount: unitAmount,\n    currency: currency || settings.currency,\n  }\n\n  if (recurring) {\n    params.recurring = recurring\n  }\n\n  return stripe.prices.create(params)\n}\n\nexport * from './types'\n","/**\n * Stripe Integration Types\n */\n\nimport type Stripe from 'stripe'\n\n// Payment status enum matching Prisma\nexport type PaymentStatus =\n  | 'PENDING'\n  | 'PROCESSING'\n  | 'SUCCEEDED'\n  | 'FAILED'\n  | 'CANCELLED'\n  | 'REFUNDED'\n  | 'PARTIALLY_REFUNDED'\n\n// Checkout session request\nexport interface CreateCheckoutSessionRequest {\n  orderId?: string\n  items: CheckoutItem[]\n  customerEmail?: string\n  customerId?: string\n  successUrl: string\n  cancelUrl: string\n  mode?: 'payment' | 'subscription'\n  allowPromotionCodes?: boolean\n  shippingAddressCollection?: boolean\n  shippingOptions?: ShippingOption[]\n  metadata?: Record<string, string>\n}\n\nexport interface CheckoutItem {\n  name: string\n  description?: string\n  price: number // in cents\n  quantity: number\n  images?: string[]\n  productId?: string\n  variantId?: string\n  stripePriceId?: string // Use existing Stripe price if available\n}\n\nexport interface ShippingOption {\n  id: string\n  displayName: string\n  amount: number // in cents\n  deliveryEstimate?: {\n    minimum: { unit: 'day' | 'week' | 'month'; value: number }\n    maximum: { unit: 'day' | 'week' | 'month'; value: number }\n  }\n}\n\n// Payment intent request\nexport interface CreatePaymentIntentRequest {\n  amount: number // in cents\n  currency?: string\n  customerId?: string\n  customerEmail?: string\n  orderId?: string\n  metadata?: Record<string, string>\n  paymentMethodTypes?: string[]\n  captureMethod?: 'automatic' | 'manual'\n}\n\n// Customer management\nexport interface CreateCustomerRequest {\n  email: string\n  name?: string\n  phone?: string\n  address?: {\n    line1: string\n    line2?: string\n    city: string\n    state: string\n    postalCode: string\n    country: string\n  }\n  metadata?: Record<string, string>\n}\n\n// Subscription management\nexport interface CreateSubscriptionRequest {\n  customerId: string\n  priceId: string\n  trialPeriodDays?: number\n  metadata?: Record<string, string>\n  cancelAtPeriodEnd?: boolean\n}\n\n// Refund request\nexport interface CreateRefundRequest {\n  paymentIntentId: string\n  amount?: number // partial refund in cents, full if not specified\n  reason?: 'duplicate' | 'fraudulent' | 'requested_by_customer'\n  metadata?: Record<string, string>\n}\n\n// Webhook event types we handle\nexport type StripeWebhookEventType =\n  | 'checkout.session.completed'\n  | 'checkout.session.expired'\n  | 'payment_intent.succeeded'\n  | 'payment_intent.payment_failed'\n  | 'payment_intent.canceled'\n  | 'charge.refunded'\n  | 'charge.dispute.created'\n  | 'customer.subscription.created'\n  | 'customer.subscription.updated'\n  | 'customer.subscription.deleted'\n  | 'invoice.paid'\n  | 'invoice.payment_failed'\n\n// Stripe settings stored in database\nexport interface StripeSettings {\n  enabled: boolean\n  testMode: boolean\n  secretKey?: string\n  publishableKey?: string\n  webhookSecret?: string\n  currency: string\n  statementDescriptor?: string\n  supportedPaymentMethods: string[]\n  automaticTax: boolean\n  billingAddressCollection: 'auto' | 'required'\n}\n\n// Default Stripe settings\nexport const DEFAULT_STRIPE_SETTINGS: StripeSettings = {\n  enabled: false,\n  testMode: true,\n  currency: 'usd',\n  supportedPaymentMethods: ['card'],\n  automaticTax: false,\n  billingAddressCollection: 'auto',\n}\n\n// Supported currencies\nexport const SUPPORTED_CURRENCIES = [\n  { value: 'usd', label: 'USD - US Dollar' },\n  { value: 'eur', label: 'EUR - Euro' },\n  { value: 'gbp', label: 'GBP - British Pound' },\n  { value: 'cad', label: 'CAD - Canadian Dollar' },\n  { value: 'aud', label: 'AUD - Australian Dollar' },\n  { value: 'jpy', label: 'JPY - Japanese Yen' },\n  { value: 'inr', label: 'INR - Indian Rupee' },\n] as const\n\n// Payment method options\nexport const PAYMENT_METHOD_OPTIONS = [\n  { value: 'card', label: 'Credit/Debit Card' },\n  { value: 'us_bank_account', label: 'ACH Bank Transfer' },\n  { value: 'sepa_debit', label: 'SEPA Direct Debit' },\n  { value: 'klarna', label: 'Klarna' },\n  { value: 'afterpay_clearpay', label: 'Afterpay / Clearpay' },\n  { value: 'affirm', label: 'Affirm' },\n  { value: 'link', label: 'Link' },\n] as const\n\n// Response types\nexport interface CheckoutSessionResponse {\n  sessionId: string\n  url: string\n}\n\nexport interface PaymentIntentResponse {\n  paymentIntentId: string\n  clientSecret: string\n  status: string\n}\n\nexport interface RefundResponse {\n  refundId: string\n  status: string\n  amount: number\n}\n\n// Utility type for Stripe event data\nexport type StripeEventData = Stripe.Event['data']['object']\n","/**\n * Form Builder Types\n */\n\n// Field types supported by the form builder\nexport type FormFieldType =\n  | 'text'\n  | 'email'\n  | 'phone'\n  | 'number'\n  | 'textarea'\n  | 'select'\n  | 'multiselect'\n  | 'checkbox'\n  | 'radio'\n  | 'date'\n  | 'time'\n  | 'datetime'\n  | 'file'\n  | 'url'\n  | 'hidden'\n  | 'rating'\n  | 'range'\n\n// Validation rule types\nexport type ValidationRuleType =\n  | 'required'\n  | 'minLength'\n  | 'maxLength'\n  | 'min'\n  | 'max'\n  | 'pattern'\n  | 'email'\n  | 'url'\n  | 'custom'\n\n// Validation rule\nexport interface ValidationRule {\n  type: ValidationRuleType\n  value?: string | number\n  message: string\n}\n\n// Select/Radio option\nexport interface FieldOption {\n  value: string\n  label: string\n}\n\n// Conditional logic\nexport interface FieldCondition {\n  field: string // Field name to check\n  operator: 'equals' | 'notEquals' | 'contains' | 'notContains' | 'isEmpty' | 'isNotEmpty'\n  value?: string | number | boolean\n}\n\n// Form field definition\nexport interface FormField {\n  id: string\n  name: string\n  type: FormFieldType\n  label: string\n  placeholder?: string\n  description?: string\n  defaultValue?: string | number | boolean | string[]\n  options?: FieldOption[] // For select, multiselect, radio\n  validation?: ValidationRule[]\n  conditions?: FieldCondition[] // Show field only if conditions are met\n  width?: 'full' | 'half' | 'third' // Grid width\n  rows?: number // For textarea\n  accept?: string // For file upload\n  min?: number // For number, range\n  max?: number // For number, range\n  step?: number // For number, range\n}\n\n// Form definition\nexport interface FormDefinition {\n  id: string\n  name: string\n  slug: string\n  description?: string\n  fields: FormField[]\n  settings: FormSettings\n  createdAt: string\n  updatedAt: string\n}\n\n// Form settings\nexport interface FormSettings {\n  submitButtonText: string\n  successMessage: string\n  redirectUrl?: string\n  notifyEmails: string[]\n  captchaEnabled: boolean\n  storeSubmissions: boolean\n  limitSubmissions?: number\n  closeAfterDate?: string\n}\n\n// Form submission data\nexport interface FormSubmissionData {\n  formId: string\n  data: Record<string, any>\n  metadata?: {\n    ipAddress?: string\n    userAgent?: string\n    referrer?: string\n    timestamp: string\n  }\n}\n\n// Submission response\nexport interface FormSubmissionResponse {\n  success: boolean\n  message: string\n  submissionId?: string\n  redirectUrl?: string\n  errors?: Record<string, string>\n}\n\n// Default field templates\nexport const FIELD_TEMPLATES: Record<string, Partial<FormField>> = {\n  name: {\n    type: 'text',\n    label: 'Name',\n    placeholder: 'Enter your name',\n    validation: [{ type: 'required', message: 'Name is required' }],\n  },\n  email: {\n    type: 'email',\n    label: 'Email',\n    placeholder: 'Enter your email',\n    validation: [\n      { type: 'required', message: 'Email is required' },\n      { type: 'email', message: 'Please enter a valid email' },\n    ],\n  },\n  phone: {\n    type: 'phone',\n    label: 'Phone',\n    placeholder: 'Enter your phone number',\n  },\n  message: {\n    type: 'textarea',\n    label: 'Message',\n    placeholder: 'Enter your message',\n    rows: 4,\n    validation: [{ type: 'required', message: 'Message is required' }],\n  },\n  company: {\n    type: 'text',\n    label: 'Company',\n    placeholder: 'Enter your company name',\n  },\n  website: {\n    type: 'url',\n    label: 'Website',\n    placeholder: 'https://example.com',\n    validation: [{ type: 'url', message: 'Please enter a valid URL' }],\n  },\n  subscribe: {\n    type: 'checkbox',\n    label: 'Subscribe to newsletter',\n    defaultValue: false,\n  },\n}\n\n// Default form settings\nexport const DEFAULT_FORM_SETTINGS: FormSettings = {\n  submitButtonText: 'Submit',\n  successMessage: 'Thank you for your submission!',\n  notifyEmails: [],\n  captchaEnabled: false,\n  storeSubmissions: true,\n}\n","/**\n * Form Builder Library\n *\n * Provides form creation, validation, and submission handling\n */\n\nimport { prisma } from '../db'\nimport type {\n  FormField,\n  FormDefinition,\n  FormSettings,\n  ValidationRule,\n  FieldCondition,\n  FormSubmissionData,\n  FormSubmissionResponse,\n} from './types'\nimport { DEFAULT_FORM_SETTINGS } from './types'\n\n/**\n * Create a new form\n */\nexport async function createForm(\n  name: string,\n  fields: FormField[],\n  settings?: Partial<FormSettings>\n): Promise<FormDefinition> {\n  const slug = name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/(^-|-$)/g, '')\n\n  const form = await prisma.form.create({\n    data: {\n      name,\n      slug,\n      fields: fields as any,\n      submitButtonText: settings?.submitButtonText || DEFAULT_FORM_SETTINGS.submitButtonText,\n      successMessage: settings?.successMessage || DEFAULT_FORM_SETTINGS.successMessage,\n      redirectUrl: settings?.redirectUrl,\n      notifyEmails: settings?.notifyEmails || [],\n      status: 'ACTIVE',\n    },\n  })\n\n  return {\n    id: form.id,\n    name: form.name,\n    slug: form.slug,\n    description: form.description || undefined,\n    fields: form.fields as unknown as FormField[],\n    settings: {\n      submitButtonText: form.submitButtonText,\n      successMessage: form.successMessage || DEFAULT_FORM_SETTINGS.successMessage,\n      redirectUrl: form.redirectUrl || undefined,\n      notifyEmails: form.notifyEmails,\n      captchaEnabled: false,\n      storeSubmissions: true,\n    },\n    createdAt: form.createdAt.toISOString(),\n    updatedAt: form.updatedAt.toISOString(),\n  }\n}\n\n/**\n * Get form by ID or slug\n */\nexport async function getForm(idOrSlug: string): Promise<FormDefinition | null> {\n  const form = await prisma.form.findFirst({\n    where: {\n      OR: [{ id: idOrSlug }, { slug: idOrSlug }],\n    },\n  })\n\n  if (!form) return null\n\n  return {\n    id: form.id,\n    name: form.name,\n    slug: form.slug,\n    description: form.description || undefined,\n    fields: form.fields as unknown as FormField[],\n    settings: {\n      submitButtonText: form.submitButtonText,\n      successMessage: form.successMessage || DEFAULT_FORM_SETTINGS.successMessage,\n      redirectUrl: form.redirectUrl || undefined,\n      notifyEmails: form.notifyEmails,\n      captchaEnabled: false,\n      storeSubmissions: true,\n    },\n    createdAt: form.createdAt.toISOString(),\n    updatedAt: form.updatedAt.toISOString(),\n  }\n}\n\n/**\n * Update a form\n */\nexport async function updateForm(\n  id: string,\n  data: {\n    name?: string\n    description?: string\n    fields?: FormField[]\n    settings?: Partial<FormSettings>\n    status?: 'DRAFT' | 'ACTIVE' | 'ARCHIVED'\n  }\n): Promise<FormDefinition> {\n  const updateData: any = {}\n\n  if (data.name) updateData.name = data.name\n  if (data.description !== undefined) updateData.description = data.description\n  if (data.fields) updateData.fields = data.fields\n  if (data.status) updateData.status = data.status\n  if (data.settings) {\n    if (data.settings.submitButtonText) updateData.submitButtonText = data.settings.submitButtonText\n    if (data.settings.successMessage) updateData.successMessage = data.settings.successMessage\n    if (data.settings.redirectUrl !== undefined) updateData.redirectUrl = data.settings.redirectUrl\n    if (data.settings.notifyEmails) updateData.notifyEmails = data.settings.notifyEmails\n  }\n\n  const form = await prisma.form.update({\n    where: { id },\n    data: updateData,\n  })\n\n  return {\n    id: form.id,\n    name: form.name,\n    slug: form.slug,\n    description: form.description || undefined,\n    fields: form.fields as unknown as FormField[],\n    settings: {\n      submitButtonText: form.submitButtonText,\n      successMessage: form.successMessage || DEFAULT_FORM_SETTINGS.successMessage,\n      redirectUrl: form.redirectUrl || undefined,\n      notifyEmails: form.notifyEmails,\n      captchaEnabled: false,\n      storeSubmissions: true,\n    },\n    createdAt: form.createdAt.toISOString(),\n    updatedAt: form.updatedAt.toISOString(),\n  }\n}\n\n/**\n * Delete a form\n */\nexport async function deleteForm(id: string): Promise<void> {\n  await prisma.form.delete({ where: { id } })\n}\n\n/**\n * Validate form data against field definitions\n */\nexport function validateFormData(\n  fields: FormField[],\n  data: Record<string, any>\n): { valid: boolean; errors: Record<string, string> } {\n  const errors: Record<string, string> = {}\n\n  for (const field of fields) {\n    const value = data[field.name]\n\n    // Check conditions - skip validation if field shouldn't be shown\n    if (field.conditions && field.conditions.length > 0) {\n      const shouldShow = field.conditions.every((condition) =>\n        evaluateCondition(condition, data)\n      )\n      if (!shouldShow) continue\n    }\n\n    // Validate each rule\n    if (field.validation) {\n      for (const rule of field.validation) {\n        const error = validateRule(rule, value, field)\n        if (error) {\n          errors[field.name] = error\n          break // Only show first error per field\n        }\n      }\n    }\n  }\n\n  return {\n    valid: Object.keys(errors).length === 0,\n    errors,\n  }\n}\n\n/**\n * Evaluate a field condition\n */\nfunction evaluateCondition(\n  condition: FieldCondition,\n  data: Record<string, any>\n): boolean {\n  const value = data[condition.field]\n\n  switch (condition.operator) {\n    case 'equals':\n      return value === condition.value\n    case 'notEquals':\n      return value !== condition.value\n    case 'contains':\n      return String(value || '').includes(String(condition.value))\n    case 'notContains':\n      return !String(value || '').includes(String(condition.value))\n    case 'isEmpty':\n      return value === undefined || value === null || value === ''\n    case 'isNotEmpty':\n      return value !== undefined && value !== null && value !== ''\n    default:\n      return true\n  }\n}\n\n/**\n * Validate a single rule\n */\nfunction validateRule(\n  rule: ValidationRule,\n  value: any,\n  field: FormField\n): string | null {\n  switch (rule.type) {\n    case 'required':\n      if (value === undefined || value === null || value === '' ||\n          (Array.isArray(value) && value.length === 0)) {\n        return rule.message\n      }\n      break\n\n    case 'minLength':\n      if (typeof value === 'string' && value.length < (rule.value as number)) {\n        return rule.message\n      }\n      break\n\n    case 'maxLength':\n      if (typeof value === 'string' && value.length > (rule.value as number)) {\n        return rule.message\n      }\n      break\n\n    case 'min':\n      if (typeof value === 'number' && value < (rule.value as number)) {\n        return rule.message\n      }\n      break\n\n    case 'max':\n      if (typeof value === 'number' && value > (rule.value as number)) {\n        return rule.message\n      }\n      break\n\n    case 'pattern':\n      if (value && !new RegExp(rule.value as string).test(String(value))) {\n        return rule.message\n      }\n      break\n\n    case 'email':\n      if (value && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(String(value))) {\n        return rule.message\n      }\n      break\n\n    case 'url':\n      if (value) {\n        try {\n          new URL(String(value))\n        } catch {\n          return rule.message\n        }\n      }\n      break\n  }\n\n  return null\n}\n\n/**\n * Submit form data\n */\nexport async function submitForm(\n  submission: FormSubmissionData\n): Promise<FormSubmissionResponse> {\n  const form = await getForm(submission.formId)\n\n  if (!form) {\n    return {\n      success: false,\n      message: 'Form not found',\n    }\n  }\n\n  // Validate data\n  const validation = validateFormData(form.fields, submission.data)\n\n  if (!validation.valid) {\n    return {\n      success: false,\n      message: 'Validation failed',\n      errors: validation.errors,\n    }\n  }\n\n  // Store submission\n  const formSubmission = await prisma.formSubmission.create({\n    data: {\n      formId: form.id,\n      data: submission.data,\n      ipAddress: submission.metadata?.ipAddress,\n      userAgent: submission.metadata?.userAgent,\n      referrer: submission.metadata?.referrer,\n    },\n  })\n\n  // Update submission count\n  await prisma.form.update({\n    where: { id: form.id },\n    data: { submissionCount: { increment: 1 } },\n  })\n\n  // TODO: Send notification emails if configured\n  // This would integrate with your email service\n\n  return {\n    success: true,\n    message: form.settings.successMessage,\n    submissionId: formSubmission.id,\n    redirectUrl: form.settings.redirectUrl,\n  }\n}\n\n/**\n * Get form submissions\n */\nexport async function getFormSubmissions(\n  formId: string,\n  options?: {\n    limit?: number\n    offset?: number\n    starred?: boolean\n    read?: boolean\n  }\n): Promise<{\n  submissions: Array<{\n    id: string\n    data: Record<string, any>\n    createdAt: string\n    read: boolean\n    starred: boolean\n  }>\n  total: number\n}> {\n  const where: any = { formId }\n\n  if (options?.starred !== undefined) {\n    where.starred = options.starred\n  }\n  if (options?.read !== undefined) {\n    where.read = options.read\n  }\n\n  const [submissions, total] = await Promise.all([\n    prisma.formSubmission.findMany({\n      where,\n      take: options?.limit || 50,\n      skip: options?.offset || 0,\n      orderBy: { createdAt: 'desc' },\n    }),\n    prisma.formSubmission.count({ where }),\n  ])\n\n  return {\n    submissions: submissions.map((s: (typeof submissions)[number]) => ({\n      id: s.id,\n      data: s.data as Record<string, any>,\n      createdAt: s.createdAt.toISOString(),\n      read: s.read,\n      starred: s.starred,\n    })),\n    total,\n  }\n}\n\n/**\n * Mark submission as read\n */\nexport async function markSubmissionRead(\n  submissionId: string,\n  read = true\n): Promise<void> {\n  await prisma.formSubmission.update({\n    where: { id: submissionId },\n    data: { read },\n  })\n}\n\n/**\n * Star/unstar submission\n */\nexport async function starSubmission(\n  submissionId: string,\n  starred = true\n): Promise<void> {\n  await prisma.formSubmission.update({\n    where: { id: submissionId },\n    data: { starred },\n  })\n}\n\n/**\n * Delete submission\n */\nexport async function deleteSubmission(submissionId: string): Promise<void> {\n  await prisma.formSubmission.delete({\n    where: { id: submissionId },\n  })\n}\n\nexport * from './types'\n","/**\n * Inventory Management Service\n *\n * Handles stock alerts, back-in-stock subscriptions, and stock reservations\n */\n\nimport { prisma } from '../db';\nimport { sendEmail } from '../email';\nimport { getEmailSettings } from '../settings';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface LowStockProduct {\n  id: string;\n  title: string;\n  sku: string | null;\n  stock: number;\n  lowStockThreshold: number;\n  variantId?: string;\n  variantTitle?: string;\n}\n\nexport interface StockReservationResult {\n  success: boolean;\n  reservationId?: string;\n  error?: string;\n}\n\n// =============================================================================\n// Low Stock Detection\n// =============================================================================\n\n/**\n * Find all products and variants below their low stock threshold\n */\nexport async function getLowStockItems(): Promise<LowStockProduct[]> {\n  const lowStockItems: LowStockProduct[] = [];\n\n  // Check simple products (non-variant)\n  const lowStockProducts = await prisma.product.findMany({\n    where: {\n      status: 'ACTIVE',\n      trackInventory: true,\n      type: 'SIMPLE',\n      stock: {\n        lte: prisma.product.fields.lowStockThreshold,\n      },\n    },\n    select: {\n      id: true,\n      title: true,\n      sku: true,\n      stock: true,\n      lowStockThreshold: true,\n    },\n  });\n\n  for (const product of lowStockProducts) {\n    if (product.stock <= product.lowStockThreshold) {\n      lowStockItems.push({\n        id: product.id,\n        title: product.title,\n        sku: product.sku,\n        stock: product.stock,\n        lowStockThreshold: product.lowStockThreshold,\n      });\n    }\n  }\n\n  // Check product variants\n  const lowStockVariants = await prisma.productVariant.findMany({\n    where: {\n      enabled: true,\n      product: {\n        status: 'ACTIVE',\n        trackInventory: true,\n      },\n    },\n    include: {\n      product: {\n        select: {\n          id: true,\n          title: true,\n        },\n      },\n      optionValues: {\n        include: {\n          optionValue: true,\n        },\n      },\n    },\n  });\n\n  for (const variant of lowStockVariants) {\n    if (variant.stock <= variant.lowStockThreshold) {\n      // Construct variant title from option values\n      const variantTitle = variant.optionValues\n        .map((ov) => ov.optionValue.value)\n        .join(' / ') || undefined;\n\n      lowStockItems.push({\n        id: variant.product.id,\n        title: variant.product.title,\n        sku: variant.sku,\n        stock: variant.stock,\n        lowStockThreshold: variant.lowStockThreshold,\n        variantId: variant.id,\n        variantTitle,\n      });\n    }\n  }\n\n  return lowStockItems;\n}\n\n/**\n * Send low stock alert email to admin\n */\nexport async function sendLowStockAlert(items: LowStockProduct[]): Promise<{ success: boolean; error?: string }> {\n  if (items.length === 0) {\n    return { success: true };\n  }\n\n  const emailSettings = await getEmailSettings();\n  const adminEmail = emailSettings.replyTo || emailSettings.fromEmail;\n\n  if (!adminEmail) {\n    return { success: false, error: 'No admin email configured' };\n  }\n\n  const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n\n  // Build email content\n  const itemRows = items\n    .map((item) => {\n      const name = item.variantTitle ? `${item.title} - ${item.variantTitle}` : item.title;\n      const sku = item.sku ? ` (SKU: ${item.sku})` : '';\n      return ` ${name}${sku}: ${item.stock} remaining (threshold: ${item.lowStockThreshold})`;\n    })\n    .join('\\n');\n\n  const html = `\n    <h2>Low Stock Alert</h2>\n    <p>The following products are at or below their low stock threshold:</p>\n    <ul>\n      ${items\n        .map((item) => {\n          const name = item.variantTitle ? `${item.title} - ${item.variantTitle}` : item.title;\n          const sku = item.sku ? ` (SKU: ${item.sku})` : '';\n          return `<li><strong>${name}</strong>${sku}: ${item.stock} remaining (threshold: ${item.lowStockThreshold})</li>`;\n        })\n        .join('')}\n    </ul>\n    <p><a href=\"${appUrl}/admin/products\">View Products in Admin</a></p>\n  `;\n\n  const text = `Low Stock Alert\n\nThe following products are at or below their low stock threshold:\n\n${itemRows}\n\nView products: ${appUrl}/admin/products`;\n\n  try {\n    const result = await sendEmail({\n      to: { email: adminEmail, name: 'Store Admin' },\n      subject: `Low Stock Alert: ${items.length} product${items.length > 1 ? 's' : ''} need attention`,\n      html,\n      text,\n      metadata: {\n        type: 'low_stock_alert',\n        itemCount: String(items.length),\n      },\n    });\n\n    return { success: result.success, error: result.error };\n  } catch (error) {\n    console.error('Error sending low stock alert:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n// =============================================================================\n// Back-In-Stock Subscriptions\n// =============================================================================\n\n/**\n * Subscribe an email to back-in-stock notifications for a product\n */\nexport async function subscribeToBackInStock(\n  email: string,\n  productId: string,\n  variantId?: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    // Verify product exists\n    const product = await prisma.product.findUnique({\n      where: { id: productId },\n      select: { id: true, status: true },\n    });\n\n    if (!product) {\n      return { success: false, error: 'Product not found' };\n    }\n\n    // Verify variant exists if provided\n    if (variantId) {\n      const variant = await prisma.productVariant.findUnique({\n        where: { id: variantId },\n        select: { id: true },\n      });\n      if (!variant) {\n        return { success: false, error: 'Variant not found' };\n      }\n    }\n\n    // Check for existing subscription\n    const existing = await prisma.backInStockSubscription.findFirst({\n      where: {\n        email,\n        productId,\n        variantId: variantId ?? null,\n      },\n    });\n\n    if (existing) {\n      // Update existing subscription\n      await prisma.backInStockSubscription.update({\n        where: { id: existing.id },\n        data: {\n          notified: false,\n          notifiedAt: null,\n        },\n      });\n    } else {\n      // Create new subscription\n      await prisma.backInStockSubscription.create({\n        data: {\n          email,\n          productId,\n          variantId: variantId ?? null,\n        },\n      });\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Error subscribing to back-in-stock:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Unsubscribe from back-in-stock notifications\n */\nexport async function unsubscribeFromBackInStock(\n  email: string,\n  productId: string,\n  variantId?: string\n): Promise<{ success: boolean }> {\n  try {\n    await prisma.backInStockSubscription.deleteMany({\n      where: {\n        email,\n        productId,\n        variantId: variantId || null,\n      },\n    });\n    return { success: true };\n  } catch {\n    return { success: false };\n  }\n}\n\n/**\n * Send back-in-stock notifications for a product that's now in stock\n */\nexport async function sendBackInStockNotifications(\n  productId: string,\n  variantId?: string\n): Promise<{ sent: number; errors: number }> {\n  const subscriptions = await prisma.backInStockSubscription.findMany({\n    where: {\n      productId,\n      variantId: variantId || null,\n      notified: false,\n    },\n    include: {\n      product: {\n        select: {\n          title: true,\n          slug: true,\n          images: {\n            select: {\n              media: {\n                select: {\n                  url: true,\n                },\n              },\n            },\n            take: 1,\n            orderBy: { position: 'asc' },\n          },\n        },\n      },\n      variant: {\n        include: {\n          optionValues: {\n            include: {\n              optionValue: true,\n            },\n          },\n        },\n      },\n    },\n  });\n\n  if (subscriptions.length === 0) {\n    return { sent: 0, errors: 0 };\n  }\n\n  const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n  let sent = 0;\n  let errors = 0;\n\n  for (const sub of subscriptions) {\n    // Construct variant title from option values\n    const variantTitle = sub.variant?.optionValues\n      .map((ov) => ov.optionValue.value)\n      .join(' / ');\n    const productName = variantTitle\n      ? `${sub.product.title} - ${variantTitle}`\n      : sub.product.title;\n    const productUrl = `${appUrl}/products/${sub.product.slug}`;\n    const imageUrl = sub.product.images?.[0]?.media?.url || '';\n\n    const html = `\n      <h2>Good News! ${productName} is Back in Stock</h2>\n      ${imageUrl ? `<img src=\"${imageUrl}\" alt=\"${productName}\" style=\"max-width: 200px; margin: 20px 0;\" />` : ''}\n      <p>The product you were waiting for is now available.</p>\n      <p><a href=\"${productUrl}\" style=\"display: inline-block; padding: 12px 24px; background-color: #000; color: #fff; text-decoration: none; border-radius: 4px;\">Shop Now</a></p>\n      <p style=\"color: #666; font-size: 12px; margin-top: 20px;\">\n        You received this email because you signed up for a back-in-stock notification.\n      </p>\n    `;\n\n    const text = `Good News! ${productName} is Back in Stock\n\nThe product you were waiting for is now available.\n\nShop now: ${productUrl}\n\nYou received this email because you signed up for a back-in-stock notification.`;\n\n    try {\n      const result = await sendEmail({\n        to: { email: sub.email },\n        subject: `${productName} is Back in Stock!`,\n        html,\n        text,\n        metadata: {\n          type: 'back_in_stock',\n          productId: sub.productId,\n          ...(sub.variantId ? { variantId: sub.variantId } : {}),\n        },\n      });\n\n      if (result.success) {\n        // Mark as notified\n        await prisma.backInStockSubscription.update({\n          where: { id: sub.id },\n          data: {\n            notified: true,\n            notifiedAt: new Date(),\n          },\n        });\n        sent++;\n      } else {\n        errors++;\n      }\n    } catch {\n      errors++;\n    }\n  }\n\n  return { sent, errors };\n}\n\n/**\n * Check if a product is back in stock and send notifications\n * Call this when updating stock levels\n */\nexport async function checkAndNotifyBackInStock(\n  productId: string,\n  variantId: string | undefined,\n  newStock: number\n): Promise<void> {\n  if (newStock <= 0) return;\n\n  // Check if there are subscribers waiting\n  const subCount = await prisma.backInStockSubscription.count({\n    where: {\n      productId,\n      variantId: variantId || null,\n      notified: false,\n    },\n  });\n\n  if (subCount > 0) {\n    // Send notifications in the background\n    sendBackInStockNotifications(productId, variantId).catch((err) => {\n      console.error('Error sending back-in-stock notifications:', err);\n    });\n  }\n}\n\n// =============================================================================\n// Stock Reservation\n// =============================================================================\n\nconst DEFAULT_RESERVATION_MINUTES = 15;\n\n/**\n * Reserve stock for a checkout session\n */\nexport async function reserveStock(\n  productId: string,\n  quantity: number,\n  sessionId: string,\n  variantId?: string,\n  reservationMinutes: number = DEFAULT_RESERVATION_MINUTES\n): Promise<StockReservationResult> {\n  try {\n    // Get current stock\n    let currentStock: number;\n    let trackInventory: boolean;\n\n    if (variantId) {\n      const variant = await prisma.productVariant.findUnique({\n        where: { id: variantId },\n        include: {\n          product: {\n            select: { trackInventory: true },\n          },\n        },\n      });\n      if (!variant) {\n        return { success: false, error: 'Variant not found' };\n      }\n      currentStock = variant.stock;\n      trackInventory = variant.product.trackInventory;\n    } else {\n      const product = await prisma.product.findUnique({\n        where: { id: productId },\n        select: { stock: true, trackInventory: true },\n      });\n      if (!product) {\n        return { success: false, error: 'Product not found' };\n      }\n      currentStock = product.stock;\n      trackInventory = product.trackInventory;\n    }\n\n    // If not tracking inventory, always succeed\n    if (!trackInventory) {\n      return { success: true };\n    }\n\n    // Calculate available stock (current - active reservations)\n    const reservedStock = await prisma.stockReservation.aggregate({\n      where: {\n        productId,\n        variantId: variantId || null,\n        released: false,\n        expiresAt: { gt: new Date() },\n      },\n      _sum: { quantity: true },\n    });\n\n    const availableStock = currentStock - (reservedStock._sum.quantity || 0);\n\n    if (availableStock < quantity) {\n      return { success: false, error: 'Insufficient stock' };\n    }\n\n    // Create reservation\n    const expiresAt = new Date(Date.now() + reservationMinutes * 60 * 1000);\n\n    const reservation = await prisma.stockReservation.create({\n      data: {\n        productId,\n        variantId: variantId || null,\n        quantity,\n        sessionId,\n        expiresAt,\n      },\n    });\n\n    return { success: true, reservationId: reservation.id };\n  } catch (error) {\n    console.error('Error reserving stock:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Release a stock reservation (cart cleared, session expired, etc.)\n */\nexport async function releaseReservation(reservationId: string): Promise<boolean> {\n  try {\n    await prisma.stockReservation.update({\n      where: { id: reservationId },\n      data: { released: true },\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Release all reservations for a session\n */\nexport async function releaseSessionReservations(sessionId: string): Promise<number> {\n  const result = await prisma.stockReservation.updateMany({\n    where: {\n      sessionId,\n      released: false,\n    },\n    data: { released: true },\n  });\n  return result.count;\n}\n\n/**\n * Convert reservations to order (when order is created)\n * Links reservations to order and makes them permanent\n */\nexport async function convertReservationsToOrder(sessionId: string, orderId: string): Promise<number> {\n  const result = await prisma.stockReservation.updateMany({\n    where: {\n      sessionId,\n      released: false,\n      expiresAt: { gt: new Date() },\n    },\n    data: {\n      orderId,\n      // Extend expiration significantly - these are now order reservations\n      expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n    },\n  });\n  return result.count;\n}\n\n/**\n * Deduct stock when order is confirmed/paid\n * Releases reservations after deducting actual stock\n */\nexport async function deductStockForOrder(orderId: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    const reservations = await prisma.stockReservation.findMany({\n      where: {\n        orderId,\n        released: false,\n      },\n    });\n\n    for (const reservation of reservations) {\n      if (reservation.variantId) {\n        await prisma.productVariant.update({\n          where: { id: reservation.variantId },\n          data: {\n            stock: { decrement: reservation.quantity },\n          },\n        });\n      } else {\n        await prisma.product.update({\n          where: { id: reservation.productId },\n          data: {\n            stock: { decrement: reservation.quantity },\n          },\n        });\n      }\n\n      // Mark reservation as released (stock has been deducted)\n      await prisma.stockReservation.update({\n        where: { id: reservation.id },\n        data: { released: true },\n      });\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Error deducting stock for order:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Cleanup expired reservations\n * Run this periodically (e.g., every 5 minutes)\n */\nexport async function cleanupExpiredReservations(): Promise<number> {\n  const result = await prisma.stockReservation.updateMany({\n    where: {\n      released: false,\n      expiresAt: { lte: new Date() },\n      orderId: null, // Only cleanup session reservations, not order reservations\n    },\n    data: { released: true },\n  });\n  return result.count;\n}\n\n/**\n * Get available stock for a product (accounting for reservations)\n */\nexport async function getAvailableStock(productId: string, variantId?: string): Promise<number> {\n  let currentStock: number;\n  let trackInventory: boolean;\n\n  if (variantId) {\n    const variant = await prisma.productVariant.findUnique({\n      where: { id: variantId },\n      include: {\n        product: { select: { trackInventory: true } },\n      },\n    });\n    if (!variant) return 0;\n    currentStock = variant.stock;\n    trackInventory = variant.product.trackInventory;\n  } else {\n    const product = await prisma.product.findUnique({\n      where: { id: productId },\n      select: { stock: true, trackInventory: true },\n    });\n    if (!product) return 0;\n    currentStock = product.stock;\n    trackInventory = product.trackInventory;\n  }\n\n  // If not tracking inventory, return max int (unlimited)\n  if (!trackInventory) {\n    return Number.MAX_SAFE_INTEGER;\n  }\n\n  // Subtract active reservations\n  const reserved = await prisma.stockReservation.aggregate({\n    where: {\n      productId,\n      variantId: variantId || null,\n      released: false,\n      expiresAt: { gt: new Date() },\n    },\n    _sum: { quantity: true },\n  });\n\n  return Math.max(0, currentStock - (reserved._sum.quantity || 0));\n}\n","/**\n * Media Library - Core CRUD Operations\n */\n\nimport { prisma } from '../db'\nimport type {\n  MediaFilters,\n  MediaWithRelations,\n  MediaListResponse,\n  MediaCreateInput,\n  MediaUpdateInput,\n} from './types'\n\n// Type augmentation for Prisma client with extended Media model\n// This allows the code to compile before prisma generate is run with new schema\ntype PrismaWithMedia = typeof prisma & {\n  media: {\n    findMany: (args: any) => Promise<any[]>\n    findUnique: (args: any) => Promise<any | null>\n    create: (args: any) => Promise<any>\n    update: (args: any) => Promise<any>\n    delete: (args: any) => Promise<any>\n    updateMany: (args: any) => Promise<{ count: number }>\n    deleteMany: (args: any) => Promise<{ count: number }>\n    count: (args: any) => Promise<number>\n    groupBy: (args: any) => Promise<any[]>\n    aggregate: (args: any) => Promise<any>\n  }\n  mediaTagOnMedia: {\n    createMany: (args: any) => Promise<{ count: number }>\n    deleteMany: (args: any) => Promise<{ count: number }>\n  }\n}\n\nconst db = prisma as PrismaWithMedia\n\n// Type for media where input\ninterface MediaWhereInput {\n  id?: { in: string[] }\n  deletedAt?: null | Date | { gte?: Date }\n  folderId?: string | null\n  mimeType?: { startsWith?: string; contains?: string } | string\n  OR?: any[]\n  tags?: { some: { tagId: { in: string[] } } }\n  createdAt?: { gte?: Date }\n}\n\n// Type for media order by\ninterface MediaOrderByInput {\n  originalName?: 'asc' | 'desc'\n  size?: 'asc' | 'desc'\n  mimeType?: 'asc' | 'desc'\n  createdAt?: 'asc' | 'desc'\n}\n\n// =============================================================================\n// LIST MEDIA\n// =============================================================================\n\nexport async function listMedia(filters: MediaFilters = {}): Promise<MediaListResponse> {\n  const {\n    folderId,\n    type,\n    search,\n    tagIds,\n    includeDeleted = false,\n    page = 1,\n    limit = 50,\n    sortBy = 'createdAt',\n    sortOrder = 'desc',\n  } = filters\n\n  const where: MediaWhereInput = {}\n\n  // Soft delete filter\n  if (!includeDeleted) {\n    where.deletedAt = null\n  }\n\n  // Folder filter\n  if (folderId !== undefined) {\n    where.folderId = folderId\n  }\n\n  // Type filter (by mime type prefix)\n  if (type) {\n    switch (type) {\n      case 'image':\n        where.mimeType = { startsWith: 'image/' }\n        break\n      case 'video':\n        where.mimeType = { startsWith: 'video/' }\n        break\n      case 'audio':\n        where.mimeType = { startsWith: 'audio/' }\n        break\n      case 'document':\n        where.OR = [\n          { mimeType: 'application/pdf' },\n          { mimeType: { contains: 'document' } },\n          { mimeType: { contains: 'spreadsheet' } },\n          { mimeType: { contains: 'presentation' } },\n          { mimeType: { contains: 'word' } },\n          { mimeType: { contains: 'excel' } },\n          { mimeType: { contains: 'powerpoint' } },\n          { mimeType: 'text/plain' },\n          { mimeType: 'text/csv' },\n        ]\n        break\n    }\n  }\n\n  // Search filter\n  if (search) {\n    const searchLower = search.toLowerCase()\n    where.OR = [\n      { filename: { contains: searchLower, mode: 'insensitive' } },\n      { originalName: { contains: searchLower, mode: 'insensitive' } },\n      { title: { contains: searchLower, mode: 'insensitive' } },\n      { alt: { contains: searchLower, mode: 'insensitive' } },\n      { caption: { contains: searchLower, mode: 'insensitive' } },\n    ]\n  }\n\n  // Tag filter\n  if (tagIds && tagIds.length > 0) {\n    where.tags = {\n      some: {\n        tagId: { in: tagIds },\n      },\n    }\n  }\n\n  // Sort\n  const orderBy: MediaOrderByInput = {}\n  switch (sortBy) {\n    case 'name':\n      orderBy.originalName = sortOrder\n      break\n    case 'size':\n      orderBy.size = sortOrder\n      break\n    case 'type':\n      orderBy.mimeType = sortOrder\n      break\n    case 'createdAt':\n    default:\n      orderBy.createdAt = sortOrder\n      break\n  }\n\n  const skip = (page - 1) * limit\n\n  const [media, total] = await Promise.all([\n    db.media.findMany({\n      where,\n      include: {\n        folder: true,\n        tags: {\n          include: {\n            tag: true,\n          },\n        },\n        uploadedBy: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n          },\n        },\n        _count: {\n          select: {\n            usages: true,\n          },\n        },\n      },\n      orderBy,\n      skip,\n      take: limit,\n    }),\n    db.media.count({ where }),\n  ])\n\n  return {\n    media: media as MediaWithRelations[],\n    total,\n    page,\n    limit,\n    hasMore: skip + media.length < total,\n  }\n}\n\n// =============================================================================\n// GET SINGLE MEDIA\n// =============================================================================\n\nexport async function getMedia(id: string, includeUsage = true): Promise<MediaWithRelations | null> {\n  const media = await db.media.findUnique({\n    where: { id },\n    include: {\n      folder: true,\n      tags: {\n        include: {\n          tag: true,\n        },\n      },\n      usages: includeUsage,\n      uploadedBy: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n    },\n  })\n\n  return media as MediaWithRelations | null\n}\n\n// =============================================================================\n// CREATE MEDIA\n// =============================================================================\n\nexport async function createMedia(input: MediaCreateInput): Promise<MediaWithRelations> {\n  const { tagIds, ...data } = input\n\n  const media = await db.media.create({\n    data: {\n      ...data,\n      tags: tagIds?.length\n        ? {\n            create: tagIds.map((tagId) => ({ tagId })),\n          }\n        : undefined,\n    },\n    include: {\n      folder: true,\n      tags: {\n        include: {\n          tag: true,\n        },\n      },\n      uploadedBy: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n    },\n  })\n\n  return media as MediaWithRelations\n}\n\n// =============================================================================\n// UPDATE MEDIA\n// =============================================================================\n\nexport async function updateMedia(id: string, input: MediaUpdateInput): Promise<MediaWithRelations> {\n  const { tagIds, ...data } = input\n\n  // If tagIds is provided, replace all tags\n  if (tagIds !== undefined) {\n    await db.mediaTagOnMedia.deleteMany({\n      where: { mediaId: id },\n    })\n\n    if (tagIds.length > 0) {\n      await db.mediaTagOnMedia.createMany({\n        data: tagIds.map((tagId) => ({ mediaId: id, tagId })),\n      })\n    }\n  }\n\n  const media = await db.media.update({\n    where: { id },\n    data,\n    include: {\n      folder: true,\n      tags: {\n        include: {\n          tag: true,\n        },\n      },\n      usages: true,\n      uploadedBy: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n    },\n  })\n\n  return media as MediaWithRelations\n}\n\n// =============================================================================\n// DELETE MEDIA\n// =============================================================================\n\nexport async function deleteMedia(id: string, hard = false): Promise<void> {\n  if (hard) {\n    // Hard delete - permanently remove\n    await db.media.delete({\n      where: { id },\n    })\n  } else {\n    // Soft delete - mark as deleted\n    await db.media.update({\n      where: { id },\n      data: { deletedAt: new Date() },\n    })\n  }\n}\n\n// =============================================================================\n// RESTORE MEDIA\n// =============================================================================\n\nexport async function restoreMedia(id: string): Promise<MediaWithRelations> {\n  const media = await db.media.update({\n    where: { id },\n    data: { deletedAt: null },\n    include: {\n      folder: true,\n      tags: {\n        include: {\n          tag: true,\n        },\n      },\n      uploadedBy: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n    },\n  })\n\n  return media as MediaWithRelations\n}\n\n// =============================================================================\n// BULK OPERATIONS\n// =============================================================================\n\nexport async function bulkDeleteMedia(ids: string[], hard = false): Promise<number> {\n  if (hard) {\n    const result = await db.media.deleteMany({\n      where: { id: { in: ids } },\n    })\n    return result.count\n  } else {\n    const result = await db.media.updateMany({\n      where: { id: { in: ids } },\n      data: { deletedAt: new Date() },\n    })\n    return result.count\n  }\n}\n\nexport async function bulkMoveMedia(ids: string[], folderId: string | null): Promise<number> {\n  const result = await db.media.updateMany({\n    where: { id: { in: ids } },\n    data: { folderId },\n  })\n  return result.count\n}\n\nexport async function bulkTagMedia(ids: string[], tagIds: string[]): Promise<number> {\n  // Create tag associations for each media item\n  const data = ids.flatMap((mediaId) =>\n    tagIds.map((tagId) => ({ mediaId, tagId }))\n  )\n\n  await db.mediaTagOnMedia.createMany({\n    data,\n    skipDuplicates: true,\n  })\n\n  return ids.length\n}\n\nexport async function bulkUntagMedia(ids: string[], tagIds: string[]): Promise<number> {\n  const result = await db.mediaTagOnMedia.deleteMany({\n    where: {\n      mediaId: { in: ids },\n      tagId: { in: tagIds },\n    },\n  })\n  return result.count\n}\n\nexport async function bulkRestoreMedia(ids: string[]): Promise<number> {\n  const result = await db.media.updateMany({\n    where: { id: { in: ids } },\n    data: { deletedAt: null },\n  })\n  return result.count\n}\n\n// =============================================================================\n// STATS\n// =============================================================================\n\nexport async function getMediaStats() {\n  const [total, byType, totalSize, recentCount] = await Promise.all([\n    db.media.count({ where: { deletedAt: null } }),\n    db.media.groupBy({\n      by: ['mimeType'],\n      where: { deletedAt: null },\n      _count: { id: true },\n    }),\n    db.media.aggregate({\n      where: { deletedAt: null },\n      _sum: { size: true },\n    }),\n    db.media.count({\n      where: {\n        deletedAt: null,\n        createdAt: { gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) },\n      },\n    }),\n  ])\n\n  // Group by media type\n  const typeStats = {\n    image: 0,\n    video: 0,\n    audio: 0,\n    document: 0,\n    other: 0,\n  }\n\n  for (const item of byType) {\n    if (item.mimeType.startsWith('image/')) {\n      typeStats.image += item._count.id\n    } else if (item.mimeType.startsWith('video/')) {\n      typeStats.video += item._count.id\n    } else if (item.mimeType.startsWith('audio/')) {\n      typeStats.audio += item._count.id\n    } else if (\n      item.mimeType === 'application/pdf' ||\n      item.mimeType.includes('document') ||\n      item.mimeType.includes('word')\n    ) {\n      typeStats.document += item._count.id\n    } else {\n      typeStats.other += item._count.id\n    }\n  }\n\n  return {\n    total,\n    totalSize: totalSize._sum.size || 0,\n    recentCount,\n    byType: typeStats,\n  }\n}\n\n// Re-export types\nexport * from './types'\n","/**\n * Base Email Template\n *\n * Provides consistent styling and structure for all transactional emails.\n * Uses inline CSS for maximum email client compatibility.\n */\n\nexport interface BaseTemplateOptions {\n  title: string;\n  preheader?: string;\n  content: string;\n  footerContent?: string;\n  brandColor?: string;\n  logoUrl?: string;\n  storeName?: string;\n  storeUrl?: string;\n  supportEmail?: string;\n  unsubscribeUrl?: string;\n  socialLinks?: {\n    facebook?: string;\n    twitter?: string;\n    instagram?: string;\n  };\n}\n\n/**\n * Base email template with responsive design and dark mode support\n */\nexport function baseTemplate(options: BaseTemplateOptions): string {\n  const {\n    title,\n    preheader = '',\n    content,\n    footerContent = '',\n    brandColor = '#4F46E5',\n    logoUrl,\n    storeName = '{{store.name}}',\n    storeUrl = '{{store.url}}',\n    supportEmail = '{{store.supportEmail}}',\n    unsubscribeUrl,\n    socialLinks = {},\n  } = options;\n\n  return `\n<!DOCTYPE html>\n<html lang=\"en\" xmlns:v=\"urn:schemas-microsoft-com:vml\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"x-apple-disable-message-reformatting\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <meta name=\"format-detection\" content=\"telephone=no, date=no, address=no, email=no, url=no\">\n  <meta name=\"color-scheme\" content=\"light dark\">\n  <meta name=\"supported-color-schemes\" content=\"light dark\">\n  <!--[if mso]>\n  <noscript>\n    <xml>\n      <o:OfficeDocumentSettings xmlns:o=\"urn:schemas-microsoft-com:office:office\">\n        <o:PixelsPerInch>96</o:PixelsPerInch>\n      </o:OfficeDocumentSettings>\n    </xml>\n  </noscript>\n  <style>\n    td,th,div,p,a,h1,h2,h3,h4,h5,h6 {font-family: \"Segoe UI\", sans-serif; mso-line-height-rule: exactly;}\n  </style>\n  <![endif]-->\n  <title>${title}</title>\n  <style>\n    :root {\n      color-scheme: light dark;\n    }\n\n    /* Reset */\n    body, table, td, p, a, li, blockquote {\n      -webkit-text-size-adjust: 100%;\n      -ms-text-size-adjust: 100%;\n    }\n\n    table, td {\n      mso-table-lspace: 0pt;\n      mso-table-rspace: 0pt;\n      border-collapse: collapse !important;\n    }\n\n    img {\n      -ms-interpolation-mode: bicubic;\n      border: 0;\n      height: auto;\n      line-height: 100%;\n      outline: none;\n      text-decoration: none;\n    }\n\n    body {\n      margin: 0 !important;\n      padding: 0 !important;\n      width: 100% !important;\n      background-color: #f4f4f5;\n    }\n\n    /* Dark mode styles */\n    @media (prefers-color-scheme: dark) {\n      body {\n        background-color: #18181b !important;\n      }\n      .email-container {\n        background-color: #27272a !important;\n      }\n      .email-content {\n        color: #e4e4e7 !important;\n      }\n      .email-footer {\n        background-color: #18181b !important;\n        color: #a1a1aa !important;\n      }\n      h1, h2, h3, h4, h5, h6 {\n        color: #fafafa !important;\n      }\n      p, td {\n        color: #e4e4e7 !important;\n      }\n      .text-muted {\n        color: #a1a1aa !important;\n      }\n    }\n\n    /* Responsive styles */\n    @media only screen and (max-width: 600px) {\n      .email-container {\n        width: 100% !important;\n        max-width: 100% !important;\n      }\n      .stack-column {\n        display: block !important;\n        width: 100% !important;\n        max-width: 100% !important;\n      }\n      .stack-column-center {\n        text-align: center !important;\n      }\n      .mobile-padding {\n        padding-left: 20px !important;\n        padding-right: 20px !important;\n      }\n      .mobile-hide {\n        display: none !important;\n      }\n    }\n  </style>\n</head>\n<body style=\"margin: 0; padding: 0; background-color: #f4f4f5;\">\n  <!-- Preheader text (hidden) -->\n  <div style=\"display: none; font-size: 1px; line-height: 1px; max-height: 0px; max-width: 0px; opacity: 0; overflow: hidden; mso-hide: all;\">\n    ${preheader}\n    ${'&zwnj;&nbsp;'.repeat(50)}\n  </div>\n\n  <!-- Email wrapper -->\n  <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #f4f4f5;\">\n    <tr>\n      <td align=\"center\" style=\"padding: 40px 10px;\">\n\n        <!-- Email container -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"600\" class=\"email-container\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\n\n          <!-- Header -->\n          <tr>\n            <td style=\"padding: 30px 40px; text-align: center; border-bottom: 1px solid #e4e4e7;\">\n              ${logoUrl ? `\n              <a href=\"${storeUrl}\" style=\"text-decoration: none;\">\n                <img src=\"${logoUrl}\" alt=\"${storeName}\" width=\"150\" style=\"max-width: 150px; height: auto;\">\n              </a>\n              ` : `\n              <a href=\"${storeUrl}\" style=\"text-decoration: none; font-size: 24px; font-weight: bold; color: ${brandColor}; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\">\n                ${storeName}\n              </a>\n              `}\n            </td>\n          </tr>\n\n          <!-- Content -->\n          <tr>\n            <td class=\"email-content mobile-padding\" style=\"padding: 40px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.6; color: #3f3f46;\">\n              ${content}\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td class=\"email-footer\" style=\"padding: 30px 40px; background-color: #fafafa; border-top: 1px solid #e4e4e7; border-radius: 0 0 8px 8px;\">\n              <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                ${footerContent ? `\n                <tr>\n                  <td style=\"padding-bottom: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 1.5; color: #71717a;\">\n                    ${footerContent}\n                  </td>\n                </tr>\n                ` : ''}\n\n                <!-- Social links -->\n                ${Object.keys(socialLinks).length > 0 ? `\n                <tr>\n                  <td align=\"center\" style=\"padding-bottom: 20px;\">\n                    ${socialLinks.facebook ? `<a href=\"${socialLinks.facebook}\" style=\"text-decoration: none; margin: 0 8px;\"><img src=\"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/facebook.svg\" width=\"24\" height=\"24\" alt=\"Facebook\" style=\"opacity: 0.6;\"></a>` : ''}\n                    ${socialLinks.twitter ? `<a href=\"${socialLinks.twitter}\" style=\"text-decoration: none; margin: 0 8px;\"><img src=\"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/twitter.svg\" width=\"24\" height=\"24\" alt=\"Twitter\" style=\"opacity: 0.6;\"></a>` : ''}\n                    ${socialLinks.instagram ? `<a href=\"${socialLinks.instagram}\" style=\"text-decoration: none; margin: 0 8px;\"><img src=\"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/instagram.svg\" width=\"24\" height=\"24\" alt=\"Instagram\" style=\"opacity: 0.6;\"></a>` : ''}\n                  </td>\n                </tr>\n                ` : ''}\n\n                <tr>\n                  <td align=\"center\" style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; line-height: 1.5; color: #a1a1aa;\">\n                    <p style=\"margin: 0 0 8px 0;\">\n                      Questions? Contact us at <a href=\"mailto:${supportEmail}\" style=\"color: ${brandColor}; text-decoration: none;\">${supportEmail}</a>\n                    </p>\n                    <p style=\"margin: 0 0 8px 0;\">\n                      &copy; {{currentYear}} ${storeName}. All rights reserved.\n                    </p>\n                    ${unsubscribeUrl ? `\n                    <p style=\"margin: 0;\">\n                      <a href=\"${unsubscribeUrl}\" style=\"color: #a1a1aa; text-decoration: underline;\">Unsubscribe</a>\n                    </p>\n                    ` : ''}\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n        </table>\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n`.trim();\n}\n\n/**\n * Common UI components for email templates\n */\nexport const emailComponents = {\n  /**\n   * Primary call-to-action button\n   */\n  button: (text: string, url: string, color = '#4F46E5'): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"border-radius: 6px; background-color: ${color};\">\n          <a href=\"${url}\" target=\"_blank\" style=\"display: inline-block; padding: 14px 28px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; font-weight: 600; color: #ffffff; text-decoration: none; border-radius: 6px;\">\n            ${text}\n          </a>\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Secondary/outline button\n   */\n  buttonOutline: (text: string, url: string, color = '#4F46E5'): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"border-radius: 6px; border: 2px solid ${color};\">\n          <a href=\"${url}\" target=\"_blank\" style=\"display: inline-block; padding: 12px 26px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; font-weight: 600; color: ${color}; text-decoration: none; border-radius: 6px;\">\n            ${text}\n          </a>\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Divider line\n   */\n  divider: (): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"border-top: 1px solid #e4e4e7;\"></td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Info box/callout\n   */\n  infoBox: (content: string, bgColor = '#eff6ff', borderColor = '#3b82f6'): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"padding: 16px 20px; background-color: ${bgColor}; border-left: 4px solid ${borderColor}; border-radius: 4px;\">\n          ${content}\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Success box\n   */\n  successBox: (content: string): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"padding: 16px 20px; background-color: #f0fdf4; border-left: 4px solid #22c55e; border-radius: 4px;\">\n          ${content}\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Warning box\n   */\n  warningBox: (content: string): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"padding: 16px 20px; background-color: #fffbeb; border-left: 4px solid #f59e0b; border-radius: 4px;\">\n          ${content}\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Two-column layout row\n   */\n  twoColumn: (leftContent: string, rightContent: string): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n      <tr>\n        <td class=\"stack-column\" width=\"50%\" valign=\"top\" style=\"padding-right: 10px;\">\n          ${leftContent}\n        </td>\n        <td class=\"stack-column\" width=\"50%\" valign=\"top\" style=\"padding-left: 10px;\">\n          ${rightContent}\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Image with optional caption\n   */\n  image: (src: string, alt: string, width = 520, caption?: string): string => `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      <tr>\n        <td align=\"center\">\n          <img src=\"${src}\" alt=\"${alt}\" width=\"${width}\" style=\"max-width: 100%; height: auto; border-radius: 6px;\">\n          ${caption ? `<p style=\"margin: 8px 0 0 0; font-size: 14px; color: #71717a;\">${caption}</p>` : ''}\n        </td>\n      </tr>\n    </table>\n  `,\n\n  /**\n   * Heading styles\n   */\n  heading: {\n    h1: (text: string): string => `<h1 style=\"margin: 0 0 24px 0; font-size: 28px; font-weight: 700; color: #18181b; line-height: 1.3;\">${text}</h1>`,\n    h2: (text: string): string => `<h2 style=\"margin: 24px 0 16px 0; font-size: 22px; font-weight: 600; color: #18181b; line-height: 1.3;\">${text}</h2>`,\n    h3: (text: string): string => `<h3 style=\"margin: 20px 0 12px 0; font-size: 18px; font-weight: 600; color: #18181b; line-height: 1.3;\">${text}</h3>`,\n  },\n\n  /**\n   * Paragraph\n   */\n  paragraph: (text: string): string => `<p style=\"margin: 0 0 16px 0; font-size: 16px; line-height: 1.6; color: #3f3f46;\">${text}</p>`,\n\n  /**\n   * Muted/secondary text\n   */\n  mutedText: (text: string): string => `<p style=\"margin: 0 0 16px 0; font-size: 14px; line-height: 1.5; color: #71717a;\">${text}</p>`,\n};\n","/**\n * Email Template Renderer\n *\n * Renders email templates with merge tags and provides\n * a unified interface for generating transactional emails.\n */\n\nimport { parseMergeTags, MergeTagData } from '../merge-tags';\nimport { baseTemplate, BaseTemplateOptions, emailComponents } from './base';\n\nexport interface StoreConfig {\n  name: string;\n  url: string;\n  supportEmail: string;\n  logoUrl?: string;\n  brandColor?: string;\n  socialLinks?: {\n    facebook?: string;\n    twitter?: string;\n    instagram?: string;\n  };\n}\n\nexport interface RenderOptions {\n  /** Store configuration */\n  store?: Partial<StoreConfig>;\n  /** Additional merge tag data */\n  data?: MergeTagData;\n}\n\n/**\n * Default store config - can be overridden per-render or via settings\n */\nconst defaultStoreConfig: StoreConfig = {\n  name: 'Our Store',\n  url: 'https://example.com',\n  supportEmail: 'support@example.com',\n};\n\n/**\n * Recursively convert Date objects to ISO strings in data\n */\nfunction sanitizeData(data: unknown): MergeTagData {\n  if (data === null || data === undefined) {\n    return {};\n  }\n\n  if (data instanceof Date) {\n    return data.toISOString() as unknown as MergeTagData;\n  }\n\n  if (Array.isArray(data)) {\n    return data.map(sanitizeData) as unknown as MergeTagData;\n  }\n\n  if (typeof data === 'object') {\n    const result: MergeTagData = {};\n    for (const [key, value] of Object.entries(data)) {\n      if (value instanceof Date) {\n        result[key] = value.toISOString();\n      } else if (Array.isArray(value)) {\n        result[key] = value.map(sanitizeData) as MergeTagData[];\n      } else if (typeof value === 'object' && value !== null) {\n        result[key] = sanitizeData(value);\n      } else {\n        result[key] = value as string | number | boolean | null | undefined;\n      }\n    }\n    return result;\n  }\n\n  return data as unknown as MergeTagData;\n}\n\n/**\n * Renders an email template with merge tags\n */\nexport function renderTemplate(\n  template: string,\n  data: Record<string, unknown>,\n  options: RenderOptions = {}\n): string {\n  const { store = {} } = options;\n\n  // Merge store config with data\n  const dataStore = typeof data.store === 'object' && data.store !== null ? data.store as Record<string, unknown> : {};\n  const mergedData: Record<string, unknown> = {\n    ...data,\n    store: {\n      ...defaultStoreConfig,\n      ...store,\n      ...dataStore,\n    },\n    currentYear: new Date().getFullYear().toString(),\n  };\n\n  // Sanitize data (convert Dates to strings)\n  const sanitizedData = sanitizeData(mergedData);\n\n  // Process merge tags\n  return parseMergeTags(template, sanitizedData);\n}\n\n/**\n * Wraps content in the base email template\n */\nexport function wrapInBaseTemplate(\n  content: string,\n  options: Partial<BaseTemplateOptions> & { store?: Partial<StoreConfig> }\n): string {\n  const store = options.store || {};\n\n  return baseTemplate({\n    title: options.title || 'Email from ' + (store.name || defaultStoreConfig.name),\n    preheader: options.preheader,\n    content,\n    footerContent: options.footerContent,\n    brandColor: store.brandColor || options.brandColor,\n    logoUrl: store.logoUrl || options.logoUrl,\n    storeName: store.name || defaultStoreConfig.name,\n    storeUrl: store.url || defaultStoreConfig.url,\n    supportEmail: store.supportEmail || defaultStoreConfig.supportEmail,\n    unsubscribeUrl: options.unsubscribeUrl,\n    socialLinks: store.socialLinks || options.socialLinks,\n  });\n}\n\n/**\n * Complete email rendering: wraps in base template and processes merge tags\n */\nexport function renderEmail(\n  content: string,\n  templateOptions: Partial<BaseTemplateOptions>,\n  data: Record<string, unknown>,\n  renderOptions: RenderOptions = {}\n): string {\n  const store = renderOptions.store || {};\n\n  // First wrap in base template\n  const wrappedHtml = wrapInBaseTemplate(content, {\n    ...templateOptions,\n    store,\n  });\n\n  // Then process merge tags\n  return renderTemplate(wrappedHtml, data, renderOptions);\n}\n\n/**\n * Generate plain text version from HTML (basic conversion)\n */\nexport function htmlToPlainText(html: string): string {\n  return html\n    // Remove style and script tags with content\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    // Convert links to text with URL\n    .replace(/<a[^>]*href=\"([^\"]*)\"[^>]*>([^<]*)<\\/a>/gi, '$2 ($1)')\n    // Convert headings to uppercase with newlines\n    .replace(/<h[1-6][^>]*>([^<]*)<\\/h[1-6]>/gi, '\\n\\n$1\\n')\n    // Convert paragraphs and divs to newlines\n    .replace(/<\\/p>/gi, '\\n\\n')\n    .replace(/<\\/div>/gi, '\\n')\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    // Convert list items\n    .replace(/<li[^>]*>/gi, '\\n- ')\n    // Remove all remaining HTML tags\n    .replace(/<[^>]+>/g, '')\n    // Decode common HTML entities\n    .replace(/&nbsp;/gi, ' ')\n    .replace(/&amp;/gi, '&')\n    .replace(/&lt;/gi, '<')\n    .replace(/&gt;/gi, '>')\n    .replace(/&quot;/gi, '\"')\n    .replace(/&#39;/gi, \"'\")\n    .replace(/&zwnj;/g, '')\n    // Clean up whitespace\n    .replace(/\\n\\s*\\n\\s*\\n/g, '\\n\\n')\n    .replace(/^\\s+|\\s+$/g, '')\n    .trim();\n}\n\n/**\n * Template builder for creating email content\n */\nexport class EmailTemplateBuilder {\n  private content: string[] = [];\n  private store: Partial<StoreConfig> = {};\n\n  constructor(store?: Partial<StoreConfig>) {\n    if (store) {\n      this.store = store;\n    }\n  }\n\n  /**\n   * Add a heading\n   */\n  heading(text: string, level: 1 | 2 | 3 = 1): this {\n    const headingFn = emailComponents.heading[`h${level}`];\n    this.content.push(headingFn(text));\n    return this;\n  }\n\n  /**\n   * Add a paragraph\n   */\n  paragraph(text: string): this {\n    this.content.push(emailComponents.paragraph(text));\n    return this;\n  }\n\n  /**\n   * Add muted/secondary text\n   */\n  muted(text: string): this {\n    this.content.push(emailComponents.mutedText(text));\n    return this;\n  }\n\n  /**\n   * Add a primary button\n   */\n  button(text: string, url: string, color?: string): this {\n    this.content.push(emailComponents.button(text, url, color || this.store.brandColor));\n    return this;\n  }\n\n  /**\n   * Add an outline button\n   */\n  buttonOutline(text: string, url: string, color?: string): this {\n    this.content.push(emailComponents.buttonOutline(text, url, color || this.store.brandColor));\n    return this;\n  }\n\n  /**\n   * Add a divider\n   */\n  divider(): this {\n    this.content.push(emailComponents.divider());\n    return this;\n  }\n\n  /**\n   * Add an info box\n   */\n  info(content: string): this {\n    this.content.push(emailComponents.infoBox(content));\n    return this;\n  }\n\n  /**\n   * Add a success box\n   */\n  success(content: string): this {\n    this.content.push(emailComponents.successBox(content));\n    return this;\n  }\n\n  /**\n   * Add a warning box\n   */\n  warning(content: string): this {\n    this.content.push(emailComponents.warningBox(content));\n    return this;\n  }\n\n  /**\n   * Add an image\n   */\n  image(src: string, alt: string, width?: number, caption?: string): this {\n    this.content.push(emailComponents.image(src, alt, width, caption));\n    return this;\n  }\n\n  /**\n   * Add raw HTML\n   */\n  raw(html: string): this {\n    this.content.push(html);\n    return this;\n  }\n\n  /**\n   * Add two-column layout\n   */\n  twoColumn(left: string, right: string): this {\n    this.content.push(emailComponents.twoColumn(left, right));\n    return this;\n  }\n\n  /**\n   * Build the content string\n   */\n  build(): string {\n    return this.content.join('\\n');\n  }\n\n  /**\n   * Build and wrap in base template\n   */\n  buildWithWrapper(options: Partial<BaseTemplateOptions>): string {\n    return wrapInBaseTemplate(this.build(), {\n      ...options,\n      store: this.store,\n    });\n  }\n\n  /**\n   * Build, wrap, and render with data\n   */\n  render(\n    templateOptions: Partial<BaseTemplateOptions>,\n    data: Record<string, unknown>,\n    renderOptions?: RenderOptions\n  ): string {\n    return renderEmail(this.build(), templateOptions, data, {\n      ...renderOptions,\n      store: { ...this.store, ...renderOptions?.store },\n    });\n  }\n}\n\n/**\n * Create a new template builder\n */\nexport function createEmailBuilder(store?: Partial<StoreConfig>): EmailTemplateBuilder {\n  return new EmailTemplateBuilder(store);\n}\n\n// Re-export components for direct use\nexport { emailComponents };\n\n// Re-export MergeTagData type for consumers\nexport type { MergeTagData };\n","/**\n * Order Confirmation Email Template\n *\n * Sent immediately after a successful order is placed.\n * Includes order details, items, pricing, and shipping info.\n */\n\nimport { renderEmail, StoreConfig, emailComponents } from './renderer';\n\nexport interface OrderItem {\n  id: string;\n  name: string;\n  variant?: string;\n  quantity: number;\n  price: number;\n  imageUrl?: string;\n}\n\nexport interface OrderAddress {\n  name: string;\n  line1: string;\n  line2?: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n}\n\nexport interface OrderConfirmationData {\n  order: {\n    id: string;\n    orderNumber: string;\n    createdAt: Date | string;\n    items: OrderItem[];\n    subtotal: number;\n    shipping: number;\n    tax: number;\n    discount?: number;\n    total: number;\n    currency?: string;\n    paymentMethod?: string;\n    shippingAddress: OrderAddress;\n    billingAddress?: OrderAddress;\n    shippingMethod?: string;\n    estimatedDelivery?: string;\n    notes?: string;\n  };\n  customer: {\n    name: string;\n    email: string;\n  };\n}\n\n/**\n * Generate order items table HTML\n */\nfunction generateItemsTable(items: OrderItem[], currency = 'USD'): string {\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(amount / 100);\n  };\n\n  const itemRows = items.map(item => `\n    <tr>\n      <td style=\"padding: 16px 0; border-bottom: 1px solid #e4e4e7;\">\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n          <tr>\n            ${item.imageUrl ? `\n            <td width=\"80\" valign=\"top\" style=\"padding-right: 16px;\">\n              <img src=\"${item.imageUrl}\" alt=\"${item.name}\" width=\"80\" height=\"80\" style=\"border-radius: 6px; object-fit: cover;\">\n            </td>\n            ` : ''}\n            <td valign=\"top\">\n              <p style=\"margin: 0 0 4px 0; font-weight: 600; color: #18181b;\">${item.name}</p>\n              ${item.variant ? `<p style=\"margin: 0 0 4px 0; font-size: 14px; color: #71717a;\">${item.variant}</p>` : ''}\n              <p style=\"margin: 0; font-size: 14px; color: #71717a;\">Qty: ${item.quantity}</p>\n            </td>\n            <td width=\"100\" valign=\"top\" align=\"right\">\n              <p style=\"margin: 0; font-weight: 600; color: #18181b;\">${formatPrice(item.price * item.quantity)}</p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  `).join('');\n\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n      ${itemRows}\n    </table>\n  `;\n}\n\n/**\n * Generate order totals section\n */\nfunction generateTotals(order: OrderConfirmationData['order']): string {\n  const currency = order.currency || 'USD';\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(amount / 100);\n  };\n\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      <tr>\n        <td style=\"padding: 8px 0; color: #71717a;\">Subtotal</td>\n        <td align=\"right\" style=\"padding: 8px 0; color: #3f3f46;\">${formatPrice(order.subtotal)}</td>\n      </tr>\n      <tr>\n        <td style=\"padding: 8px 0; color: #71717a;\">Shipping</td>\n        <td align=\"right\" style=\"padding: 8px 0; color: #3f3f46;\">${order.shipping === 0 ? 'Free' : formatPrice(order.shipping)}</td>\n      </tr>\n      <tr>\n        <td style=\"padding: 8px 0; color: #71717a;\">Tax</td>\n        <td align=\"right\" style=\"padding: 8px 0; color: #3f3f46;\">${formatPrice(order.tax)}</td>\n      </tr>\n      ${order.discount ? `\n      <tr>\n        <td style=\"padding: 8px 0; color: #22c55e;\">Discount</td>\n        <td align=\"right\" style=\"padding: 8px 0; color: #22c55e;\">-${formatPrice(order.discount)}</td>\n      </tr>\n      ` : ''}\n      <tr>\n        <td style=\"padding: 16px 0 8px 0; border-top: 2px solid #e4e4e7; font-weight: 700; font-size: 18px; color: #18181b;\">Total</td>\n        <td align=\"right\" style=\"padding: 16px 0 8px 0; border-top: 2px solid #e4e4e7; font-weight: 700; font-size: 18px; color: #18181b;\">${formatPrice(order.total)}</td>\n      </tr>\n    </table>\n  `;\n}\n\n/**\n * Generate address block\n */\nfunction generateAddressBlock(title: string, address: OrderAddress): string {\n  return `\n    <div style=\"padding: 16px; background-color: #fafafa; border-radius: 6px;\">\n      <p style=\"margin: 0 0 8px 0; font-weight: 600; color: #18181b;\">${title}</p>\n      <p style=\"margin: 0; font-size: 14px; line-height: 1.5; color: #3f3f46;\">\n        ${address.name}<br>\n        ${address.line1}<br>\n        ${address.line2 ? address.line2 + '<br>' : ''}\n        ${address.city}, ${address.state} ${address.postalCode}<br>\n        ${address.country}\n      </p>\n    </div>\n  `;\n}\n\n/**\n * Generate order confirmation email content\n */\nexport function generateOrderConfirmationContent(data: OrderConfirmationData): string {\n  const { order, customer } = data;\n  const orderDate = new Date(order.createdAt).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  return `\n    ${emailComponents.heading.h1('Thank you for your order!')}\n\n    ${emailComponents.paragraph(`Hi ${customer.name},`)}\n\n    ${emailComponents.paragraph(`We've received your order and it's being processed. You'll receive another email when your order ships.`)}\n\n    ${emailComponents.successBox(`\n      <p style=\"margin: 0; font-weight: 600;\">Order #${order.orderNumber}</p>\n      <p style=\"margin: 4px 0 0 0; font-size: 14px; color: #71717a;\">Placed on ${orderDate}</p>\n    `)}\n\n    ${emailComponents.button('View Order', `{{store.url}}/account/orders/${order.id}`)}\n\n    ${emailComponents.heading.h2('Order Details')}\n\n    ${generateItemsTable(order.items, order.currency)}\n\n    ${generateTotals(order)}\n\n    ${emailComponents.divider()}\n\n    ${emailComponents.heading.h2('Shipping Information')}\n\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n      <tr>\n        <td class=\"stack-column\" width=\"50%\" valign=\"top\" style=\"padding-right: 10px; padding-bottom: 16px;\">\n          ${generateAddressBlock('Shipping Address', order.shippingAddress)}\n        </td>\n        ${order.billingAddress ? `\n        <td class=\"stack-column\" width=\"50%\" valign=\"top\" style=\"padding-left: 10px; padding-bottom: 16px;\">\n          ${generateAddressBlock('Billing Address', order.billingAddress)}\n        </td>\n        ` : ''}\n      </tr>\n    </table>\n\n    ${order.shippingMethod ? `\n    ${emailComponents.infoBox(`\n      <p style=\"margin: 0;\"><strong>Shipping Method:</strong> ${order.shippingMethod}</p>\n      ${order.estimatedDelivery ? `<p style=\"margin: 4px 0 0 0;\"><strong>Estimated Delivery:</strong> ${order.estimatedDelivery}</p>` : ''}\n    `)}\n    ` : ''}\n\n    ${order.paymentMethod ? `\n    ${emailComponents.mutedText(`<strong>Payment Method:</strong> ${order.paymentMethod}`)}\n    ` : ''}\n\n    ${order.notes ? `\n    ${emailComponents.divider()}\n    ${emailComponents.heading.h3('Order Notes')}\n    ${emailComponents.paragraph(order.notes)}\n    ` : ''}\n\n    ${emailComponents.divider()}\n\n    ${emailComponents.mutedText('If you have any questions about your order, please don\\'t hesitate to contact our support team.')}\n  `;\n}\n\n/**\n * Render complete order confirmation email\n */\nexport function renderOrderConfirmationEmail(\n  data: OrderConfirmationData,\n  store?: Partial<StoreConfig>\n): { html: string; text: string; subject: string } {\n  const content = generateOrderConfirmationContent(data);\n\n  const mergeData: Record<string, unknown> = {\n    order: data.order,\n    customer: data.customer,\n  };\n\n  const html = renderEmail(\n    content,\n    {\n      title: `Order Confirmation #${data.order.orderNumber}`,\n      preheader: `Thank you for your order! Your order #${data.order.orderNumber} has been confirmed.`,\n    },\n    mergeData,\n    { store }\n  );\n\n  // Generate plain text version\n  const text = `\nThank you for your order!\n\nHi ${data.customer.name},\n\nWe've received your order and it's being processed. You'll receive another email when your order ships.\n\nOrder #${data.order.orderNumber}\nPlaced on ${new Date(data.order.createdAt).toLocaleDateString()}\n\nORDER DETAILS:\n${data.order.items.map(item => `- ${item.name}${item.variant ? ` (${item.variant})` : ''} x${item.quantity}`).join('\\n')}\n\nSubtotal: ${(data.order.subtotal / 100).toFixed(2)}\nShipping: ${data.order.shipping === 0 ? 'Free' : (data.order.shipping / 100).toFixed(2)}\nTax: ${(data.order.tax / 100).toFixed(2)}\n${data.order.discount ? `Discount: -${(data.order.discount / 100).toFixed(2)}` : ''}\nTotal: ${(data.order.total / 100).toFixed(2)}\n\nSHIPPING ADDRESS:\n${data.order.shippingAddress.name}\n${data.order.shippingAddress.line1}\n${data.order.shippingAddress.line2 ? data.order.shippingAddress.line2 + '\\n' : ''}${data.order.shippingAddress.city}, ${data.order.shippingAddress.state} ${data.order.shippingAddress.postalCode}\n${data.order.shippingAddress.country}\n\nIf you have any questions, please contact our support team.\n  `.trim();\n\n  return {\n    html,\n    text,\n    subject: `Order Confirmation #${data.order.orderNumber}`,\n  };\n}\n","/**\n * Shipping Notification Email Template\n *\n * Sent when an order has been shipped.\n * Includes tracking information and shipment details.\n */\n\nimport { renderEmail, StoreConfig, emailComponents } from './renderer';\nimport { OrderItem, OrderAddress } from './order-confirmation';\n\nexport interface ShipmentData {\n  order: {\n    id: string;\n    orderNumber: string;\n    items: OrderItem[];\n  };\n  shipment: {\n    id: string;\n    carrier: string;\n    carrierName?: string;\n    trackingNumber: string;\n    trackingUrl?: string;\n    shippedAt: Date | string;\n    estimatedDelivery?: string;\n    shippingAddress: OrderAddress;\n    items?: OrderItem[]; // Items in this shipment (for partial shipments)\n  };\n  customer: {\n    name: string;\n    email: string;\n  };\n  isPartialShipment?: boolean;\n}\n\n/**\n * Generate tracking info box\n */\nfunction generateTrackingBox(shipment: ShipmentData['shipment']): string {\n  const carrierDisplay = shipment.carrierName || shipment.carrier;\n  const shippedDate = new Date(shipment.shippedAt).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0; background-color: #eff6ff; border-radius: 8px;\">\n      <tr>\n        <td style=\"padding: 24px;\">\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n            <tr>\n              <td>\n                <p style=\"margin: 0 0 16px 0; font-size: 14px; color: #3b82f6; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">\n                   Shipment Details\n                </p>\n              </td>\n            </tr>\n            <tr>\n              <td>\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                  <tr>\n                    <td width=\"50%\" style=\"padding-bottom: 12px;\">\n                      <p style=\"margin: 0 0 4px 0; font-size: 12px; color: #71717a; text-transform: uppercase;\">Carrier</p>\n                      <p style=\"margin: 0; font-size: 16px; font-weight: 600; color: #18181b;\">${carrierDisplay}</p>\n                    </td>\n                    <td width=\"50%\" style=\"padding-bottom: 12px;\">\n                      <p style=\"margin: 0 0 4px 0; font-size: 12px; color: #71717a; text-transform: uppercase;\">Shipped On</p>\n                      <p style=\"margin: 0; font-size: 16px; font-weight: 600; color: #18181b;\">${shippedDate}</p>\n                    </td>\n                  </tr>\n                  <tr>\n                    <td colspan=\"2\" style=\"padding-top: 12px; border-top: 1px solid #bfdbfe;\">\n                      <p style=\"margin: 0 0 4px 0; font-size: 12px; color: #71717a; text-transform: uppercase;\">Tracking Number</p>\n                      <p style=\"margin: 0; font-size: 18px; font-weight: 700; color: #18181b; font-family: monospace;\">${shipment.trackingNumber}</p>\n                    </td>\n                  </tr>\n                  ${shipment.estimatedDelivery ? `\n                  <tr>\n                    <td colspan=\"2\" style=\"padding-top: 12px;\">\n                      <p style=\"margin: 0 0 4px 0; font-size: 12px; color: #71717a; text-transform: uppercase;\">Estimated Delivery</p>\n                      <p style=\"margin: 0; font-size: 16px; font-weight: 600; color: #22c55e;\">${shipment.estimatedDelivery}</p>\n                    </td>\n                  </tr>\n                  ` : ''}\n                </table>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </table>\n  `;\n}\n\n/**\n * Generate shipped items list\n */\nfunction generateShippedItems(items: OrderItem[]): string {\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      ${items.map(item => `\n        <tr>\n          <td style=\"padding: 12px 0; border-bottom: 1px solid #e4e4e7;\">\n            <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n              <tr>\n                ${item.imageUrl ? `\n                <td width=\"60\" valign=\"top\" style=\"padding-right: 12px;\">\n                  <img src=\"${item.imageUrl}\" alt=\"${item.name}\" width=\"60\" height=\"60\" style=\"border-radius: 4px; object-fit: cover;\">\n                </td>\n                ` : ''}\n                <td valign=\"middle\">\n                  <p style=\"margin: 0 0 2px 0; font-weight: 500; color: #18181b;\">${item.name}</p>\n                  ${item.variant ? `<p style=\"margin: 0; font-size: 13px; color: #71717a;\">${item.variant}</p>` : ''}\n                </td>\n                <td width=\"50\" valign=\"middle\" align=\"right\">\n                  <p style=\"margin: 0; font-size: 14px; color: #71717a;\">x${item.quantity}</p>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n      `).join('')}\n    </table>\n  `;\n}\n\n/**\n * Generate shipping notification email content\n */\nexport function generateShippingNotificationContent(data: ShipmentData): string {\n  const { order, shipment, customer, isPartialShipment } = data;\n  const itemsToShow = shipment.items || order.items;\n\n  return `\n    ${emailComponents.heading.h1('Your order is on its way! ')}\n\n    ${emailComponents.paragraph(`Hi ${customer.name},`)}\n\n    ${emailComponents.paragraph(\n      isPartialShipment\n        ? `Part of your order #${order.orderNumber} has shipped! Here are the tracking details for this shipment.`\n        : `Great news! Your order #${order.orderNumber} has shipped and is on its way to you.`\n    )}\n\n    ${generateTrackingBox(shipment)}\n\n    ${shipment.trackingUrl ? emailComponents.button('Track Your Package', shipment.trackingUrl) : ''}\n\n    ${emailComponents.divider()}\n\n    ${emailComponents.heading.h2(isPartialShipment ? 'Items in This Shipment' : 'Items Shipped')}\n\n    ${generateShippedItems(itemsToShow)}\n\n    ${emailComponents.divider()}\n\n    ${emailComponents.heading.h2('Shipping To')}\n\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      <tr>\n        <td style=\"padding: 16px; background-color: #fafafa; border-radius: 6px;\">\n          <p style=\"margin: 0; line-height: 1.6; color: #3f3f46;\">\n            <strong>${shipment.shippingAddress.name}</strong><br>\n            ${shipment.shippingAddress.line1}<br>\n            ${shipment.shippingAddress.line2 ? shipment.shippingAddress.line2 + '<br>' : ''}\n            ${shipment.shippingAddress.city}, ${shipment.shippingAddress.state} ${shipment.shippingAddress.postalCode}<br>\n            ${shipment.shippingAddress.country}\n          </p>\n        </td>\n      </tr>\n    </table>\n\n    ${emailComponents.infoBox(`\n      <p style=\"margin: 0; font-size: 14px;\">\n        <strong>Tip:</strong> You can also track your package by visiting your\n        <a href=\"{{store.url}}/account/orders/${order.id}\" style=\"color: #3b82f6; text-decoration: none;\">order details page</a>.\n      </p>\n    `)}\n\n    ${emailComponents.mutedText('If you have any questions about your shipment, please contact our support team.')}\n  `;\n}\n\n/**\n * Render complete shipping notification email\n */\nexport function renderShippingNotificationEmail(\n  data: ShipmentData,\n  store?: Partial<StoreConfig>\n): { html: string; text: string; subject: string } {\n  const content = generateShippingNotificationContent(data);\n\n  const mergeData: Record<string, unknown> = {\n    order: data.order,\n    shipment: data.shipment,\n    customer: data.customer,\n  };\n\n  const html = renderEmail(\n    content,\n    {\n      title: `Your Order #${data.order.orderNumber} Has Shipped`,\n      preheader: `Your order is on its way! Track your package with ${data.shipment.carrierName || data.shipment.carrier}.`,\n    },\n    mergeData,\n    { store }\n  );\n\n  const itemsToShow = data.shipment.items || data.order.items;\n\n  const text = `\nYour order is on its way!\n\nHi ${data.customer.name},\n\n${data.isPartialShipment\n  ? `Part of your order #${data.order.orderNumber} has shipped!`\n  : `Great news! Your order #${data.order.orderNumber} has shipped and is on its way to you.`\n}\n\nSHIPMENT DETAILS:\nCarrier: ${data.shipment.carrierName || data.shipment.carrier}\nTracking Number: ${data.shipment.trackingNumber}\n${data.shipment.trackingUrl ? `Track your package: ${data.shipment.trackingUrl}` : ''}\n${data.shipment.estimatedDelivery ? `Estimated Delivery: ${data.shipment.estimatedDelivery}` : ''}\n\nITEMS SHIPPED:\n${itemsToShow.map(item => `- ${item.name}${item.variant ? ` (${item.variant})` : ''} x${item.quantity}`).join('\\n')}\n\nSHIPPING TO:\n${data.shipment.shippingAddress.name}\n${data.shipment.shippingAddress.line1}\n${data.shipment.shippingAddress.line2 ? data.shipment.shippingAddress.line2 + '\\n' : ''}${data.shipment.shippingAddress.city}, ${data.shipment.shippingAddress.state} ${data.shipment.shippingAddress.postalCode}\n${data.shipment.shippingAddress.country}\n\nIf you have any questions, please contact our support team.\n  `.trim();\n\n  return {\n    html,\n    text,\n    subject: `Your Order #${data.order.orderNumber} Has Shipped`,\n  };\n}\n","/**\n * Delivery Confirmation Email Template\n *\n * Sent when an order has been delivered.\n * Includes delivery details and prompts for feedback/review.\n */\n\nimport { renderEmail, StoreConfig, emailComponents } from './renderer';\nimport { OrderItem, OrderAddress } from './order-confirmation';\n\nexport interface DeliveryData {\n  order: {\n    id: string;\n    orderNumber: string;\n    items: OrderItem[];\n  };\n  delivery: {\n    deliveredAt: Date | string;\n    deliveredTo?: string;\n    signedBy?: string;\n    proofImageUrl?: string;\n    shippingAddress: OrderAddress;\n  };\n  customer: {\n    name: string;\n    email: string;\n  };\n}\n\n/**\n * Generate delivery confirmation box\n */\nfunction generateDeliveryBox(delivery: DeliveryData['delivery']): string {\n  const deliveredDate = new Date(delivery.deliveredAt).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  const deliveredTime = new Date(delivery.deliveredAt).toLocaleTimeString('en-US', {\n    hour: 'numeric',\n    minute: '2-digit',\n  });\n\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0; background-color: #f0fdf4; border-radius: 8px;\">\n      <tr>\n        <td style=\"padding: 24px;\">\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n            <tr>\n              <td align=\"center\" style=\"padding-bottom: 16px;\">\n                <div style=\"width: 64px; height: 64px; background-color: #22c55e; border-radius: 50%; display: inline-block; text-align: center; line-height: 64px;\">\n                  <span style=\"font-size: 32px;\"></span>\n                </div>\n              </td>\n            </tr>\n            <tr>\n              <td align=\"center\">\n                <p style=\"margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #166534;\">Delivered!</p>\n                <p style=\"margin: 0 0 4px 0; font-size: 16px; color: #3f3f46;\">${deliveredDate}</p>\n                <p style=\"margin: 0; font-size: 14px; color: #71717a;\">at ${deliveredTime}</p>\n              </td>\n            </tr>\n            ${delivery.signedBy ? `\n            <tr>\n              <td align=\"center\" style=\"padding-top: 16px; border-top: 1px solid #bbf7d0; margin-top: 16px;\">\n                <p style=\"margin: 0; font-size: 14px; color: #71717a;\">Signed by: <strong style=\"color: #3f3f46;\">${delivery.signedBy}</strong></p>\n              </td>\n            </tr>\n            ` : ''}\n            ${delivery.deliveredTo ? `\n            <tr>\n              <td align=\"center\" style=\"padding-top: 8px;\">\n                <p style=\"margin: 0; font-size: 14px; color: #71717a;\">Delivered to: <strong style=\"color: #3f3f46;\">${delivery.deliveredTo}</strong></p>\n              </td>\n            </tr>\n            ` : ''}\n          </table>\n        </td>\n      </tr>\n    </table>\n  `;\n}\n\n/**\n * Generate delivered items list (compact)\n */\nfunction generateDeliveredItems(items: OrderItem[]): string {\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      ${items.map(item => `\n        <tr>\n          <td style=\"padding: 10px 0; border-bottom: 1px solid #e4e4e7;\">\n            <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n              <tr>\n                ${item.imageUrl ? `\n                <td width=\"50\" valign=\"middle\" style=\"padding-right: 12px;\">\n                  <img src=\"${item.imageUrl}\" alt=\"${item.name}\" width=\"50\" height=\"50\" style=\"border-radius: 4px; object-fit: cover;\">\n                </td>\n                ` : ''}\n                <td valign=\"middle\">\n                  <p style=\"margin: 0; font-size: 15px; color: #18181b;\">${item.name}</p>\n                  ${item.variant ? `<p style=\"margin: 2px 0 0 0; font-size: 13px; color: #71717a;\">${item.variant}</p>` : ''}\n                </td>\n                <td width=\"40\" valign=\"middle\" align=\"right\">\n                  <p style=\"margin: 0; font-size: 14px; color: #71717a;\">x${item.quantity}</p>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n      `).join('')}\n    </table>\n  `;\n}\n\n/**\n * Generate review prompt section\n */\nfunction generateReviewPrompt(orderId: string): string {\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0; background-color: #fefce8; border: 1px solid #fef08a; border-radius: 8px;\">\n      <tr>\n        <td style=\"padding: 24px;\">\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n            <tr>\n              <td align=\"center\">\n                <p style=\"margin: 0 0 8px 0; font-size: 24px;\"></p>\n                <p style=\"margin: 0 0 8px 0; font-size: 18px; font-weight: 600; color: #854d0e;\">How was your experience?</p>\n                <p style=\"margin: 0 0 16px 0; font-size: 14px; color: #713f12;\">We'd love to hear your feedback! Your review helps other shoppers and helps us improve.</p>\n              </td>\n            </tr>\n            <tr>\n              <td align=\"center\">\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\n                  <tr>\n                    <td style=\"border-radius: 6px; background-color: #eab308;\">\n                      <a href=\"{{store.url}}/account/orders/${orderId}/review\" style=\"display: inline-block; padding: 12px 24px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; font-weight: 600; color: #ffffff; text-decoration: none; border-radius: 6px;\">\n                        Write a Review\n                      </a>\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </table>\n  `;\n}\n\n/**\n * Generate delivery confirmation email content\n */\nexport function generateDeliveryConfirmationContent(data: DeliveryData): string {\n  const { order, delivery, customer } = data;\n\n  return `\n    ${emailComponents.heading.h1('Your order has been delivered!')}\n\n    ${emailComponents.paragraph(`Hi ${customer.name},`)}\n\n    ${emailComponents.paragraph(`Great news! Your order #${order.orderNumber} has been delivered. We hope you love your purchase!`)}\n\n    ${generateDeliveryBox(delivery)}\n\n    ${delivery.proofImageUrl ? `\n    ${emailComponents.heading.h3('Delivery Photo')}\n    ${emailComponents.image(delivery.proofImageUrl, 'Delivery proof photo', 400)}\n    ` : ''}\n\n    ${emailComponents.divider()}\n\n    ${emailComponents.heading.h2('Items Delivered')}\n\n    ${generateDeliveredItems(order.items)}\n\n    ${emailComponents.heading.h3('Delivered To')}\n\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      <tr>\n        <td style=\"padding: 16px; background-color: #fafafa; border-radius: 6px;\">\n          <p style=\"margin: 0; line-height: 1.6; color: #3f3f46;\">\n            ${delivery.shippingAddress.name}<br>\n            ${delivery.shippingAddress.line1}<br>\n            ${delivery.shippingAddress.line2 ? delivery.shippingAddress.line2 + '<br>' : ''}\n            ${delivery.shippingAddress.city}, ${delivery.shippingAddress.state} ${delivery.shippingAddress.postalCode}<br>\n            ${delivery.shippingAddress.country}\n          </p>\n        </td>\n      </tr>\n    </table>\n\n    ${generateReviewPrompt(order.id)}\n\n    ${emailComponents.infoBox(`\n      <p style=\"margin: 0; font-size: 14px;\">\n        <strong>Didn't receive your package?</strong> If something doesn't look right,\n        please <a href=\"{{store.url}}/support\" style=\"color: #3b82f6; text-decoration: none;\">contact our support team</a>\n        and we'll help resolve the issue.\n      </p>\n    `)}\n\n    ${emailComponents.mutedText('Thank you for shopping with us! We appreciate your business.')}\n  `;\n}\n\n/**\n * Render complete delivery confirmation email\n */\nexport function renderDeliveryConfirmationEmail(\n  data: DeliveryData,\n  store?: Partial<StoreConfig>\n): { html: string; text: string; subject: string } {\n  const content = generateDeliveryConfirmationContent(data);\n\n  const mergeData: Record<string, unknown> = {\n    order: data.order,\n    delivery: data.delivery,\n    customer: data.customer,\n  };\n\n  const html = renderEmail(\n    content,\n    {\n      title: `Your Order #${data.order.orderNumber} Has Been Delivered`,\n      preheader: `Your order has been delivered! We hope you love your purchase.`,\n    },\n    mergeData,\n    { store }\n  );\n\n  const deliveredDate = new Date(data.delivery.deliveredAt).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  const text = `\nYour order has been delivered!\n\nHi ${data.customer.name},\n\nGreat news! Your order #${data.order.orderNumber} has been delivered. We hope you love your purchase!\n\nDELIVERY DETAILS:\nDelivered on: ${deliveredDate}\n${data.delivery.signedBy ? `Signed by: ${data.delivery.signedBy}` : ''}\n${data.delivery.deliveredTo ? `Delivered to: ${data.delivery.deliveredTo}` : ''}\n\nITEMS DELIVERED:\n${data.order.items.map(item => `- ${item.name}${item.variant ? ` (${item.variant})` : ''} x${item.quantity}`).join('\\n')}\n\nDELIVERED TO:\n${data.delivery.shippingAddress.name}\n${data.delivery.shippingAddress.line1}\n${data.delivery.shippingAddress.line2 ? data.delivery.shippingAddress.line2 + '\\n' : ''}${data.delivery.shippingAddress.city}, ${data.delivery.shippingAddress.state} ${data.delivery.shippingAddress.postalCode}\n${data.delivery.shippingAddress.country}\n\nHOW WAS YOUR EXPERIENCE?\nWe'd love to hear your feedback! Write a review at:\n{{store.url}}/account/orders/${data.order.id}/review\n\nIf something doesn't look right, please contact our support team.\n\nThank you for shopping with us!\n  `.trim();\n\n  return {\n    html,\n    text,\n    subject: `Your Order #${data.order.orderNumber} Has Been Delivered`,\n  };\n}\n","/**\n * Refund Notification Email Template\n *\n * Sent when a refund has been processed for an order.\n * Includes refund details and timeline.\n */\n\nimport { renderEmail, StoreConfig, emailComponents } from './renderer';\nimport { OrderItem } from './order-confirmation';\n\nexport interface RefundData {\n  order: {\n    id: string;\n    orderNumber: string;\n    items: OrderItem[];\n    total: number;\n    currency?: string;\n  };\n  refund: {\n    id: string;\n    amount: number;\n    reason?: string;\n    type: 'full' | 'partial';\n    refundedItems?: OrderItem[];\n    processedAt: Date | string;\n    estimatedArrival?: string;\n    paymentMethod?: string;\n    lastFourDigits?: string;\n  };\n  customer: {\n    name: string;\n    email: string;\n  };\n}\n\n/**\n * Generate refund summary box\n */\nfunction generateRefundBox(refund: RefundData['refund'], currency = 'USD'): string {\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(amount / 100);\n  };\n\n  const processedDate = new Date(refund.processedAt).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0; background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px;\">\n      <tr>\n        <td style=\"padding: 24px;\">\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n            <tr>\n              <td align=\"center\" style=\"padding-bottom: 16px;\">\n                <p style=\"margin: 0; font-size: 14px; color: #166534; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">\n                   Refund Processed\n                </p>\n              </td>\n            </tr>\n            <tr>\n              <td align=\"center\">\n                <p style=\"margin: 0 0 8px 0; font-size: 36px; font-weight: 700; color: #166534;\">${formatPrice(refund.amount)}</p>\n                <p style=\"margin: 0; font-size: 14px; color: #71717a;\">${refund.type === 'full' ? 'Full Refund' : 'Partial Refund'}</p>\n              </td>\n            </tr>\n            <tr>\n              <td style=\"padding-top: 20px;\">\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                  <tr>\n                    <td width=\"50%\" style=\"padding: 8px 0;\">\n                      <p style=\"margin: 0 0 2px 0; font-size: 12px; color: #71717a; text-transform: uppercase;\">Processed</p>\n                      <p style=\"margin: 0; font-size: 14px; font-weight: 500; color: #3f3f46;\">${processedDate}</p>\n                    </td>\n                    <td width=\"50%\" style=\"padding: 8px 0;\">\n                      <p style=\"margin: 0 0 2px 0; font-size: 12px; color: #71717a; text-transform: uppercase;\">Refund To</p>\n                      <p style=\"margin: 0; font-size: 14px; font-weight: 500; color: #3f3f46;\">\n                        ${refund.paymentMethod || 'Original payment method'}\n                        ${refund.lastFourDigits ? `  ${refund.lastFourDigits}` : ''}\n                      </p>\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n            ${refund.estimatedArrival ? `\n            <tr>\n              <td style=\"padding-top: 16px; border-top: 1px solid #bbf7d0; margin-top: 16px;\">\n                <p style=\"margin: 0; font-size: 14px; color: #71717a;\">\n                  <strong>Estimated arrival:</strong> ${refund.estimatedArrival}\n                </p>\n              </td>\n            </tr>\n            ` : ''}\n          </table>\n        </td>\n      </tr>\n    </table>\n  `;\n}\n\n/**\n * Generate refunded items list\n */\nfunction generateRefundedItems(items: OrderItem[], currency = 'USD'): string {\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(amount / 100);\n  };\n\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 16px 0;\">\n      ${items.map(item => `\n        <tr>\n          <td style=\"padding: 12px 0; border-bottom: 1px solid #e4e4e7;\">\n            <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n              <tr>\n                ${item.imageUrl ? `\n                <td width=\"50\" valign=\"middle\" style=\"padding-right: 12px;\">\n                  <img src=\"${item.imageUrl}\" alt=\"${item.name}\" width=\"50\" height=\"50\" style=\"border-radius: 4px; object-fit: cover;\">\n                </td>\n                ` : ''}\n                <td valign=\"middle\">\n                  <p style=\"margin: 0; font-size: 15px; color: #18181b;\">${item.name}</p>\n                  ${item.variant ? `<p style=\"margin: 2px 0 0 0; font-size: 13px; color: #71717a;\">${item.variant}</p>` : ''}\n                </td>\n                <td width=\"40\" valign=\"middle\" align=\"center\">\n                  <p style=\"margin: 0; font-size: 14px; color: #71717a;\">x${item.quantity}</p>\n                </td>\n                <td width=\"80\" valign=\"middle\" align=\"right\">\n                  <p style=\"margin: 0; font-size: 14px; font-weight: 500; color: #166534;\">${formatPrice(item.price * item.quantity)}</p>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n      `).join('')}\n    </table>\n  `;\n}\n\n/**\n * Generate refund timeline\n */\nfunction generateRefundTimeline(): string {\n  return `\n    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n      <tr>\n        <td style=\"padding: 20px; background-color: #fafafa; border-radius: 8px;\">\n          <p style=\"margin: 0 0 16px 0; font-weight: 600; color: #18181b;\">When will I receive my refund?</p>\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n            <tr>\n              <td style=\"padding: 8px 0;\">\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                  <tr>\n                    <td width=\"24\" valign=\"top\">\n                      <div style=\"width: 20px; height: 20px; background-color: #22c55e; border-radius: 50%; text-align: center; line-height: 20px; color: white; font-size: 12px;\"></div>\n                    </td>\n                    <td style=\"padding-left: 12px;\">\n                      <p style=\"margin: 0; font-size: 14px; color: #3f3f46;\"><strong>Refund initiated</strong> - We've started processing your refund</p>\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n            <tr>\n              <td style=\"padding: 8px 0;\">\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                  <tr>\n                    <td width=\"24\" valign=\"top\">\n                      <div style=\"width: 20px; height: 20px; background-color: #d4d4d8; border-radius: 50%; text-align: center; line-height: 20px; color: white; font-size: 12px;\">2</div>\n                    </td>\n                    <td style=\"padding-left: 12px;\">\n                      <p style=\"margin: 0; font-size: 14px; color: #71717a;\"><strong>Bank processing</strong> - Your bank will process the refund (1-3 business days)</p>\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n            <tr>\n              <td style=\"padding: 8px 0;\">\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                  <tr>\n                    <td width=\"24\" valign=\"top\">\n                      <div style=\"width: 20px; height: 20px; background-color: #d4d4d8; border-radius: 50%; text-align: center; line-height: 20px; color: white; font-size: 12px;\">3</div>\n                    </td>\n                    <td style=\"padding-left: 12px;\">\n                      <p style=\"margin: 0; font-size: 14px; color: #71717a;\"><strong>Funds returned</strong> - The refund will appear on your statement (3-10 business days)</p>\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </table>\n  `;\n}\n\n/**\n * Generate refund notification email content\n */\nexport function generateRefundNotificationContent(data: RefundData): string {\n  const { order, refund, customer } = data;\n  const currency = order.currency || 'USD';\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(amount / 100);\n  };\n\n  return `\n    ${emailComponents.heading.h1('Your refund has been processed')}\n\n    ${emailComponents.paragraph(`Hi ${customer.name},`)}\n\n    ${emailComponents.paragraph(\n      refund.type === 'full'\n        ? `We've processed a full refund of ${formatPrice(refund.amount)} for your order #${order.orderNumber}.`\n        : `We've processed a partial refund of ${formatPrice(refund.amount)} for your order #${order.orderNumber}.`\n    )}\n\n    ${generateRefundBox(refund, currency)}\n\n    ${refund.reason ? `\n    ${emailComponents.infoBox(`\n      <p style=\"margin: 0;\"><strong>Refund reason:</strong> ${refund.reason}</p>\n    `)}\n    ` : ''}\n\n    ${refund.refundedItems && refund.refundedItems.length > 0 ? `\n    ${emailComponents.divider()}\n\n    ${emailComponents.heading.h2('Refunded Items')}\n\n    ${generateRefundedItems(refund.refundedItems, currency)}\n    ` : ''}\n\n    ${generateRefundTimeline()}\n\n    ${emailComponents.button('View Order Details', `{{store.url}}/account/orders/${order.id}`)}\n\n    ${emailComponents.divider()}\n\n    ${emailComponents.warningBox(`\n      <p style=\"margin: 0; font-size: 14px;\">\n        <strong>Note:</strong> Refund processing times vary by payment method and bank.\n        If you don't see the refund after 10 business days, please\n        <a href=\"{{store.url}}/support\" style=\"color: #d97706; text-decoration: none;\">contact our support team</a>.\n      </p>\n    `)}\n\n    ${emailComponents.mutedText('We\\'re sorry to see this order returned. If there\\'s anything we could have done better, please let us know.')}\n  `;\n}\n\n/**\n * Render complete refund notification email\n */\nexport function renderRefundNotificationEmail(\n  data: RefundData,\n  store?: Partial<StoreConfig>\n): { html: string; text: string; subject: string } {\n  const content = generateRefundNotificationContent(data);\n  const currency = data.order.currency || 'USD';\n\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(amount / 100);\n  };\n\n  const mergeData: Record<string, unknown> = {\n    order: data.order,\n    refund: data.refund,\n    customer: data.customer,\n  };\n\n  const html = renderEmail(\n    content,\n    {\n      title: `Refund Processed for Order #${data.order.orderNumber}`,\n      preheader: `Your ${formatPrice(data.refund.amount)} refund has been processed and is on its way back to you.`,\n    },\n    mergeData,\n    { store }\n  );\n\n  const processedDate = new Date(data.refund.processedAt).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  const text = `\nYour refund has been processed\n\nHi ${data.customer.name},\n\n${data.refund.type === 'full'\n  ? `We've processed a full refund of ${formatPrice(data.refund.amount)} for your order #${data.order.orderNumber}.`\n  : `We've processed a partial refund of ${formatPrice(data.refund.amount)} for your order #${data.order.orderNumber}.`\n}\n\nREFUND DETAILS:\nAmount: ${formatPrice(data.refund.amount)}\nType: ${data.refund.type === 'full' ? 'Full Refund' : 'Partial Refund'}\nProcessed: ${processedDate}\nRefund to: ${data.refund.paymentMethod || 'Original payment method'}${data.refund.lastFourDigits ? `  ${data.refund.lastFourDigits}` : ''}\n${data.refund.estimatedArrival ? `Estimated arrival: ${data.refund.estimatedArrival}` : ''}\n\n${data.refund.reason ? `Reason: ${data.refund.reason}` : ''}\n\n${data.refund.refundedItems && data.refund.refundedItems.length > 0 ? `\nREFUNDED ITEMS:\n${data.refund.refundedItems.map(item => `- ${item.name}${item.variant ? ` (${item.variant})` : ''} x${item.quantity} - ${formatPrice(item.price * item.quantity)}`).join('\\n')}\n` : ''}\n\nWHEN WILL I RECEIVE MY REFUND?\n1. Refund initiated - We've started processing your refund\n2. Bank processing - Your bank will process the refund (1-3 business days)\n3. Funds returned - The refund will appear on your statement (3-10 business days)\n\nIf you don't see the refund after 10 business days, please contact our support team.\n\nView your order: {{store.url}}/account/orders/${data.order.id}\n  `.trim();\n\n  return {\n    html,\n    text,\n    subject: `Refund Processed for Order #${data.order.orderNumber}`,\n  };\n}\n","/**\n * Puck Email Template Renderer\n *\n * Renders EmailTemplate records that contain Puck JSON content\n */\n\nimport { prisma } from '../../db';\nimport { parseMergeTags, MergeTagData } from '../merge-tags';\nimport { wrapInBaseTemplate, htmlToPlainText } from './renderer';\nimport { getEmailSettings } from '../../settings';\n\ninterface RenderResult {\n  html: string;\n  text: string;\n  subject?: string;\n}\n\n/**\n * Render an email template by ID with merge data\n */\nexport async function renderEmailTemplate(\n  templateId: string,\n  data: Record<string, unknown>\n): Promise<RenderResult> {\n  const template = await prisma.emailTemplate.findUnique({\n    where: { id: templateId },\n  });\n\n  if (!template) {\n    throw new Error(`Email template not found: ${templateId}`);\n  }\n\n  return renderEmailTemplateData(template, data);\n}\n\n/**\n * Render an email template by slug with merge data\n */\nexport async function renderEmailTemplateBySlug(\n  slug: string,\n  data: Record<string, unknown>\n): Promise<RenderResult | null> {\n  const template = await prisma.emailTemplate.findUnique({\n    where: { slug },\n  });\n\n  if (!template) {\n    return null;\n  }\n\n  return renderEmailTemplateData(template, data);\n}\n\n/**\n * Render template data (internal helper)\n */\nasync function renderEmailTemplateData(\n  template: {\n    subject: string | null;\n    preheader: string | null;\n    content: unknown;\n    html: string | null;\n    name: string;\n  },\n  data: Record<string, unknown>\n): Promise<RenderResult> {\n  const emailSettings = await getEmailSettings();\n\n  // Build merge data with store info\n  const mergeData: MergeTagData = {\n    ...flattenData(data),\n    store: {\n      name: emailSettings.fromName || 'Our Store',\n      email: emailSettings.fromEmail || 'noreply@example.com',\n      url: process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',\n    },\n    currentYear: new Date().getFullYear().toString(),\n  };\n\n  let html: string;\n  let subject = template.subject || template.name;\n\n  // Process subject merge tags\n  subject = parseMergeTags(subject, mergeData);\n\n  // If we have Puck JSON content, render it\n  if (template.content && typeof template.content === 'object') {\n    html = renderPuckContent(template.content as PuckContent, mergeData);\n  } else if (template.html) {\n    // Use pre-rendered HTML\n    html = template.html;\n  } else {\n    // Fallback to empty content\n    html = '<p>No content</p>';\n  }\n\n  // Process merge tags in HTML\n  html = parseMergeTags(html, mergeData);\n\n  // Wrap in base template\n  html = wrapInBaseTemplate(html, {\n    title: subject,\n    preheader: template.preheader ? parseMergeTags(template.preheader, mergeData) : undefined,\n    store: {\n      name: emailSettings.fromName || 'Our Store',\n      url: process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',\n      supportEmail: emailSettings.replyTo || emailSettings.fromEmail || 'support@example.com',\n    },\n  });\n\n  // Generate plain text version\n  const text = htmlToPlainText(html);\n\n  return { html, text, subject };\n}\n\n/**\n * Puck content structure\n */\ninterface PuckContent {\n  content?: PuckComponent[];\n  root?: {\n    props?: Record<string, unknown>;\n  };\n}\n\ninterface PuckComponent {\n  type: string;\n  props?: Record<string, unknown>;\n}\n\n/**\n * Render Puck email content to HTML\n */\nfunction renderPuckContent(content: PuckContent, mergeData: MergeTagData): string {\n  if (!content.content || !Array.isArray(content.content)) {\n    return '';\n  }\n\n  return content.content\n    .map((component) => renderPuckComponent(component, mergeData))\n    .join('\\n');\n}\n\n/**\n * Render individual Puck component to HTML\n */\nfunction renderPuckComponent(component: PuckComponent, mergeData: MergeTagData): string {\n  const props = component.props || {};\n\n  switch (component.type) {\n    case 'Heading':\n      const level = props.level || 'h1';\n      const headingText = parseMergeTags(String(props.text || ''), mergeData);\n      return `<${level} style=\"color: #333; margin: 0 0 16px 0;\">${headingText}</${level}>`;\n\n    case 'Text':\n    case 'Paragraph':\n      const text = parseMergeTags(String(props.text || props.content || ''), mergeData);\n      return `<p style=\"color: #333; line-height: 1.6; margin: 0 0 16px 0;\">${text}</p>`;\n\n    case 'Button':\n      const buttonText = parseMergeTags(String(props.label || props.text || 'Click Here'), mergeData);\n      const buttonUrl = parseMergeTags(String(props.url || props.href || '#'), mergeData);\n      const buttonColor = props.color || '#000';\n      return `\n        <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin: 16px 0;\">\n          <tr>\n            <td style=\"background-color: ${buttonColor}; border-radius: 6px; padding: 12px 24px;\">\n              <a href=\"${buttonUrl}\" style=\"color: #ffffff; text-decoration: none; font-weight: 600;\">${buttonText}</a>\n            </td>\n          </tr>\n        </table>\n      `;\n\n    case 'Image':\n      const src = parseMergeTags(String(props.src || props.url || ''), mergeData);\n      const alt = parseMergeTags(String(props.alt || ''), mergeData);\n      const width = props.width || '100%';\n      return `<img src=\"${src}\" alt=\"${alt}\" width=\"${width}\" style=\"max-width: 100%; height: auto; margin: 16px 0; border-radius: 8px;\" />`;\n\n    case 'Divider':\n      return '<hr style=\"border: none; border-top: 1px solid #eee; margin: 24px 0;\" />';\n\n    case 'Spacer':\n      const height = props.height || 24;\n      return `<div style=\"height: ${height}px;\"></div>`;\n\n    case 'Card':\n    case 'Box':\n      const cardContent = props.content ? renderPuckContent(props.content as PuckContent, mergeData) : '';\n      return `<div style=\"background: #f9f9f9; border-radius: 8px; padding: 24px; margin: 16px 0;\">${cardContent}</div>`;\n\n    case 'Table':\n      // Render data table\n      const rows = (props.rows || props.data) as Array<Record<string, string>> || [];\n      if (rows.length === 0) return '';\n\n      const tableRows = rows\n        .map((row) => {\n          const cells = Object.entries(row)\n            .map(([key, value]) => `<td style=\"padding: 8px; border-bottom: 1px solid #eee;\">${parseMergeTags(String(value), mergeData)}</td>`)\n            .join('');\n          return `<tr>${cells}</tr>`;\n        })\n        .join('');\n\n      return `<table style=\"width: 100%; border-collapse: collapse; margin: 16px 0;\"><tbody>${tableRows}</tbody></table>`;\n\n    case 'OrderSummary':\n    case 'SubmissionData':\n      // Render dynamic data from merge tags\n      const dataKey = typeof props.dataKey === 'string' ? props.dataKey : 'submission.fields';\n      const fields = getNestedValue(mergeData, dataKey) as Array<{ label: string; value: string }> || [];\n\n      if (!Array.isArray(fields) || fields.length === 0) return '';\n\n      const summaryRows = fields\n        .map((field) => `\n          <tr>\n            <td style=\"padding: 8px; border-bottom: 1px solid #eee; font-weight: 500;\">${field.label}</td>\n            <td style=\"padding: 8px; border-bottom: 1px solid #eee;\">${field.value}</td>\n          </tr>\n        `)\n        .join('');\n\n      return `<table style=\"width: 100%; border-collapse: collapse; margin: 16px 0;\"><tbody>${summaryRows}</tbody></table>`;\n\n    default:\n      // Unknown component - try to render children or return empty\n      if (props.children && typeof props.children === 'string') {\n        return `<div>${parseMergeTags(props.children, mergeData)}</div>`;\n      }\n      return '';\n  }\n}\n\n/**\n * Flatten nested object for merge tag access\n */\nfunction flattenData(data: Record<string, unknown>, prefix = ''): MergeTagData {\n  const result: MergeTagData = {};\n\n  for (const [key, value] of Object.entries(data)) {\n    const fullKey = prefix ? `${prefix}.${key}` : key;\n\n    if (value === null || value === undefined) {\n      result[fullKey] = '';\n    } else if (typeof value === 'object' && !Array.isArray(value)) {\n      Object.assign(result, flattenData(value as Record<string, unknown>, fullKey));\n      result[fullKey] = value as MergeTagData;\n    } else if (Array.isArray(value)) {\n      result[fullKey] = value as MergeTagData[];\n    } else {\n      result[fullKey] = value as string | number | boolean;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Get nested value from object using dot notation\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  return path.split('.').reduce((current, key) => {\n    if (current && typeof current === 'object') {\n      return (current as Record<string, unknown>)[key];\n    }\n    return undefined;\n  }, obj as unknown);\n}\n","/**\n * Transactional Notifications Service\n *\n * Sends order lifecycle emails by fetching order data and using email templates.\n * Integrates with Stripe/Shippo webhooks for automatic notifications.\n *\n * Supports Puck-editable templates - falls back to hardcoded templates if not found.\n */\n\nimport { prisma } from '../db';\nimport { sendEmail } from '../email';\nimport { getEmailSettings } from '../settings';\nimport {\n  renderOrderConfirmationEmail,\n  renderShippingNotificationEmail,\n  renderDeliveryConfirmationEmail,\n  renderRefundNotificationEmail,\n  type OrderConfirmationData,\n  type ShipmentData,\n  type DeliveryData,\n  type RefundData,\n} from '../email/templates';\nimport { renderEmailTemplateBySlug } from '../email/templates/render';\n\nexport interface NotificationResult {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}\n\n/**\n * Get store configuration for email templates\n */\nasync function getStoreConfig() {\n  const settings = await getEmailSettings();\n  return {\n    name: settings.fromName || 'Our Store',\n    url: process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',\n    supportEmail: settings.replyTo || settings.fromEmail,\n    logoUrl: process.env.NEXT_PUBLIC_LOGO_URL,\n  };\n}\n\n/**\n * Format address from Prisma Address model\n */\nfunction formatAddress(address: {\n  firstName: string;\n  lastName: string;\n  street1: string;\n  street2: string | null;\n  city: string;\n  state: string;\n  zip: string;\n  country: string;\n} | null) {\n  if (!address) {\n    return {\n      name: '',\n      line1: '',\n      city: '',\n      state: '',\n      postalCode: '',\n      country: 'US',\n    };\n  }\n  return {\n    name: `${address.firstName} ${address.lastName}`.trim(),\n    line1: address.street1,\n    line2: address.street2 || undefined,\n    city: address.city,\n    state: address.state,\n    postalCode: address.zip,\n    country: address.country,\n  };\n}\n\n/**\n * Get customer name from address or customer\n */\nfunction getCustomerName(\n  address: { firstName: string; lastName: string } | null | undefined,\n  customer: { firstName: string | null; lastName: string | null } | null | undefined\n): string {\n  if (address) {\n    return `${address.firstName} ${address.lastName}`.trim() || 'Customer';\n  }\n  if (customer) {\n    const name = [customer.firstName, customer.lastName].filter(Boolean).join(' ');\n    return name || 'Customer';\n  }\n  return 'Customer';\n}\n\n/**\n * Send order confirmation email\n */\nexport async function sendOrderConfirmation(orderId: string): Promise<NotificationResult> {\n  try {\n    const order = await prisma.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: {\n          include: {\n            product: {\n              include: {\n                images: {\n                  include: {\n                    media: true,\n                  },\n                  orderBy: { position: 'asc' },\n                  take: 1,\n                },\n              },\n            },\n          },\n        },\n        customer: true,\n        shippingAddress: true,\n        billingAddress: true,\n      },\n    });\n\n    if (!order) {\n      return { success: false, error: 'Order not found' };\n    }\n\n    const customerEmail = order.email || order.customer?.email;\n    if (!customerEmail) {\n      return { success: false, error: 'No customer email' };\n    }\n\n    const data: OrderConfirmationData = {\n      order: {\n        id: order.id,\n        orderNumber: order.orderNumber,\n        createdAt: order.createdAt,\n        items: order.items.map((item) => ({\n          id: item.id,\n          name: item.product?.title || item.title || 'Product',\n          variant: item.variantTitle || undefined,\n          quantity: item.quantity,\n          price: item.price, // Already in cents\n          imageUrl: item.product?.images?.[0]?.media?.url || undefined,\n        })),\n        subtotal: order.subtotal,\n        shipping: order.shippingTotal,\n        tax: order.taxTotal,\n        discount: order.discountTotal > 0 ? order.discountTotal : undefined,\n        total: order.total,\n        currency: 'USD', // Default currency\n        paymentMethod: 'Credit Card',\n        shippingAddress: formatAddress(order.shippingAddress),\n        billingAddress: order.billingAddress\n          ? formatAddress(order.billingAddress)\n          : undefined,\n        shippingMethod: undefined,\n        notes: order.customerNotes || undefined,\n      },\n      customer: {\n        name: getCustomerName(order.shippingAddress, order.customer),\n        email: customerEmail,\n      },\n    };\n\n    const store = await getStoreConfig();\n\n    // Try Puck template first, fall back to hardcoded\n    let html: string;\n    let text: string;\n    let subject: string;\n\n    const puckResult = await renderEmailTemplateBySlug('order-confirmation', {\n      order: data.order,\n      customer: data.customer,\n    });\n\n    if (puckResult) {\n      html = puckResult.html;\n      text = puckResult.text;\n      subject = puckResult.subject || `Order Confirmation #${data.order.orderNumber}`;\n    } else {\n      const fallback = renderOrderConfirmationEmail(data, store);\n      html = fallback.html;\n      text = fallback.text;\n      subject = fallback.subject;\n    }\n\n    const result = await sendEmail({\n      to: { email: customerEmail, name: data.customer.name },\n      subject,\n      html,\n      text,\n      metadata: {\n        orderId: order.id,\n        orderNumber: order.orderNumber,\n        type: 'order_confirmation',\n      },\n    });\n\n    return { success: result.success, messageId: result.messageId, error: result.error };\n  } catch (error) {\n    console.error('Error sending order confirmation:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Send shipping notification email\n */\nexport async function sendShippingNotification(\n  orderId: string,\n  shipmentId: string\n): Promise<NotificationResult> {\n  try {\n    const order = await prisma.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: {\n          include: {\n            product: {\n              include: {\n                images: {\n                  include: {\n                    media: true,\n                  },\n                  orderBy: { position: 'asc' },\n                  take: 1,\n                },\n              },\n            },\n          },\n        },\n        customer: true,\n        shippingAddress: true,\n      },\n    });\n\n    if (!order) {\n      return { success: false, error: 'Order not found' };\n    }\n\n    const shipment = await prisma.shipment.findUnique({\n      where: { id: shipmentId },\n    });\n\n    if (!shipment) {\n      return { success: false, error: 'Shipment not found' };\n    }\n\n    const customerEmail = order.email || order.customer?.email;\n    if (!customerEmail) {\n      return { success: false, error: 'No customer email' };\n    }\n\n    const data: ShipmentData = {\n      order: {\n        id: order.id,\n        orderNumber: order.orderNumber,\n        items: order.items.map((item) => ({\n          id: item.id,\n          name: item.product?.title || item.title || 'Product',\n          variant: item.variantTitle || undefined,\n          quantity: item.quantity,\n          price: item.price, // Already in cents\n          imageUrl: item.product?.images?.[0]?.media?.url || undefined,\n        })),\n      },\n      shipment: {\n        id: shipment.id,\n        carrier: shipment.carrier || 'Unknown',\n        carrierName: getCarrierName(shipment.carrier || ''),\n        trackingNumber: shipment.trackingNumber || '',\n        trackingUrl: shipment.trackingUrl || undefined,\n        shippedAt: shipment.shippedAt || new Date(),\n        estimatedDelivery: undefined, // Not available in schema\n        shippingAddress: formatAddress(order.shippingAddress),\n      },\n      customer: {\n        name: getCustomerName(order.shippingAddress, order.customer),\n        email: customerEmail,\n      },\n    };\n\n    const store = await getStoreConfig();\n\n    // Try Puck template first, fall back to hardcoded\n    let html: string;\n    let text: string;\n    let subject: string;\n\n    const puckResult = await renderEmailTemplateBySlug('shipping-notification', {\n      order: data.order,\n      shipment: data.shipment,\n      customer: data.customer,\n    });\n\n    if (puckResult) {\n      html = puckResult.html;\n      text = puckResult.text;\n      subject = puckResult.subject || `Your order #${data.order.orderNumber} has shipped!`;\n    } else {\n      const fallback = renderShippingNotificationEmail(data, store);\n      html = fallback.html;\n      text = fallback.text;\n      subject = fallback.subject;\n    }\n\n    const result = await sendEmail({\n      to: { email: customerEmail, name: data.customer.name },\n      subject,\n      html,\n      text,\n      metadata: {\n        orderId: order.id,\n        orderNumber: order.orderNumber,\n        shipmentId: shipment.id,\n        type: 'shipping_notification',\n      },\n    });\n\n    return { success: result.success, messageId: result.messageId, error: result.error };\n  } catch (error) {\n    console.error('Error sending shipping notification:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Send delivery confirmation email\n */\nexport async function sendDeliveryConfirmation(\n  orderId: string,\n  shipmentId: string\n): Promise<NotificationResult> {\n  try {\n    const order = await prisma.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: {\n          include: {\n            product: {\n              include: {\n                images: {\n                  include: {\n                    media: true,\n                  },\n                  orderBy: { position: 'asc' },\n                  take: 1,\n                },\n              },\n            },\n          },\n        },\n        customer: true,\n        shippingAddress: true,\n      },\n    });\n\n    if (!order) {\n      return { success: false, error: 'Order not found' };\n    }\n\n    const shipment = await prisma.shipment.findUnique({\n      where: { id: shipmentId },\n    });\n\n    if (!shipment) {\n      return { success: false, error: 'Shipment not found' };\n    }\n\n    const customerEmail = order.email || order.customer?.email;\n    if (!customerEmail) {\n      return { success: false, error: 'No customer email' };\n    }\n\n    const data: DeliveryData = {\n      order: {\n        id: order.id,\n        orderNumber: order.orderNumber,\n        items: order.items.map((item) => ({\n          id: item.id,\n          name: item.product?.title || item.title || 'Product',\n          variant: item.variantTitle || undefined,\n          quantity: item.quantity,\n          price: item.price, // Already in cents\n          imageUrl: item.product?.images?.[0]?.media?.url || undefined,\n        })),\n      },\n      delivery: {\n        deliveredAt: shipment.deliveredAt || new Date(),\n        signedBy: undefined, // Not tracked in schema\n        shippingAddress: formatAddress(order.shippingAddress),\n      },\n      customer: {\n        name: getCustomerName(order.shippingAddress, order.customer),\n        email: customerEmail,\n      },\n    };\n\n    const store = await getStoreConfig();\n\n    // Try Puck template first, fall back to hardcoded\n    let html: string;\n    let text: string;\n    let subject: string;\n\n    const puckResult = await renderEmailTemplateBySlug('delivery-confirmation', {\n      order: data.order,\n      delivery: data.delivery,\n      customer: data.customer,\n    });\n\n    if (puckResult) {\n      html = puckResult.html;\n      text = puckResult.text;\n      subject = puckResult.subject || `Your order #${data.order.orderNumber} has been delivered!`;\n    } else {\n      const fallback = renderDeliveryConfirmationEmail(data, store);\n      html = fallback.html;\n      text = fallback.text;\n      subject = fallback.subject;\n    }\n\n    const result = await sendEmail({\n      to: { email: customerEmail, name: data.customer.name },\n      subject,\n      html,\n      text,\n      metadata: {\n        orderId: order.id,\n        orderNumber: order.orderNumber,\n        shipmentId: shipment.id,\n        type: 'delivery_confirmation',\n      },\n    });\n\n    return { success: result.success, messageId: result.messageId, error: result.error };\n  } catch (error) {\n    console.error('Error sending delivery confirmation:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Send refund notification email\n */\nexport async function sendRefundNotification(\n  orderId: string,\n  refundAmount: number, // In cents\n  refundReason?: string,\n  isFullRefund = true\n): Promise<NotificationResult> {\n  try {\n    const order = await prisma.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: {\n          include: {\n            product: {\n              include: {\n                images: {\n                  include: {\n                    media: true,\n                  },\n                  orderBy: { position: 'asc' },\n                  take: 1,\n                },\n              },\n            },\n          },\n        },\n        customer: true,\n      },\n    });\n\n    if (!order) {\n      return { success: false, error: 'Order not found' };\n    }\n\n    const customerEmail = order.email || order.customer?.email;\n    if (!customerEmail) {\n      return { success: false, error: 'No customer email' };\n    }\n\n    const data: RefundData = {\n      order: {\n        id: order.id,\n        orderNumber: order.orderNumber,\n        total: order.total, // Already in cents\n        currency: 'USD',\n        items: order.items.map((item) => ({\n          id: item.id,\n          name: item.product?.title || item.title || 'Product',\n          variant: item.variantTitle || undefined,\n          quantity: item.quantity,\n          price: item.price, // Already in cents\n          imageUrl: item.product?.images?.[0]?.media?.url || undefined,\n        })),\n      },\n      refund: {\n        id: `refund_${Date.now()}`,\n        amount: refundAmount, // Already in cents\n        reason: refundReason,\n        type: isFullRefund ? 'full' : 'partial',\n        processedAt: new Date(),\n        paymentMethod: 'Original payment method',\n        estimatedArrival: '5-10 business days',\n      },\n      customer: {\n        name: order.customer ? [order.customer.firstName, order.customer.lastName].filter(Boolean).join(' ') || 'Customer' : 'Customer',\n        email: customerEmail,\n      },\n    };\n\n    const store = await getStoreConfig();\n\n    // Try Puck template first, fall back to hardcoded\n    let html: string;\n    let text: string;\n    let subject: string;\n\n    const puckResult = await renderEmailTemplateBySlug('refund-notification', {\n      order: data.order,\n      refund: data.refund,\n      customer: data.customer,\n    });\n\n    if (puckResult) {\n      html = puckResult.html;\n      text = puckResult.text;\n      subject = puckResult.subject || `Refund processed for order #${data.order.orderNumber}`;\n    } else {\n      const fallback = renderRefundNotificationEmail(data, store);\n      html = fallback.html;\n      text = fallback.text;\n      subject = fallback.subject;\n    }\n\n    const result = await sendEmail({\n      to: { email: customerEmail, name: data.customer.name },\n      subject,\n      html,\n      text,\n      metadata: {\n        orderId: order.id,\n        orderNumber: order.orderNumber,\n        type: 'refund_notification',\n      },\n    });\n\n    return { success: result.success, messageId: result.messageId, error: result.error };\n  } catch (error) {\n    console.error('Error sending refund notification:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\n/**\n * Helper to get friendly carrier name\n */\nfunction getCarrierName(carrier: string): string {\n  const names: Record<string, string> = {\n    usps: 'USPS',\n    ups: 'UPS',\n    fedex: 'FedEx',\n    dhl: 'DHL',\n    fedex_ground: 'FedEx Ground',\n    fedex_express: 'FedEx Express',\n    ups_ground: 'UPS Ground',\n    usps_priority: 'USPS Priority Mail',\n    usps_express: 'USPS Express',\n  };\n  return names[carrier.toLowerCase()] || carrier;\n}\n\nexport * from './types';\n","/**\n * Permission Constants\n * Defines all available permissions in the system\n */\n\n// Permission string format: \"resource.action\"\n// Wildcard support: \"resource.*\" or \"*\" (super admin)\n\nexport const PERMISSIONS = {\n  // Products\n  PRODUCTS_VIEW: 'products.view',\n  PRODUCTS_CREATE: 'products.create',\n  PRODUCTS_EDIT: 'products.edit',\n  PRODUCTS_DELETE: 'products.delete',\n  PRODUCTS_PUBLISH: 'products.publish',\n  PRODUCTS_ALL: 'products.*',\n\n  // Product Variants\n  VARIANTS_VIEW: 'variants.view',\n  VARIANTS_CREATE: 'variants.create',\n  VARIANTS_EDIT: 'variants.edit',\n  VARIANTS_DELETE: 'variants.delete',\n  VARIANTS_ALL: 'variants.*',\n\n  // Orders\n  ORDERS_VIEW: 'orders.view',\n  ORDERS_CREATE: 'orders.create',\n  ORDERS_EDIT: 'orders.edit',\n  ORDERS_DELETE: 'orders.delete',\n  ORDERS_FULFILL: 'orders.fulfill',\n  ORDERS_REFUND: 'orders.refund',\n  ORDERS_CANCEL: 'orders.cancel',\n  ORDERS_ALL: 'orders.*',\n\n  // Inventory\n  INVENTORY_VIEW: 'inventory.view',\n  INVENTORY_EDIT: 'inventory.edit',\n  INVENTORY_ALL: 'inventory.*',\n\n  // Customers\n  CUSTOMERS_VIEW: 'customers.view',\n  CUSTOMERS_CREATE: 'customers.create',\n  CUSTOMERS_EDIT: 'customers.edit',\n  CUSTOMERS_DELETE: 'customers.delete',\n  CUSTOMERS_EXPORT: 'customers.export',\n  CUSTOMERS_ALL: 'customers.*',\n\n  // Content - Pages\n  PAGES_VIEW: 'pages.view',\n  PAGES_CREATE: 'pages.create',\n  PAGES_EDIT: 'pages.edit',\n  PAGES_DELETE: 'pages.delete',\n  PAGES_PUBLISH: 'pages.publish',\n  PAGES_ALL: 'pages.*',\n\n  // Puck Templates\n  PUCK_TEMPLATES_VIEW: 'puck_templates.view',\n  PUCK_TEMPLATES_CREATE: 'puck_templates.create',\n  PUCK_TEMPLATES_EDIT: 'puck_templates.edit',\n  PUCK_TEMPLATES_DELETE: 'puck_templates.delete',\n  PUCK_TEMPLATES_ALL: 'puck_templates.*',\n\n  // Routes Configuration\n  ROUTES_VIEW: 'routes.view',\n  ROUTES_CREATE: 'routes.create',\n  ROUTES_EDIT: 'routes.edit',\n  ROUTES_DELETE: 'routes.delete',\n  ROUTES_ALL: 'routes.*',\n\n  // Content - Blog\n  BLOG_VIEW: 'blog.view',\n  BLOG_CREATE: 'blog.create',\n  BLOG_EDIT: 'blog.edit',\n  BLOG_DELETE: 'blog.delete',\n  BLOG_PUBLISH: 'blog.publish',\n  BLOG_ALL: 'blog.*',\n\n  // Media\n  MEDIA_VIEW: 'media.view',\n  MEDIA_UPLOAD: 'media.upload',\n  MEDIA_EDIT: 'media.edit',\n  MEDIA_DELETE: 'media.delete',\n  MEDIA_ALL: 'media.*',\n\n  // Categories\n  CATEGORIES_VIEW: 'categories.view',\n  CATEGORIES_CREATE: 'categories.create',\n  CATEGORIES_EDIT: 'categories.edit',\n  CATEGORIES_DELETE: 'categories.delete',\n  CATEGORIES_ALL: 'categories.*',\n\n  // Custom Fields\n  CUSTOM_FIELDS_VIEW: 'custom_fields.view',\n  CUSTOM_FIELDS_CREATE: 'custom_fields.create',\n  CUSTOM_FIELDS_EDIT: 'custom_fields.edit',\n  CUSTOM_FIELDS_DELETE: 'custom_fields.delete',\n  CUSTOM_FIELDS_ALL: 'custom_fields.*',\n\n  // Settings\n  SETTINGS_VIEW: 'settings.view',\n  SETTINGS_GENERAL: 'settings.general',\n  SETTINGS_PAYMENTS: 'settings.payments',\n  SETTINGS_SHIPPING: 'settings.shipping',\n  SETTINGS_TAXES: 'settings.taxes',\n  SETTINGS_EMAIL: 'settings.email',\n  SETTINGS_STORAGE: 'settings.storage',\n  SETTINGS_AI: 'settings.ai',\n  SETTINGS_ALL: 'settings.*',\n\n  // Users & Roles\n  USERS_VIEW: 'users.view',\n  USERS_CREATE: 'users.create',\n  USERS_EDIT: 'users.edit',\n  USERS_DELETE: 'users.delete',\n  USERS_ROLES: 'users.roles', // Manage role assignments\n  USERS_PERMISSIONS: 'users.permissions', // Manage permission overrides\n  USERS_ALL: 'users.*',\n\n  // Roles Management\n  ROLES_VIEW: 'roles.view',\n  ROLES_CREATE: 'roles.create',\n  ROLES_EDIT: 'roles.edit',\n  ROLES_DELETE: 'roles.delete',\n  ROLES_ALL: 'roles.*',\n\n  // Analytics\n  ANALYTICS_VIEW: 'analytics.view',\n  ANALYTICS_EXPORT: 'analytics.export',\n  ANALYTICS_ALL: 'analytics.*',\n\n  // Plugins & Workflows\n  PLUGINS_VIEW: 'plugins.view',\n  PLUGINS_INSTALL: 'plugins.install',\n  PLUGINS_CONFIGURE: 'plugins.configure',\n  PLUGINS_DELETE: 'plugins.delete',\n  PLUGINS_ALL: 'plugins.*',\n\n  WORKFLOWS_VIEW: 'workflows.view',\n  WORKFLOWS_CREATE: 'workflows.create',\n  WORKFLOWS_EDIT: 'workflows.edit',\n  WORKFLOWS_DELETE: 'workflows.delete',\n  WORKFLOWS_EXECUTE: 'workflows.execute',\n  WORKFLOWS_ALL: 'workflows.*',\n\n  // Forms\n  FORMS_VIEW: 'forms.view',\n  FORMS_CREATE: 'forms.create',\n  FORMS_EDIT: 'forms.edit',\n  FORMS_DELETE: 'forms.delete',\n  FORMS_SUBMISSIONS: 'forms.submissions',\n  FORMS_ALL: 'forms.*',\n\n  // Email Campaigns\n  EMAIL_VIEW: 'email.view',\n  EMAIL_CREATE: 'email.create',\n  EMAIL_EDIT: 'email.edit',\n  EMAIL_DELETE: 'email.delete',\n  EMAIL_SEND: 'email.send',\n  EMAIL_ALL: 'email.*',\n\n  // Audit Log\n  AUDIT_VIEW: 'audit.view',\n\n  // Super Admin (all permissions)\n  SUPER_ADMIN: '*',\n} as const\n\nexport type Permission = (typeof PERMISSIONS)[keyof typeof PERMISSIONS]\n\n// Permission groups for UI display\nexport const PERMISSION_GROUPS = {\n  products: {\n    label: 'Products',\n    permissions: [\n      { key: PERMISSIONS.PRODUCTS_VIEW, label: 'View products' },\n      { key: PERMISSIONS.PRODUCTS_CREATE, label: 'Create products' },\n      { key: PERMISSIONS.PRODUCTS_EDIT, label: 'Edit products' },\n      { key: PERMISSIONS.PRODUCTS_DELETE, label: 'Delete products' },\n      { key: PERMISSIONS.PRODUCTS_PUBLISH, label: 'Publish/unpublish products' },\n    ],\n  },\n  variants: {\n    label: 'Product Variants',\n    permissions: [\n      { key: PERMISSIONS.VARIANTS_VIEW, label: 'View variants' },\n      { key: PERMISSIONS.VARIANTS_CREATE, label: 'Create variants' },\n      { key: PERMISSIONS.VARIANTS_EDIT, label: 'Edit variants' },\n      { key: PERMISSIONS.VARIANTS_DELETE, label: 'Delete variants' },\n    ],\n  },\n  orders: {\n    label: 'Orders',\n    permissions: [\n      { key: PERMISSIONS.ORDERS_VIEW, label: 'View orders' },\n      { key: PERMISSIONS.ORDERS_CREATE, label: 'Create orders' },\n      { key: PERMISSIONS.ORDERS_EDIT, label: 'Edit orders' },\n      { key: PERMISSIONS.ORDERS_DELETE, label: 'Delete orders' },\n      { key: PERMISSIONS.ORDERS_FULFILL, label: 'Fulfill orders' },\n      { key: PERMISSIONS.ORDERS_REFUND, label: 'Process refunds' },\n      { key: PERMISSIONS.ORDERS_CANCEL, label: 'Cancel orders' },\n    ],\n  },\n  inventory: {\n    label: 'Inventory',\n    permissions: [\n      { key: PERMISSIONS.INVENTORY_VIEW, label: 'View inventory' },\n      { key: PERMISSIONS.INVENTORY_EDIT, label: 'Edit inventory' },\n    ],\n  },\n  customers: {\n    label: 'Customers',\n    permissions: [\n      { key: PERMISSIONS.CUSTOMERS_VIEW, label: 'View customers' },\n      { key: PERMISSIONS.CUSTOMERS_CREATE, label: 'Create customers' },\n      { key: PERMISSIONS.CUSTOMERS_EDIT, label: 'Edit customers' },\n      { key: PERMISSIONS.CUSTOMERS_DELETE, label: 'Delete customers' },\n      { key: PERMISSIONS.CUSTOMERS_EXPORT, label: 'Export customer data' },\n    ],\n  },\n  pages: {\n    label: 'Pages',\n    permissions: [\n      { key: PERMISSIONS.PAGES_VIEW, label: 'View pages' },\n      { key: PERMISSIONS.PAGES_CREATE, label: 'Create pages' },\n      { key: PERMISSIONS.PAGES_EDIT, label: 'Edit pages' },\n      { key: PERMISSIONS.PAGES_DELETE, label: 'Delete pages' },\n      { key: PERMISSIONS.PAGES_PUBLISH, label: 'Publish pages' },\n    ],\n  },\n  puck_templates: {\n    label: 'Page Templates',\n    permissions: [\n      { key: PERMISSIONS.PUCK_TEMPLATES_VIEW, label: 'View templates' },\n      { key: PERMISSIONS.PUCK_TEMPLATES_CREATE, label: 'Create templates' },\n      { key: PERMISSIONS.PUCK_TEMPLATES_EDIT, label: 'Edit templates' },\n      { key: PERMISSIONS.PUCK_TEMPLATES_DELETE, label: 'Delete templates' },\n    ],\n  },\n  routes: {\n    label: 'Route Configuration',\n    permissions: [\n      { key: PERMISSIONS.ROUTES_VIEW, label: 'View routes' },\n      { key: PERMISSIONS.ROUTES_CREATE, label: 'Create routes' },\n      { key: PERMISSIONS.ROUTES_EDIT, label: 'Edit routes' },\n      { key: PERMISSIONS.ROUTES_DELETE, label: 'Delete routes' },\n    ],\n  },\n  blog: {\n    label: 'Blog',\n    permissions: [\n      { key: PERMISSIONS.BLOG_VIEW, label: 'View blog posts' },\n      { key: PERMISSIONS.BLOG_CREATE, label: 'Create blog posts' },\n      { key: PERMISSIONS.BLOG_EDIT, label: 'Edit blog posts' },\n      { key: PERMISSIONS.BLOG_DELETE, label: 'Delete blog posts' },\n      { key: PERMISSIONS.BLOG_PUBLISH, label: 'Publish blog posts' },\n    ],\n  },\n  media: {\n    label: 'Media',\n    permissions: [\n      { key: PERMISSIONS.MEDIA_VIEW, label: 'View media' },\n      { key: PERMISSIONS.MEDIA_UPLOAD, label: 'Upload media' },\n      { key: PERMISSIONS.MEDIA_EDIT, label: 'Edit media' },\n      { key: PERMISSIONS.MEDIA_DELETE, label: 'Delete media' },\n    ],\n  },\n  categories: {\n    label: 'Categories',\n    permissions: [\n      { key: PERMISSIONS.CATEGORIES_VIEW, label: 'View categories' },\n      { key: PERMISSIONS.CATEGORIES_CREATE, label: 'Create categories' },\n      { key: PERMISSIONS.CATEGORIES_EDIT, label: 'Edit categories' },\n      { key: PERMISSIONS.CATEGORIES_DELETE, label: 'Delete categories' },\n    ],\n  },\n  settings: {\n    label: 'Settings',\n    permissions: [\n      { key: PERMISSIONS.SETTINGS_VIEW, label: 'View settings' },\n      { key: PERMISSIONS.SETTINGS_GENERAL, label: 'General settings' },\n      { key: PERMISSIONS.SETTINGS_PAYMENTS, label: 'Payment settings' },\n      { key: PERMISSIONS.SETTINGS_SHIPPING, label: 'Shipping settings' },\n      { key: PERMISSIONS.SETTINGS_TAXES, label: 'Tax settings' },\n      { key: PERMISSIONS.SETTINGS_EMAIL, label: 'Email settings' },\n      { key: PERMISSIONS.SETTINGS_STORAGE, label: 'Storage settings' },\n      { key: PERMISSIONS.SETTINGS_AI, label: 'AI settings' },\n    ],\n  },\n  users: {\n    label: 'User Management',\n    permissions: [\n      { key: PERMISSIONS.USERS_VIEW, label: 'View users' },\n      { key: PERMISSIONS.USERS_CREATE, label: 'Create users' },\n      { key: PERMISSIONS.USERS_EDIT, label: 'Edit users' },\n      { key: PERMISSIONS.USERS_DELETE, label: 'Delete users' },\n      { key: PERMISSIONS.USERS_ROLES, label: 'Manage user roles' },\n      { key: PERMISSIONS.USERS_PERMISSIONS, label: 'Manage user permissions' },\n    ],\n  },\n  roles: {\n    label: 'Role Management',\n    permissions: [\n      { key: PERMISSIONS.ROLES_VIEW, label: 'View roles' },\n      { key: PERMISSIONS.ROLES_CREATE, label: 'Create roles' },\n      { key: PERMISSIONS.ROLES_EDIT, label: 'Edit roles' },\n      { key: PERMISSIONS.ROLES_DELETE, label: 'Delete roles' },\n    ],\n  },\n  analytics: {\n    label: 'Analytics',\n    permissions: [\n      { key: PERMISSIONS.ANALYTICS_VIEW, label: 'View analytics' },\n      { key: PERMISSIONS.ANALYTICS_EXPORT, label: 'Export analytics' },\n    ],\n  },\n  plugins: {\n    label: 'Plugins',\n    permissions: [\n      { key: PERMISSIONS.PLUGINS_VIEW, label: 'View plugins' },\n      { key: PERMISSIONS.PLUGINS_INSTALL, label: 'Install plugins' },\n      { key: PERMISSIONS.PLUGINS_CONFIGURE, label: 'Configure plugins' },\n      { key: PERMISSIONS.PLUGINS_DELETE, label: 'Delete plugins' },\n    ],\n  },\n  workflows: {\n    label: 'Workflows',\n    permissions: [\n      { key: PERMISSIONS.WORKFLOWS_VIEW, label: 'View workflows' },\n      { key: PERMISSIONS.WORKFLOWS_CREATE, label: 'Create workflows' },\n      { key: PERMISSIONS.WORKFLOWS_EDIT, label: 'Edit workflows' },\n      { key: PERMISSIONS.WORKFLOWS_DELETE, label: 'Delete workflows' },\n      { key: PERMISSIONS.WORKFLOWS_EXECUTE, label: 'Execute workflows' },\n    ],\n  },\n  forms: {\n    label: 'Forms',\n    permissions: [\n      { key: PERMISSIONS.FORMS_VIEW, label: 'View forms' },\n      { key: PERMISSIONS.FORMS_CREATE, label: 'Create forms' },\n      { key: PERMISSIONS.FORMS_EDIT, label: 'Edit forms' },\n      { key: PERMISSIONS.FORMS_DELETE, label: 'Delete forms' },\n      { key: PERMISSIONS.FORMS_SUBMISSIONS, label: 'View submissions' },\n    ],\n  },\n  email: {\n    label: 'Email Campaigns',\n    permissions: [\n      { key: PERMISSIONS.EMAIL_VIEW, label: 'View campaigns' },\n      { key: PERMISSIONS.EMAIL_CREATE, label: 'Create campaigns' },\n      { key: PERMISSIONS.EMAIL_EDIT, label: 'Edit campaigns' },\n      { key: PERMISSIONS.EMAIL_DELETE, label: 'Delete campaigns' },\n      { key: PERMISSIONS.EMAIL_SEND, label: 'Send campaigns' },\n    ],\n  },\n  audit: {\n    label: 'Audit Log',\n    permissions: [\n      { key: PERMISSIONS.AUDIT_VIEW, label: 'View audit log' },\n    ],\n  },\n} as const\n\n// Built-in role definitions\nexport const BUILT_IN_ROLES = {\n  super_admin: {\n    name: 'super_admin',\n    displayName: 'Super Admin',\n    description: 'Full access to all features and settings',\n    permissions: [PERMISSIONS.SUPER_ADMIN],\n    isSystem: true,\n    position: 0,\n  },\n  store_manager: {\n    name: 'store_manager',\n    displayName: 'Store Manager',\n    description: 'Manage products, orders, inventory, and customers',\n    permissions: [\n      PERMISSIONS.PRODUCTS_ALL,\n      PERMISSIONS.VARIANTS_ALL,\n      PERMISSIONS.ORDERS_ALL,\n      PERMISSIONS.INVENTORY_ALL,\n      PERMISSIONS.CUSTOMERS_VIEW,\n      PERMISSIONS.CUSTOMERS_EDIT,\n      PERMISSIONS.CATEGORIES_ALL,\n      PERMISSIONS.MEDIA_VIEW,\n      PERMISSIONS.MEDIA_UPLOAD,\n      PERMISSIONS.ANALYTICS_VIEW,\n    ],\n    isSystem: true,\n    position: 1,\n  },\n  content_editor: {\n    name: 'content_editor',\n    displayName: 'Content Editor',\n    description: 'Manage pages, blog posts, and media',\n    permissions: [\n      PERMISSIONS.PAGES_ALL,\n      PERMISSIONS.BLOG_ALL,\n      PERMISSIONS.MEDIA_ALL,\n      PERMISSIONS.CATEGORIES_VIEW,\n      PERMISSIONS.CATEGORIES_EDIT,\n    ],\n    isSystem: true,\n    position: 2,\n  },\n  order_fulfiller: {\n    name: 'order_fulfiller',\n    displayName: 'Order Fulfiller',\n    description: 'View and fulfill orders',\n    permissions: [\n      PERMISSIONS.ORDERS_VIEW,\n      PERMISSIONS.ORDERS_FULFILL,\n      PERMISSIONS.INVENTORY_VIEW,\n      PERMISSIONS.CUSTOMERS_VIEW,\n    ],\n    isSystem: true,\n    position: 3,\n  },\n  support_staff: {\n    name: 'support_staff',\n    displayName: 'Support Staff',\n    description: 'View orders and manage customer inquiries',\n    permissions: [\n      PERMISSIONS.ORDERS_VIEW,\n      PERMISSIONS.CUSTOMERS_VIEW,\n      PERMISSIONS.CUSTOMERS_EDIT,\n    ],\n    isSystem: true,\n    position: 4,\n  },\n} as const\n\nexport type BuiltInRoleName = keyof typeof BUILT_IN_ROLES\n","/**\n * Permission Checking Utilities\n * Core RBAC logic for checking user permissions\n */\n\nimport { prisma } from '../db'\nimport { PERMISSIONS, BUILT_IN_ROLES } from './constants'\nimport type {\n  UserWithPermissions,\n  RoleData,\n  PermissionOverride,\n  PermissionCheckResult,\n  AuditAction,\n} from './types'\n\nexport { PERMISSIONS, PERMISSION_GROUPS, BUILT_IN_ROLES } from './constants'\nexport type { Permission, BuiltInRoleName } from './constants'\nexport type * from './types'\n\n/**\n * Get a user's complete permission set (roles + overrides)\n */\nexport async function getUserPermissions(userId: string): Promise<UserWithPermissions | null> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    include: {\n      roleAssignments: {\n        include: {\n          role: true,\n        },\n      },\n      permissions: {\n        where: {\n          OR: [\n            { expiresAt: null },\n            { expiresAt: { gt: new Date() } },\n          ],\n        },\n      },\n    },\n  })\n\n  if (!user) return null\n\n  // Extract roles\n  const roles: RoleData[] = user.roleAssignments.map((ra) => ({\n    id: ra.role.id,\n    name: ra.role.name,\n    displayName: ra.role.displayName,\n    description: ra.role.description,\n    permissions: ra.role.permissions as string[],\n    isSystem: ra.role.isSystem,\n  }))\n\n  // Extract overrides\n  const overrides: PermissionOverride[] = user.permissions.map((p) => ({\n    id: p.id,\n    permission: p.permission,\n    type: p.type as 'GRANT' | 'DENY',\n    expiresAt: p.expiresAt,\n    reason: p.reason,\n  }))\n\n  // Compute effective permissions\n  const permissions = computeEffectivePermissions(roles, overrides)\n\n  return {\n    id: user.id,\n    email: user.email,\n    name: user.name,\n    permissions,\n    roles,\n    overrides,\n  }\n}\n\n/**\n * Compute effective permissions from roles and overrides\n * Order: Collect from roles  Apply DENY overrides  Apply GRANT overrides\n */\nfunction computeEffectivePermissions(\n  roles: RoleData[],\n  overrides: PermissionOverride[]\n): Set<string> {\n  const permissions = new Set<string>()\n\n  // 1. Collect all permissions from roles\n  for (const role of roles) {\n    for (const perm of role.permissions) {\n      permissions.add(perm)\n    }\n  }\n\n  // 2. Apply DENY overrides (remove permissions)\n  for (const override of overrides) {\n    if (override.type === 'DENY') {\n      permissions.delete(override.permission)\n    }\n  }\n\n  // 3. Apply GRANT overrides (add permissions)\n  for (const override of overrides) {\n    if (override.type === 'GRANT') {\n      permissions.add(override.permission)\n    }\n  }\n\n  return permissions\n}\n\n/**\n * Check if a permission matches (including wildcards)\n * Examples:\n * - \"products.view\" matches \"products.view\" exactly\n * - \"products.*\" matches \"products.view\", \"products.edit\", etc.\n * - \"*\" matches everything\n */\nfunction permissionMatches(userPermission: string, requiredPermission: string): boolean {\n  // Exact match\n  if (userPermission === requiredPermission) return true\n\n  // Super admin wildcard\n  if (userPermission === '*') return true\n\n  // Resource wildcard (e.g., \"products.*\" matches \"products.view\")\n  if (userPermission.endsWith('.*')) {\n    const resource = userPermission.slice(0, -2) // Remove \".*\"\n    return requiredPermission.startsWith(resource + '.')\n  }\n\n  return false\n}\n\n/**\n * Check if user has a specific permission\n */\nexport async function hasPermission(\n  userId: string,\n  permission: string\n): Promise<PermissionCheckResult> {\n  const userPerms = await getUserPermissions(userId)\n\n  if (!userPerms) {\n    return { allowed: false, reason: 'User not found' }\n  }\n\n  return checkPermission(userPerms, permission)\n}\n\n/**\n * Check permission against a pre-loaded user permission set\n * (Use this in loops to avoid repeated DB queries)\n */\nexport function checkPermission(\n  userPerms: UserWithPermissions,\n  requiredPermission: string\n): PermissionCheckResult {\n  // Check for super admin first\n  if (userPerms.permissions.has('*')) {\n    return {\n      allowed: true,\n      source: { type: 'super_admin' },\n    }\n  }\n\n  // Check each user permission for a match\n  for (const userPerm of userPerms.permissions) {\n    if (permissionMatches(userPerm, requiredPermission)) {\n      // Determine source (role or override)\n      const grantOverride = userPerms.overrides.find(\n        (o) => o.type === 'GRANT' && o.permission === userPerm\n      )\n\n      if (grantOverride) {\n        return {\n          allowed: true,\n          source: {\n            type: 'override',\n            id: grantOverride.id,\n          },\n        }\n      }\n\n      // Find which role grants this\n      for (const role of userPerms.roles) {\n        if (role.permissions.some((p) => permissionMatches(p, requiredPermission))) {\n          return {\n            allowed: true,\n            source: {\n              type: 'role',\n              id: role.id,\n              name: role.displayName,\n            },\n          }\n        }\n      }\n\n      return { allowed: true }\n    }\n  }\n\n  // Check if explicitly denied\n  const denyOverride = userPerms.overrides.find(\n    (o) => o.type === 'DENY' && o.permission === requiredPermission\n  )\n\n  if (denyOverride) {\n    return {\n      allowed: false,\n      reason: denyOverride.reason || 'Permission explicitly denied',\n      source: {\n        type: 'override',\n        id: denyOverride.id,\n      },\n    }\n  }\n\n  return {\n    allowed: false,\n    reason: 'Permission not granted by any role',\n  }\n}\n\n/**\n * Check multiple permissions at once\n * Returns true only if ALL permissions are granted\n */\nexport async function hasAllPermissions(\n  userId: string,\n  permissions: string[]\n): Promise<boolean> {\n  const userPerms = await getUserPermissions(userId)\n  if (!userPerms) return false\n\n  return permissions.every((p) => checkPermission(userPerms, p).allowed)\n}\n\n/**\n * Check multiple permissions at once\n * Returns true if ANY permission is granted\n */\nexport async function hasAnyPermission(\n  userId: string,\n  permissions: string[]\n): Promise<boolean> {\n  const userPerms = await getUserPermissions(userId)\n  if (!userPerms) return false\n\n  return permissions.some((p) => checkPermission(userPerms, p).allowed)\n}\n\n/**\n * Check if user is a super admin\n */\nexport async function isSuperAdmin(userId: string): Promise<boolean> {\n  const userPerms = await getUserPermissions(userId)\n  return userPerms?.permissions.has('*') ?? false\n}\n\n/**\n * Log an audit event\n */\nexport async function logAuditEvent(params: {\n  userId?: string\n  userEmail?: string\n  action: AuditAction\n  targetType?: string\n  targetId?: string\n  details?: Record<string, unknown>\n  ipAddress?: string\n  userAgent?: string\n}): Promise<void> {\n  await prisma.auditLog.create({\n    data: {\n      userId: params.userId,\n      userEmail: params.userEmail,\n      action: params.action,\n      targetType: params.targetType,\n      targetId: params.targetId,\n      details: (params.details || {}) as any,\n      ipAddress: params.ipAddress,\n      userAgent: params.userAgent,\n    },\n  })\n}\n\n/**\n * Seed built-in roles (run on app startup or migration)\n */\nexport async function seedBuiltInRoles(): Promise<void> {\n  for (const [, roleData] of Object.entries(BUILT_IN_ROLES)) {\n    await prisma.role.upsert({\n      where: { name: roleData.name },\n      update: {\n        displayName: roleData.displayName,\n        description: roleData.description,\n        permissions: roleData.permissions,\n        position: roleData.position,\n      },\n      create: {\n        name: roleData.name,\n        displayName: roleData.displayName,\n        description: roleData.description,\n        permissions: roleData.permissions,\n        isSystem: roleData.isSystem,\n        position: roleData.position,\n      },\n    })\n  }\n}\n\n/**\n * Assign a role to a user\n */\nexport async function assignRole(params: {\n  userId: string\n  roleId: string\n  assignedBy?: string\n}): Promise<void> {\n  await prisma.roleAssignment.create({\n    data: {\n      userId: params.userId,\n      roleId: params.roleId,\n      assignedBy: params.assignedBy,\n    },\n  })\n\n  // Log the action\n  if (params.assignedBy) {\n    const assigner = await prisma.user.findUnique({\n      where: { id: params.assignedBy },\n      select: { email: true },\n    })\n\n    const role = await prisma.role.findUnique({\n      where: { id: params.roleId },\n      select: { name: true },\n    })\n\n    await logAuditEvent({\n      userId: params.assignedBy,\n      userEmail: assigner?.email,\n      action: 'role.assign',\n      targetType: 'user',\n      targetId: params.userId,\n      details: {\n        roleId: params.roleId,\n        roleName: role?.name,\n      },\n    })\n  }\n}\n\n/**\n * Remove a role from a user\n */\nexport async function removeRole(params: {\n  userId: string\n  roleId: string\n  removedBy?: string\n}): Promise<void> {\n  await prisma.roleAssignment.delete({\n    where: {\n      userId_roleId: {\n        userId: params.userId,\n        roleId: params.roleId,\n      },\n    },\n  })\n\n  // Log the action\n  if (params.removedBy) {\n    const remover = await prisma.user.findUnique({\n      where: { id: params.removedBy },\n      select: { email: true },\n    })\n\n    const role = await prisma.role.findUnique({\n      where: { id: params.roleId },\n      select: { name: true },\n    })\n\n    await logAuditEvent({\n      userId: params.removedBy,\n      userEmail: remover?.email,\n      action: 'role.remove',\n      targetType: 'user',\n      targetId: params.userId,\n      details: {\n        roleId: params.roleId,\n        roleName: role?.name,\n      },\n    })\n  }\n}\n\n/**\n * Grant a permission override to a user\n */\nexport async function grantPermission(params: {\n  userId: string\n  permission: string\n  expiresAt?: Date\n  reason?: string\n  grantedBy?: string\n}): Promise<void> {\n  await prisma.userPermission.upsert({\n    where: {\n      userId_permission: {\n        userId: params.userId,\n        permission: params.permission,\n      },\n    },\n    update: {\n      type: 'GRANT',\n      expiresAt: params.expiresAt,\n      reason: params.reason,\n      grantedBy: params.grantedBy,\n    },\n    create: {\n      userId: params.userId,\n      permission: params.permission,\n      type: 'GRANT',\n      expiresAt: params.expiresAt,\n      reason: params.reason,\n      grantedBy: params.grantedBy,\n    },\n  })\n\n  // Log the action\n  if (params.grantedBy) {\n    const granter = await prisma.user.findUnique({\n      where: { id: params.grantedBy },\n      select: { email: true },\n    })\n\n    await logAuditEvent({\n      userId: params.grantedBy,\n      userEmail: granter?.email,\n      action: 'permission.grant',\n      targetType: 'user',\n      targetId: params.userId,\n      details: {\n        permission: params.permission,\n        expiresAt: params.expiresAt?.toISOString(),\n        reason: params.reason,\n      },\n    })\n  }\n}\n\n/**\n * Deny a permission override to a user\n */\nexport async function denyPermission(params: {\n  userId: string\n  permission: string\n  expiresAt?: Date\n  reason?: string\n  deniedBy?: string\n}): Promise<void> {\n  await prisma.userPermission.upsert({\n    where: {\n      userId_permission: {\n        userId: params.userId,\n        permission: params.permission,\n      },\n    },\n    update: {\n      type: 'DENY',\n      expiresAt: params.expiresAt,\n      reason: params.reason,\n      grantedBy: params.deniedBy,\n    },\n    create: {\n      userId: params.userId,\n      permission: params.permission,\n      type: 'DENY',\n      expiresAt: params.expiresAt,\n      reason: params.reason,\n      grantedBy: params.deniedBy,\n    },\n  })\n\n  // Log the action\n  if (params.deniedBy) {\n    const denier = await prisma.user.findUnique({\n      where: { id: params.deniedBy },\n      select: { email: true },\n    })\n\n    await logAuditEvent({\n      userId: params.deniedBy,\n      userEmail: denier?.email,\n      action: 'permission.deny',\n      targetType: 'user',\n      targetId: params.userId,\n      details: {\n        permission: params.permission,\n        expiresAt: params.expiresAt?.toISOString(),\n        reason: params.reason,\n      },\n    })\n  }\n}\n\n/**\n * Remove a permission override from a user\n */\nexport async function removePermissionOverride(params: {\n  userId: string\n  permission: string\n  removedBy?: string\n}): Promise<void> {\n  const existing = await prisma.userPermission.findUnique({\n    where: {\n      userId_permission: {\n        userId: params.userId,\n        permission: params.permission,\n      },\n    },\n  })\n\n  if (!existing) return\n\n  await prisma.userPermission.delete({\n    where: {\n      userId_permission: {\n        userId: params.userId,\n        permission: params.permission,\n      },\n    },\n  })\n\n  // Log the action\n  if (params.removedBy) {\n    const remover = await prisma.user.findUnique({\n      where: { id: params.removedBy },\n      select: { email: true },\n    })\n\n    await logAuditEvent({\n      userId: params.removedBy,\n      userEmail: remover?.email,\n      action: 'permission.remove',\n      targetType: 'user',\n      targetId: params.userId,\n      details: {\n        permission: params.permission,\n        previousType: existing.type,\n      },\n    })\n  }\n}\n","/**\n * Order Workflow Types\n *\n * Type definitions for the order progress management system\n */\n\n// =============================================================================\n// SHIPPO EVENT TYPES\n// =============================================================================\n\nexport type ShippoTrackingEvent =\n  | 'PRE_TRANSIT'\n  | 'TRANSIT'\n  | 'DELIVERED'\n  | 'RETURNED'\n  | 'FAILURE'\n  | 'UNKNOWN'\n\n// =============================================================================\n// PROGRESS SOURCE TYPES\n// =============================================================================\n\nexport type ProgressSource = 'manual' | 'shippo' | 'system' | 'webhook'\n\n// =============================================================================\n// WORKFLOW TYPES\n// =============================================================================\n\nexport interface WorkflowStageInput {\n  name: string\n  slug: string\n  displayName: string\n  customerMessage?: string\n  icon?: string\n  color?: string\n  position: number\n  isTerminal?: boolean\n  notifyCustomer?: boolean\n  estimatedDuration?: number\n  shippoEventTrigger?: ShippoTrackingEvent | null\n}\n\nexport interface WorkflowCreateInput {\n  name: string\n  slug: string\n  description?: string\n  isDefault?: boolean\n  isActive?: boolean\n  enableShippoSync?: boolean\n  stages?: WorkflowStageInput[]\n}\n\nexport interface WorkflowUpdateInput {\n  name?: string\n  slug?: string\n  description?: string\n  isDefault?: boolean\n  isActive?: boolean\n  enableShippoSync?: boolean\n}\n\nexport interface StageUpdateInput {\n  name?: string\n  slug?: string\n  displayName?: string\n  customerMessage?: string\n  icon?: string\n  color?: string\n  position?: number\n  isTerminal?: boolean\n  notifyCustomer?: boolean\n  estimatedDuration?: number\n  shippoEventTrigger?: ShippoTrackingEvent | null\n}\n\n// =============================================================================\n// PROGRESS TYPES\n// =============================================================================\n\nexport interface ProgressTransitionInput {\n  orderId: string\n  stageId: string\n  source?: ProgressSource\n  isOverride?: boolean\n  reason?: string\n  updatedById?: string\n  notes?: string\n}\n\nexport interface ProgressRevertInput {\n  orderId: string\n  targetStageId: string\n  reason: string\n  updatedById?: string\n  notes?: string\n}\n\n// =============================================================================\n// RESPONSE TYPES\n// =============================================================================\n\nexport interface WorkflowWithStages {\n  id: string\n  name: string\n  slug: string\n  description: string | null\n  isDefault: boolean\n  isActive: boolean\n  enableShippoSync: boolean\n  createdAt: Date\n  updatedAt: Date\n  stages: WorkflowStage[]\n}\n\nexport interface WorkflowStage {\n  id: string\n  workflowId: string\n  name: string\n  slug: string\n  displayName: string\n  customerMessage: string | null\n  icon: string | null\n  color: string | null\n  position: number\n  isTerminal: boolean\n  notifyCustomer: boolean\n  estimatedDuration: number | null\n  shippoEventTrigger: string | null\n  createdAt: Date\n  updatedAt: Date\n}\n\nexport interface OrderProgressEntry {\n  id: string\n  orderId: string\n  stageId: string\n  enteredAt: Date\n  exitedAt: Date | null\n  source: string\n  isOverride: boolean\n  reason: string | null\n  updatedById: string | null\n  notes: string | null\n  createdAt: Date\n  stage: WorkflowStage\n  updatedBy?: {\n    id: string\n    name: string | null\n    email: string\n  } | null\n}\n\nexport interface OrderWithProgress {\n  id: string\n  orderNumber: string\n  workflowId: string | null\n  currentStageId: string | null\n  trackingAutoSync: boolean\n  workflow: WorkflowWithStages | null\n  currentStage: WorkflowStage | null\n  progress: OrderProgressEntry[]\n}\n\n// =============================================================================\n// CUSTOMER-FACING TYPES\n// =============================================================================\n\nexport interface CustomerProgressView {\n  orderId: string\n  orderNumber: string\n  currentStage: {\n    displayName: string\n    customerMessage: string | null\n    icon: string | null\n    color: string | null\n    isTerminal: boolean\n  } | null\n  stages: {\n    displayName: string\n    icon: string | null\n    color: string | null\n    isCompleted: boolean\n    isCurrent: boolean\n    completedAt: Date | null\n  }[]\n  estimatedDelivery: Date | null\n}\n\n// =============================================================================\n// DEFAULT WORKFLOW TEMPLATES\n// =============================================================================\n\nexport interface WorkflowTemplate {\n  name: string\n  slug: string\n  description: string\n  enableShippoSync: boolean\n  stages: WorkflowStageInput[]\n}\n\nexport const DEFAULT_WORKFLOW_TEMPLATES: WorkflowTemplate[] = [\n  {\n    name: 'Standard Shipping',\n    slug: 'standard-shipping',\n    description: 'Default workflow for physical products requiring shipping',\n    enableShippoSync: true,\n    stages: [\n      {\n        name: 'order_received',\n        slug: 'order-received',\n        displayName: 'Order Received',\n        customerMessage: \"We've received your order and are preparing it for processing.\",\n        icon: 'inbox',\n        color: '#3B82F6',\n        position: 0,\n        notifyCustomer: true,\n        estimatedDuration: 24,\n        shippoEventTrigger: null,\n      },\n      {\n        name: 'processing',\n        slug: 'processing',\n        displayName: 'Processing',\n        customerMessage: \"Your order is being prepared and will be shipped soon.\",\n        icon: 'package',\n        color: '#F59E0B',\n        position: 1,\n        notifyCustomer: true,\n        estimatedDuration: 48,\n        shippoEventTrigger: 'PRE_TRANSIT',\n      },\n      {\n        name: 'shipped',\n        slug: 'shipped',\n        displayName: 'Shipped',\n        customerMessage: \"Great news! Your order is on its way.\",\n        icon: 'truck',\n        color: '#8B5CF6',\n        position: 2,\n        notifyCustomer: true,\n        estimatedDuration: 72,\n        shippoEventTrigger: 'TRANSIT',\n      },\n      {\n        name: 'delivered',\n        slug: 'delivered',\n        displayName: 'Delivered',\n        customerMessage: \"Your order has been delivered. Thank you for shopping with us!\",\n        icon: 'check-circle',\n        color: '#10B981',\n        position: 3,\n        isTerminal: true,\n        notifyCustomer: true,\n        shippoEventTrigger: 'DELIVERED',\n      },\n    ],\n  },\n  {\n    name: 'Digital Download',\n    slug: 'digital-download',\n    description: 'Workflow for digital products with instant delivery',\n    enableShippoSync: false,\n    stages: [\n      {\n        name: 'order_received',\n        slug: 'order-received',\n        displayName: 'Order Received',\n        customerMessage: \"We've received your order.\",\n        icon: 'inbox',\n        color: '#3B82F6',\n        position: 0,\n        notifyCustomer: true,\n        estimatedDuration: 1,\n      },\n      {\n        name: 'ready',\n        slug: 'ready',\n        displayName: 'Ready for Download',\n        customerMessage: \"Your files are ready! Check your email for download links.\",\n        icon: 'download',\n        color: '#10B981',\n        position: 1,\n        isTerminal: true,\n        notifyCustomer: true,\n      },\n    ],\n  },\n  {\n    name: 'Custom Order',\n    slug: 'custom-order',\n    description: 'Workflow for made-to-order or customized products',\n    enableShippoSync: true,\n    stages: [\n      {\n        name: 'order_received',\n        slug: 'order-received',\n        displayName: 'Order Received',\n        customerMessage: \"We've received your custom order request.\",\n        icon: 'inbox',\n        color: '#3B82F6',\n        position: 0,\n        notifyCustomer: true,\n        estimatedDuration: 24,\n      },\n      {\n        name: 'design_review',\n        slug: 'design-review',\n        displayName: 'Design Review',\n        customerMessage: \"Our team is reviewing your customization details.\",\n        icon: 'eye',\n        color: '#6366F1',\n        position: 1,\n        notifyCustomer: true,\n        estimatedDuration: 48,\n      },\n      {\n        name: 'in_production',\n        slug: 'in-production',\n        displayName: 'In Production',\n        customerMessage: \"Your custom item is being crafted with care.\",\n        icon: 'hammer',\n        color: '#F59E0B',\n        position: 2,\n        notifyCustomer: true,\n        estimatedDuration: 120,\n        shippoEventTrigger: 'PRE_TRANSIT',\n      },\n      {\n        name: 'quality_check',\n        slug: 'quality-check',\n        displayName: 'Quality Check',\n        customerMessage: \"Your item is undergoing final quality inspection.\",\n        icon: 'shield-check',\n        color: '#8B5CF6',\n        position: 3,\n        notifyCustomer: true,\n        estimatedDuration: 24,\n      },\n      {\n        name: 'shipped',\n        slug: 'shipped',\n        displayName: 'Shipped',\n        customerMessage: \"Your custom order is on its way!\",\n        icon: 'truck',\n        color: '#EC4899',\n        position: 4,\n        notifyCustomer: true,\n        estimatedDuration: 72,\n        shippoEventTrigger: 'TRANSIT',\n      },\n      {\n        name: 'delivered',\n        slug: 'delivered',\n        displayName: 'Delivered',\n        customerMessage: \"Your custom order has been delivered. Enjoy!\",\n        icon: 'check-circle',\n        color: '#10B981',\n        position: 5,\n        isTerminal: true,\n        notifyCustomer: true,\n        shippoEventTrigger: 'DELIVERED',\n      },\n    ],\n  },\n  {\n    name: 'Local Pickup',\n    slug: 'local-pickup',\n    description: 'Workflow for in-store or local pickup orders',\n    enableShippoSync: false,\n    stages: [\n      {\n        name: 'order_received',\n        slug: 'order-received',\n        displayName: 'Order Received',\n        customerMessage: \"We've received your order.\",\n        icon: 'inbox',\n        color: '#3B82F6',\n        position: 0,\n        notifyCustomer: true,\n        estimatedDuration: 24,\n      },\n      {\n        name: 'preparing',\n        slug: 'preparing',\n        displayName: 'Preparing',\n        customerMessage: \"We're preparing your order for pickup.\",\n        icon: 'package',\n        color: '#F59E0B',\n        position: 1,\n        notifyCustomer: true,\n        estimatedDuration: 24,\n      },\n      {\n        name: 'ready_for_pickup',\n        slug: 'ready-for-pickup',\n        displayName: 'Ready for Pickup',\n        customerMessage: \"Your order is ready! Come pick it up at your convenience.\",\n        icon: 'map-pin',\n        color: '#10B981',\n        position: 2,\n        notifyCustomer: true,\n        estimatedDuration: 168, // 7 days\n      },\n      {\n        name: 'picked_up',\n        slug: 'picked-up',\n        displayName: 'Picked Up',\n        customerMessage: \"Thank you for picking up your order!\",\n        icon: 'check-circle',\n        color: '#10B981',\n        position: 3,\n        isTerminal: true,\n        notifyCustomer: true,\n      },\n    ],\n  },\n]\n","/**\n * Order Workflows - Core CRUD Operations\n *\n * Manage order workflow templates and stages\n */\n\nimport { prisma } from '../db'\nimport type {\n  WorkflowCreateInput,\n  WorkflowUpdateInput,\n  WorkflowStageInput,\n  StageUpdateInput,\n  WorkflowWithStages,\n  WorkflowStage,\n} from './types'\n\n// =============================================================================\n// WORKFLOW CRUD\n// =============================================================================\n\n/**\n * List all workflows\n */\nexport async function listWorkflows(includeInactive = false): Promise<WorkflowWithStages[]> {\n  const workflows = await prisma.orderWorkflow.findMany({\n    where: includeInactive ? {} : { isActive: true },\n    include: {\n      stages: {\n        orderBy: { position: 'asc' },\n      },\n    },\n    orderBy: [{ isDefault: 'desc' }, { name: 'asc' }],\n  })\n\n  return workflows as WorkflowWithStages[]\n}\n\n/**\n * Get a single workflow by ID or slug\n */\nexport async function getWorkflow(idOrSlug: string): Promise<WorkflowWithStages | null> {\n  const workflow = await prisma.orderWorkflow.findFirst({\n    where: {\n      OR: [{ id: idOrSlug }, { slug: idOrSlug }],\n    },\n    include: {\n      stages: {\n        orderBy: { position: 'asc' },\n      },\n    },\n  })\n\n  return workflow as WorkflowWithStages | null\n}\n\n/**\n * Get the default workflow\n */\nexport async function getDefaultWorkflow(): Promise<WorkflowWithStages | null> {\n  const workflow = await prisma.orderWorkflow.findFirst({\n    where: { isDefault: true, isActive: true },\n    include: {\n      stages: {\n        orderBy: { position: 'asc' },\n      },\n    },\n  })\n\n  return workflow as WorkflowWithStages | null\n}\n\n/**\n * Create a new workflow with stages\n */\nexport async function createWorkflow(input: WorkflowCreateInput): Promise<WorkflowWithStages> {\n  const { stages, ...workflowData } = input\n\n  // If setting as default, unset other defaults first\n  if (workflowData.isDefault) {\n    await prisma.orderWorkflow.updateMany({\n      where: { isDefault: true },\n      data: { isDefault: false },\n    })\n  }\n\n  const workflow = await prisma.orderWorkflow.create({\n    data: {\n      ...workflowData,\n      stages: stages\n        ? {\n            create: stages.map((stage, index) => ({\n              ...stage,\n              position: stage.position ?? index,\n            })),\n          }\n        : undefined,\n    },\n    include: {\n      stages: {\n        orderBy: { position: 'asc' },\n      },\n    },\n  })\n\n  return workflow as WorkflowWithStages\n}\n\n/**\n * Update a workflow\n */\nexport async function updateWorkflow(\n  id: string,\n  input: WorkflowUpdateInput\n): Promise<WorkflowWithStages> {\n  // If setting as default, unset other defaults first\n  if (input.isDefault) {\n    await prisma.orderWorkflow.updateMany({\n      where: { isDefault: true, id: { not: id } },\n      data: { isDefault: false },\n    })\n  }\n\n  const workflow = await prisma.orderWorkflow.update({\n    where: { id },\n    data: input,\n    include: {\n      stages: {\n        orderBy: { position: 'asc' },\n      },\n    },\n  })\n\n  return workflow as WorkflowWithStages\n}\n\n/**\n * Delete a workflow\n */\nexport async function deleteWorkflow(id: string): Promise<void> {\n  // Check if any orders are using this workflow\n  const orderCount = await prisma.order.count({\n    where: { workflowId: id },\n  })\n\n  if (orderCount > 0) {\n    throw new Error(`Cannot delete workflow: ${orderCount} orders are using it`)\n  }\n\n  await prisma.orderWorkflow.delete({\n    where: { id },\n  })\n}\n\n/**\n * Duplicate a workflow\n */\nexport async function duplicateWorkflow(\n  id: string,\n  newName: string,\n  newSlug: string\n): Promise<WorkflowWithStages> {\n  const original = await getWorkflow(id)\n  if (!original) {\n    throw new Error('Workflow not found')\n  }\n\n  return createWorkflow({\n    name: newName,\n    slug: newSlug,\n    description: original.description || undefined,\n    isDefault: false,\n    isActive: true,\n    enableShippoSync: original.enableShippoSync,\n    stages: original.stages.map((stage) => ({\n      name: stage.name,\n      slug: stage.slug,\n      displayName: stage.displayName,\n      customerMessage: stage.customerMessage || undefined,\n      icon: stage.icon || undefined,\n      color: stage.color || undefined,\n      position: stage.position,\n      isTerminal: stage.isTerminal,\n      notifyCustomer: stage.notifyCustomer,\n      estimatedDuration: stage.estimatedDuration || undefined,\n      shippoEventTrigger: (stage.shippoEventTrigger as any) || null,\n    })),\n  })\n}\n\n// =============================================================================\n// STAGE CRUD\n// =============================================================================\n\n/**\n * Get a single stage\n */\nexport async function getStage(id: string): Promise<WorkflowStage | null> {\n  const stage = await prisma.orderWorkflowStage.findUnique({\n    where: { id },\n  })\n\n  return stage as WorkflowStage | null\n}\n\n/**\n * Add a stage to a workflow\n */\nexport async function addStage(\n  workflowId: string,\n  input: WorkflowStageInput\n): Promise<WorkflowStage> {\n  // If no position specified, add at end\n  if (input.position === undefined) {\n    const lastStage = await prisma.orderWorkflowStage.findFirst({\n      where: { workflowId },\n      orderBy: { position: 'desc' },\n    })\n    input.position = lastStage ? lastStage.position + 1 : 0\n  }\n\n  // Shift existing stages if needed\n  await prisma.orderWorkflowStage.updateMany({\n    where: {\n      workflowId,\n      position: { gte: input.position },\n    },\n    data: {\n      position: { increment: 1 },\n    },\n  })\n\n  const stage = await prisma.orderWorkflowStage.create({\n    data: {\n      workflowId,\n      ...input,\n    },\n  })\n\n  return stage as WorkflowStage\n}\n\n/**\n * Update a stage\n */\nexport async function updateStage(id: string, input: StageUpdateInput): Promise<WorkflowStage> {\n  const stage = await prisma.orderWorkflowStage.update({\n    where: { id },\n    data: input,\n  })\n\n  return stage as WorkflowStage\n}\n\n/**\n * Delete a stage\n */\nexport async function deleteStage(id: string): Promise<void> {\n  // Check if any orders are at this stage\n  const orderCount = await prisma.order.count({\n    where: { currentStageId: id },\n  })\n\n  if (orderCount > 0) {\n    throw new Error(`Cannot delete stage: ${orderCount} orders are currently at this stage`)\n  }\n\n  const stage = await prisma.orderWorkflowStage.findUnique({\n    where: { id },\n  })\n\n  if (!stage) {\n    throw new Error('Stage not found')\n  }\n\n  // Delete the stage\n  await prisma.orderWorkflowStage.delete({\n    where: { id },\n  })\n\n  // Reorder remaining stages\n  await prisma.orderWorkflowStage.updateMany({\n    where: {\n      workflowId: stage.workflowId,\n      position: { gt: stage.position },\n    },\n    data: {\n      position: { decrement: 1 },\n    },\n  })\n}\n\n/**\n * Reorder stages within a workflow\n */\nexport async function reorderStages(\n  workflowId: string,\n  stageIds: string[]\n): Promise<WorkflowStage[]> {\n  // Update positions in a transaction\n  await prisma.$transaction(\n    stageIds.map((stageId, index) =>\n      prisma.orderWorkflowStage.update({\n        where: { id: stageId },\n        data: { position: index },\n      })\n    )\n  )\n\n  const stages = await prisma.orderWorkflowStage.findMany({\n    where: { workflowId },\n    orderBy: { position: 'asc' },\n  })\n\n  return stages as WorkflowStage[]\n}\n\n// =============================================================================\n// WORKFLOW ASSIGNMENT\n// =============================================================================\n\n/**\n * Determine the workflow for an order based on its items\n * Priority: Product workflow > Category workflow > Default workflow\n */\nexport async function determineOrderWorkflow(orderId: string): Promise<string | null> {\n  // Get order items with product and category info\n  const orderItems = await prisma.orderItem.findMany({\n    where: { orderId },\n    include: {\n      product: {\n        include: {\n          categories: {\n            include: {\n              category: true,\n            },\n          },\n        },\n      },\n    },\n  })\n\n  // Check for product-level workflow\n  for (const item of orderItems) {\n    if (item.product.orderWorkflowId) {\n      return item.product.orderWorkflowId\n    }\n  }\n\n  // Check for category-level workflow\n  for (const item of orderItems) {\n    for (const pc of item.product.categories) {\n      if (pc.category.orderWorkflowId) {\n        return pc.category.orderWorkflowId\n      }\n    }\n  }\n\n  // Fall back to default workflow\n  const defaultWorkflow = await getDefaultWorkflow()\n  return defaultWorkflow?.id || null\n}\n\n/**\n * Assign a workflow to an order\n */\nexport async function assignWorkflowToOrder(\n  orderId: string,\n  workflowId: string | null\n): Promise<void> {\n  // Get the first stage of the workflow\n  let firstStageId: string | null = null\n\n  if (workflowId) {\n    const workflow = await getWorkflow(workflowId)\n    if (workflow && workflow.stages.length > 0) {\n      firstStageId = workflow.stages[0].id\n    }\n  }\n\n  await prisma.order.update({\n    where: { id: orderId },\n    data: {\n      workflowId,\n      currentStageId: firstStageId,\n    },\n  })\n}\n\n/**\n * Initialize workflow for a new order\n */\nexport async function initializeOrderWorkflow(orderId: string): Promise<void> {\n  const workflowId = await determineOrderWorkflow(orderId)\n\n  if (workflowId) {\n    await assignWorkflowToOrder(orderId, workflowId)\n\n    // Create initial progress entry\n    const order = await prisma.order.findUnique({\n      where: { id: orderId },\n      select: { currentStageId: true },\n    })\n\n    if (order?.currentStageId) {\n      await prisma.orderProgress.create({\n        data: {\n          orderId,\n          stageId: order.currentStageId,\n          source: 'system',\n          notes: 'Order created - workflow initialized',\n        },\n      })\n    }\n  }\n}\n\n// Re-export types\nexport * from './types'\n","/**\n * Plugin System Types\n *\n * Core type definitions for the self-extending agent architecture.\n * Inspired by vmcp (Virtual Model Context Protocol) patterns.\n */\n\n/**\n * JSON Schema types for input validation\n */\nexport interface JSONSchemaProperty {\n  type?: 'string' | 'number' | 'boolean' | 'object' | 'array' | 'null';\n  description?: string;\n  enum?: string[];\n  items?: JSONSchemaProperty;\n  properties?: Record<string, JSONSchemaProperty>;\n  required?: string[];\n  default?: unknown;\n  minLength?: number;\n  maxLength?: number;\n  minimum?: number;\n  maximum?: number;\n  pattern?: string;\n}\n\nexport interface JSONSchema {\n  type: 'object';\n  properties: Record<string, JSONSchemaProperty>;\n  required?: string[];\n  additionalProperties?: boolean;\n}\n\n/**\n * Primitive - Atomic unit of tool definition\n *\n * This is the core data structure representing a dynamic tool.\n * Compatible with MCP tool definitions for AI agent integration.\n */\nexport interface PrimitiveDefinition {\n  // Identity\n  id: string;\n  name: string;\n  version: string;\n\n  // Schema (MCP-compatible)\n  description: string;\n  inputSchema: JSONSchema;\n\n  // Implementation\n  handler: string;           // JavaScript code\n  dependencies?: string[];   // npm packages (allowlisted)\n\n  // Metadata\n  author?: string;\n  tags?: string[];\n  tier?: 'FREE' | 'PROPRIETARY';\n  category?: string;\n  icon?: string;\n\n  // Runtime hints\n  timeout?: number;          // ms (default: 30000)\n  memory?: number;           // MB (default: 128)\n  sandbox?: boolean;         // Run in sandbox (default: true)\n\n  // Status\n  enabled?: boolean;\n  builtIn?: boolean;\n\n  // Plugin relationship\n  pluginId?: string | null;\n\n  // Timestamps\n  createdAt?: Date;\n  updatedAt?: Date;\n}\n\n/**\n * Mounted Primitive - A primitive that is currently active and available\n */\nexport interface MountedPrimitive {\n  definition: PrimitiveDefinition;\n  mountedAt: number;\n  config?: Record<string, unknown>;\n  invocationCount: number;\n  lastInvoked?: number;\n  compiledHandler?: Function;\n}\n\n/**\n * Plugin - Collection of primitives forming a feature unit\n */\nexport interface PluginDefinition {\n  id: string;\n  name: string;\n  slug: string;\n  description?: string;\n  version: string;\n\n  // Display\n  icon?: string;\n  color?: string;\n\n  // Configuration\n  config?: Record<string, unknown>;\n  configSchema?: JSONSchema;\n\n  // Status\n  enabled?: boolean;\n  installed?: boolean;\n  builtIn?: boolean;\n\n  // Author info\n  author?: string;\n  authorUrl?: string;\n  repository?: string;\n\n  // Timestamps\n  createdAt?: Date;\n  updatedAt?: Date;\n  installedAt?: Date;\n}\n\n/**\n * Workflow - Visual composition of primitives\n */\nexport interface WorkflowDefinition {\n  id: string;\n  name: string;\n  slug: string;\n  description?: string;\n\n  // React Flow data\n  nodes: WorkflowNodeData[];\n  edges: WorkflowEdgeData[];\n  viewport?: {\n    x: number;\n    y: number;\n    zoom: number;\n  };\n\n  // Configuration\n  config?: Record<string, unknown>;\n  variables?: Record<string, unknown>;\n\n  // Trigger\n  triggerType: 'MANUAL' | 'SCHEDULE' | 'WEBHOOK' | 'EVENT' | 'AI_AGENT';\n  triggerConfig?: Record<string, unknown>;\n\n  // Status\n  enabled?: boolean;\n\n  // Plugin relationship\n  pluginId?: string | null;\n\n  // Timestamps\n  createdAt?: Date;\n  updatedAt?: Date;\n  lastRunAt?: Date;\n}\n\n/**\n * Workflow Node Data - React Flow node structure\n */\nexport interface WorkflowNodeData {\n  id: string;\n  type: 'primitive' | 'trigger' | 'condition' | 'loop' | 'output';\n  position: { x: number; y: number };\n  data: {\n    label?: string;\n    primitiveId?: string;\n    config?: Record<string, unknown>;\n    inputMappings?: Record<string, string>; // Map workflow vars to inputs\n  };\n}\n\n/**\n * Workflow Edge Data - React Flow edge structure\n */\nexport interface WorkflowEdgeData {\n  id: string;\n  source: string;\n  target: string;\n  sourceHandle?: string;\n  targetHandle?: string;\n  data?: {\n    condition?: string;  // For conditional edges\n    label?: string;\n  };\n}\n\n/**\n * Execution Context - Passed to primitive handlers\n */\nexport interface ExecutionContext {\n  primitiveId: string;\n  primitiveName: string;\n  invocationId: string;\n  startTime: number;\n  timeout?: number;\n  config?: Record<string, unknown>;\n  debug?: boolean;\n\n  // Workflow context (if part of workflow execution)\n  workflowExecutionId?: string;\n  workflowVariables?: Record<string, unknown>;\n\n  // User context\n  userId?: string;\n  agentId?: string;\n\n  // Platform info\n  platform?: {\n    os: 'windows' | 'mac' | 'linux';\n    isWSL: boolean;\n    arch: string;\n  };\n}\n\n/**\n * Execution Result\n */\nexport interface ExecutionResult {\n  success: boolean;\n  result?: unknown;\n  error?: string;\n  executionTime: number;\n  invocationId?: string;\n}\n\n/**\n * Primitive Info - Simplified for listings\n */\nexport interface PrimitiveInfo {\n  id: string;\n  name: string;\n  description: string;\n  version: string;\n  tags: string[];\n  category?: string;\n  icon?: string;\n  mounted: boolean;\n  enabled: boolean;\n  author?: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * Plugin Info - Simplified for listings\n */\nexport interface PluginInfo {\n  id: string;\n  name: string;\n  slug: string;\n  description?: string;\n  version: string;\n  icon?: string;\n  color?: string;\n  enabled: boolean;\n  installed: boolean;\n  builtIn: boolean;\n  primitiveCount: number;\n  author?: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * Registry Statistics\n */\nexport interface RegistryStats {\n  primitiveCount: number;\n  mountedCount: number;\n  pluginCount: number;\n  enabledPluginCount: number;\n  workflowCount: number;\n  totalExecutions: number;\n}\n\n/**\n * Create Primitive Request\n */\nexport interface CreatePrimitiveRequest {\n  name: string;\n  description: string;\n  inputSchema: JSONSchema;\n  handler: string;\n  category?: string;\n  tags?: string[];\n  icon?: string;\n  timeout?: number;\n  pluginId?: string;\n  autoMount?: boolean;\n}\n\n/**\n * Update Primitive Request\n */\nexport interface UpdatePrimitiveRequest {\n  description?: string;\n  inputSchema?: JSONSchema;\n  handler?: string;\n  category?: string;\n  tags?: string[];\n  icon?: string;\n  timeout?: number;\n  enabled?: boolean;\n}\n\n/**\n * Create Plugin Request\n */\nexport interface CreatePluginRequest {\n  name: string;\n  slug: string;\n  description?: string;\n  icon?: string;\n  color?: string;\n  config?: Record<string, unknown>;\n  configSchema?: JSONSchema;\n  author?: string;\n}\n\n/**\n * Standard Response Format\n */\nexport interface PluginResponse<T = unknown> {\n  status: 'success' | 'error';\n  data?: T;\n  message?: string;\n  hint?: string;\n}\n\n/**\n * Generate a unique ID with optional prefix\n */\nexport function generateId(prefix: string = 'id'): string {\n  const timestamp = Date.now().toString(36);\n  const random = Math.random().toString(36).substring(2, 8);\n  return `${prefix}_${timestamp}${random}`;\n}\n\n/**\n * Increment semver patch version\n */\nexport function incrementVersion(version: string): string {\n  const parts = version.split('.').map(Number);\n  parts[2] = (parts[2] || 0) + 1;\n  return parts.join('.');\n}\n\n/**\n * Slugify a string\n */\nexport function slugify(str: string): string {\n  return str\n    .toLowerCase()\n    .trim()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/[\\s_-]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n}\n","/**\n * Sandbox - Isolated Execution Environment for Primitive Handlers\n *\n * Provides a restricted execution environment for user-provided code.\n * Security measures:\n * - No access to Node.js built-ins (fs, path, child_process, etc.)\n * - No access to global objects (process, global, globalThis)\n * - Limited JavaScript APIs (JSON, Math, Date, String, Number, etc.)\n * - Timeout enforcement\n * - Output size limits\n */\n\nimport type { ExecutionContext } from './types';\n\n/**\n * Sandbox Configuration\n */\nexport interface SandboxConfig {\n  timeout: number;         // Max execution time in ms\n  allowAsync: boolean;     // Allow async operations\n  maxOutputSize: number;   // Max output size in bytes\n}\n\n/**\n * Sandbox Execution Result\n */\nexport interface SandboxResult {\n  success: boolean;\n  result?: unknown;\n  error?: string;\n  executionTime: number;\n  outputSize?: number;\n}\n\n/**\n * Default sandbox configuration\n */\nconst DEFAULT_CONFIG: SandboxConfig = {\n  timeout: 30000,\n  allowAsync: true,\n  maxOutputSize: 1024 * 1024,  // 1MB\n};\n\n/**\n * Allowed globals in sandbox - safe JavaScript APIs only\n */\nconst SANDBOX_GLOBALS: Record<string, unknown> = {\n  // Core JavaScript\n  Object,\n  Array,\n  String,\n  Number,\n  Boolean,\n  Date,\n  RegExp,\n  Error,\n  TypeError,\n  RangeError,\n  SyntaxError,\n\n  // JSON operations\n  JSON,\n\n  // Math operations\n  Math,\n\n  // Data structures\n  Map,\n  Set,\n  WeakMap,\n  WeakSet,\n\n  // Utilities\n  parseInt,\n  parseFloat,\n  isNaN,\n  isFinite,\n  encodeURIComponent,\n  decodeURIComponent,\n  encodeURI,\n  decodeURI,\n\n  // Promises (if async allowed)\n  Promise,\n\n  // Console (captured, not actual logging)\n  console: {\n    log: (..._args: unknown[]) => {},\n    warn: (..._args: unknown[]) => {},\n    error: (..._args: unknown[]) => {},\n    info: (..._args: unknown[]) => {},\n  },\n\n  // URL parsing\n  URL,\n  URLSearchParams,\n\n  // Typed arrays\n  Uint8Array,\n  Int8Array,\n  Uint16Array,\n  Int16Array,\n  Uint32Array,\n  Int32Array,\n  Float32Array,\n  Float64Array,\n  ArrayBuffer,\n  DataView,\n\n  // Text encoding\n  TextEncoder,\n  TextDecoder,\n\n  // Explicit undefined values\n  undefined,\n  NaN,\n  Infinity,\n};\n\n/**\n * Security patterns - blocked code patterns\n */\nconst BLOCKED_PATTERNS: Array<{ pattern: RegExp; message: string }> = [\n  { pattern: /\\bprocess\\b/, message: 'Access to process object' },\n  { pattern: /\\brequire\\s*\\(/, message: 'CommonJS require' },\n  { pattern: /\\bimport\\s*\\(/, message: 'Dynamic import' },\n  { pattern: /\\bglobal\\b/, message: 'Access to global object' },\n  { pattern: /\\bglobalThis\\b/, message: 'Access to globalThis' },\n  { pattern: /\\beval\\s*\\(/, message: 'Use of eval()' },\n  { pattern: /\\bFunction\\s*\\(/, message: 'Function constructor' },\n  { pattern: /\\bchild_process\\b/, message: 'child_process module' },\n  { pattern: /\\b__proto__\\b/, message: 'Prototype manipulation' },\n  { pattern: /\\.constructor\\s*\\(/, message: 'Constructor access' },\n  { pattern: /\\bProxy\\b/, message: 'Proxy object' },\n  { pattern: /\\bReflect\\b/, message: 'Reflect object' },\n  { pattern: /\\bfetch\\b/, message: 'fetch API (use HTTP primitive instead)' },\n  { pattern: /\\bXMLHttpRequest\\b/, message: 'XMLHttpRequest (use HTTP primitive instead)' },\n];\n\n/**\n * Warning patterns - not blocked but flagged\n */\nconst WARNING_PATTERNS: Array<{ pattern: RegExp; message: string }> = [\n  { pattern: /\\bwhile\\s*\\(\\s*true\\s*\\)/, message: 'Potential infinite loop' },\n  { pattern: /\\bfor\\s*\\(\\s*;\\s*;\\s*\\)/, message: 'Potential infinite loop' },\n  { pattern: /\\bsetTimeout\\b/, message: 'Use of setTimeout' },\n  { pattern: /\\bsetInterval\\b/, message: 'Use of setInterval' },\n  { pattern: /\\.prototype\\b/, message: 'Prototype access' },\n];\n\n/**\n * Validate handler code for security issues\n */\nexport function validateHandlerSecurity(code: string): {\n  safe: boolean;\n  warnings: string[];\n  blocked: string[];\n} {\n  const warnings: string[] = [];\n  const blocked: string[] = [];\n\n  // Check blocked patterns\n  for (const { pattern, message } of BLOCKED_PATTERNS) {\n    if (pattern.test(code)) {\n      blocked.push(message);\n    }\n  }\n\n  // Check warning patterns\n  for (const { pattern, message } of WARNING_PATTERNS) {\n    if (pattern.test(code)) {\n      warnings.push(message);\n    }\n  }\n\n  return {\n    safe: blocked.length === 0,\n    warnings,\n    blocked,\n  };\n}\n\n/**\n * Create a sandbox function with restricted globals\n */\nexport function createSandboxFunction(\n  code: string,\n  config: Partial<SandboxConfig> = {}\n): (args: unknown, context: ExecutionContext) => unknown {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { allowAsync: _allowAsync } = { ...DEFAULT_CONFIG, ...config };\n\n  // Wrap code in strict mode\n  const wrappedCode = `\n    \"use strict\";\n    ${code}\n  `;\n\n  // Get global names and values for shadowing\n  const globalNames = Object.keys(SANDBOX_GLOBALS);\n  const globalValues = Object.values(SANDBOX_GLOBALS);\n\n  try {\n    // Create the sandbox function with shadowed globals\n    const sandboxFn = new Function(\n      'args',\n      'context',\n      ...globalNames,\n      // Add dummy parameters for blocked globals (shadowing)\n      '__blocked_process__',\n      '__blocked_require__',\n      '__blocked_global__',\n      '__blocked_globalThis__',\n      '__blocked_eval__',\n      '__blocked_Function__',\n      // The actual code\n      wrappedCode\n    );\n\n    // Return wrapped executor\n    return (args: unknown, context: ExecutionContext) => {\n      return sandboxFn(\n        args,\n        context,\n        ...globalValues,\n        // Pass undefined for blocked globals\n        undefined,  // process\n        undefined,  // require\n        undefined,  // global\n        undefined,  // globalThis\n        undefined,  // eval\n        undefined,  // Function\n      );\n    };\n  } catch (e) {\n    throw new Error(`Failed to compile handler: ${e instanceof Error ? e.message : String(e)}`);\n  }\n}\n\n/**\n * Execute function with timeout\n */\nasync function executeWithTimeout<T>(\n  fn: () => T | Promise<T>,\n  timeout: number\n): Promise<T> {\n  return new Promise<T>((resolve, reject) => {\n    const timeoutId = setTimeout(() => {\n      reject(new Error(`Execution timeout after ${timeout}ms`));\n    }, timeout);\n\n    try {\n      const result = fn();\n\n      if (result instanceof Promise) {\n        result\n          .then((value) => {\n            clearTimeout(timeoutId);\n            resolve(value);\n          })\n          .catch((err) => {\n            clearTimeout(timeoutId);\n            reject(err);\n          });\n      } else {\n        clearTimeout(timeoutId);\n        resolve(result);\n      }\n    } catch (e) {\n      clearTimeout(timeoutId);\n      reject(e);\n    }\n  });\n}\n\n/**\n * Get the size of output in bytes\n */\nfunction getOutputSize(output: unknown): number {\n  try {\n    return new TextEncoder().encode(JSON.stringify(output)).length;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Execute code in sandbox with timeout\n */\nexport async function executeSandbox(\n  code: string,\n  args: unknown,\n  context: ExecutionContext,\n  config: Partial<SandboxConfig> = {}\n): Promise<SandboxResult> {\n  const fullConfig = { ...DEFAULT_CONFIG, ...config };\n  const startTime = Date.now();\n\n  try {\n    // Validate security first\n    const securityCheck = validateHandlerSecurity(code);\n    if (!securityCheck.safe) {\n      return {\n        success: false,\n        error: `Security validation failed: ${securityCheck.blocked.join(', ')}`,\n        executionTime: Date.now() - startTime,\n      };\n    }\n\n    // Create sandbox function\n    const sandboxFn = createSandboxFunction(code, fullConfig);\n\n    // Execute with timeout\n    const result = await executeWithTimeout(\n      () => sandboxFn(args, context),\n      fullConfig.timeout\n    );\n\n    // Check output size\n    const outputSize = getOutputSize(result);\n    if (outputSize > fullConfig.maxOutputSize) {\n      return {\n        success: false,\n        error: `Output too large: ${outputSize} bytes (max: ${fullConfig.maxOutputSize})`,\n        executionTime: Date.now() - startTime,\n        outputSize,\n      };\n    }\n\n    return {\n      success: true,\n      result,\n      executionTime: Date.now() - startTime,\n      outputSize,\n    };\n  } catch (e) {\n    return {\n      success: false,\n      error: e instanceof Error ? e.message : String(e),\n      executionTime: Date.now() - startTime,\n    };\n  }\n}\n\n/**\n * Handler cache for compiled functions\n */\nconst handlerCache = new Map<string, (args: unknown, context: ExecutionContext) => unknown>();\n\n/**\n * Get or compile a handler function (cached)\n */\nexport function getOrCompileHandler(\n  primitiveId: string,\n  code: string,\n  config: Partial<SandboxConfig> = {}\n): (args: unknown, context: ExecutionContext) => unknown {\n  const cacheKey = `${primitiveId}:${hashCode(code)}`;\n\n  let handler = handlerCache.get(cacheKey);\n  if (!handler) {\n    handler = createSandboxFunction(code, config);\n    handlerCache.set(cacheKey, handler);\n  }\n\n  return handler;\n}\n\n/**\n * Invalidate cached handler for a primitive\n */\nexport function invalidateHandler(primitiveId: string): void {\n  for (const key of handlerCache.keys()) {\n    if (key.startsWith(`${primitiveId}:`)) {\n      handlerCache.delete(key);\n    }\n  }\n}\n\n/**\n * Clear all cached handlers\n */\nexport function clearHandlerCache(): void {\n  handlerCache.clear();\n}\n\n/**\n * Simple hash function for cache keys\n */\nfunction hashCode(str: string): number {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n  return Math.abs(hash);\n}\n","/**\n * Plugin Registry - Manages primitives, plugins, and workflows\n *\n * Two-tier architecture:\n * - Tier 1: In-memory cache (fast access for mounted primitives)\n * - Tier 2: PostgreSQL via Prisma (persistent storage)\n *\n * Read path: Memory -> DB (on cache miss)\n * Write path: Memory + DB (write-through)\n */\n\nimport { prisma } from '../db';\nimport type {\n  PrimitiveDefinition,\n  MountedPrimitive,\n  PluginDefinition,\n  WorkflowDefinition,\n  PrimitiveInfo,\n  PluginInfo,\n  RegistryStats,\n  CreatePrimitiveRequest,\n  UpdatePrimitiveRequest,\n  CreatePluginRequest,\n  JSONSchema,\n} from './types';\nimport { generateId, incrementVersion, slugify } from './types';\nimport { validateHandlerSecurity, createSandboxFunction, invalidateHandler } from './sandbox';\n\n/**\n * Plugin Registry - Singleton class managing the plugin system\n */\nexport class PluginRegistry {\n  // Tier 1: In-memory mounted primitives\n  private mountedPrimitives: Map<string, MountedPrimitive> = new Map();\n\n  // In-memory primitive definitions cache\n  private primitiveCache: Map<string, PrimitiveDefinition> = new Map();\n\n  // Compiled handlers cache\n  private handlerCache: Map<string, Function> = new Map();\n\n  // Initialization flag\n  private initialized: boolean = false;\n\n  /**\n   * Initialize the registry - load primitives from DB into memory\n   */\n  async initialize(): Promise<{ loaded: number; mounted: number; errors: string[] }> {\n    if (this.initialized) {\n      return { loaded: 0, mounted: 0, errors: [] };\n    }\n\n    const errors: string[] = [];\n    let loaded = 0;\n    let mounted = 0;\n\n    try {\n      // Load all enabled primitives from DB\n      const primitives = await prisma.primitive.findMany({\n        where: { enabled: true },\n      });\n\n      for (const dbPrimitive of primitives) {\n        try {\n          const definition = this.dbToPrimitiveDefinition(dbPrimitive);\n          this.primitiveCache.set(definition.id, definition);\n          loaded++;\n\n          // Auto-mount all enabled primitives\n          const mountResult = this.mountPrimitive(definition.id);\n          if (mountResult.success) {\n            mounted++;\n          } else {\n            errors.push(`Failed to mount ${definition.name}: ${mountResult.error}`);\n          }\n        } catch (e) {\n          errors.push(`Failed to load primitive ${dbPrimitive.id}: ${e instanceof Error ? e.message : String(e)}`);\n        }\n      }\n\n      this.initialized = true;\n    } catch (e) {\n      errors.push(`Failed to initialize registry: ${e instanceof Error ? e.message : String(e)}`);\n    }\n\n    return { loaded, mounted, errors };\n  }\n\n  // ============================================================================\n  // PRIMITIVE MANAGEMENT\n  // ============================================================================\n\n  /**\n   * Create a new primitive\n   */\n  async createPrimitive(request: CreatePrimitiveRequest): Promise<{ success: boolean; primitiveId?: string; error?: string }> {\n    // Validate handler security\n    const securityCheck = validateHandlerSecurity(request.handler);\n    if (!securityCheck.safe) {\n      return { success: false, error: `Handler security failed: ${securityCheck.blocked.join(', ')}` };\n    }\n\n    // Check for duplicate name\n    const existing = await prisma.primitive.findUnique({ where: { name: request.name } });\n    if (existing) {\n      return { success: false, error: `Primitive with name \"${request.name}\" already exists` };\n    }\n\n    // Validate handler can compile\n    try {\n      createSandboxFunction(request.handler);\n    } catch (e) {\n      return { success: false, error: `Handler compilation failed: ${e instanceof Error ? e.message : String(e)}` };\n    }\n\n    const id = generateId('prim');\n\n    try {\n      // Create in DB\n      const dbPrimitive = await prisma.primitive.create({\n        data: {\n          id,\n          name: request.name,\n          description: request.description,\n          inputSchema: request.inputSchema as object,\n          handler: request.handler,\n          category: request.category,\n          tags: request.tags || [],\n          icon: request.icon,\n          timeout: request.timeout || 30000,\n          enabled: true,\n          pluginId: request.pluginId,\n        },\n      });\n\n      // Add to memory cache\n      const definition = this.dbToPrimitiveDefinition(dbPrimitive);\n      this.primitiveCache.set(id, definition);\n\n      // Auto-mount if requested\n      if (request.autoMount !== false) {\n        const mountResult = this.mountPrimitive(id);\n        if (!mountResult.success) {\n          return { success: true, primitiveId: id, error: `Created but mount failed: ${mountResult.error}` };\n        }\n      }\n\n      return { success: true, primitiveId: id };\n    } catch (e) {\n      return { success: false, error: `Database error: ${e instanceof Error ? e.message : String(e)}` };\n    }\n  }\n\n  /**\n   * Update an existing primitive\n   */\n  async updatePrimitive(id: string, request: UpdatePrimitiveRequest): Promise<{ success: boolean; error?: string }> {\n    const existing = this.primitiveCache.get(id) || await this.getPrimitiveFromDb(id);\n    if (!existing) {\n      return { success: false, error: `Primitive not found: ${id}` };\n    }\n\n    // Validate new handler if provided\n    if (request.handler) {\n      const securityCheck = validateHandlerSecurity(request.handler);\n      if (!securityCheck.safe) {\n        return { success: false, error: `Handler security failed: ${securityCheck.blocked.join(', ')}` };\n      }\n\n      try {\n        createSandboxFunction(request.handler);\n      } catch (e) {\n        return { success: false, error: `Handler compilation failed: ${e instanceof Error ? e.message : String(e)}` };\n      }\n    }\n\n    try {\n      // Update in DB\n      const updated = await prisma.primitive.update({\n        where: { id },\n        data: {\n          description: request.description ?? existing.description,\n          inputSchema: (request.inputSchema ?? existing.inputSchema) as object,\n          handler: request.handler ?? existing.handler,\n          category: request.category ?? existing.category,\n          tags: request.tags ?? existing.tags,\n          icon: request.icon ?? existing.icon,\n          timeout: request.timeout ?? existing.timeout,\n          enabled: request.enabled ?? existing.enabled,\n          version: incrementVersion(existing.version),\n        },\n      });\n\n      // Update memory cache\n      const definition = this.dbToPrimitiveDefinition(updated);\n      this.primitiveCache.set(id, definition);\n\n      // Invalidate handler cache\n      invalidateHandler(id);\n      this.handlerCache.delete(id);\n\n      // Re-mount if currently mounted\n      if (this.mountedPrimitives.has(id)) {\n        this.dismountPrimitive(id);\n        this.mountPrimitive(id);\n      }\n\n      return { success: true };\n    } catch (e) {\n      return { success: false, error: `Database error: ${e instanceof Error ? e.message : String(e)}` };\n    }\n  }\n\n  /**\n   * Delete a primitive\n   */\n  async deletePrimitive(id: string, force: boolean = false): Promise<{ success: boolean; error?: string }> {\n    if (this.mountedPrimitives.has(id) && !force) {\n      return { success: false, error: 'Primitive is mounted. Use force=true to dismount and delete.' };\n    }\n\n    // Dismount if mounted\n    if (this.mountedPrimitives.has(id)) {\n      this.dismountPrimitive(id);\n    }\n\n    try {\n      await prisma.primitive.delete({ where: { id } });\n      this.primitiveCache.delete(id);\n      invalidateHandler(id);\n      this.handlerCache.delete(id);\n\n      return { success: true };\n    } catch (e) {\n      return { success: false, error: `Database error: ${e instanceof Error ? e.message : String(e)}` };\n    }\n  }\n\n  /**\n   * Mount a primitive to make it active\n   */\n  mountPrimitive(id: string, config?: Record<string, unknown>): { success: boolean; error?: string } {\n    const definition = this.primitiveCache.get(id);\n    if (!definition) {\n      return { success: false, error: `Primitive not found in cache: ${id}` };\n    }\n\n    if (this.mountedPrimitives.has(id)) {\n      return { success: false, error: `Primitive already mounted: ${id}` };\n    }\n\n    // Compile handler\n    let compiledHandler: Function;\n    try {\n      compiledHandler = createSandboxFunction(definition.handler);\n      this.handlerCache.set(id, compiledHandler);\n    } catch (e) {\n      return { success: false, error: `Handler compilation failed: ${e instanceof Error ? e.message : String(e)}` };\n    }\n\n    // Mount\n    const mounted: MountedPrimitive = {\n      definition,\n      mountedAt: Date.now(),\n      config,\n      invocationCount: 0,\n      compiledHandler,\n    };\n\n    this.mountedPrimitives.set(id, mounted);\n    return { success: true };\n  }\n\n  /**\n   * Dismount a primitive\n   */\n  dismountPrimitive(id: string): { success: boolean; error?: string } {\n    if (!this.mountedPrimitives.has(id)) {\n      return { success: false, error: `Primitive not mounted: ${id}` };\n    }\n\n    this.mountedPrimitives.delete(id);\n    this.handlerCache.delete(id);\n    invalidateHandler(id);\n\n    return { success: true };\n  }\n\n  /**\n   * Get a mounted primitive by ID or name\n   */\n  getMountedPrimitive(idOrName: string): MountedPrimitive | undefined {\n    // Try by ID first\n    let primitive = this.mountedPrimitives.get(idOrName);\n    if (primitive) return primitive;\n\n    // Try by name\n    for (const mounted of this.mountedPrimitives.values()) {\n      if (mounted.definition.name === idOrName) {\n        return mounted;\n      }\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Get all mounted primitives\n   */\n  getMountedPrimitives(): MountedPrimitive[] {\n    return Array.from(this.mountedPrimitives.values());\n  }\n\n  /**\n   * Get compiled handler for a primitive\n   */\n  getCompiledHandler(id: string): Function | undefined {\n    return this.handlerCache.get(id);\n  }\n\n  /**\n   * Record a primitive invocation\n   */\n  recordInvocation(id: string): void {\n    const mounted = this.mountedPrimitives.get(id);\n    if (mounted) {\n      mounted.invocationCount++;\n      mounted.lastInvoked = Date.now();\n    }\n  }\n\n  /**\n   * List primitives with filtering\n   */\n  async listPrimitives(options: {\n    filter?: 'mounted' | 'available' | 'all';\n    category?: string;\n    tags?: string[];\n    pluginId?: string;\n    search?: string;\n  } = {}): Promise<PrimitiveInfo[]> {\n    const { filter = 'all', category, tags, pluginId, search } = options;\n\n    let primitives: PrimitiveInfo[] = [];\n\n    if (filter === 'mounted') {\n      // Only mounted primitives (from memory)\n      for (const mounted of this.mountedPrimitives.values()) {\n        primitives.push(this.toPrimitiveInfo(mounted.definition, true));\n      }\n    } else {\n      // Query from DB\n      const where: any = {};\n      if (category) where.category = category;\n      if (pluginId) where.pluginId = pluginId;\n      if (tags?.length) where.tags = { hasSome: tags };\n      if (search) {\n        where.OR = [\n          { name: { contains: search, mode: 'insensitive' } },\n          { description: { contains: search, mode: 'insensitive' } },\n        ];\n      }\n\n      const dbPrimitives = await prisma.primitive.findMany({ where });\n\n      for (const dbPrim of dbPrimitives) {\n        const isMounted = this.mountedPrimitives.has(dbPrim.id);\n        if (filter === 'available' && isMounted) continue;\n\n        primitives.push({\n          id: dbPrim.id,\n          name: dbPrim.name,\n          description: dbPrim.description,\n          version: dbPrim.version,\n          tags: dbPrim.tags,\n          category: dbPrim.category || undefined,\n          icon: dbPrim.icon || undefined,\n          mounted: isMounted,\n          enabled: dbPrim.enabled,\n          author: dbPrim.author || undefined,\n          createdAt: dbPrim.createdAt,\n          updatedAt: dbPrim.updatedAt,\n        });\n      }\n    }\n\n    return primitives;\n  }\n\n  // ============================================================================\n  // PLUGIN MANAGEMENT\n  // ============================================================================\n\n  /**\n   * Create a new plugin\n   */\n  async createPlugin(request: CreatePluginRequest): Promise<{ success: boolean; pluginId?: string; error?: string }> {\n    const slug = request.slug || slugify(request.name);\n\n    // Check for duplicate\n    const existing = await prisma.plugin.findFirst({\n      where: { OR: [{ name: request.name }, { slug }] },\n    });\n    if (existing) {\n      return { success: false, error: `Plugin with name or slug already exists` };\n    }\n\n    const id = generateId('plug');\n\n    try {\n      await prisma.plugin.create({\n        data: {\n          id,\n          name: request.name,\n          slug,\n          description: request.description,\n          icon: request.icon,\n          color: request.color,\n          config: request.config as object,\n          configSchema: request.configSchema as object,\n          author: request.author,\n          enabled: false, // Disabled by default\n        },\n      });\n\n      return { success: true, pluginId: id };\n    } catch (e) {\n      return { success: false, error: `Database error: ${e instanceof Error ? e.message : String(e)}` };\n    }\n  }\n\n  /**\n   * Enable/disable a plugin\n   */\n  async setPluginEnabled(id: string, enabled: boolean): Promise<{ success: boolean; error?: string }> {\n    try {\n      const plugin = await prisma.plugin.findUnique({ where: { id } });\n      if (!plugin) {\n        return { success: false, error: `Plugin not found: ${id}` };\n      }\n\n      // Update plugin\n      await prisma.plugin.update({\n        where: { id },\n        data: { enabled },\n      });\n\n      // Mount/dismount plugin's primitives\n      const primitives = await prisma.primitive.findMany({\n        where: { pluginId: id, enabled: true },\n      });\n\n      for (const prim of primitives) {\n        if (enabled) {\n          const def = this.dbToPrimitiveDefinition(prim);\n          this.primitiveCache.set(prim.id, def);\n          this.mountPrimitive(prim.id);\n        } else {\n          this.dismountPrimitive(prim.id);\n        }\n      }\n\n      return { success: true };\n    } catch (e) {\n      return { success: false, error: `Database error: ${e instanceof Error ? e.message : String(e)}` };\n    }\n  }\n\n  /**\n   * Delete a plugin and its primitives\n   */\n  async deletePlugin(id: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      // Get primitives to dismount\n      const primitives = await prisma.primitive.findMany({ where: { pluginId: id } });\n\n      for (const prim of primitives) {\n        this.dismountPrimitive(prim.id);\n        this.primitiveCache.delete(prim.id);\n      }\n\n      // Delete plugin (cascades to primitives)\n      await prisma.plugin.delete({ where: { id } });\n\n      return { success: true };\n    } catch (e) {\n      return { success: false, error: `Database error: ${e instanceof Error ? e.message : String(e)}` };\n    }\n  }\n\n  /**\n   * List plugins\n   */\n  async listPlugins(options: {\n    enabled?: boolean;\n    search?: string;\n  } = {}): Promise<PluginInfo[]> {\n    const { enabled, search } = options;\n\n    const where: any = {};\n    if (enabled !== undefined) where.enabled = enabled;\n    if (search) {\n      where.OR = [\n        { name: { contains: search, mode: 'insensitive' } },\n        { description: { contains: search, mode: 'insensitive' } },\n      ];\n    }\n\n    const plugins = await prisma.plugin.findMany({\n      where,\n      include: { _count: { select: { primitives: true } } },\n    });\n\n    return plugins.map(p => ({\n      id: p.id,\n      name: p.name,\n      slug: p.slug,\n      description: p.description || undefined,\n      version: p.version,\n      icon: p.icon || undefined,\n      color: p.color || undefined,\n      enabled: p.enabled,\n      installed: p.installed,\n      builtIn: p.builtIn,\n      primitiveCount: p._count.primitives,\n      author: p.author || undefined,\n      createdAt: p.createdAt,\n      updatedAt: p.updatedAt,\n    }));\n  }\n\n  // ============================================================================\n  // WORKFLOW MANAGEMENT\n  // ============================================================================\n\n  /**\n   * Get workflow by ID\n   */\n  async getWorkflow(id: string): Promise<WorkflowDefinition | null> {\n    const workflow = await prisma.workflow.findUnique({ where: { id } });\n    if (!workflow) return null;\n\n    return {\n      id: workflow.id,\n      name: workflow.name,\n      slug: workflow.slug,\n      description: workflow.description || undefined,\n      nodes: workflow.nodes as any[],\n      edges: workflow.edges as any[],\n      viewport: workflow.viewport as any,\n      config: workflow.config as any,\n      variables: workflow.variables as any,\n      triggerType: workflow.triggerType,\n      triggerConfig: workflow.triggerConfig as any,\n      enabled: workflow.enabled,\n      pluginId: workflow.pluginId,\n      createdAt: workflow.createdAt,\n      updatedAt: workflow.updatedAt,\n      lastRunAt: workflow.lastRunAt || undefined,\n    };\n  }\n\n  /**\n   * List workflows\n   */\n  async listWorkflows(options: {\n    enabled?: boolean;\n    pluginId?: string;\n    triggerType?: string;\n  } = {}): Promise<WorkflowDefinition[]> {\n    const where: any = {};\n    if (options.enabled !== undefined) where.enabled = options.enabled;\n    if (options.pluginId) where.pluginId = options.pluginId;\n    if (options.triggerType) where.triggerType = options.triggerType;\n\n    const workflows = await prisma.workflow.findMany({ where });\n\n    return workflows.map(w => ({\n      id: w.id,\n      name: w.name,\n      slug: w.slug,\n      description: w.description || undefined,\n      nodes: w.nodes as any[],\n      edges: w.edges as any[],\n      viewport: w.viewport as any,\n      config: w.config as any,\n      variables: w.variables as any,\n      triggerType: w.triggerType,\n      triggerConfig: w.triggerConfig as any,\n      enabled: w.enabled,\n      pluginId: w.pluginId,\n      createdAt: w.createdAt,\n      updatedAt: w.updatedAt,\n      lastRunAt: w.lastRunAt || undefined,\n    }));\n  }\n\n  // ============================================================================\n  // STATISTICS\n  // ============================================================================\n\n  /**\n   * Get registry statistics\n   */\n  async getStats(): Promise<RegistryStats> {\n    const [primitiveCount, pluginStats, workflowCount, executionCount] = await Promise.all([\n      prisma.primitive.count(),\n      prisma.plugin.aggregate({\n        _count: true,\n        where: { enabled: true },\n      }),\n      prisma.workflow.count(),\n      prisma.primitiveExecution.count(),\n    ]);\n\n    return {\n      primitiveCount,\n      mountedCount: this.mountedPrimitives.size,\n      pluginCount: await prisma.plugin.count(),\n      enabledPluginCount: pluginStats._count,\n      workflowCount,\n      totalExecutions: executionCount,\n    };\n  }\n\n  // ============================================================================\n  // HELPER METHODS\n  // ============================================================================\n\n  private dbToPrimitiveDefinition(db: any): PrimitiveDefinition {\n    return {\n      id: db.id,\n      name: db.name,\n      version: db.version,\n      description: db.description,\n      inputSchema: db.inputSchema as JSONSchema,\n      handler: db.handler,\n      dependencies: db.dependencies,\n      author: db.author || undefined,\n      tags: db.tags,\n      tier: db.tier,\n      category: db.category || undefined,\n      icon: db.icon || undefined,\n      timeout: db.timeout,\n      memory: db.memory,\n      sandbox: db.sandbox,\n      enabled: db.enabled,\n      builtIn: db.builtIn,\n      pluginId: db.pluginId,\n      createdAt: db.createdAt,\n      updatedAt: db.updatedAt,\n    };\n  }\n\n  private async getPrimitiveFromDb(id: string): Promise<PrimitiveDefinition | null> {\n    const db = await prisma.primitive.findUnique({ where: { id } });\n    if (!db) return null;\n    return this.dbToPrimitiveDefinition(db);\n  }\n\n  private toPrimitiveInfo(def: PrimitiveDefinition, mounted: boolean): PrimitiveInfo {\n    return {\n      id: def.id,\n      name: def.name,\n      description: def.description,\n      version: def.version,\n      tags: def.tags || [],\n      category: def.category,\n      icon: def.icon,\n      mounted,\n      enabled: def.enabled ?? true,\n      author: def.author,\n      createdAt: def.createdAt ?? new Date(),\n      updatedAt: def.updatedAt ?? new Date(),\n    };\n  }\n\n  /**\n   * Check if registry is initialized\n   */\n  isInitialized(): boolean {\n    return this.initialized;\n  }\n}\n\n// Singleton instance\nlet registryInstance: PluginRegistry | null = null;\n\n/**\n * Get the global plugin registry instance\n */\nexport function getPluginRegistry(): PluginRegistry {\n  if (!registryInstance) {\n    registryInstance = new PluginRegistry();\n  }\n  return registryInstance;\n}\n\n/**\n * Reset the registry (for testing)\n */\nexport function resetPluginRegistry(): void {\n  registryInstance = new PluginRegistry();\n}\n","/**\n * Primitive Executor - Orchestrates execution with validation and sandboxing\n *\n * Ties together:\n * - Input validation\n * - Sandboxed execution\n * - Output validation\n * - Error handling and metrics\n * - Execution logging\n */\n\nimport { prisma } from '../db';\nimport type {\n  PrimitiveDefinition,\n  ExecutionContext,\n  ExecutionResult,\n  JSONSchema,\n} from './types';\nimport { generateId } from './types';\nimport {\n  executeSandbox,\n  validateHandlerSecurity,\n  getOrCompileHandler,\n  type SandboxConfig,\n} from './sandbox';\nimport { getPluginRegistry } from './registry';\n\n/**\n * Execution Options\n */\nexport interface ExecutionOptions {\n  timeout?: number;          // Override default timeout\n  skipValidation?: boolean;  // Skip input validation\n  skipSandbox?: boolean;     // Run without sandbox (trusted code only)\n  recordMetrics?: boolean;   // Record execution to DB (default: true)\n  debug?: boolean;           // Enable debug mode\n}\n\n/**\n * Validate input against JSON Schema\n */\nfunction validateInput(\n  input: Record<string, unknown>,\n  schema: JSONSchema\n): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n\n  // Check required fields\n  if (schema.required) {\n    for (const field of schema.required) {\n      if (!(field in input)) {\n        errors.push(`Missing required field: ${field}`);\n      }\n    }\n  }\n\n  // Check property types\n  for (const [key, prop] of Object.entries(schema.properties)) {\n    if (key in input) {\n      const value = input[key];\n      const expectedType = prop.type;\n\n      if (expectedType === 'array' && !Array.isArray(value)) {\n        errors.push(`Field \"${key}\" should be an array`);\n      } else if (expectedType === 'object' && (typeof value !== 'object' || value === null || Array.isArray(value))) {\n        errors.push(`Field \"${key}\" should be an object`);\n      } else if (expectedType === 'string' && typeof value !== 'string') {\n        errors.push(`Field \"${key}\" should be a string`);\n      } else if (expectedType === 'number' && typeof value !== 'number') {\n        errors.push(`Field \"${key}\" should be a number`);\n      } else if (expectedType === 'boolean' && typeof value !== 'boolean') {\n        errors.push(`Field \"${key}\" should be a boolean`);\n      }\n\n      // Check enum values\n      if (prop.enum && !prop.enum.includes(value as string)) {\n        errors.push(`Field \"${key}\" must be one of: ${prop.enum.join(', ')}`);\n      }\n\n      // Check string constraints\n      if (typeof value === 'string') {\n        if (prop.minLength && value.length < prop.minLength) {\n          errors.push(`Field \"${key}\" must be at least ${prop.minLength} characters`);\n        }\n        if (prop.maxLength && value.length > prop.maxLength) {\n          errors.push(`Field \"${key}\" must be at most ${prop.maxLength} characters`);\n        }\n        if (prop.pattern && !new RegExp(prop.pattern).test(value)) {\n          errors.push(`Field \"${key}\" must match pattern: ${prop.pattern}`);\n        }\n      }\n\n      // Check number constraints\n      if (typeof value === 'number') {\n        if (prop.minimum !== undefined && value < prop.minimum) {\n          errors.push(`Field \"${key}\" must be at least ${prop.minimum}`);\n        }\n        if (prop.maximum !== undefined && value > prop.maximum) {\n          errors.push(`Field \"${key}\" must be at most ${prop.maximum}`);\n        }\n      }\n    }\n  }\n\n  // Check for extra fields if additionalProperties is false\n  if (schema.additionalProperties === false) {\n    for (const key of Object.keys(input)) {\n      if (!(key in schema.properties)) {\n        errors.push(`Unknown field: ${key}`);\n      }\n    }\n  }\n\n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Execute a primitive with full validation and sandboxing\n */\nexport async function executePrimitive(\n  primitive: PrimitiveDefinition,\n  args: Record<string, unknown>,\n  context: Partial<ExecutionContext> = {},\n  options: ExecutionOptions = {}\n): Promise<ExecutionResult> {\n  const startTime = Date.now();\n  const invocationId = generateId('exec');\n  const {\n    timeout = primitive.timeout || 30000,\n    skipValidation = false,\n    skipSandbox = false,\n    recordMetrics = true,\n    debug = false,\n  } = options;\n\n  // Build full execution context\n  const execContext: ExecutionContext = {\n    primitiveId: primitive.id,\n    primitiveName: primitive.name,\n    invocationId,\n    startTime,\n    timeout,\n    debug,\n    ...context,\n  };\n\n  try {\n    // Step 1: Input validation\n    if (!skipValidation) {\n      const validation = validateInput(args, primitive.inputSchema);\n      if (!validation.valid) {\n        return createErrorResult(\n          `Input validation failed:\\n- ${validation.errors.join('\\n- ')}`,\n          startTime,\n          invocationId\n        );\n      }\n    }\n\n    // Step 2: Security check on handler\n    const securityCheck = validateHandlerSecurity(primitive.handler);\n    if (!securityCheck.safe) {\n      return createErrorResult(\n        `Handler security validation failed:\\n- ${securityCheck.blocked.join('\\n- ')}`,\n        startTime,\n        invocationId\n      );\n    }\n\n    // Log warnings in debug mode\n    if (debug && securityCheck.warnings.length > 0) {\n      console.warn(`[${primitive.name}] Security warnings:\\n- ${securityCheck.warnings.join('\\n- ')}`);\n    }\n\n    // Step 3: Execute handler\n    let result: unknown;\n\n    if (skipSandbox) {\n      // Direct execution (trusted code only)\n      result = await executeDirectly(primitive, args, execContext, timeout);\n    } else {\n      // Sandboxed execution\n      const sandboxConfig: Partial<SandboxConfig> = {\n        timeout,\n        allowAsync: true,\n        maxOutputSize: 1024 * 1024, // 1MB\n      };\n\n      const sandboxResult = await executeSandbox(\n        primitive.handler,\n        args,\n        execContext,\n        sandboxConfig\n      );\n\n      if (!sandboxResult.success) {\n        const errorResult = createErrorResult(\n          sandboxResult.error || 'Unknown execution error',\n          startTime,\n          invocationId\n        );\n\n        // Record failed execution\n        if (recordMetrics) {\n          await recordExecution(\n            primitive.id,\n            args,\n            null,\n            false,\n            sandboxResult.error,\n            startTime,\n            Date.now(),\n            execContext\n          );\n        }\n\n        return errorResult;\n      }\n\n      result = sandboxResult.result;\n    }\n\n    // Step 4: Success\n    const endTime = Date.now();\n    const executionResult: ExecutionResult = {\n      success: true,\n      result,\n      executionTime: endTime - startTime,\n      invocationId,\n    };\n\n    // Record successful execution\n    if (recordMetrics) {\n      await recordExecution(\n        primitive.id,\n        args,\n        result,\n        true,\n        undefined,\n        startTime,\n        endTime,\n        execContext\n      );\n    }\n\n    // Update registry invocation count\n    const registry = getPluginRegistry();\n    registry.recordInvocation(primitive.id);\n\n    return executionResult;\n\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorResult = createErrorResult(errorMessage, startTime, invocationId);\n\n    // Record failed execution\n    if (recordMetrics) {\n      await recordExecution(\n        primitive.id,\n        args,\n        null,\n        false,\n        errorMessage,\n        startTime,\n        Date.now(),\n        execContext\n      );\n    }\n\n    return errorResult;\n  }\n}\n\n/**\n * Execute handler directly without sandbox (for trusted code)\n */\nasync function executeDirectly(\n  primitive: PrimitiveDefinition,\n  args: Record<string, unknown>,\n  context: ExecutionContext,\n  timeout: number\n): Promise<unknown> {\n  const handler = getOrCompileHandler(primitive.id, primitive.handler);\n\n  return new Promise((resolve, reject) => {\n    const timeoutId = setTimeout(() => {\n      reject(new Error(`Execution timeout after ${timeout}ms`));\n    }, timeout);\n\n    try {\n      const result = handler(args, context);\n\n      if (result instanceof Promise) {\n        result\n          .then((value) => {\n            clearTimeout(timeoutId);\n            resolve(value);\n          })\n          .catch((err) => {\n            clearTimeout(timeoutId);\n            reject(err);\n          });\n      } else {\n        clearTimeout(timeoutId);\n        resolve(result);\n      }\n    } catch (e) {\n      clearTimeout(timeoutId);\n      reject(e);\n    }\n  });\n}\n\n/**\n * Create an error result\n */\nfunction createErrorResult(\n  error: string,\n  startTime: number,\n  invocationId: string\n): ExecutionResult {\n  return {\n    success: false,\n    error,\n    executionTime: Date.now() - startTime,\n    invocationId,\n  };\n}\n\n/**\n * Record execution to database for audit trail\n */\nasync function recordExecution(\n  primitiveId: string,\n  input: Record<string, unknown>,\n  output: unknown,\n  success: boolean,\n  error: string | undefined,\n  startedAt: number,\n  completedAt: number,\n  context: ExecutionContext\n): Promise<void> {\n  try {\n    await prisma.primitiveExecution.create({\n      data: {\n        primitiveId,\n        workflowExecutionId: context.workflowExecutionId,\n        userId: context.userId,\n        agentId: context.agentId,\n        input: input as object,\n        output: output as object,\n        success,\n        error,\n        startedAt: new Date(startedAt),\n        completedAt: new Date(completedAt),\n        executionTime: completedAt - startedAt,\n      },\n    });\n  } catch (e) {\n    // Don't fail execution if metrics recording fails\n    console.error('Failed to record execution:', e);\n  }\n}\n\n/**\n * Test a primitive with sample input\n */\nexport async function testPrimitive(\n  primitive: PrimitiveDefinition,\n  testInput: Record<string, unknown>,\n  context?: Partial<ExecutionContext>\n): Promise<{\n  success: boolean;\n  result?: unknown;\n  error?: string;\n  validationErrors?: string[];\n  securityWarnings?: string[];\n  executionTime: number;\n}> {\n  const startTime = Date.now();\n\n  // Check input validation\n  const inputValidation = validateInput(testInput, primitive.inputSchema);\n\n  // Check handler security\n  const securityCheck = validateHandlerSecurity(primitive.handler);\n\n  // If validation fails, return early\n  if (!inputValidation.valid) {\n    return {\n      success: false,\n      error: 'Input validation failed',\n      validationErrors: inputValidation.errors,\n      securityWarnings: securityCheck.warnings,\n      executionTime: Date.now() - startTime,\n    };\n  }\n\n  if (!securityCheck.safe) {\n    return {\n      success: false,\n      error: 'Handler security check failed',\n      validationErrors: securityCheck.blocked,\n      securityWarnings: securityCheck.warnings,\n      executionTime: Date.now() - startTime,\n    };\n  }\n\n  // Execute (without recording metrics)\n  const result = await executePrimitive(primitive, testInput, context, {\n    recordMetrics: false,\n    debug: true,\n  });\n\n  return {\n    success: result.success,\n    result: result.result,\n    error: result.error,\n    securityWarnings: securityCheck.warnings,\n    executionTime: result.executionTime,\n  };\n}\n\n/**\n * Execute a primitive by ID or name\n */\nexport async function executeByIdOrName(\n  idOrName: string,\n  args: Record<string, unknown>,\n  context?: Partial<ExecutionContext>,\n  options?: ExecutionOptions\n): Promise<ExecutionResult> {\n  const registry = getPluginRegistry();\n  const mounted = registry.getMountedPrimitive(idOrName);\n\n  if (!mounted) {\n    return {\n      success: false,\n      error: `Primitive not found or not mounted: ${idOrName}`,\n      executionTime: 0,\n    };\n  }\n\n  return executePrimitive(mounted.definition, args, context, options);\n}\n\n/**\n * Get execution statistics for a primitive\n */\nexport async function getExecutionStats(primitiveId: string): Promise<{\n  totalExecutions: number;\n  successCount: number;\n  errorCount: number;\n  averageExecutionTime: number;\n  lastExecution?: Date;\n}> {\n  const stats = await prisma.primitiveExecution.aggregate({\n    where: { primitiveId },\n    _count: true,\n    _avg: { executionTime: true },\n  });\n\n  const successCount = await prisma.primitiveExecution.count({\n    where: { primitiveId, success: true },\n  });\n\n  const lastExecution = await prisma.primitiveExecution.findFirst({\n    where: { primitiveId },\n    orderBy: { startedAt: 'desc' },\n    select: { startedAt: true },\n  });\n\n  return {\n    totalExecutions: stats._count,\n    successCount,\n    errorCount: stats._count - successCount,\n    averageExecutionTime: stats._avg.executionTime || 0,\n    lastExecution: lastExecution?.startedAt,\n  };\n}\n\n/**\n * Get recent executions for a primitive\n */\nexport async function getRecentExecutions(\n  primitiveId: string,\n  limit: number = 10\n): Promise<Array<{\n  id: string;\n  success: boolean;\n  error?: string;\n  executionTime: number;\n  startedAt: Date;\n  userId?: string;\n  agentId?: string;\n}>> {\n  const executions = await prisma.primitiveExecution.findMany({\n    where: { primitiveId },\n    orderBy: { startedAt: 'desc' },\n    take: limit,\n    select: {\n      id: true,\n      success: true,\n      error: true,\n      executionTime: true,\n      startedAt: true,\n      userId: true,\n      agentId: true,\n    },\n  });\n\n  return executions.map(e => ({\n    id: e.id,\n    success: e.success,\n    error: e.error || undefined,\n    executionTime: e.executionTime,\n    startedAt: e.startedAt,\n    userId: e.userId || undefined,\n    agentId: e.agentId || undefined,\n  }));\n}\n","/**\n * AI Chat Primitives\n *\n * AI-callable primitives for AI chat functionality.\n * Enables store owners to build custom AI chat interfaces.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const AI_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // SEND MESSAGE\n  // ============================================================================\n  {\n    name: 'ai.chat',\n    description: 'Send a message to the AI assistant and get a response',\n    category: 'ai',\n    tags: ['ai', 'chat', 'assistant', 'conversation'],\n    icon: 'MessageSquare',\n    timeout: 60000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        message: {\n          type: 'string',\n          description: 'User message',\n          minLength: 1,\n        },\n        conversationId: {\n          type: 'string',\n          description: 'Existing conversation ID to continue',\n        },\n        systemPrompt: {\n          type: 'string',\n          description: 'Custom system prompt (for new conversations)',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        context: {\n          type: 'object',\n          description: 'Additional context (product info, order details, etc.)',\n        },\n      },\n      required: ['message'],\n    },\n    handler: `\n      const { message, conversationId, systemPrompt, userId, context } = input;\n\n      let conversation;\n\n      if (conversationId) {\n        conversation = await prisma.aIConversation.findFirst({\n          where: { id: conversationId, deletedAt: null },\n          include: {\n            messages: { orderBy: { createdAt: 'asc' }, take: 20 },\n          },\n        });\n\n        if (!conversation) {\n          throw new Error('Conversation not found');\n        }\n      } else {\n        // Create new conversation\n        conversation = await prisma.aIConversation.create({\n          data: {\n            userId: userId || null,\n            title: message.substring(0, 50) + (message.length > 50 ? '...' : ''),\n            systemPrompt: systemPrompt || 'You are a helpful e-commerce assistant.',\n            context: context || {},\n          },\n          include: { messages: true },\n        });\n      }\n\n      // Save user message\n      await prisma.aIMessage.create({\n        data: {\n          conversationId: conversation.id,\n          role: 'user',\n          content: message,\n        },\n      });\n\n      // Note: Actual AI response would be generated via API route using AI SDK\n      // This primitive sets up the conversation structure\n      return {\n        conversationId: conversation.id,\n        message,\n        context: conversation.context,\n        previousMessages: conversation.messages.map(m => ({\n          role: m.role,\n          content: m.content,\n          createdAt: m.createdAt,\n        })),\n        systemPrompt: conversation.systemPrompt,\n        note: 'Use /api/ai/chat endpoint for actual AI responses with streaming',\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET CONVERSATIONS\n  // ============================================================================\n  {\n    name: 'ai.getConversations',\n    description: 'Get list of AI chat conversations for a user',\n    category: 'ai',\n    tags: ['ai', 'chat', 'history', 'conversations'],\n    icon: 'MessageCircle',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, page = 1, limit = 20 } = input;\n\n      const where = { userId, deletedAt: null };\n\n      const [conversations, total] = await Promise.all([\n        prisma.aIConversation.findMany({\n          where,\n          include: {\n            messages: {\n              orderBy: { createdAt: 'desc' },\n              take: 1,\n            },\n            _count: { select: { messages: true } },\n          },\n          orderBy: { updatedAt: 'desc' },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.aIConversation.count({ where }),\n      ]);\n\n      return {\n        conversations: conversations.map(c => ({\n          id: c.id,\n          title: c.title,\n          lastMessage: c.messages[0]?.content?.substring(0, 100),\n          messageCount: c._count.messages,\n          createdAt: c.createdAt,\n          updatedAt: c.updatedAt,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET CONVERSATION\n  // ============================================================================\n  {\n    name: 'ai.getConversation',\n    description: 'Get a single conversation with all messages',\n    category: 'ai',\n    tags: ['ai', 'chat', 'conversation', 'messages'],\n    icon: 'MessagesSquare',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        conversationId: {\n          type: 'string',\n          description: 'Conversation ID',\n        },\n        limit: {\n          type: 'number',\n          description: 'Max messages to return',\n          default: 50,\n        },\n        before: {\n          type: 'string',\n          description: 'Get messages before this message ID (for pagination)',\n        },\n      },\n      required: ['conversationId'],\n    },\n    handler: `\n      const { conversationId, limit = 50, before } = input;\n\n      const conversation = await prisma.aIConversation.findFirst({\n        where: { id: conversationId, deletedAt: null },\n      });\n\n      if (!conversation) {\n        throw new Error('Conversation not found');\n      }\n\n      const messageWhere = { conversationId };\n      if (before) {\n        const beforeMsg = await prisma.aIMessage.findUnique({ where: { id: before } });\n        if (beforeMsg) {\n          messageWhere.createdAt = { lt: beforeMsg.createdAt };\n        }\n      }\n\n      const messages = await prisma.aIMessage.findMany({\n        where: messageWhere,\n        orderBy: { createdAt: 'asc' },\n        take: limit,\n      });\n\n      return {\n        id: conversation.id,\n        title: conversation.title,\n        systemPrompt: conversation.systemPrompt,\n        context: conversation.context,\n        messages: messages.map(m => ({\n          id: m.id,\n          role: m.role,\n          content: m.content,\n          toolCalls: m.toolCalls,\n          createdAt: m.createdAt,\n        })),\n        createdAt: conversation.createdAt,\n        updatedAt: conversation.updatedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // DELETE CONVERSATION\n  // ============================================================================\n  {\n    name: 'ai.deleteConversation',\n    description: 'Delete an AI chat conversation',\n    category: 'ai',\n    tags: ['ai', 'chat', 'delete', 'conversation'],\n    icon: 'Trash2',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        conversationId: {\n          type: 'string',\n          description: 'Conversation ID',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID (for authorization)',\n        },\n      },\n      required: ['conversationId'],\n    },\n    handler: `\n      const { conversationId, userId } = input;\n\n      const conversation = await prisma.aIConversation.findFirst({\n        where: { id: conversationId, deletedAt: null },\n      });\n\n      if (!conversation) {\n        throw new Error('Conversation not found');\n      }\n\n      // Check ownership if userId provided\n      if (userId && conversation.userId !== userId) {\n        throw new Error('Not authorized to delete this conversation');\n      }\n\n      await prisma.aIConversation.update({\n        where: { id: conversationId },\n        data: { deletedAt: new Date() },\n      });\n\n      return {\n        deleted: true,\n        conversationId,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // UPDATE CONVERSATION\n  // ============================================================================\n  {\n    name: 'ai.updateConversation',\n    description: 'Update conversation title or context',\n    category: 'ai',\n    tags: ['ai', 'chat', 'update', 'conversation'],\n    icon: 'Edit',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        conversationId: {\n          type: 'string',\n          description: 'Conversation ID',\n        },\n        title: {\n          type: 'string',\n          description: 'New conversation title',\n        },\n        context: {\n          type: 'object',\n          description: 'Updated context object',\n        },\n      },\n      required: ['conversationId'],\n    },\n    handler: `\n      const { conversationId, title, context } = input;\n\n      const conversation = await prisma.aIConversation.findFirst({\n        where: { id: conversationId, deletedAt: null },\n      });\n\n      if (!conversation) {\n        throw new Error('Conversation not found');\n      }\n\n      const updateData = {};\n      if (title !== undefined) updateData.title = title;\n      if (context !== undefined) updateData.context = context;\n\n      const updated = await prisma.aIConversation.update({\n        where: { id: conversationId },\n        data: updateData,\n      });\n\n      return {\n        id: updated.id,\n        title: updated.title,\n        context: updated.context,\n        updatedAt: updated.updatedAt,\n      };\n    `,\n  },\n];\n","/**\n * Analytics Primitives\n *\n * AI-callable primitives for event tracking and analytics.\n * Integrates with the existing analytics system in src/lib/analytics/.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const ANALYTICS_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // TRACK EVENT\n  // ============================================================================\n  {\n    name: 'analytics.trackEvent',\n    description: 'Track a custom analytics event',\n    category: 'analytics',\n    tags: ['analytics', 'tracking', 'events'],\n    icon: 'Activity',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        event: {\n          type: 'string',\n          description: 'Event name (e.g., button_click, form_submit)',\n          minLength: 1,\n          maxLength: 100,\n        },\n        category: {\n          type: 'string',\n          description: 'Event category (e.g., engagement, conversion)',\n        },\n        properties: {\n          type: 'object',\n          description: 'Additional event properties',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID (if authenticated)',\n        },\n        sessionId: {\n          type: 'string',\n          description: 'Session ID',\n        },\n      },\n      required: ['event'],\n    },\n    handler: `\n      const { event, category, properties = {}, userId, sessionId } = input;\n\n      const analyticsEvent = await prisma.analyticsEvent.create({\n        data: {\n          event,\n          category: category || 'custom',\n          properties,\n          userId: userId || null,\n          sessionId: sessionId || null,\n          timestamp: new Date(),\n          url: properties.url || null,\n          referrer: properties.referrer || null,\n          userAgent: properties.userAgent || null,\n        },\n      });\n\n      return {\n        tracked: true,\n        eventId: analyticsEvent.id,\n        event,\n        category: category || 'custom',\n        timestamp: analyticsEvent.timestamp,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // TRACK PAGE VIEW\n  // ============================================================================\n  {\n    name: 'analytics.trackPageView',\n    description: 'Track a page view event',\n    category: 'analytics',\n    tags: ['analytics', 'tracking', 'pageview'],\n    icon: 'Eye',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        url: {\n          type: 'string',\n          description: 'Page URL',\n        },\n        title: {\n          type: 'string',\n          description: 'Page title',\n        },\n        referrer: {\n          type: 'string',\n          description: 'Referrer URL',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID (if authenticated)',\n        },\n        sessionId: {\n          type: 'string',\n          description: 'Session ID',\n        },\n        userAgent: {\n          type: 'string',\n          description: 'User agent string',\n        },\n      },\n      required: ['url'],\n    },\n    handler: `\n      const { url, title, referrer, userId, sessionId, userAgent } = input;\n\n      const event = await prisma.analyticsEvent.create({\n        data: {\n          event: 'page_view',\n          category: 'navigation',\n          properties: { title },\n          url,\n          referrer: referrer || null,\n          userId: userId || null,\n          sessionId: sessionId || null,\n          userAgent: userAgent || null,\n          timestamp: new Date(),\n        },\n      });\n\n      return {\n        tracked: true,\n        eventId: event.id,\n        url,\n        title,\n        timestamp: event.timestamp,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // TRACK PURCHASE\n  // ============================================================================\n  {\n    name: 'analytics.trackPurchase',\n    description: 'Track an e-commerce purchase event',\n    category: 'analytics',\n    tags: ['analytics', 'tracking', 'ecommerce', 'purchase'],\n    icon: 'ShoppingCart',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID',\n        },\n        total: {\n          type: 'number',\n          description: 'Order total',\n        },\n        currency: {\n          type: 'string',\n          description: 'Currency code',\n          default: 'USD',\n        },\n        items: {\n          type: 'array',\n          description: 'Purchased items',\n          items: {\n            type: 'object',\n            properties: {\n              productId: { type: 'string' },\n              name: { type: 'string' },\n              price: { type: 'number' },\n              quantity: { type: 'number' },\n            },\n          },\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        sessionId: {\n          type: 'string',\n          description: 'Session ID',\n        },\n      },\n      required: ['orderId', 'total'],\n    },\n    handler: `\n      const { orderId, total, currency = 'USD', items = [], userId, sessionId } = input;\n\n      const event = await prisma.analyticsEvent.create({\n        data: {\n          event: 'purchase',\n          category: 'ecommerce',\n          properties: {\n            orderId,\n            total,\n            currency,\n            items,\n            itemCount: items.length,\n          },\n          userId: userId || null,\n          sessionId: sessionId || null,\n          timestamp: new Date(),\n        },\n      });\n\n      return {\n        tracked: true,\n        eventId: event.id,\n        orderId,\n        total,\n        currency,\n        itemCount: items.length,\n        timestamp: event.timestamp,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET EVENTS\n  // ============================================================================\n  {\n    name: 'analytics.getEvents',\n    description: 'Query analytics events with filtering',\n    category: 'analytics',\n    tags: ['analytics', 'reporting', 'events'],\n    icon: 'BarChart',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        event: {\n          type: 'string',\n          description: 'Filter by event name',\n        },\n        category: {\n          type: 'string',\n          description: 'Filter by category',\n        },\n        userId: {\n          type: 'string',\n          description: 'Filter by user ID',\n        },\n        startDate: {\n          type: 'string',\n          description: 'Start date (ISO 8601)',\n        },\n        endDate: {\n          type: 'string',\n          description: 'End date (ISO 8601)',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 50,\n          maximum: 200,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { event, category, userId, startDate, endDate, page = 1, limit = 50 } = input;\n\n      const where = {};\n      if (event) where.event = event;\n      if (category) where.category = category;\n      if (userId) where.userId = userId;\n      if (startDate || endDate) {\n        where.timestamp = {};\n        if (startDate) where.timestamp.gte = new Date(startDate);\n        if (endDate) where.timestamp.lte = new Date(endDate);\n      }\n\n      const [events, total] = await Promise.all([\n        prisma.analyticsEvent.findMany({\n          where,\n          orderBy: { timestamp: 'desc' },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.analyticsEvent.count({ where }),\n      ]);\n\n      return {\n        events: events.map(e => ({\n          id: e.id,\n          event: e.event,\n          category: e.category,\n          properties: e.properties,\n          url: e.url,\n          userId: e.userId,\n          sessionId: e.sessionId,\n          timestamp: e.timestamp,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET AGGREGATED STATS\n  // ============================================================================\n  {\n    name: 'analytics.getStats',\n    description: 'Get aggregated analytics statistics',\n    category: 'analytics',\n    tags: ['analytics', 'reporting', 'statistics'],\n    icon: 'TrendingUp',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        period: {\n          type: 'string',\n          description: 'Time period',\n          enum: ['today', 'yesterday', '7d', '30d', '90d', 'custom'],\n          default: '7d',\n        },\n        startDate: {\n          type: 'string',\n          description: 'Custom start date (ISO 8601)',\n        },\n        endDate: {\n          type: 'string',\n          description: 'Custom end date (ISO 8601)',\n        },\n        metrics: {\n          type: 'array',\n          description: 'Metrics to include',\n          items: {\n            type: 'string',\n            enum: ['pageViews', 'uniqueVisitors', 'purchases', 'revenue', 'topPages', 'topEvents'],\n          },\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { period = '7d', startDate, endDate, metrics = ['pageViews', 'uniqueVisitors', 'purchases', 'revenue'] } = input;\n\n      // Calculate date range\n      let start, end = new Date();\n      if (period === 'custom' && startDate) {\n        start = new Date(startDate);\n        if (endDate) end = new Date(endDate);\n      } else {\n        const days = { today: 0, yesterday: 1, '7d': 7, '30d': 30, '90d': 90 }[period] || 7;\n        start = new Date();\n        start.setDate(start.getDate() - days);\n        if (period === 'yesterday') {\n          end = new Date(start);\n          end.setDate(end.getDate() + 1);\n        }\n      }\n\n      const where = {\n        timestamp: { gte: start, lte: end },\n      };\n\n      const stats = {};\n\n      if (metrics.includes('pageViews')) {\n        stats.pageViews = await prisma.analyticsEvent.count({\n          where: { ...where, event: 'page_view' },\n        });\n      }\n\n      if (metrics.includes('uniqueVisitors')) {\n        const visitors = await prisma.analyticsEvent.findMany({\n          where: { ...where, event: 'page_view', sessionId: { not: null } },\n          select: { sessionId: true },\n          distinct: ['sessionId'],\n        });\n        stats.uniqueVisitors = visitors.length;\n      }\n\n      if (metrics.includes('purchases')) {\n        stats.purchases = await prisma.analyticsEvent.count({\n          where: { ...where, event: 'purchase' },\n        });\n      }\n\n      if (metrics.includes('revenue')) {\n        const purchases = await prisma.analyticsEvent.findMany({\n          where: { ...where, event: 'purchase' },\n          select: { properties: true },\n        });\n        stats.revenue = purchases.reduce((sum, p) => sum + (p.properties?.total || 0), 0);\n      }\n\n      if (metrics.includes('topPages')) {\n        const pages = await prisma.analyticsEvent.groupBy({\n          by: ['url'],\n          where: { ...where, event: 'page_view', url: { not: null } },\n          _count: { url: true },\n          orderBy: { _count: { url: 'desc' } },\n          take: 10,\n        });\n        stats.topPages = pages.map(p => ({ url: p.url, views: p._count.url }));\n      }\n\n      if (metrics.includes('topEvents')) {\n        const events = await prisma.analyticsEvent.groupBy({\n          by: ['event'],\n          where,\n          _count: { event: true },\n          orderBy: { _count: { event: 'desc' } },\n          take: 10,\n        });\n        stats.topEvents = events.map(e => ({ event: e.event, count: e._count.event }));\n      }\n\n      return {\n        period,\n        startDate: start.toISOString(),\n        endDate: end.toISOString(),\n        ...stats,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // TRACK ADD TO CART\n  // ============================================================================\n  {\n    name: 'analytics.trackAddToCart',\n    description: 'Track add to cart event for e-commerce analytics',\n    category: 'analytics',\n    tags: ['analytics', 'tracking', 'ecommerce', 'cart'],\n    icon: 'ShoppingBag',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        variantId: {\n          type: 'string',\n          description: 'Variant ID',\n        },\n        productName: {\n          type: 'string',\n          description: 'Product name',\n        },\n        price: {\n          type: 'number',\n          description: 'Product price',\n        },\n        quantity: {\n          type: 'number',\n          description: 'Quantity added',\n          default: 1,\n        },\n        currency: {\n          type: 'string',\n          description: 'Currency code',\n          default: 'USD',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        sessionId: {\n          type: 'string',\n          description: 'Session ID',\n        },\n      },\n      required: ['productId'],\n    },\n    handler: `\n      const { productId, variantId, productName, price, quantity = 1, currency = 'USD', userId, sessionId } = input;\n\n      const event = await prisma.analyticsEvent.create({\n        data: {\n          event: 'add_to_cart',\n          category: 'ecommerce',\n          properties: {\n            productId,\n            variantId,\n            productName,\n            price,\n            quantity,\n            currency,\n            value: (price || 0) * quantity,\n          },\n          userId: userId || null,\n          sessionId: sessionId || null,\n          timestamp: new Date(),\n        },\n      });\n\n      return {\n        tracked: true,\n        eventId: event.id,\n        productId,\n        quantity,\n        timestamp: event.timestamp,\n      };\n    `,\n  },\n];\n","/**\n * Blog/CMS Primitives\n *\n * AI-callable primitives for blog and content management.\n * These enable store owners to build custom blog displays via Puck.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const BLOG_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // GET POSTS\n  // ============================================================================\n  {\n    name: 'blog.getPosts',\n    description: 'Get blog posts with pagination, filtering, and sorting',\n    category: 'blog',\n    tags: ['blog', 'cms', 'content', 'posts'],\n    icon: 'FileText',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        page: {\n          type: 'number',\n          description: 'Page number (1-based)',\n          default: 1,\n          minimum: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 10,\n          minimum: 1,\n          maximum: 50,\n        },\n        categoryId: {\n          type: 'string',\n          description: 'Filter by category ID',\n        },\n        categorySlug: {\n          type: 'string',\n          description: 'Filter by category slug',\n        },\n        tagId: {\n          type: 'string',\n          description: 'Filter by tag ID',\n        },\n        tagSlug: {\n          type: 'string',\n          description: 'Filter by tag slug',\n        },\n        authorId: {\n          type: 'string',\n          description: 'Filter by author ID',\n        },\n        featured: {\n          type: 'boolean',\n          description: 'Filter to featured posts only',\n        },\n        status: {\n          type: 'string',\n          description: 'Filter by status (admin only)',\n          enum: ['DRAFT', 'PUBLISHED', 'SCHEDULED', 'ARCHIVED'],\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['publishedAt', 'createdAt', 'title', 'views'],\n          default: 'publishedAt',\n        },\n        sortOrder: {\n          type: 'string',\n          description: 'Sort direction',\n          enum: ['asc', 'desc'],\n          default: 'desc',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { page = 1, limit = 10, categoryId, categorySlug, tagId, tagSlug, authorId, featured, status, sortBy = 'publishedAt', sortOrder = 'desc' } = input;\n\n      const where = { deletedAt: null };\n\n      // Default to published only unless admin\n      where.status = status || 'PUBLISHED';\n      if (!status) {\n        where.publishedAt = { lte: new Date() };\n      }\n\n      if (categoryId) where.categoryId = categoryId;\n      if (categorySlug) {\n        const cat = await prisma.blogCategory.findFirst({ where: { slug: categorySlug } });\n        if (cat) where.categoryId = cat.id;\n      }\n      if (tagId || tagSlug) {\n        where.tags = {\n          some: tagId ? { id: tagId } : { slug: tagSlug },\n        };\n      }\n      if (authorId) where.authorId = authorId;\n      if (featured !== undefined) where.featured = featured;\n\n      const [posts, total] = await Promise.all([\n        prisma.blogPost.findMany({\n          where,\n          include: {\n            author: { select: { id: true, name: true, email: true } },\n            category: { select: { id: true, name: true, slug: true } },\n            tags: { select: { id: true, name: true, slug: true } },\n          },\n          orderBy: { [sortBy]: sortOrder },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.blogPost.count({ where }),\n      ]);\n\n      return {\n        posts: posts.map(p => ({\n          id: p.id,\n          title: p.title,\n          slug: p.slug,\n          excerpt: p.excerpt,\n          featuredImage: p.featuredImage,\n          author: p.author,\n          category: p.category,\n          tags: p.tags,\n          featured: p.featured,\n          publishedAt: p.publishedAt,\n          readingTime: p.readingTime,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n          hasNext: page * limit < total,\n          hasPrev: page > 1,\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET SINGLE POST\n  // ============================================================================\n  {\n    name: 'blog.getPost',\n    description: 'Get a single blog post by ID or slug with full content',\n    category: 'blog',\n    tags: ['blog', 'cms', 'content', 'post'],\n    icon: 'FileText',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        postId: {\n          type: 'string',\n          description: 'Post ID',\n        },\n        slug: {\n          type: 'string',\n          description: 'Post slug (alternative to ID)',\n        },\n        incrementViews: {\n          type: 'boolean',\n          description: 'Increment view count',\n          default: true,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { postId, slug, incrementViews = true } = input;\n\n      if (!postId && !slug) {\n        throw new Error('Either postId or slug is required');\n      }\n\n      const where = postId ? { id: postId } : { slug };\n      where.deletedAt = null;\n\n      const post = await prisma.blogPost.findFirst({\n        where,\n        include: {\n          author: { select: { id: true, name: true, email: true, avatar: true } },\n          category: true,\n          tags: true,\n        },\n      });\n\n      if (!post) {\n        throw new Error('Post not found');\n      }\n\n      // Only show published posts to public\n      if (post.status !== 'PUBLISHED' || post.publishedAt > new Date()) {\n        throw new Error('Post not found');\n      }\n\n      // Increment view count\n      if (incrementViews) {\n        await prisma.blogPost.update({\n          where: { id: post.id },\n          data: { views: { increment: 1 } },\n        });\n      }\n\n      // Get related posts\n      const related = await prisma.blogPost.findMany({\n        where: {\n          categoryId: post.categoryId,\n          id: { not: post.id },\n          status: 'PUBLISHED',\n          publishedAt: { lte: new Date() },\n          deletedAt: null,\n        },\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n          excerpt: true,\n          featuredImage: true,\n          publishedAt: true,\n        },\n        take: 3,\n        orderBy: { publishedAt: 'desc' },\n      });\n\n      return {\n        id: post.id,\n        title: post.title,\n        slug: post.slug,\n        content: post.content,\n        puckContent: post.puckContent,\n        excerpt: post.excerpt,\n        featuredImage: post.featuredImage,\n        author: post.author,\n        category: post.category,\n        tags: post.tags,\n        featured: post.featured,\n        views: post.views + (incrementViews ? 1 : 0),\n        publishedAt: post.publishedAt,\n        readingTime: post.readingTime,\n        seo: {\n          title: post.seoTitle || post.title,\n          description: post.seoDescription || post.excerpt,\n          keywords: post.seoKeywords,\n        },\n        related,\n        createdAt: post.createdAt,\n        updatedAt: post.updatedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET CATEGORIES\n  // ============================================================================\n  {\n    name: 'blog.getCategories',\n    description: 'Get all blog categories with post counts',\n    category: 'blog',\n    tags: ['blog', 'cms', 'categories'],\n    icon: 'FolderOpen',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        includePostCount: {\n          type: 'boolean',\n          description: 'Include post count per category',\n          default: true,\n        },\n        activeOnly: {\n          type: 'boolean',\n          description: 'Only return categories with published posts',\n          default: false,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { includePostCount = true, activeOnly = false } = input;\n\n      const categories = await prisma.blogCategory.findMany({\n        include: {\n          _count: includePostCount ? {\n            select: {\n              posts: {\n                where: { status: 'PUBLISHED', publishedAt: { lte: new Date() }, deletedAt: null },\n              },\n            },\n          } : false,\n        },\n        orderBy: { name: 'asc' },\n      });\n\n      let result = categories.map(c => ({\n        id: c.id,\n        name: c.name,\n        slug: c.slug,\n        description: c.description,\n        postCount: c._count?.posts || 0,\n      }));\n\n      if (activeOnly) {\n        result = result.filter(c => c.postCount > 0);\n      }\n\n      return {\n        categories: result,\n        total: result.length,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET TAGS\n  // ============================================================================\n  {\n    name: 'blog.getTags',\n    description: 'Get all blog tags with post counts',\n    category: 'blog',\n    tags: ['blog', 'cms', 'tags'],\n    icon: 'Tag',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        includePostCount: {\n          type: 'boolean',\n          description: 'Include post count per tag',\n          default: true,\n        },\n        limit: {\n          type: 'number',\n          description: 'Max tags to return (for tag clouds)',\n          minimum: 1,\n          maximum: 100,\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['name', 'postCount'],\n          default: 'name',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { includePostCount = true, limit, sortBy = 'name' } = input;\n\n      const tags = await prisma.blogTag.findMany({\n        include: {\n          _count: includePostCount ? {\n            select: {\n              posts: {\n                where: { status: 'PUBLISHED', publishedAt: { lte: new Date() }, deletedAt: null },\n              },\n            },\n          } : false,\n        },\n      });\n\n      let result = tags.map(t => ({\n        id: t.id,\n        name: t.name,\n        slug: t.slug,\n        postCount: t._count?.posts || 0,\n      }));\n\n      // Sort\n      if (sortBy === 'postCount') {\n        result.sort((a, b) => b.postCount - a.postCount);\n      } else {\n        result.sort((a, b) => a.name.localeCompare(b.name));\n      }\n\n      // Limit\n      if (limit) {\n        result = result.slice(0, limit);\n      }\n\n      return {\n        tags: result,\n        total: result.length,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // SEARCH POSTS\n  // ============================================================================\n  {\n    name: 'blog.search',\n    description: 'Search blog posts by keyword',\n    category: 'blog',\n    tags: ['blog', 'cms', 'search'],\n    icon: 'Search',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'Search query',\n          minLength: 2,\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 10,\n        },\n      },\n      required: ['query'],\n    },\n    handler: `\n      const { query, page = 1, limit = 10 } = input;\n\n      const where = {\n        status: 'PUBLISHED',\n        publishedAt: { lte: new Date() },\n        deletedAt: null,\n        OR: [\n          { title: { contains: query, mode: 'insensitive' } },\n          { content: { contains: query, mode: 'insensitive' } },\n          { excerpt: { contains: query, mode: 'insensitive' } },\n        ],\n      };\n\n      const [posts, total] = await Promise.all([\n        prisma.blogPost.findMany({\n          where,\n          include: {\n            author: { select: { id: true, name: true } },\n            category: { select: { id: true, name: true, slug: true } },\n          },\n          orderBy: { publishedAt: 'desc' },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.blogPost.count({ where }),\n      ]);\n\n      return {\n        query,\n        results: posts.map(p => ({\n          id: p.id,\n          title: p.title,\n          slug: p.slug,\n          excerpt: p.excerpt,\n          featuredImage: p.featuredImage,\n          author: p.author,\n          category: p.category,\n          publishedAt: p.publishedAt,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET PAGES\n  // ============================================================================\n  {\n    name: 'blog.getPages',\n    description: 'Get CMS pages (about, contact, etc.)',\n    category: 'blog',\n    tags: ['cms', 'pages', 'content'],\n    icon: 'Layout',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        status: {\n          type: 'string',\n          description: 'Filter by status',\n          enum: ['DRAFT', 'PUBLISHED'],\n        },\n        includeContent: {\n          type: 'boolean',\n          description: 'Include full page content',\n          default: false,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { status = 'PUBLISHED', includeContent = false } = input;\n\n      const pages = await prisma.page.findMany({\n        where: { status, deletedAt: null },\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n          description: true,\n          template: true,\n          content: includeContent,\n          puckContent: includeContent,\n          order: true,\n          showInNav: true,\n          createdAt: true,\n          updatedAt: true,\n        },\n        orderBy: { order: 'asc' },\n      });\n\n      return {\n        pages,\n        total: pages.length,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET SINGLE PAGE\n  // ============================================================================\n  {\n    name: 'blog.getPage',\n    description: 'Get a single CMS page by slug',\n    category: 'blog',\n    tags: ['cms', 'pages', 'content'],\n    icon: 'Layout',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        slug: {\n          type: 'string',\n          description: 'Page slug',\n        },\n        pageId: {\n          type: 'string',\n          description: 'Page ID (alternative to slug)',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { slug, pageId } = input;\n\n      if (!slug && !pageId) {\n        throw new Error('Either slug or pageId is required');\n      }\n\n      const where = pageId ? { id: pageId } : { slug };\n      where.status = 'PUBLISHED';\n      where.deletedAt = null;\n\n      const page = await prisma.page.findFirst({ where });\n\n      if (!page) {\n        throw new Error('Page not found');\n      }\n\n      return {\n        id: page.id,\n        title: page.title,\n        slug: page.slug,\n        description: page.description,\n        content: page.content,\n        puckContent: page.puckContent,\n        template: page.template,\n        seo: {\n          title: page.seoTitle || page.title,\n          description: page.seoDescription || page.description,\n        },\n        createdAt: page.createdAt,\n        updatedAt: page.updatedAt,\n      };\n    `,\n  },\n];\n","/**\n * Cart Primitives\n *\n * Primitives for shopping cart management including items,\n * coupons, and shipping rate calculations.\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const CART_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // CART RETRIEVAL\n  // ============================================================================\n  {\n    name: 'cart.get',\n    description: 'Get a cart by ID, session ID, or user ID. Returns cart with items and totals.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'get'],\n    icon: 'ShoppingCart',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID to retrieve',\n        },\n        sessionId: {\n          type: 'string',\n          description: 'Session ID (for guest carts)',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID (for logged-in users)',\n        },\n        includeItems: {\n          type: 'boolean',\n          description: 'Include cart items in response (default: true)',\n          default: true,\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      let cart = null;\n      const include = args.includeItems !== false ? {\n        items: {\n          include: {\n            product: { select: { id: true, slug: true, status: true } },\n            variant: { select: { id: true, sku: true, inventory: true } },\n          },\n          orderBy: { createdAt: 'asc' },\n        },\n      } : undefined;\n\n      if (args.cartId) {\n        cart = await prisma.cart.findUnique({\n          where: { id: args.cartId },\n          include,\n        });\n      } else if (args.sessionId) {\n        cart = await prisma.cart.findFirst({\n          where: { sessionId: args.sessionId, status: 'ACTIVE' },\n          include,\n        });\n      } else if (args.userId) {\n        cart = await prisma.cart.findFirst({\n          where: { userId: args.userId, status: 'ACTIVE' },\n          include,\n        });\n      } else {\n        throw new Error('Must provide cartId, sessionId, or userId');\n      }\n\n      return cart;\n    `,\n  },\n\n  // ============================================================================\n  // CART CREATION\n  // ============================================================================\n  {\n    name: 'cart.create',\n    description: 'Create a new shopping cart for a session or user.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'create'],\n    icon: 'ShoppingCart',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        sessionId: {\n          type: 'string',\n          description: 'Session ID for guest cart',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID for logged-in user cart',\n        },\n        email: {\n          type: 'string',\n          description: 'Email for cart recovery',\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (!args.sessionId && !args.userId) {\n        throw new Error('Must provide sessionId or userId');\n      }\n\n      // Check for existing active cart\n      const existing = await prisma.cart.findFirst({\n        where: {\n          OR: [\n            args.sessionId ? { sessionId: args.sessionId, status: 'ACTIVE' } : {},\n            args.userId ? { userId: args.userId, status: 'ACTIVE' } : {},\n          ].filter(c => Object.keys(c).length > 0),\n        },\n      });\n\n      if (existing) {\n        return existing;\n      }\n\n      // Create new cart\n      const cart = await prisma.cart.create({\n        data: {\n          sessionId: args.sessionId,\n          userId: args.userId,\n          email: args.email,\n          status: 'ACTIVE',\n          subtotal: 0,\n          discountTotal: 0,\n          taxTotal: 0,\n          shippingTotal: 0,\n          total: 0,\n        },\n      });\n\n      return cart;\n    `,\n  },\n\n  // ============================================================================\n  // CART ITEM MANAGEMENT\n  // ============================================================================\n  {\n    name: 'cart.addItem',\n    description: 'Add a product to the cart. Creates cart item or increments quantity if exists.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'add', 'item'],\n    icon: 'Plus',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID',\n        },\n        productId: {\n          type: 'string',\n          description: 'Product ID to add',\n        },\n        variantId: {\n          type: 'string',\n          description: 'Product variant ID (optional)',\n        },\n        quantity: {\n          type: 'number',\n          description: 'Quantity to add (default: 1)',\n          default: 1,\n        },\n      },\n      required: ['cartId', 'productId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const quantity = args.quantity || 1;\n\n      // Get product and variant info\n      const product = await prisma.product.findUnique({\n        where: { id: args.productId },\n        include: {\n          images: { take: 1, orderBy: { position: 'asc' } },\n          variants: args.variantId ? { where: { id: args.variantId } } : undefined,\n        },\n      });\n\n      if (!product) {\n        throw new Error('Product not found');\n      }\n\n      if (product.status !== 'ACTIVE') {\n        throw new Error('Product is not available');\n      }\n\n      const variant = args.variantId ? product.variants?.[0] : null;\n      const price = variant?.price ?? product.price;\n      const imageUrl = product.images[0]?.url || null;\n\n      // Check for existing item\n      const existingItem = await prisma.cartItem.findFirst({\n        where: {\n          cartId: args.cartId,\n          productId: args.productId,\n          variantId: args.variantId || null,\n        },\n      });\n\n      let item;\n      if (existingItem) {\n        // Update quantity\n        item = await prisma.cartItem.update({\n          where: { id: existingItem.id },\n          data: { quantity: existingItem.quantity + quantity },\n        });\n      } else {\n        // Create new item\n        item = await prisma.cartItem.create({\n          data: {\n            cartId: args.cartId,\n            productId: args.productId,\n            variantId: args.variantId || null,\n            quantity,\n            title: product.title,\n            variantTitle: variant?.title || null,\n            price,\n            imageUrl,\n          },\n        });\n      }\n\n      // Recalculate cart totals\n      const items = await prisma.cartItem.findMany({\n        where: { cartId: args.cartId },\n      });\n\n      const subtotal = items.reduce((sum, i) => sum + (i.price * i.quantity), 0);\n\n      await prisma.cart.update({\n        where: { id: args.cartId },\n        data: {\n          subtotal,\n          total: subtotal, // Will be adjusted when discount/shipping applied\n        },\n      });\n\n      return item;\n    `,\n  },\n  {\n    name: 'cart.updateItem',\n    description: 'Update quantity of a cart item.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'update', 'item'],\n    icon: 'Edit',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID',\n        },\n        itemId: {\n          type: 'string',\n          description: 'Cart item ID',\n        },\n        quantity: {\n          type: 'number',\n          description: 'New quantity (0 removes item)',\n        },\n      },\n      required: ['cartId', 'itemId', 'quantity'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (args.quantity <= 0) {\n        // Remove item\n        await prisma.cartItem.delete({\n          where: { id: args.itemId },\n        });\n      } else {\n        // Update quantity\n        await prisma.cartItem.update({\n          where: { id: args.itemId },\n          data: { quantity: args.quantity },\n        });\n      }\n\n      // Recalculate cart totals\n      const items = await prisma.cartItem.findMany({\n        where: { cartId: args.cartId },\n      });\n\n      const subtotal = items.reduce((sum, i) => sum + (i.price * i.quantity), 0);\n\n      const cart = await prisma.cart.update({\n        where: { id: args.cartId },\n        data: {\n          subtotal,\n          total: subtotal - (await prisma.cart.findUnique({ where: { id: args.cartId } }))?.discountTotal || 0,\n        },\n        include: { items: true },\n      });\n\n      return cart;\n    `,\n  },\n  {\n    name: 'cart.removeItem',\n    description: 'Remove an item from the cart.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'remove', 'item'],\n    icon: 'Trash',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID',\n        },\n        itemId: {\n          type: 'string',\n          description: 'Cart item ID to remove',\n        },\n      },\n      required: ['cartId', 'itemId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      await prisma.cartItem.delete({\n        where: { id: args.itemId },\n      });\n\n      // Recalculate cart totals\n      const items = await prisma.cartItem.findMany({\n        where: { cartId: args.cartId },\n      });\n\n      const subtotal = items.reduce((sum, i) => sum + (i.price * i.quantity), 0);\n      const cart = await prisma.cart.findUnique({ where: { id: args.cartId } });\n\n      const updated = await prisma.cart.update({\n        where: { id: args.cartId },\n        data: {\n          subtotal,\n          total: subtotal - (cart?.discountTotal || 0) + (cart?.shippingTotal || 0) + (cart?.taxTotal || 0),\n        },\n        include: { items: true },\n      });\n\n      return updated;\n    `,\n  },\n  {\n    name: 'cart.clear',\n    description: 'Remove all items from a cart.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'clear'],\n    icon: 'Trash2',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID to clear',\n        },\n      },\n      required: ['cartId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      // Delete all items\n      await prisma.cartItem.deleteMany({\n        where: { cartId: args.cartId },\n      });\n\n      // Reset cart totals\n      const cart = await prisma.cart.update({\n        where: { id: args.cartId },\n        data: {\n          subtotal: 0,\n          discountTotal: 0,\n          taxTotal: 0,\n          shippingTotal: 0,\n          total: 0,\n          discountCodeId: null,\n        },\n        include: { items: true },\n      });\n\n      return cart;\n    `,\n  },\n\n  // ============================================================================\n  // COUPON/DISCOUNT MANAGEMENT\n  // ============================================================================\n  {\n    name: 'cart.applyCoupon',\n    description: 'Apply a discount code to the cart.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'coupon', 'discount'],\n    icon: 'Tag',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID',\n        },\n        code: {\n          type: 'string',\n          description: 'Discount code to apply',\n        },\n        email: {\n          type: 'string',\n          description: 'Customer email (for usage validation)',\n        },\n      },\n      required: ['cartId', 'code'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      // Find the discount code\n      const discount = await prisma.discountCode.findUnique({\n        where: { code: args.code.toUpperCase() },\n      });\n\n      if (!discount) {\n        throw new Error('Invalid discount code');\n      }\n\n      // Check if active\n      if (!discount.isActive) {\n        throw new Error('Discount code is not active');\n      }\n\n      // Check dates\n      const now = new Date();\n      if (discount.startDate && discount.startDate > now) {\n        throw new Error('Discount code is not yet valid');\n      }\n      if (discount.endDate && discount.endDate < now) {\n        throw new Error('Discount code has expired');\n      }\n\n      // Check usage limit\n      if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {\n        throw new Error('Discount code usage limit reached');\n      }\n\n      // Check per-customer limit\n      if (discount.perCustomerLimit && args.email) {\n        const customerUsage = await prisma.discountUsage.count({\n          where: {\n            discountCodeId: discount.id,\n            email: args.email,\n          },\n        });\n        if (customerUsage >= discount.perCustomerLimit) {\n          throw new Error('You have already used this discount code');\n        }\n      }\n\n      // Get cart\n      const cart = await prisma.cart.findUnique({\n        where: { id: args.cartId },\n        include: { items: true },\n      });\n\n      if (!cart) {\n        throw new Error('Cart not found');\n      }\n\n      // Check minimum order value\n      if (discount.minOrderValue && cart.subtotal < discount.minOrderValue) {\n        throw new Error('Order does not meet minimum value for this discount');\n      }\n\n      // Calculate discount amount\n      let discountAmount = 0;\n\n      if (discount.type === 'PERCENTAGE') {\n        discountAmount = Math.floor(cart.subtotal * (discount.value / 100));\n        if (discount.maxDiscount) {\n          discountAmount = Math.min(discountAmount, discount.maxDiscount);\n        }\n      } else if (discount.type === 'FIXED') {\n        discountAmount = discount.value;\n      } else if (discount.type === 'FREE_SHIPPING') {\n        discountAmount = cart.shippingTotal;\n      }\n\n      // Don't discount more than the subtotal\n      discountAmount = Math.min(discountAmount, cart.subtotal);\n\n      // Update cart\n      const updated = await prisma.cart.update({\n        where: { id: args.cartId },\n        data: {\n          discountCodeId: discount.id,\n          discountTotal: discountAmount,\n          total: cart.subtotal - discountAmount + cart.shippingTotal + cart.taxTotal,\n        },\n        include: { items: true },\n      });\n\n      return {\n        cart: updated,\n        discount: {\n          code: discount.code,\n          type: discount.type,\n          value: discount.value,\n          discountAmount,\n        },\n      };\n    `,\n  },\n  {\n    name: 'cart.removeCoupon',\n    description: 'Remove applied discount code from the cart.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'coupon', 'remove'],\n    icon: 'X',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID',\n        },\n      },\n      required: ['cartId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const cart = await prisma.cart.findUnique({\n        where: { id: args.cartId },\n      });\n\n      if (!cart) {\n        throw new Error('Cart not found');\n      }\n\n      const updated = await prisma.cart.update({\n        where: { id: args.cartId },\n        data: {\n          discountCodeId: null,\n          discountTotal: 0,\n          total: cart.subtotal + cart.shippingTotal + cart.taxTotal,\n        },\n        include: { items: true },\n      });\n\n      return updated;\n    `,\n  },\n\n  // ============================================================================\n  // SHIPPING\n  // ============================================================================\n  {\n    name: 'cart.getShippingRates',\n    description: 'Get available shipping rates for the cart based on address.',\n    category: 'cart',\n    tags: ['cart', 'ecommerce', 'shipping', 'rates'],\n    icon: 'Truck',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        cartId: {\n          type: 'string',\n          description: 'Cart ID',\n        },\n        address: {\n          type: 'object',\n          description: 'Shipping address',\n          properties: {\n            street1: { type: 'string' },\n            street2: { type: 'string' },\n            city: { type: 'string' },\n            state: { type: 'string' },\n            postalCode: { type: 'string' },\n            country: { type: 'string' },\n          },\n          required: ['city', 'state', 'postalCode', 'country'],\n        },\n      },\n      required: ['cartId', 'address'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const cart = await prisma.cart.findUnique({\n        where: { id: args.cartId },\n        include: { items: { include: { product: true, variant: true } } },\n      });\n\n      if (!cart || cart.items.length === 0) {\n        throw new Error('Cart is empty');\n      }\n\n      // Calculate total weight\n      let totalWeightGrams = 0;\n      for (const item of cart.items) {\n        const weight = item.variant?.weight ?? item.product?.weight ?? 100; // Default 100g\n        totalWeightGrams += weight * item.quantity;\n      }\n\n      // Try to get rates from Shippo if configured\n      try {\n        const { getShippingRates } = await import('../../shippo');\n        const rates = await getShippingRates({\n          addressTo: {\n            street1: args.address.street1,\n            street2: args.address.street2,\n            city: args.address.city,\n            state: args.address.state,\n            zip: args.address.postalCode,\n            country: args.address.country,\n          },\n          parcels: [{\n            length: 10,\n            width: 10,\n            height: 10,\n            weight: totalWeightGrams / 1000, // Convert to kg\n            massUnit: 'kg',\n            distanceUnit: 'cm',\n          }],\n        });\n\n        return {\n          rates: rates.map(r => ({\n            id: r.objectId,\n            carrier: r.provider,\n            service: r.servicelevel?.name || 'Standard',\n            price: Math.round(parseFloat(r.amount) * 100), // Convert to cents\n            currency: r.currency,\n            estimatedDays: r.estimatedDays,\n          })),\n        };\n      } catch (e) {\n        // Fallback to flat rate shipping\n        return {\n          rates: [\n            {\n              id: 'flat_standard',\n              carrier: 'Flat Rate',\n              service: 'Standard Shipping',\n              price: 999, // $9.99\n              currency: 'USD',\n              estimatedDays: 5,\n            },\n            {\n              id: 'flat_express',\n              carrier: 'Flat Rate',\n              service: 'Express Shipping',\n              price: 1999, // $19.99\n              currency: 'USD',\n              estimatedDays: 2,\n            },\n          ],\n        };\n      }\n    `,\n  },\n];\n","/**\n * Customer Primitives\n *\n * Primitives for customer portal functionality including profile management,\n * order history, addresses, subscriptions, and digital downloads.\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const CUSTOMER_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // PROFILE PRIMITIVES\n  // ============================================================================\n  {\n    name: 'customer.getProfile',\n    description: 'Get the current authenticated customer\\'s profile information including name, email, and account details.',\n    category: 'customer',\n    tags: ['customer', 'profile', 'account'],\n    icon: 'User',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The user ID to fetch profile for',\n        },\n        include: {\n          type: 'array',\n          description: 'Related data to include: addresses, orders, subscriptions',\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const includeOptions = {};\n      if (args.include?.includes('addresses')) includeOptions.addresses = true;\n      if (args.include?.includes('orders')) includeOptions.orders = { take: 5, orderBy: { createdAt: 'desc' } };\n      if (args.include?.includes('subscriptions')) includeOptions.subscriptions = true;\n\n      const user = await prisma.user.findUnique({\n        where: { id: args.userId },\n        include: includeOptions,\n      });\n\n      if (!user) {\n        throw new Error('Customer not found');\n      }\n\n      return {\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        avatar: user.avatar,\n        createdAt: user.createdAt,\n        ...user,\n      };\n    `,\n  },\n  {\n    name: 'customer.updateProfile',\n    description: 'Update the customer\\'s profile information such as name, email, or avatar.',\n    category: 'customer',\n    tags: ['customer', 'profile', 'update'],\n    icon: 'UserCog',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The user ID to update',\n        },\n        name: {\n          type: 'string',\n          description: 'New display name',\n        },\n        avatar: {\n          type: 'string',\n          description: 'New avatar URL',\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const updateData = {};\n      if (args.name !== undefined) updateData.name = args.name;\n      if (args.avatar !== undefined) updateData.avatar = args.avatar;\n\n      const user = await prisma.user.update({\n        where: { id: args.userId },\n        data: updateData,\n      });\n\n      return {\n        success: true,\n        user: {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          avatar: user.avatar,\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // ORDER PRIMITIVES\n  // ============================================================================\n  {\n    name: 'customer.getOrders',\n    description: 'Get a paginated list of orders for the customer with filtering options.',\n    category: 'customer',\n    tags: ['customer', 'orders', 'history'],\n    icon: 'ShoppingBag',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        status: {\n          type: 'string',\n          description: 'Filter by order status',\n          enum: ['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED', 'REFUNDED'],\n        },\n        page: {\n          type: 'number',\n          description: 'Page number (1-indexed)',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 10,\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const page = args.page || 1;\n      const limit = Math.min(args.limit || 10, 50);\n      const skip = (page - 1) * limit;\n\n      const where = { customerId: args.userId };\n      if (args.status) where.status = args.status;\n\n      const [orders, total] = await Promise.all([\n        prisma.order.findMany({\n          where,\n          include: {\n            items: {\n              include: {\n                product: { select: { title: true, slug: true } },\n              },\n            },\n            shipments: { select: { trackingNumber: true, carrier: true, status: true } },\n          },\n          orderBy: { createdAt: 'desc' },\n          skip,\n          take: limit,\n        }),\n        prisma.order.count({ where }),\n      ]);\n\n      return {\n        orders: orders.map(o => ({\n          id: o.id,\n          orderNumber: o.orderNumber,\n          status: o.status,\n          paymentStatus: o.paymentStatus,\n          total: o.total,\n          itemCount: o.items.length,\n          items: o.items,\n          shipments: o.shipments,\n          createdAt: o.createdAt,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n  {\n    name: 'customer.getOrder',\n    description: 'Get detailed information about a specific order including items, shipping, and payment details.',\n    category: 'customer',\n    tags: ['customer', 'order', 'detail'],\n    icon: 'Receipt',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID (for authorization)',\n        },\n        orderId: {\n          type: 'string',\n          description: 'The order ID or order number',\n        },\n      },\n      required: ['userId', 'orderId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const order = await prisma.order.findFirst({\n        where: {\n          OR: [\n            { id: args.orderId },\n            { orderNumber: args.orderId },\n          ],\n          customerId: args.userId,\n        },\n        include: {\n          items: {\n            include: {\n              product: { select: { id: true, title: true, slug: true } },\n              variant: { select: { id: true, sku: true } },\n            },\n          },\n          shipments: true,\n          payments: true,\n          shippingAddress: true,\n          billingAddress: true,\n          progress: {\n            include: { stage: true },\n            orderBy: { createdAt: 'desc' },\n          },\n        },\n      });\n\n      if (!order) {\n        throw new Error('Order not found');\n      }\n\n      return order;\n    `,\n  },\n\n  // ============================================================================\n  // ADDRESS PRIMITIVES\n  // ============================================================================\n  {\n    name: 'customer.getAddresses',\n    description: 'Get all saved addresses for the customer.',\n    category: 'customer',\n    tags: ['customer', 'addresses', 'shipping'],\n    icon: 'MapPin',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        type: {\n          type: 'string',\n          description: 'Filter by address type',\n          enum: ['SHIPPING', 'BILLING'],\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const where = { userId: args.userId };\n      if (args.type) where.type = args.type;\n\n      const addresses = await prisma.address.findMany({\n        where,\n        orderBy: [\n          { isDefault: 'desc' },\n          { createdAt: 'desc' },\n        ],\n      });\n\n      return { addresses };\n    `,\n  },\n  {\n    name: 'customer.saveAddress',\n    description: 'Create or update a customer address.',\n    category: 'customer',\n    tags: ['customer', 'address', 'save'],\n    icon: 'MapPinPlus',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        addressId: {\n          type: 'string',\n          description: 'Address ID to update (omit to create new)',\n        },\n        type: {\n          type: 'string',\n          description: 'Address type',\n          enum: ['SHIPPING', 'BILLING'],\n        },\n        firstName: {\n          type: 'string',\n          description: 'First name',\n        },\n        lastName: {\n          type: 'string',\n          description: 'Last name',\n        },\n        company: {\n          type: 'string',\n          description: 'Company name',\n        },\n        street1: {\n          type: 'string',\n          description: 'Street address line 1',\n        },\n        street2: {\n          type: 'string',\n          description: 'Street address line 2',\n        },\n        city: {\n          type: 'string',\n          description: 'City',\n        },\n        state: {\n          type: 'string',\n          description: 'State/Province',\n        },\n        zip: {\n          type: 'string',\n          description: 'ZIP/Postal code',\n        },\n        country: {\n          type: 'string',\n          description: 'Country code',\n          default: 'US',\n        },\n        phone: {\n          type: 'string',\n          description: 'Phone number',\n        },\n        isDefault: {\n          type: 'boolean',\n          description: 'Set as default address',\n        },\n      },\n      required: ['userId', 'firstName', 'lastName', 'street1', 'city', 'state', 'zip'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const addressData = {\n        type: args.type || 'SHIPPING',\n        firstName: args.firstName,\n        lastName: args.lastName,\n        company: args.company,\n        street1: args.street1,\n        street2: args.street2,\n        city: args.city,\n        state: args.state,\n        zip: args.zip,\n        country: args.country || 'US',\n        phone: args.phone,\n        isDefault: args.isDefault || false,\n      };\n\n      // If setting as default, unset other defaults first\n      if (args.isDefault) {\n        await prisma.address.updateMany({\n          where: { userId: args.userId, type: addressData.type },\n          data: { isDefault: false },\n        });\n      }\n\n      let address;\n      if (args.addressId) {\n        // Update existing\n        address = await prisma.address.update({\n          where: { id: args.addressId, userId: args.userId },\n          data: addressData,\n        });\n      } else {\n        // Create new\n        address = await prisma.address.create({\n          data: {\n            ...addressData,\n            userId: args.userId,\n          },\n        });\n      }\n\n      return { success: true, address };\n    `,\n  },\n  {\n    name: 'customer.deleteAddress',\n    description: 'Delete a saved address.',\n    category: 'customer',\n    tags: ['customer', 'address', 'delete'],\n    icon: 'MapPinOff',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        addressId: {\n          type: 'string',\n          description: 'The address ID to delete',\n        },\n      },\n      required: ['userId', 'addressId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      await prisma.address.delete({\n        where: {\n          id: args.addressId,\n          userId: args.userId,\n        },\n      });\n\n      return { success: true };\n    `,\n  },\n\n  // ============================================================================\n  // SUBSCRIPTION PRIMITIVES\n  // ============================================================================\n  {\n    name: 'customer.getSubscriptions',\n    description: 'Get all active and past subscriptions for the customer.',\n    category: 'customer',\n    tags: ['customer', 'subscriptions', 'recurring'],\n    icon: 'RefreshCw',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        status: {\n          type: 'string',\n          description: 'Filter by status',\n          enum: ['ACTIVE', 'PAUSED', 'CANCELLED', 'EXPIRED'],\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const where = { userId: args.userId };\n      if (args.status) where.status = args.status;\n\n      const subscriptions = await prisma.subscription.findMany({\n        where,\n        include: {\n          product: {\n            select: { id: true, title: true, slug: true },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n      });\n\n      return { subscriptions };\n    `,\n  },\n  {\n    name: 'customer.cancelSubscription',\n    description: 'Cancel an active subscription.',\n    category: 'customer',\n    tags: ['customer', 'subscription', 'cancel'],\n    icon: 'XCircle',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        subscriptionId: {\n          type: 'string',\n          description: 'The subscription ID to cancel',\n        },\n        reason: {\n          type: 'string',\n          description: 'Cancellation reason',\n        },\n        cancelImmediately: {\n          type: 'boolean',\n          description: 'Cancel immediately vs at period end',\n          default: false,\n        },\n      },\n      required: ['userId', 'subscriptionId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      // Verify ownership\n      const subscription = await prisma.subscription.findFirst({\n        where: {\n          id: args.subscriptionId,\n          userId: args.userId,\n          status: 'ACTIVE',\n        },\n      });\n\n      if (!subscription) {\n        throw new Error('Active subscription not found');\n      }\n\n      // Cancel in Stripe if applicable\n      if (subscription.stripeSubscriptionId) {\n        const { stripe } = await import('../../stripe');\n        await stripe.subscriptions.update(subscription.stripeSubscriptionId, {\n          cancel_at_period_end: !args.cancelImmediately,\n        });\n\n        if (args.cancelImmediately) {\n          await stripe.subscriptions.cancel(subscription.stripeSubscriptionId);\n        }\n      }\n\n      // Update local record\n      const updated = await prisma.subscription.update({\n        where: { id: args.subscriptionId },\n        data: {\n          status: args.cancelImmediately ? 'CANCELLED' : 'ACTIVE',\n          cancelledAt: args.cancelImmediately ? new Date() : null,\n          cancelReason: args.reason,\n        },\n      });\n\n      return {\n        success: true,\n        subscription: updated,\n        cancelledImmediately: args.cancelImmediately,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // DIGITAL DOWNLOADS PRIMITIVES\n  // ============================================================================\n  {\n    name: 'customer.getDownloads',\n    description: 'Get all digital products/downloads available to the customer.',\n    category: 'customer',\n    tags: ['customer', 'downloads', 'digital'],\n    icon: 'Download',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      // Get all orders with digital products\n      const downloads = await prisma.digitalDownload.findMany({\n        where: { userId: args.userId },\n        include: {\n          asset: true,\n          order: {\n            select: { id: true, orderNumber: true, createdAt: true },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n      });\n\n      return {\n        downloads: downloads.map(d => ({\n          id: d.id,\n          fileName: d.asset.fileName,\n          fileSize: d.asset.fileSize,\n          downloadCount: d.downloadCount,\n          maxDownloads: d.maxDownloads,\n          expiresAt: d.expiresAt,\n          canDownload: d.downloadCount < (d.maxDownloads || Infinity) &&\n                       (!d.expiresAt || new Date(d.expiresAt) > new Date()),\n          order: d.order,\n          createdAt: d.createdAt,\n        })),\n      };\n    `,\n  },\n  {\n    name: 'customer.downloadAsset',\n    description: 'Generate a secure download link for a digital asset.',\n    category: 'customer',\n    tags: ['customer', 'download', 'asset'],\n    icon: 'FileDown',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'The customer user ID',\n        },\n        downloadId: {\n          type: 'string',\n          description: 'The digital download ID',\n        },\n      },\n      required: ['userId', 'downloadId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const download = await prisma.digitalDownload.findFirst({\n        where: {\n          id: args.downloadId,\n          userId: args.userId,\n        },\n        include: { asset: true },\n      });\n\n      if (!download) {\n        throw new Error('Download not found');\n      }\n\n      // Check limits\n      if (download.maxDownloads && download.downloadCount >= download.maxDownloads) {\n        throw new Error('Download limit reached');\n      }\n\n      if (download.expiresAt && new Date(download.expiresAt) < new Date()) {\n        throw new Error('Download has expired');\n      }\n\n      // Increment download count\n      await prisma.digitalDownload.update({\n        where: { id: args.downloadId },\n        data: { downloadCount: { increment: 1 } },\n      });\n\n      // Generate signed URL (implementation depends on storage provider)\n      // This is a placeholder - actual implementation would use S3/R2/etc.\n      const downloadUrl = download.asset.url;\n\n      return {\n        success: true,\n        downloadUrl,\n        fileName: download.asset.fileName,\n        remainingDownloads: download.maxDownloads\n          ? download.maxDownloads - download.downloadCount - 1\n          : null,\n      };\n    `,\n  },\n];\n","/**\n * Discount Primitives\n *\n * Primitives for discount and coupon management: validation, application, and tracking.\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const DISCOUNT_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // DISCOUNT PRIMITIVES\n  // ============================================================================\n  {\n    name: 'discount.validate',\n    description: 'Validate a discount code and check eligibility for an order.',\n    category: 'discount',\n    tags: ['discount', 'coupon', 'validate', 'e-commerce'],\n    icon: 'Percent',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Discount code to validate',\n        },\n        orderTotal: {\n          type: 'number',\n          description: 'Order subtotal in cents (for minimum order validation)',\n        },\n        productIds: {\n          type: 'array',\n          description: 'Product IDs in the order (for product-specific discounts)',\n          items: { type: 'string' },\n        },\n        categoryIds: {\n          type: 'array',\n          description: 'Category IDs of products (for category-specific discounts)',\n          items: { type: 'string' },\n        },\n        customerId: {\n          type: 'string',\n          description: 'Customer ID (for per-customer limits and first-order discounts)',\n        },\n        email: {\n          type: 'string',\n          description: 'Customer email (for tracking usage)',\n        },\n      },\n      required: ['code'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const discount = await prisma.discountCode.findUnique({\n        where: { code: args.code.toUpperCase() },\n        include: {\n          _count: {\n            select: { usages: true },\n          },\n        },\n      });\n\n      if (!discount) {\n        return { valid: false, error: 'Invalid discount code' };\n      }\n\n      // Check if enabled\n      if (!discount.enabled) {\n        return { valid: false, error: 'This discount code is no longer active' };\n      }\n\n      // Check date validity\n      const now = new Date();\n      if (discount.startsAt > now) {\n        return { valid: false, error: 'This discount code is not yet active' };\n      }\n      if (discount.expiresAt && discount.expiresAt < now) {\n        return { valid: false, error: 'This discount code has expired' };\n      }\n\n      // Check usage limits\n      if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {\n        return { valid: false, error: 'This discount code has reached its usage limit' };\n      }\n\n      // Check per-customer limit\n      if (discount.perCustomer && (args.customerId || args.email)) {\n        const customerUsages = await prisma.discountUsage.count({\n          where: {\n            discountCodeId: discount.id,\n            OR: [\n              args.customerId ? { userId: args.customerId } : {},\n              args.email ? { email: args.email } : {},\n            ].filter(o => Object.keys(o).length > 0),\n          },\n        });\n\n        if (customerUsages >= discount.perCustomer) {\n          return { valid: false, error: 'You have already used this discount code the maximum number of times' };\n        }\n      }\n\n      // Check first order only\n      if (discount.firstOrderOnly && (args.customerId || args.email)) {\n        const previousOrders = await prisma.order.count({\n          where: {\n            OR: [\n              args.customerId ? { customerId: args.customerId } : {},\n              args.email ? { email: args.email } : {},\n            ].filter(o => Object.keys(o).length > 0),\n            status: { notIn: ['CANCELLED'] },\n          },\n        });\n\n        if (previousOrders > 0) {\n          return { valid: false, error: 'This discount code is only valid for first orders' };\n        }\n      }\n\n      // Check minimum order value\n      if (discount.minOrderValue && args.orderTotal && args.orderTotal < discount.minOrderValue) {\n        return {\n          valid: false,\n          error: 'Minimum order of $' + (discount.minOrderValue / 100).toFixed(2) + ' required',\n        };\n      }\n\n      // Check product/category applicability\n      if (discount.applyTo === 'PRODUCT' && discount.productIds.length > 0) {\n        const hasApplicableProduct = args.productIds?.some(id => discount.productIds.includes(id));\n        if (!hasApplicableProduct) {\n          return { valid: false, error: 'This discount does not apply to items in your cart' };\n        }\n      }\n\n      if (discount.applyTo === 'CATEGORY' && discount.categoryIds.length > 0) {\n        const hasApplicableCategory = args.categoryIds?.some(id => discount.categoryIds.includes(id));\n        if (!hasApplicableCategory) {\n          return { valid: false, error: 'This discount does not apply to items in your cart' };\n        }\n      }\n\n      // Calculate discount amount if order total provided\n      let discountAmount = 0;\n      if (args.orderTotal) {\n        if (discount.type === 'PERCENTAGE') {\n          discountAmount = Math.floor(args.orderTotal * discount.value / 100);\n          if (discount.maxDiscount) {\n            discountAmount = Math.min(discountAmount, discount.maxDiscount);\n          }\n        } else {\n          discountAmount = Math.min(discount.value, args.orderTotal);\n        }\n      }\n\n      return {\n        valid: true,\n        discount: {\n          id: discount.id,\n          code: discount.code,\n          type: discount.type,\n          value: discount.value,\n          description: discount.description,\n          minOrderValue: discount.minOrderValue,\n          maxDiscount: discount.maxDiscount,\n          expiresAt: discount.expiresAt?.toISOString(),\n        },\n        discountAmount,\n        savings: discountAmount > 0 ? '$' + (discountAmount / 100).toFixed(2) : null,\n      };\n    `,\n  },\n  {\n    name: 'discount.apply',\n    description: 'Apply a validated discount code to an order or cart.',\n    category: 'discount',\n    tags: ['discount', 'coupon', 'apply', 'e-commerce'],\n    icon: 'Tag',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Discount code to apply',\n        },\n        orderId: {\n          type: 'string',\n          description: 'Order ID to apply discount to',\n        },\n        cartId: {\n          type: 'string',\n          description: 'Cart ID to apply discount to (alternative to orderId)',\n        },\n      },\n      required: ['code'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (!args.orderId && !args.cartId) {\n        throw new Error('Either orderId or cartId is required');\n      }\n\n      const discount = await prisma.discountCode.findUnique({\n        where: { code: args.code.toUpperCase(), enabled: true },\n      });\n\n      if (!discount) {\n        throw new Error('Invalid discount code');\n      }\n\n      if (args.orderId) {\n        const order = await prisma.order.findUnique({\n          where: { id: args.orderId },\n        });\n\n        if (!order) {\n          throw new Error('Order not found');\n        }\n\n        // Calculate discount\n        let discountAmount = 0;\n        if (discount.type === 'PERCENTAGE') {\n          discountAmount = Math.floor(order.subtotal * discount.value / 100);\n          if (discount.maxDiscount) {\n            discountAmount = Math.min(discountAmount, discount.maxDiscount);\n          }\n        } else {\n          discountAmount = Math.min(discount.value, order.subtotal);\n        }\n\n        // Update order\n        const updated = await prisma.order.update({\n          where: { id: args.orderId },\n          data: {\n            discountCodeId: discount.id,\n            discountTotal: discountAmount,\n            total: order.subtotal + order.shippingTotal + order.taxTotal - discountAmount,\n          },\n        });\n\n        return {\n          success: true,\n          applied: 'order',\n          orderId: updated.id,\n          discountAmount,\n          newTotal: updated.total,\n        };\n      }\n\n      if (args.cartId) {\n        const cart = await prisma.cart.findUnique({\n          where: { id: args.cartId },\n        });\n\n        if (!cart) {\n          throw new Error('Cart not found');\n        }\n\n        // Calculate discount\n        let discountAmount = 0;\n        if (discount.type === 'PERCENTAGE') {\n          discountAmount = Math.floor(cart.subtotal * discount.value / 100);\n          if (discount.maxDiscount) {\n            discountAmount = Math.min(discountAmount, discount.maxDiscount);\n          }\n        } else {\n          discountAmount = Math.min(discount.value, cart.subtotal);\n        }\n\n        // Update cart\n        const updated = await prisma.cart.update({\n          where: { id: args.cartId },\n          data: {\n            discountCodeId: discount.id,\n            discountTotal: discountAmount,\n            total: cart.subtotal + cart.shippingTotal + cart.taxTotal - discountAmount,\n          },\n        });\n\n        return {\n          success: true,\n          applied: 'cart',\n          cartId: updated.id,\n          discountAmount,\n          newTotal: updated.total,\n        };\n      }\n    `,\n  },\n  {\n    name: 'discount.remove',\n    description: 'Remove a discount code from an order or cart.',\n    category: 'discount',\n    tags: ['discount', 'coupon', 'remove', 'e-commerce'],\n    icon: 'X',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID to remove discount from',\n        },\n        cartId: {\n          type: 'string',\n          description: 'Cart ID to remove discount from',\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (!args.orderId && !args.cartId) {\n        throw new Error('Either orderId or cartId is required');\n      }\n\n      if (args.orderId) {\n        const order = await prisma.order.findUnique({\n          where: { id: args.orderId },\n        });\n\n        if (!order) {\n          throw new Error('Order not found');\n        }\n\n        const updated = await prisma.order.update({\n          where: { id: args.orderId },\n          data: {\n            discountCodeId: null,\n            discountTotal: 0,\n            total: order.subtotal + order.shippingTotal + order.taxTotal,\n          },\n        });\n\n        return {\n          success: true,\n          removed: 'order',\n          orderId: updated.id,\n          newTotal: updated.total,\n        };\n      }\n\n      if (args.cartId) {\n        const cart = await prisma.cart.findUnique({\n          where: { id: args.cartId },\n        });\n\n        if (!cart) {\n          throw new Error('Cart not found');\n        }\n\n        const updated = await prisma.cart.update({\n          where: { id: args.cartId },\n          data: {\n            discountCodeId: null,\n            discountTotal: 0,\n            total: cart.subtotal + cart.shippingTotal + cart.taxTotal,\n          },\n        });\n\n        return {\n          success: true,\n          removed: 'cart',\n          cartId: updated.id,\n          newTotal: updated.total,\n        };\n      }\n    `,\n  },\n  {\n    name: 'discount.list',\n    description: 'List discount codes with filtering and pagination.',\n    category: 'discount',\n    tags: ['discount', 'coupon', 'list', 'e-commerce'],\n    icon: 'List',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        enabled: {\n          type: 'boolean',\n          description: 'Filter by enabled status',\n        },\n        type: {\n          type: 'string',\n          description: 'Filter by discount type',\n          enum: ['PERCENTAGE', 'FIXED'],\n        },\n        active: {\n          type: 'boolean',\n          description: 'Filter active discounts (enabled, within date range, not exhausted)',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number (default: 1)',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page (default: 20)',\n          default: 20,\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const page = Math.max(1, args.page || 1);\n      const limit = Math.min(100, Math.max(1, args.limit || 20));\n      const skip = (page - 1) * limit;\n\n      const where = {};\n      const now = new Date();\n\n      if (typeof args.enabled === 'boolean') {\n        where.enabled = args.enabled;\n      }\n\n      if (args.type) {\n        where.type = args.type;\n      }\n\n      if (args.active) {\n        where.enabled = true;\n        where.startsAt = { lte: now };\n        where.OR = [\n          { expiresAt: null },\n          { expiresAt: { gt: now } },\n        ];\n      }\n\n      const [discounts, total] = await Promise.all([\n        prisma.discountCode.findMany({\n          where,\n          skip,\n          take: limit,\n          orderBy: { createdAt: 'desc' },\n          include: {\n            _count: { select: { usages: true } },\n          },\n        }),\n        prisma.discountCode.count({ where }),\n      ]);\n\n      return {\n        success: true,\n        discounts: discounts.map(d => ({\n          id: d.id,\n          code: d.code,\n          description: d.description,\n          type: d.type,\n          value: d.value,\n          minOrderValue: d.minOrderValue,\n          maxDiscount: d.maxDiscount,\n          enabled: d.enabled,\n          usageCount: d.usageCount,\n          usageLimit: d.usageLimit,\n          startsAt: d.startsAt.toISOString(),\n          expiresAt: d.expiresAt?.toISOString(),\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n  {\n    name: 'discount.get',\n    description: 'Get details of a specific discount code by ID or code.',\n    category: 'discount',\n    tags: ['discount', 'coupon', 'get', 'e-commerce'],\n    icon: 'Info',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        id: {\n          type: 'string',\n          description: 'Discount ID',\n        },\n        code: {\n          type: 'string',\n          description: 'Discount code (alternative to id)',\n        },\n        includeUsages: {\n          type: 'boolean',\n          description: 'Include usage history',\n          default: false,\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (!args.id && !args.code) {\n        throw new Error('Either id or code is required');\n      }\n\n      const where = args.id\n        ? { id: args.id }\n        : { code: args.code.toUpperCase() };\n\n      const discount = await prisma.discountCode.findUnique({\n        where,\n        include: {\n          usages: args.includeUsages ? {\n            take: 50,\n            orderBy: { createdAt: 'desc' },\n          } : false,\n          _count: { select: { usages: true } },\n        },\n      });\n\n      if (!discount) {\n        return { success: false, error: 'Discount not found' };\n      }\n\n      const now = new Date();\n      const isActive = discount.enabled &&\n        discount.startsAt <= now &&\n        (!discount.expiresAt || discount.expiresAt > now) &&\n        (!discount.usageLimit || discount.usageCount < discount.usageLimit);\n\n      return {\n        success: true,\n        discount: {\n          id: discount.id,\n          code: discount.code,\n          description: discount.description,\n          type: discount.type,\n          value: discount.value,\n          applyTo: discount.applyTo,\n          productIds: discount.productIds,\n          categoryIds: discount.categoryIds,\n          excludeProductIds: discount.excludeProductIds,\n          excludeSaleItems: discount.excludeSaleItems,\n          minOrderValue: discount.minOrderValue,\n          maxDiscount: discount.maxDiscount,\n          usageLimit: discount.usageLimit,\n          usageCount: discount.usageCount,\n          perCustomer: discount.perCustomer,\n          firstOrderOnly: discount.firstOrderOnly,\n          enabled: discount.enabled,\n          startsAt: discount.startsAt.toISOString(),\n          expiresAt: discount.expiresAt?.toISOString(),\n          isActive,\n          usages: args.includeUsages ? discount.usages.map(u => ({\n            orderId: u.orderId,\n            email: u.email,\n            discountAmount: u.discountAmount,\n            createdAt: u.createdAt.toISOString(),\n          })) : undefined,\n        },\n      };\n    `,\n  },\n  {\n    name: 'discount.create',\n    description: 'Create a new discount code.',\n    category: 'discount',\n    tags: ['discount', 'coupon', 'create', 'e-commerce'],\n    icon: 'Plus',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Unique discount code',\n        },\n        description: {\n          type: 'string',\n          description: 'Description of the discount',\n        },\n        type: {\n          type: 'string',\n          description: 'Discount type',\n          enum: ['PERCENTAGE', 'FIXED'],\n        },\n        value: {\n          type: 'number',\n          description: 'Discount value (percentage or cents)',\n        },\n        minOrderValue: {\n          type: 'number',\n          description: 'Minimum order value in cents',\n        },\n        maxDiscount: {\n          type: 'number',\n          description: 'Maximum discount amount in cents (for percentage)',\n        },\n        usageLimit: {\n          type: 'number',\n          description: 'Total usage limit',\n        },\n        perCustomer: {\n          type: 'number',\n          description: 'Uses per customer',\n        },\n        firstOrderOnly: {\n          type: 'boolean',\n          description: 'Only valid for first orders',\n        },\n        startsAt: {\n          type: 'string',\n          description: 'Start date (ISO string)',\n        },\n        expiresAt: {\n          type: 'string',\n          description: 'Expiry date (ISO string)',\n        },\n        enabled: {\n          type: 'boolean',\n          description: 'Enable immediately',\n          default: true,\n        },\n      },\n      required: ['code', 'type', 'value'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      // Check for existing code\n      const existing = await prisma.discountCode.findUnique({\n        where: { code: args.code.toUpperCase() },\n      });\n\n      if (existing) {\n        throw new Error('Discount code already exists');\n      }\n\n      const discount = await prisma.discountCode.create({\n        data: {\n          code: args.code.toUpperCase(),\n          description: args.description,\n          type: args.type,\n          value: args.value,\n          minOrderValue: args.minOrderValue,\n          maxDiscount: args.maxDiscount,\n          usageLimit: args.usageLimit,\n          perCustomer: args.perCustomer,\n          firstOrderOnly: args.firstOrderOnly || false,\n          startsAt: args.startsAt ? new Date(args.startsAt) : new Date(),\n          expiresAt: args.expiresAt ? new Date(args.expiresAt) : null,\n          enabled: args.enabled !== false,\n        },\n      });\n\n      return {\n        success: true,\n        discount: {\n          id: discount.id,\n          code: discount.code,\n          type: discount.type,\n          value: discount.value,\n          enabled: discount.enabled,\n        },\n      };\n    `,\n  },\n];\n","/**\n * Email Primitives\n *\n * Primitives for email sending, subscriptions, and preference management.\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const EMAIL_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // EMAIL SENDING\n  // ============================================================================\n  {\n    name: 'email.send',\n    description: 'Send an email to one or more recipients.',\n    category: 'email',\n    tags: ['email', 'send', 'notification'],\n    icon: 'Mail',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        to: {\n          type: 'array',\n          description: 'Recipient email addresses',\n          items: {\n            type: 'object',\n            properties: {\n              email: { type: 'string' },\n              name: { type: 'string' },\n            },\n            required: ['email'],\n          },\n        },\n        subject: {\n          type: 'string',\n          description: 'Email subject line',\n        },\n        html: {\n          type: 'string',\n          description: 'HTML email body',\n        },\n        text: {\n          type: 'string',\n          description: 'Plain text email body',\n        },\n        from: {\n          type: 'object',\n          description: 'Sender (optional, uses default if not provided)',\n          properties: {\n            email: { type: 'string' },\n            name: { type: 'string' },\n          },\n        },\n        replyTo: {\n          type: 'object',\n          description: 'Reply-to address',\n          properties: {\n            email: { type: 'string' },\n            name: { type: 'string' },\n          },\n        },\n      },\n      required: ['to', 'subject'],\n    },\n    handler: `\n      const { sendEmail } = await import('../../email');\n\n      const toArray = Array.isArray(args.to) ? args.to : [args.to];\n\n      const results = [];\n      for (const recipient of toArray) {\n        const result = await sendEmail({\n          to: recipient,\n          subject: args.subject,\n          html: args.html,\n          text: args.text,\n          from: args.from,\n          replyTo: args.replyTo,\n        });\n        results.push({\n          email: recipient.email,\n          success: result.success,\n          messageId: result.messageId,\n          error: result.error,\n        });\n      }\n\n      return {\n        success: results.every(r => r.success),\n        results,\n      };\n    `,\n  },\n  {\n    name: 'email.sendTemplate',\n    description: 'Send an email using a saved template with merge tags.',\n    category: 'email',\n    tags: ['email', 'template', 'merge-tags'],\n    icon: 'FileText',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        templateId: {\n          type: 'string',\n          description: 'Email template ID',\n        },\n        to: {\n          type: 'object',\n          description: 'Recipient',\n          properties: {\n            email: { type: 'string' },\n            name: { type: 'string' },\n          },\n          required: ['email'],\n        },\n        data: {\n          type: 'object',\n          description: 'Merge tag data (e.g., { firstName: \"John\", orderNumber: \"12345\" })',\n        },\n        from: {\n          type: 'object',\n          description: 'Sender (optional)',\n          properties: {\n            email: { type: 'string' },\n            name: { type: 'string' },\n          },\n        },\n      },\n      required: ['templateId', 'to'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n      const { sendEmailWithMergeTags } = await import('../../email');\n\n      // Get template\n      const template = await prisma.emailTemplate.findUnique({\n        where: { id: args.templateId },\n      });\n\n      if (!template) {\n        throw new Error('Email template not found');\n      }\n\n      if (!template.isActive) {\n        throw new Error('Email template is not active');\n      }\n\n      const result = await sendEmailWithMergeTags(\n        {\n          to: args.to,\n          subjectTemplate: template.subject,\n          htmlTemplate: template.htmlContent || undefined,\n          textTemplate: template.textContent || undefined,\n          from: args.from,\n        },\n        args.data || {}\n      );\n\n      return {\n        success: result.success,\n        messageId: result.messageId,\n        template: template.name,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // SUBSCRIPTIONS\n  // ============================================================================\n  {\n    name: 'email.subscribe',\n    description: 'Subscribe an email address to the mailing list.',\n    category: 'email',\n    tags: ['email', 'subscribe', 'newsletter'],\n    icon: 'UserPlus',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        email: {\n          type: 'string',\n          description: 'Email address to subscribe',\n        },\n        firstName: {\n          type: 'string',\n          description: 'Subscriber first name',\n        },\n        lastName: {\n          type: 'string',\n          description: 'Subscriber last name',\n        },\n        lists: {\n          type: 'array',\n          description: 'List IDs to subscribe to (default: newsletter)',\n          items: { type: 'string' },\n        },\n        source: {\n          type: 'string',\n          description: 'Subscription source (e.g., \"checkout\", \"popup\", \"footer\")',\n        },\n        requireDoubleOptIn: {\n          type: 'boolean',\n          description: 'Require double opt-in confirmation (default: true)',\n          default: true,\n        },\n      },\n      required: ['email'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n      const { createSubscription, sendConfirmationEmail } = await import('../../email/subscriptions');\n\n      const lists = args.lists || ['newsletter'];\n      const requireDoubleOptIn = args.requireDoubleOptIn !== false;\n\n      // Check for existing subscriber\n      let subscriber = await prisma.emailSubscriber.findUnique({\n        where: { email: args.email.toLowerCase() },\n      });\n\n      if (subscriber) {\n        if (subscriber.status === 'UNSUBSCRIBED') {\n          // Resubscribe\n          subscriber = await prisma.emailSubscriber.update({\n            where: { id: subscriber.id },\n            data: {\n              status: requireDoubleOptIn ? 'PENDING' : 'SUBSCRIBED',\n              firstName: args.firstName || subscriber.firstName,\n              lastName: args.lastName || subscriber.lastName,\n              unsubscribedAt: null,\n            },\n          });\n        } else if (subscriber.status === 'SUBSCRIBED') {\n          return { success: true, message: 'Already subscribed', subscriber };\n        }\n      } else {\n        // Create new subscriber\n        subscriber = await prisma.emailSubscriber.create({\n          data: {\n            email: args.email.toLowerCase(),\n            firstName: args.firstName,\n            lastName: args.lastName,\n            status: requireDoubleOptIn ? 'PENDING' : 'SUBSCRIBED',\n            source: args.source || 'api',\n            lists,\n          },\n        });\n      }\n\n      // Send confirmation email if double opt-in\n      if (requireDoubleOptIn) {\n        await sendConfirmationEmail(subscriber.id);\n        return {\n          success: true,\n          message: 'Confirmation email sent',\n          requiresConfirmation: true,\n          subscriber\n        };\n      }\n\n      return { success: true, message: 'Subscribed successfully', subscriber };\n    `,\n  },\n  {\n    name: 'email.unsubscribe',\n    description: 'Unsubscribe an email address from the mailing list.',\n    category: 'email',\n    tags: ['email', 'unsubscribe'],\n    icon: 'UserMinus',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        email: {\n          type: 'string',\n          description: 'Email address to unsubscribe',\n        },\n        reason: {\n          type: 'string',\n          description: 'Unsubscribe reason',\n        },\n        lists: {\n          type: 'array',\n          description: 'Specific list IDs to unsubscribe from (empty = all)',\n          items: { type: 'string' },\n        },\n      },\n      required: ['email'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const subscriber = await prisma.emailSubscriber.findUnique({\n        where: { email: args.email.toLowerCase() },\n      });\n\n      if (!subscriber) {\n        return { success: true, message: 'Email not found in list' };\n      }\n\n      if (args.lists && args.lists.length > 0) {\n        // Unsubscribe from specific lists\n        const remainingLists = (subscriber.lists || []).filter(\n          l => !args.lists.includes(l)\n        );\n\n        if (remainingLists.length === 0) {\n          // No lists left, fully unsubscribe\n          await prisma.emailSubscriber.update({\n            where: { id: subscriber.id },\n            data: {\n              status: 'UNSUBSCRIBED',\n              unsubscribedAt: new Date(),\n              unsubscribeReason: args.reason,\n              lists: [],\n            },\n          });\n        } else {\n          await prisma.emailSubscriber.update({\n            where: { id: subscriber.id },\n            data: { lists: remainingLists },\n          });\n        }\n      } else {\n        // Unsubscribe from all\n        await prisma.emailSubscriber.update({\n          where: { id: subscriber.id },\n          data: {\n            status: 'UNSUBSCRIBED',\n            unsubscribedAt: new Date(),\n            unsubscribeReason: args.reason,\n            lists: [],\n          },\n        });\n      }\n\n      return { success: true, message: 'Unsubscribed successfully' };\n    `,\n  },\n  {\n    name: 'email.updatePreferences',\n    description: 'Update email subscription preferences for a subscriber.',\n    category: 'email',\n    tags: ['email', 'preferences', 'settings'],\n    icon: 'Settings',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        email: {\n          type: 'string',\n          description: 'Subscriber email address',\n        },\n        lists: {\n          type: 'array',\n          description: 'List IDs to subscribe to',\n          items: { type: 'string' },\n        },\n        frequency: {\n          type: 'string',\n          description: 'Email frequency preference',\n          enum: ['instant', 'daily', 'weekly', 'monthly'],\n        },\n        firstName: {\n          type: 'string',\n          description: 'Update first name',\n        },\n        lastName: {\n          type: 'string',\n          description: 'Update last name',\n        },\n      },\n      required: ['email'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const subscriber = await prisma.emailSubscriber.findUnique({\n        where: { email: args.email.toLowerCase() },\n      });\n\n      if (!subscriber) {\n        throw new Error('Subscriber not found');\n      }\n\n      const updateData = {};\n\n      if (args.lists !== undefined) {\n        updateData.lists = args.lists;\n      }\n      if (args.frequency !== undefined) {\n        updateData.preferences = {\n          ...(subscriber.preferences || {}),\n          frequency: args.frequency,\n        };\n      }\n      if (args.firstName !== undefined) {\n        updateData.firstName = args.firstName;\n      }\n      if (args.lastName !== undefined) {\n        updateData.lastName = args.lastName;\n      }\n\n      const updated = await prisma.emailSubscriber.update({\n        where: { id: subscriber.id },\n        data: updateData,\n      });\n\n      return { success: true, subscriber: updated };\n    `,\n  },\n  {\n    name: 'email.getSubscriptionStatus',\n    description: 'Get the subscription status for an email address.',\n    category: 'email',\n    tags: ['email', 'status', 'subscription'],\n    icon: 'Info',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        email: {\n          type: 'string',\n          description: 'Email address to check',\n        },\n      },\n      required: ['email'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const subscriber = await prisma.emailSubscriber.findUnique({\n        where: { email: args.email.toLowerCase() },\n        select: {\n          id: true,\n          email: true,\n          firstName: true,\n          lastName: true,\n          status: true,\n          lists: true,\n          preferences: true,\n          subscribedAt: true,\n          unsubscribedAt: true,\n          source: true,\n        },\n      });\n\n      if (!subscriber) {\n        return {\n          subscribed: false,\n          status: 'NOT_FOUND',\n        };\n      }\n\n      return {\n        subscribed: subscriber.status === 'SUBSCRIBED',\n        status: subscriber.status,\n        subscriber,\n      };\n    `,\n  },\n];\n","/**\n * Gift Card Primitives\n *\n * AI-callable primitives for gift card functionality.\n * Enables purchasing, sending, and redeeming gift cards.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const GIFTCARD_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // CHECK BALANCE\n  // ============================================================================\n  {\n    name: 'giftcard.check',\n    description: 'Check gift card balance and validity',\n    category: 'giftcard',\n    tags: ['giftcard', 'balance', 'check', 'storefront'],\n    icon: 'CreditCard',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Gift card code',\n        },\n      },\n      required: ['code'],\n    },\n    handler: `\n      const { code } = input;\n\n      const giftCard = await prisma.giftCard.findFirst({\n        where: { code: code.toUpperCase() },\n      });\n\n      if (!giftCard) {\n        return {\n          valid: false,\n          error: 'Gift card not found',\n        };\n      }\n\n      if (giftCard.status !== 'ACTIVE') {\n        return {\n          valid: false,\n          error: 'Gift card is ' + giftCard.status.toLowerCase(),\n          status: giftCard.status,\n        };\n      }\n\n      if (giftCard.expiresAt && giftCard.expiresAt < new Date()) {\n        return {\n          valid: false,\n          error: 'Gift card has expired',\n          expiresAt: giftCard.expiresAt,\n        };\n      }\n\n      if (giftCard.balance <= 0) {\n        return {\n          valid: false,\n          error: 'Gift card has no remaining balance',\n          balance: 0,\n        };\n      }\n\n      return {\n        valid: true,\n        balance: giftCard.balance,\n        originalAmount: giftCard.originalAmount,\n        currency: giftCard.currency,\n        expiresAt: giftCard.expiresAt,\n        status: giftCard.status,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // REDEEM GIFT CARD\n  // ============================================================================\n  {\n    name: 'giftcard.redeem',\n    description: 'Redeem gift card balance towards an order',\n    category: 'giftcard',\n    tags: ['giftcard', 'redeem', 'payment', 'checkout'],\n    icon: 'Gift',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Gift card code',\n        },\n        amount: {\n          type: 'number',\n          description: 'Amount to redeem',\n          minimum: 0.01,\n        },\n        orderId: {\n          type: 'string',\n          description: 'Order ID to apply to',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID redeeming',\n        },\n      },\n      required: ['code', 'amount', 'orderId'],\n    },\n    handler: `\n      const { code, amount, orderId, userId } = input;\n\n      const giftCard = await prisma.giftCard.findFirst({\n        where: { code: code.toUpperCase() },\n      });\n\n      if (!giftCard) {\n        throw new Error('Gift card not found');\n      }\n\n      if (giftCard.status !== 'ACTIVE') {\n        throw new Error('Gift card is not active');\n      }\n\n      if (giftCard.expiresAt && giftCard.expiresAt < new Date()) {\n        throw new Error('Gift card has expired');\n      }\n\n      if (giftCard.balance < amount) {\n        throw new Error('Insufficient gift card balance. Available: ' + giftCard.balance);\n      }\n\n      // Create transaction and update balance\n      const [transaction, updatedCard] = await prisma.$transaction([\n        prisma.giftCardTransaction.create({\n          data: {\n            giftCardId: giftCard.id,\n            type: 'REDEMPTION',\n            amount: -amount,\n            balance: giftCard.balance - amount,\n            orderId,\n            userId: userId || null,\n            description: 'Redeemed for order ' + orderId,\n          },\n        }),\n        prisma.giftCard.update({\n          where: { id: giftCard.id },\n          data: {\n            balance: { decrement: amount },\n            usedAt: giftCard.usedAt || new Date(),\n            status: giftCard.balance - amount <= 0 ? 'REDEEMED' : 'ACTIVE',\n          },\n        }),\n      ]);\n\n      return {\n        redeemed: true,\n        amountRedeemed: amount,\n        remainingBalance: updatedCard.balance,\n        transactionId: transaction.id,\n        orderId,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET BALANCE\n  // ============================================================================\n  {\n    name: 'giftcard.getBalance',\n    description: 'Get detailed gift card information with transaction history',\n    category: 'giftcard',\n    tags: ['giftcard', 'balance', 'history'],\n    icon: 'Wallet',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Gift card code',\n        },\n        includeHistory: {\n          type: 'boolean',\n          description: 'Include transaction history',\n          default: false,\n        },\n      },\n      required: ['code'],\n    },\n    handler: `\n      const { code, includeHistory = false } = input;\n\n      const giftCard = await prisma.giftCard.findFirst({\n        where: { code: code.toUpperCase() },\n        include: {\n          transactions: includeHistory ? {\n            orderBy: { createdAt: 'desc' },\n            take: 20,\n          } : false,\n        },\n      });\n\n      if (!giftCard) {\n        throw new Error('Gift card not found');\n      }\n\n      return {\n        code: giftCard.code,\n        balance: giftCard.balance,\n        originalAmount: giftCard.originalAmount,\n        currency: giftCard.currency,\n        status: giftCard.status,\n        expiresAt: giftCard.expiresAt,\n        activatedAt: giftCard.activatedAt,\n        usedAt: giftCard.usedAt,\n        transactions: giftCard.transactions?.map(t => ({\n          id: t.id,\n          type: t.type,\n          amount: t.amount,\n          balance: t.balance,\n          description: t.description,\n          orderId: t.orderId,\n          createdAt: t.createdAt,\n        })) || [],\n      };\n    `,\n  },\n\n  // ============================================================================\n  // PURCHASE GIFT CARD\n  // ============================================================================\n  {\n    name: 'giftcard.purchase',\n    description: 'Purchase a new gift card',\n    category: 'giftcard',\n    tags: ['giftcard', 'purchase', 'buy'],\n    icon: 'ShoppingBag',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        amount: {\n          type: 'number',\n          description: 'Gift card amount',\n          minimum: 5,\n          maximum: 1000,\n        },\n        currency: {\n          type: 'string',\n          description: 'Currency code',\n          default: 'USD',\n        },\n        purchaserId: {\n          type: 'string',\n          description: 'Purchaser user ID',\n        },\n        delivery: {\n          type: 'string',\n          description: 'Delivery method',\n          enum: ['EMAIL', 'PRINT', 'PHYSICAL'],\n          default: 'EMAIL',\n        },\n        recipientEmail: {\n          type: 'string',\n          description: 'Recipient email (for EMAIL delivery)',\n        },\n        recipientName: {\n          type: 'string',\n          description: 'Recipient name',\n        },\n        senderName: {\n          type: 'string',\n          description: 'Sender name',\n        },\n        message: {\n          type: 'string',\n          description: 'Gift message',\n          maxLength: 500,\n        },\n        scheduledFor: {\n          type: 'string',\n          description: 'Schedule delivery date (ISO 8601)',\n        },\n      },\n      required: ['amount', 'purchaserId'],\n    },\n    handler: `\n      const { amount, currency = 'USD', purchaserId, delivery = 'EMAIL', recipientEmail, recipientName, senderName, message, scheduledFor } = input;\n\n      // Generate unique code\n      const generateCode = () => {\n        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n        let code = '';\n        for (let i = 0; i < 16; i++) {\n          if (i > 0 && i % 4 === 0) code += '-';\n          code += chars.charAt(Math.floor(Math.random() * chars.length));\n        }\n        return code;\n      };\n\n      let code;\n      let attempts = 0;\n      do {\n        code = generateCode();\n        const existing = await prisma.giftCard.findFirst({ where: { code } });\n        if (!existing) break;\n        attempts++;\n      } while (attempts < 10);\n\n      if (attempts >= 10) {\n        throw new Error('Failed to generate unique code');\n      }\n\n      // Set expiration (1 year from now by default)\n      const expiresAt = new Date();\n      expiresAt.setFullYear(expiresAt.getFullYear() + 1);\n\n      const giftCard = await prisma.giftCard.create({\n        data: {\n          code,\n          originalAmount: amount,\n          balance: amount,\n          currency,\n          status: 'ACTIVE',\n          purchaserId,\n          recipientEmail: recipientEmail || null,\n          recipientName: recipientName || null,\n          senderName: senderName || null,\n          message: message || null,\n          delivery,\n          scheduledFor: scheduledFor ? new Date(scheduledFor) : null,\n          expiresAt,\n          activatedAt: new Date(),\n        },\n      });\n\n      // Create initial transaction\n      await prisma.giftCardTransaction.create({\n        data: {\n          giftCardId: giftCard.id,\n          type: 'PURCHASE',\n          amount: amount,\n          balance: amount,\n          userId: purchaserId,\n          description: 'Gift card purchased',\n        },\n      });\n\n      return {\n        id: giftCard.id,\n        code: giftCard.code,\n        amount: giftCard.originalAmount,\n        currency: giftCard.currency,\n        delivery: giftCard.delivery,\n        recipientEmail: giftCard.recipientEmail,\n        expiresAt: giftCard.expiresAt,\n        message: 'Gift card created successfully',\n      };\n    `,\n  },\n\n  // ============================================================================\n  // SEND GIFT CARD\n  // ============================================================================\n  {\n    name: 'giftcard.send',\n    description: 'Send/resend gift card to recipient',\n    category: 'giftcard',\n    tags: ['giftcard', 'send', 'email'],\n    icon: 'Send',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        giftCardId: {\n          type: 'string',\n          description: 'Gift card ID',\n        },\n        code: {\n          type: 'string',\n          description: 'Gift card code (alternative to ID)',\n        },\n        recipientEmail: {\n          type: 'string',\n          description: 'Email to send to (override)',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { giftCardId, code, recipientEmail } = input;\n\n      if (!giftCardId && !code) {\n        throw new Error('Either giftCardId or code is required');\n      }\n\n      const giftCard = await prisma.giftCard.findFirst({\n        where: giftCardId ? { id: giftCardId } : { code: code.toUpperCase() },\n      });\n\n      if (!giftCard) {\n        throw new Error('Gift card not found');\n      }\n\n      const email = recipientEmail || giftCard.recipientEmail;\n      if (!email) {\n        throw new Error('No recipient email available');\n      }\n\n      // Note: Actual email sending would be done via email service\n      // This just records the send attempt\n      await prisma.giftCard.update({\n        where: { id: giftCard.id },\n        data: {\n          recipientEmail: email,\n          sentAt: new Date(),\n        },\n      });\n\n      return {\n        sent: true,\n        giftCardId: giftCard.id,\n        recipientEmail: email,\n        code: giftCard.code.substring(0, 4) + '-****-****-' + giftCard.code.slice(-4),\n        note: 'Email will be sent via configured email service',\n      };\n    `,\n  },\n\n  // ============================================================================\n  // REFUND TO GIFT CARD\n  // ============================================================================\n  {\n    name: 'giftcard.refund',\n    description: 'Add balance back to a gift card (for refunds)',\n    category: 'giftcard',\n    tags: ['giftcard', 'refund', 'balance'],\n    icon: 'RefreshCw',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        code: {\n          type: 'string',\n          description: 'Gift card code',\n        },\n        amount: {\n          type: 'number',\n          description: 'Amount to refund',\n          minimum: 0.01,\n        },\n        orderId: {\n          type: 'string',\n          description: 'Related order ID',\n        },\n        reason: {\n          type: 'string',\n          description: 'Refund reason',\n        },\n      },\n      required: ['code', 'amount'],\n    },\n    handler: `\n      const { code, amount, orderId, reason } = input;\n\n      const giftCard = await prisma.giftCard.findFirst({\n        where: { code: code.toUpperCase() },\n      });\n\n      if (!giftCard) {\n        throw new Error('Gift card not found');\n      }\n\n      const newBalance = giftCard.balance + amount;\n\n      // Cannot exceed original amount\n      if (newBalance > giftCard.originalAmount) {\n        throw new Error('Refund would exceed original gift card amount');\n      }\n\n      const [transaction, updatedCard] = await prisma.$transaction([\n        prisma.giftCardTransaction.create({\n          data: {\n            giftCardId: giftCard.id,\n            type: 'REFUND',\n            amount: amount,\n            balance: newBalance,\n            orderId: orderId || null,\n            description: reason || 'Refund to gift card',\n          },\n        }),\n        prisma.giftCard.update({\n          where: { id: giftCard.id },\n          data: {\n            balance: newBalance,\n            status: 'ACTIVE',\n          },\n        }),\n      ]);\n\n      return {\n        refunded: true,\n        amountRefunded: amount,\n        newBalance: updatedCard.balance,\n        transactionId: transaction.id,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET USER GIFT CARDS\n  // ============================================================================\n  {\n    name: 'giftcard.getUserCards',\n    description: 'Get gift cards purchased by or sent to a user',\n    category: 'giftcard',\n    tags: ['giftcard', 'user', 'list'],\n    icon: 'CreditCard',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        type: {\n          type: 'string',\n          description: 'Filter type',\n          enum: ['purchased', 'received', 'all'],\n          default: 'all',\n        },\n        status: {\n          type: 'string',\n          description: 'Filter by status',\n          enum: ['ACTIVE', 'REDEEMED', 'EXPIRED', 'DISABLED'],\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, type = 'all', status } = input;\n\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: { email: true },\n      });\n\n      if (!user) {\n        throw new Error('User not found');\n      }\n\n      const where = {};\n\n      if (type === 'purchased') {\n        where.purchaserId = userId;\n      } else if (type === 'received') {\n        where.recipientEmail = user.email;\n      } else {\n        where.OR = [\n          { purchaserId: userId },\n          { recipientEmail: user.email },\n        ];\n      }\n\n      if (status) where.status = status;\n\n      const giftCards = await prisma.giftCard.findMany({\n        where,\n        orderBy: { createdAt: 'desc' },\n      });\n\n      return {\n        giftCards: giftCards.map(gc => ({\n          id: gc.id,\n          code: gc.code.substring(0, 4) + '-****-****-' + gc.code.slice(-4),\n          fullCode: gc.purchaserId === userId ? gc.code : undefined,\n          balance: gc.balance,\n          originalAmount: gc.originalAmount,\n          currency: gc.currency,\n          status: gc.status,\n          isPurchased: gc.purchaserId === userId,\n          isReceived: gc.recipientEmail === user.email,\n          recipientName: gc.recipientName,\n          senderName: gc.senderName,\n          expiresAt: gc.expiresAt,\n          createdAt: gc.createdAt,\n        })),\n        total: giftCards.length,\n      };\n    `,\n  },\n];\n","/**\n * Media Primitives\n *\n * AI-callable primitives for media/file management.\n * Supports S3, Cloudflare R2, and local storage.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const MEDIA_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // LIST MEDIA\n  // ============================================================================\n  {\n    name: 'media.list',\n    description: 'List media files with filtering and pagination',\n    category: 'media',\n    tags: ['media', 'files', 'images', 'storage'],\n    icon: 'Image',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n          minimum: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n          minimum: 1,\n          maximum: 100,\n        },\n        type: {\n          type: 'string',\n          description: 'Filter by file type',\n          enum: ['image', 'video', 'audio', 'document', 'other'],\n        },\n        folderId: {\n          type: 'string',\n          description: 'Filter by folder ID',\n        },\n        search: {\n          type: 'string',\n          description: 'Search by filename',\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['name', 'size', 'createdAt'],\n          default: 'createdAt',\n        },\n        sortOrder: {\n          type: 'string',\n          description: 'Sort direction',\n          enum: ['asc', 'desc'],\n          default: 'desc',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { page = 1, limit = 20, type, folderId, search, sortBy = 'createdAt', sortOrder = 'desc' } = input;\n\n      const where = { deletedAt: null };\n\n      if (type) {\n        const mimePatterns = {\n          image: 'image/%',\n          video: 'video/%',\n          audio: 'audio/%',\n          document: ['application/pdf', 'application/msword', 'application/vnd.openxmlformats%', 'text/%'],\n        };\n        if (type !== 'other') {\n          const pattern = mimePatterns[type];\n          if (Array.isArray(pattern)) {\n            where.OR = pattern.map(p => ({ mimeType: { contains: p.replace('%', '') } }));\n          } else {\n            where.mimeType = { startsWith: pattern.replace('%', '') };\n          }\n        }\n      }\n\n      if (folderId) where.folderId = folderId;\n      if (search) where.name = { contains: search, mode: 'insensitive' };\n\n      const [files, total] = await Promise.all([\n        prisma.media.findMany({\n          where,\n          include: {\n            folder: { select: { id: true, name: true } },\n          },\n          orderBy: { [sortBy]: sortOrder },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.media.count({ where }),\n      ]);\n\n      return {\n        files: files.map(f => ({\n          id: f.id,\n          name: f.name,\n          url: f.url,\n          thumbnailUrl: f.thumbnailUrl,\n          mimeType: f.mimeType,\n          size: f.size,\n          width: f.width,\n          height: f.height,\n          alt: f.alt,\n          folder: f.folder,\n          createdAt: f.createdAt,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n          hasNext: page * limit < total,\n          hasPrev: page > 1,\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET MEDIA\n  // ============================================================================\n  {\n    name: 'media.get',\n    description: 'Get a single media file by ID',\n    category: 'media',\n    tags: ['media', 'files', 'storage'],\n    icon: 'File',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        mediaId: {\n          type: 'string',\n          description: 'Media ID',\n        },\n      },\n      required: ['mediaId'],\n    },\n    handler: `\n      const { mediaId } = input;\n\n      const media = await prisma.media.findFirst({\n        where: { id: mediaId, deletedAt: null },\n        include: {\n          folder: { select: { id: true, name: true, path: true } },\n        },\n      });\n\n      if (!media) {\n        throw new Error('Media not found');\n      }\n\n      return {\n        id: media.id,\n        name: media.name,\n        url: media.url,\n        thumbnailUrl: media.thumbnailUrl,\n        mimeType: media.mimeType,\n        size: media.size,\n        width: media.width,\n        height: media.height,\n        alt: media.alt,\n        caption: media.caption,\n        folder: media.folder,\n        metadata: media.metadata,\n        createdAt: media.createdAt,\n        updatedAt: media.updatedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET FOLDERS\n  // ============================================================================\n  {\n    name: 'media.getFolders',\n    description: 'Get media folders for organization',\n    category: 'media',\n    tags: ['media', 'folders', 'storage'],\n    icon: 'Folder',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        parentId: {\n          type: 'string',\n          description: 'Parent folder ID (null for root)',\n        },\n        includeFileCount: {\n          type: 'boolean',\n          description: 'Include file count per folder',\n          default: true,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { parentId, includeFileCount = true } = input;\n\n      const where = {};\n      if (parentId === null || parentId === undefined) {\n        where.parentId = null;\n      } else if (parentId) {\n        where.parentId = parentId;\n      }\n\n      const folders = await prisma.mediaFolder.findMany({\n        where,\n        include: {\n          _count: includeFileCount ? {\n            select: { files: { where: { deletedAt: null } } },\n          } : false,\n          children: {\n            select: { id: true, name: true },\n          },\n        },\n        orderBy: { name: 'asc' },\n      });\n\n      return {\n        folders: folders.map(f => ({\n          id: f.id,\n          name: f.name,\n          path: f.path,\n          fileCount: f._count?.files || 0,\n          hasChildren: f.children.length > 0,\n          createdAt: f.createdAt,\n        })),\n        total: folders.length,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // UPDATE MEDIA\n  // ============================================================================\n  {\n    name: 'media.update',\n    description: 'Update media file metadata (alt text, caption, folder)',\n    category: 'media',\n    tags: ['media', 'update', 'storage'],\n    icon: 'Edit',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        mediaId: {\n          type: 'string',\n          description: 'Media ID',\n        },\n        name: {\n          type: 'string',\n          description: 'New filename',\n        },\n        alt: {\n          type: 'string',\n          description: 'Alt text for accessibility',\n        },\n        caption: {\n          type: 'string',\n          description: 'Caption/description',\n        },\n        folderId: {\n          type: 'string',\n          description: 'Move to folder',\n        },\n      },\n      required: ['mediaId'],\n    },\n    handler: `\n      const { mediaId, name, alt, caption, folderId } = input;\n\n      const media = await prisma.media.findFirst({\n        where: { id: mediaId, deletedAt: null },\n      });\n\n      if (!media) {\n        throw new Error('Media not found');\n      }\n\n      const updateData = {};\n      if (name !== undefined) updateData.name = name;\n      if (alt !== undefined) updateData.alt = alt;\n      if (caption !== undefined) updateData.caption = caption;\n      if (folderId !== undefined) updateData.folderId = folderId || null;\n\n      const updated = await prisma.media.update({\n        where: { id: mediaId },\n        data: updateData,\n        include: {\n          folder: { select: { id: true, name: true } },\n        },\n      });\n\n      return {\n        id: updated.id,\n        name: updated.name,\n        url: updated.url,\n        alt: updated.alt,\n        caption: updated.caption,\n        folder: updated.folder,\n        updatedAt: updated.updatedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // DELETE MEDIA\n  // ============================================================================\n  {\n    name: 'media.delete',\n    description: 'Soft delete a media file',\n    category: 'media',\n    tags: ['media', 'delete', 'storage'],\n    icon: 'Trash2',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        mediaId: {\n          type: 'string',\n          description: 'Media ID',\n        },\n        permanent: {\n          type: 'boolean',\n          description: 'Permanently delete (cannot be undone)',\n          default: false,\n        },\n      },\n      required: ['mediaId'],\n    },\n    handler: `\n      const { mediaId, permanent = false } = input;\n\n      const media = await prisma.media.findFirst({\n        where: { id: mediaId },\n      });\n\n      if (!media) {\n        throw new Error('Media not found');\n      }\n\n      if (permanent) {\n        // Delete from storage (would need to implement storage adapter)\n        await prisma.media.delete({ where: { id: mediaId } });\n        return { deleted: true, permanent: true, mediaId };\n      } else {\n        await prisma.media.update({\n          where: { id: mediaId },\n          data: { deletedAt: new Date() },\n        });\n        return { deleted: true, permanent: false, mediaId };\n      }\n    `,\n  },\n\n  // ============================================================================\n  // CREATE FOLDER\n  // ============================================================================\n  {\n    name: 'media.createFolder',\n    description: 'Create a new media folder',\n    category: 'media',\n    tags: ['media', 'folders', 'storage'],\n    icon: 'FolderPlus',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'Folder name',\n          minLength: 1,\n          maxLength: 100,\n        },\n        parentId: {\n          type: 'string',\n          description: 'Parent folder ID (null for root)',\n        },\n      },\n      required: ['name'],\n    },\n    handler: `\n      const { name, parentId } = input;\n\n      // Build path\n      let path = '/' + name;\n      if (parentId) {\n        const parent = await prisma.mediaFolder.findUnique({ where: { id: parentId } });\n        if (!parent) {\n          throw new Error('Parent folder not found');\n        }\n        path = parent.path + '/' + name;\n      }\n\n      // Check for duplicate\n      const existing = await prisma.mediaFolder.findFirst({\n        where: { name, parentId: parentId || null },\n      });\n\n      if (existing) {\n        throw new Error('Folder with this name already exists');\n      }\n\n      const folder = await prisma.mediaFolder.create({\n        data: {\n          name,\n          path,\n          parentId: parentId || null,\n        },\n      });\n\n      return {\n        id: folder.id,\n        name: folder.name,\n        path: folder.path,\n        parentId: folder.parentId,\n        createdAt: folder.createdAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET UPLOAD URL\n  // ============================================================================\n  {\n    name: 'media.getUploadUrl',\n    description: 'Get a presigned URL for direct upload to storage',\n    category: 'media',\n    tags: ['media', 'upload', 'storage'],\n    icon: 'Upload',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        filename: {\n          type: 'string',\n          description: 'Original filename',\n        },\n        mimeType: {\n          type: 'string',\n          description: 'File MIME type',\n        },\n        size: {\n          type: 'number',\n          description: 'File size in bytes',\n        },\n        folderId: {\n          type: 'string',\n          description: 'Target folder ID',\n        },\n      },\n      required: ['filename', 'mimeType'],\n    },\n    handler: `\n      const { filename, mimeType, size, folderId } = input;\n\n      // Validate file type\n      const allowedTypes = [\n        'image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml',\n        'video/mp4', 'video/webm',\n        'audio/mpeg', 'audio/wav', 'audio/ogg',\n        'application/pdf',\n        'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      ];\n\n      if (!allowedTypes.some(t => mimeType.startsWith(t.split('/')[0]) || mimeType === t)) {\n        throw new Error('File type not allowed');\n      }\n\n      // Max size check (50MB default)\n      const maxSize = 50 * 1024 * 1024;\n      if (size && size > maxSize) {\n        throw new Error('File size exceeds maximum allowed (50MB)');\n      }\n\n      // Generate unique key\n      const ext = filename.split('.').pop() || '';\n      const key = 'uploads/' + Date.now() + '-' + Math.random().toString(36).substring(2) + '.' + ext;\n\n      // For now, return placeholder - actual implementation would use S3/R2/local storage\n      return {\n        uploadUrl: '/api/media/upload',\n        method: 'POST',\n        key,\n        fields: {\n          filename,\n          mimeType,\n          folderId: folderId || null,\n        },\n        expiresIn: 3600,\n        note: 'Use multipart/form-data with file field',\n      };\n    `,\n  },\n];\n","/**\n * Notification Primitives\n *\n * AI-callable primitives for user notifications.\n * Enables in-app notifications for orders, promotions, etc.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const NOTIFICATION_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // LIST NOTIFICATIONS\n  // ============================================================================\n  {\n    name: 'notification.list',\n    description: 'Get user notifications with filtering',\n    category: 'notification',\n    tags: ['notification', 'user', 'alerts'],\n    icon: 'Bell',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        type: {\n          type: 'string',\n          description: 'Filter by notification type',\n          enum: ['ORDER', 'SHIPPING', 'PROMOTION', 'REVIEW', 'SYSTEM', 'PRICE_DROP', 'BACK_IN_STOCK'],\n        },\n        unreadOnly: {\n          type: 'boolean',\n          description: 'Only unread notifications',\n          default: false,\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, type, unreadOnly = false, page = 1, limit = 20 } = input;\n\n      const where = { userId };\n      if (type) where.type = type;\n      if (unreadOnly) where.readAt = null;\n\n      const [notifications, total, unreadCount] = await Promise.all([\n        prisma.notification.findMany({\n          where,\n          orderBy: { createdAt: 'desc' },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.notification.count({ where }),\n        prisma.notification.count({ where: { userId, readAt: null } }),\n      ]);\n\n      return {\n        notifications: notifications.map(n => ({\n          id: n.id,\n          type: n.type,\n          title: n.title,\n          message: n.message,\n          data: n.data,\n          actionUrl: n.actionUrl,\n          imageUrl: n.imageUrl,\n          read: !!n.readAt,\n          readAt: n.readAt,\n          createdAt: n.createdAt,\n        })),\n        unreadCount,\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // MARK AS READ\n  // ============================================================================\n  {\n    name: 'notification.markRead',\n    description: 'Mark a notification as read',\n    category: 'notification',\n    tags: ['notification', 'read', 'update'],\n    icon: 'CheckCircle',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        notificationId: {\n          type: 'string',\n          description: 'Notification ID',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID (for authorization)',\n        },\n      },\n      required: ['notificationId', 'userId'],\n    },\n    handler: `\n      const { notificationId, userId } = input;\n\n      const notification = await prisma.notification.findFirst({\n        where: { id: notificationId, userId },\n      });\n\n      if (!notification) {\n        throw new Error('Notification not found');\n      }\n\n      if (notification.readAt) {\n        return { id: notificationId, alreadyRead: true };\n      }\n\n      await prisma.notification.update({\n        where: { id: notificationId },\n        data: { readAt: new Date() },\n      });\n\n      return { id: notificationId, markedAsRead: true };\n    `,\n  },\n\n  // ============================================================================\n  // MARK ALL AS READ\n  // ============================================================================\n  {\n    name: 'notification.markAllRead',\n    description: 'Mark all notifications as read for a user',\n    category: 'notification',\n    tags: ['notification', 'read', 'bulk'],\n    icon: 'CheckCheck',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        type: {\n          type: 'string',\n          description: 'Only mark specific type as read',\n          enum: ['ORDER', 'SHIPPING', 'PROMOTION', 'REVIEW', 'SYSTEM', 'PRICE_DROP', 'BACK_IN_STOCK'],\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, type } = input;\n\n      const where = { userId, readAt: null };\n      if (type) where.type = type;\n\n      const result = await prisma.notification.updateMany({\n        where,\n        data: { readAt: new Date() },\n      });\n\n      return {\n        markedAsRead: result.count,\n        userId,\n        type: type || 'all',\n      };\n    `,\n  },\n\n  // ============================================================================\n  // DELETE NOTIFICATION\n  // ============================================================================\n  {\n    name: 'notification.delete',\n    description: 'Delete a notification',\n    category: 'notification',\n    tags: ['notification', 'delete'],\n    icon: 'Trash2',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        notificationId: {\n          type: 'string',\n          description: 'Notification ID',\n        },\n        userId: {\n          type: 'string',\n          description: 'User ID (for authorization)',\n        },\n      },\n      required: ['notificationId', 'userId'],\n    },\n    handler: `\n      const { notificationId, userId } = input;\n\n      const notification = await prisma.notification.findFirst({\n        where: { id: notificationId, userId },\n      });\n\n      if (!notification) {\n        throw new Error('Notification not found');\n      }\n\n      await prisma.notification.delete({ where: { id: notificationId } });\n\n      return { deleted: true, notificationId };\n    `,\n  },\n\n  // ============================================================================\n  // GET UNREAD COUNT\n  // ============================================================================\n  {\n    name: 'notification.getUnreadCount',\n    description: 'Get count of unread notifications',\n    category: 'notification',\n    tags: ['notification', 'count', 'badge'],\n    icon: 'Hash',\n    timeout: 2000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId } = input;\n\n      const count = await prisma.notification.count({\n        where: { userId, readAt: null },\n      });\n\n      return { userId, unreadCount: count };\n    `,\n  },\n\n  // ============================================================================\n  // CREATE NOTIFICATION (Admin/System)\n  // ============================================================================\n  {\n    name: 'notification.create',\n    description: 'Create a new notification for a user',\n    category: 'notification',\n    tags: ['notification', 'create', 'admin'],\n    icon: 'BellPlus',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'Target user ID',\n        },\n        type: {\n          type: 'string',\n          description: 'Notification type',\n          enum: ['ORDER', 'SHIPPING', 'PROMOTION', 'REVIEW', 'SYSTEM', 'PRICE_DROP', 'BACK_IN_STOCK'],\n        },\n        title: {\n          type: 'string',\n          description: 'Notification title',\n          maxLength: 200,\n        },\n        message: {\n          type: 'string',\n          description: 'Notification message',\n          maxLength: 1000,\n        },\n        actionUrl: {\n          type: 'string',\n          description: 'URL to navigate when clicked',\n        },\n        imageUrl: {\n          type: 'string',\n          description: 'Image URL to display',\n        },\n        data: {\n          type: 'object',\n          description: 'Additional data (orderId, productId, etc.)',\n        },\n      },\n      required: ['userId', 'type', 'title', 'message'],\n    },\n    handler: `\n      const { userId, type, title, message, actionUrl, imageUrl, data } = input;\n\n      // Verify user exists\n      const user = await prisma.user.findUnique({ where: { id: userId } });\n      if (!user) {\n        throw new Error('User not found');\n      }\n\n      const notification = await prisma.notification.create({\n        data: {\n          userId,\n          type,\n          title,\n          message,\n          actionUrl: actionUrl || null,\n          imageUrl: imageUrl || null,\n          data: data || {},\n        },\n      });\n\n      return {\n        id: notification.id,\n        type: notification.type,\n        title: notification.title,\n        createdAt: notification.createdAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET NOTIFICATION PREFERENCES\n  // ============================================================================\n  {\n    name: 'notification.getPreferences',\n    description: 'Get user notification preferences',\n    category: 'notification',\n    tags: ['notification', 'preferences', 'settings'],\n    icon: 'Settings',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId } = input;\n\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: { notificationPreferences: true },\n      });\n\n      if (!user) {\n        throw new Error('User not found');\n      }\n\n      // Default preferences if not set\n      const defaults = {\n        orderUpdates: true,\n        shippingUpdates: true,\n        promotions: true,\n        priceDrops: true,\n        backInStock: true,\n        reviewReminders: true,\n        emailNotifications: true,\n        pushNotifications: false,\n      };\n\n      return {\n        userId,\n        preferences: { ...defaults, ...(user.notificationPreferences || {}) },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // UPDATE NOTIFICATION PREFERENCES\n  // ============================================================================\n  {\n    name: 'notification.updatePreferences',\n    description: 'Update user notification preferences',\n    category: 'notification',\n    tags: ['notification', 'preferences', 'settings'],\n    icon: 'Settings2',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        preferences: {\n          type: 'object',\n          description: 'Preference settings to update',\n          properties: {\n            orderUpdates: { type: 'boolean' },\n            shippingUpdates: { type: 'boolean' },\n            promotions: { type: 'boolean' },\n            priceDrops: { type: 'boolean' },\n            backInStock: { type: 'boolean' },\n            reviewReminders: { type: 'boolean' },\n            emailNotifications: { type: 'boolean' },\n            pushNotifications: { type: 'boolean' },\n          },\n        },\n      },\n      required: ['userId', 'preferences'],\n    },\n    handler: `\n      const { userId, preferences } = input;\n\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: { notificationPreferences: true },\n      });\n\n      if (!user) {\n        throw new Error('User not found');\n      }\n\n      const updated = await prisma.user.update({\n        where: { id: userId },\n        data: {\n          notificationPreferences: {\n            ...(user.notificationPreferences || {}),\n            ...preferences,\n          },\n        },\n        select: { notificationPreferences: true },\n      });\n\n      return {\n        userId,\n        preferences: updated.notificationPreferences,\n        updated: true,\n      };\n    `,\n  },\n];\n","/**\n * Order Primitives\n *\n * Primitives for managing orders: creation, status updates, cancellation, refunds, and tracking.\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const ORDER_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // ORDER MANAGEMENT PRIMITIVES\n  // ============================================================================\n  {\n    name: 'order.create',\n    description: 'Create a new order from cart or direct product purchase. Calculates totals, applies discounts, and initializes order workflow.',\n    category: 'order',\n    tags: ['order', 'create', 'checkout', 'e-commerce'],\n    icon: 'ShoppingBag',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        customerId: {\n          type: 'string',\n          description: 'Optional customer ID for logged-in users',\n        },\n        email: {\n          type: 'string',\n          description: 'Customer email address (required)',\n        },\n        items: {\n          type: 'array',\n          description: 'Array of order items with productId, variantId, quantity',\n          items: {\n            type: 'object',\n            properties: {\n              productId: { type: 'string' },\n              variantId: { type: 'string' },\n              quantity: { type: 'number' },\n            },\n            required: ['productId', 'quantity'],\n          },\n        },\n        shippingAddressId: {\n          type: 'string',\n          description: 'ID of the shipping address',\n        },\n        billingAddressId: {\n          type: 'string',\n          description: 'ID of the billing address',\n        },\n        discountCode: {\n          type: 'string',\n          description: 'Optional discount code to apply',\n        },\n        customerNotes: {\n          type: 'string',\n          description: 'Optional notes from customer',\n        },\n      },\n      required: ['email', 'items'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n      const { generateOrderNumber } = await import('../../orders');\n\n      // Validate items and get product info\n      const orderItems = [];\n      let subtotal = 0;\n\n      for (const item of args.items) {\n        const product = await prisma.product.findUnique({\n          where: { id: item.productId },\n          include: { variants: true },\n        });\n\n        if (!product) {\n          throw new Error('Product not found: ' + item.productId);\n        }\n\n        const variant = item.variantId\n          ? product.variants.find(v => v.id === item.variantId)\n          : null;\n\n        const price = variant?.price ?? product.price;\n        const itemTotal = price * item.quantity;\n        subtotal += itemTotal;\n\n        orderItems.push({\n          productId: product.id,\n          variantId: variant?.id,\n          title: product.title,\n          variantTitle: variant?.title,\n          sku: variant?.sku || product.sku,\n          quantity: item.quantity,\n          price: price,\n          total: itemTotal,\n        });\n      }\n\n      // Apply discount if provided\n      let discountTotal = 0;\n      let discountCodeId = null;\n\n      if (args.discountCode) {\n        const discount = await prisma.discountCode.findUnique({\n          where: { code: args.discountCode, enabled: true },\n        });\n\n        if (discount) {\n          if (discount.type === 'PERCENTAGE') {\n            discountTotal = Math.floor(subtotal * discount.value / 100);\n            if (discount.maxDiscount) {\n              discountTotal = Math.min(discountTotal, discount.maxDiscount);\n            }\n          } else {\n            discountTotal = discount.value;\n          }\n          discountCodeId = discount.id;\n        }\n      }\n\n      const total = subtotal - discountTotal;\n\n      // Create order with items\n      const order = await prisma.order.create({\n        data: {\n          orderNumber: await generateOrderNumber(),\n          customerId: args.customerId,\n          email: args.email,\n          status: 'PENDING',\n          subtotal,\n          discountTotal,\n          total,\n          discountCodeId,\n          shippingAddressId: args.shippingAddressId,\n          billingAddressId: args.billingAddressId,\n          customerNotes: args.customerNotes,\n          items: {\n            create: orderItems,\n          },\n        },\n        include: {\n          items: true,\n        },\n      });\n\n      return {\n        success: true,\n        order: {\n          id: order.id,\n          orderNumber: order.orderNumber,\n          status: order.status,\n          total: order.total,\n          itemCount: order.items.length,\n        },\n      };\n    `,\n  },\n  {\n    name: 'order.get',\n    description: 'Get order details by ID or order number. Includes items, shipments, and workflow progress.',\n    category: 'order',\n    tags: ['order', 'get', 'details', 'e-commerce'],\n    icon: 'FileText',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID',\n        },\n        orderNumber: {\n          type: 'string',\n          description: 'Order number (alternative to orderId)',\n        },\n        includeItems: {\n          type: 'boolean',\n          description: 'Include order items (default: true)',\n          default: true,\n        },\n        includeShipments: {\n          type: 'boolean',\n          description: 'Include shipment info (default: true)',\n          default: true,\n        },\n        includeProgress: {\n          type: 'boolean',\n          description: 'Include workflow progress (default: false)',\n          default: false,\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (!args.orderId && !args.orderNumber) {\n        throw new Error('Either orderId or orderNumber is required');\n      }\n\n      const where = args.orderId\n        ? { id: args.orderId }\n        : { orderNumber: args.orderNumber };\n\n      const order = await prisma.order.findUnique({\n        where,\n        include: {\n          items: args.includeItems !== false ? {\n            include: {\n              product: { select: { id: true, title: true, slug: true } },\n              variant: { select: { id: true, title: true } },\n            },\n          } : false,\n          shipments: args.includeShipments !== false,\n          progress: args.includeProgress ? {\n            include: { stage: true },\n            orderBy: { enteredAt: 'desc' },\n          } : false,\n          customer: { select: { id: true, name: true, email: true } },\n          shippingAddress: true,\n          billingAddress: true,\n          workflow: args.includeProgress ? { include: { stages: true } } : false,\n        },\n      });\n\n      if (!order) {\n        return { success: false, error: 'Order not found' };\n      }\n\n      return { success: true, order };\n    `,\n  },\n  {\n    name: 'order.list',\n    description: 'List orders with filtering, pagination, and sorting options.',\n    category: 'order',\n    tags: ['order', 'list', 'search', 'e-commerce'],\n    icon: 'List',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        customerId: {\n          type: 'string',\n          description: 'Filter by customer ID',\n        },\n        email: {\n          type: 'string',\n          description: 'Filter by customer email',\n        },\n        status: {\n          type: 'string',\n          description: 'Filter by order status',\n          enum: ['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED', 'REFUNDED'],\n        },\n        paymentStatus: {\n          type: 'string',\n          description: 'Filter by payment status',\n          enum: ['UNPAID', 'PAID', 'PARTIALLY_REFUNDED', 'REFUNDED'],\n        },\n        dateFrom: {\n          type: 'string',\n          description: 'Filter orders from this date (ISO string)',\n        },\n        dateTo: {\n          type: 'string',\n          description: 'Filter orders up to this date (ISO string)',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number (default: 1)',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page (default: 20, max: 100)',\n          default: 20,\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['createdAt', 'updatedAt', 'total', 'orderNumber'],\n          default: 'createdAt',\n        },\n        sortOrder: {\n          type: 'string',\n          description: 'Sort direction',\n          enum: ['asc', 'desc'],\n          default: 'desc',\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const page = Math.max(1, args.page || 1);\n      const limit = Math.min(100, Math.max(1, args.limit || 20));\n      const skip = (page - 1) * limit;\n\n      const where = {};\n\n      if (args.customerId) where.customerId = args.customerId;\n      if (args.email) where.email = { contains: args.email, mode: 'insensitive' };\n      if (args.status) where.status = args.status;\n      if (args.paymentStatus) where.paymentStatus = args.paymentStatus;\n\n      if (args.dateFrom || args.dateTo) {\n        where.createdAt = {};\n        if (args.dateFrom) where.createdAt.gte = new Date(args.dateFrom);\n        if (args.dateTo) where.createdAt.lte = new Date(args.dateTo);\n      }\n\n      const [orders, total] = await Promise.all([\n        prisma.order.findMany({\n          where,\n          skip,\n          take: limit,\n          orderBy: { [args.sortBy || 'createdAt']: args.sortOrder || 'desc' },\n          include: {\n            items: { select: { id: true, title: true, quantity: true, total: true } },\n            customer: { select: { id: true, name: true, email: true } },\n          },\n        }),\n        prisma.order.count({ where }),\n      ]);\n\n      return {\n        success: true,\n        orders,\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n  {\n    name: 'order.updateStatus',\n    description: 'Update order status with optional notes and notification trigger.',\n    category: 'order',\n    tags: ['order', 'status', 'update', 'e-commerce'],\n    icon: 'RefreshCw',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID to update',\n        },\n        status: {\n          type: 'string',\n          description: 'New order status',\n          enum: ['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED', 'REFUNDED'],\n        },\n        internalNotes: {\n          type: 'string',\n          description: 'Internal notes for this status change',\n        },\n        notifyCustomer: {\n          type: 'boolean',\n          description: 'Send notification to customer (default: true)',\n          default: true,\n        },\n        updatedById: {\n          type: 'string',\n          description: 'User ID who made the change',\n        },\n      },\n      required: ['orderId', 'status'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const order = await prisma.order.findUnique({\n        where: { id: args.orderId },\n      });\n\n      if (!order) {\n        throw new Error('Order not found');\n      }\n\n      const previousStatus = order.status;\n\n      const updated = await prisma.order.update({\n        where: { id: args.orderId },\n        data: {\n          status: args.status,\n          internalNotes: args.internalNotes\n            ? (order.internalNotes ? order.internalNotes + '\\\\n' : '') +\n              '[' + new Date().toISOString() + '] Status: ' + args.status + ' - ' + args.internalNotes\n            : order.internalNotes,\n        },\n      });\n\n      // TODO: Trigger notification if notifyCustomer is true\n\n      return {\n        success: true,\n        order: {\n          id: updated.id,\n          orderNumber: updated.orderNumber,\n          previousStatus,\n          newStatus: updated.status,\n        },\n      };\n    `,\n  },\n  {\n    name: 'order.cancel',\n    description: 'Cancel an order. Restores inventory, voids payment if applicable, and updates status.',\n    category: 'order',\n    tags: ['order', 'cancel', 'void', 'e-commerce'],\n    icon: 'XCircle',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID to cancel',\n        },\n        reason: {\n          type: 'string',\n          description: 'Reason for cancellation',\n        },\n        restoreInventory: {\n          type: 'boolean',\n          description: 'Restore product inventory (default: true)',\n          default: true,\n        },\n        notifyCustomer: {\n          type: 'boolean',\n          description: 'Send cancellation notification (default: true)',\n          default: true,\n        },\n        cancelledById: {\n          type: 'string',\n          description: 'User ID who cancelled',\n        },\n      },\n      required: ['orderId', 'reason'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const order = await prisma.order.findUnique({\n        where: { id: args.orderId },\n        include: { items: true },\n      });\n\n      if (!order) {\n        throw new Error('Order not found');\n      }\n\n      if (order.status === 'CANCELLED') {\n        throw new Error('Order is already cancelled');\n      }\n\n      if (order.status === 'DELIVERED') {\n        throw new Error('Cannot cancel a delivered order. Use refund instead.');\n      }\n\n      // Restore inventory if requested\n      if (args.restoreInventory !== false) {\n        for (const item of order.items) {\n          if (item.variantId) {\n            await prisma.productVariant.update({\n              where: { id: item.variantId },\n              data: { inventory: { increment: item.quantity } },\n            });\n          } else {\n            await prisma.product.update({\n              where: { id: item.productId },\n              data: { inventory: { increment: item.quantity } },\n            });\n          }\n        }\n      }\n\n      const updated = await prisma.order.update({\n        where: { id: args.orderId },\n        data: {\n          status: 'CANCELLED',\n          internalNotes: (order.internalNotes ? order.internalNotes + '\\\\n' : '') +\n            '[' + new Date().toISOString() + '] CANCELLED: ' + args.reason,\n        },\n      });\n\n      return {\n        success: true,\n        order: {\n          id: updated.id,\n          orderNumber: updated.orderNumber,\n          status: updated.status,\n          reason: args.reason,\n          inventoryRestored: args.restoreInventory !== false,\n        },\n      };\n    `,\n  },\n  {\n    name: 'order.refund',\n    description: 'Process a refund for an order. Supports full or partial refunds with optional inventory restoration.',\n    category: 'order',\n    tags: ['order', 'refund', 'payment', 'e-commerce'],\n    icon: 'RotateCcw',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID to refund',\n        },\n        amount: {\n          type: 'number',\n          description: 'Refund amount in cents. If not provided, full refund.',\n        },\n        reason: {\n          type: 'string',\n          description: 'Reason for refund',\n        },\n        items: {\n          type: 'array',\n          description: 'Specific items to refund (for partial refunds)',\n          items: {\n            type: 'object',\n            properties: {\n              orderItemId: { type: 'string' },\n              quantity: { type: 'number' },\n            },\n            required: ['orderItemId', 'quantity'],\n          },\n        },\n        restoreInventory: {\n          type: 'boolean',\n          description: 'Restore inventory for refunded items',\n          default: true,\n        },\n        processStripeRefund: {\n          type: 'boolean',\n          description: 'Process refund through Stripe (default: true)',\n          default: true,\n        },\n        refundedById: {\n          type: 'string',\n          description: 'User ID who processed refund',\n        },\n      },\n      required: ['orderId', 'reason'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      const order = await prisma.order.findUnique({\n        where: { id: args.orderId },\n        include: { items: true },\n      });\n\n      if (!order) {\n        throw new Error('Order not found');\n      }\n\n      if (order.paymentStatus !== 'PAID' && order.paymentStatus !== 'PARTIALLY_REFUNDED') {\n        throw new Error('Order must be paid to process refund');\n      }\n\n      const refundAmount = args.amount || order.total;\n\n      // Process Stripe refund if applicable\n      let stripeRefundId = null;\n      if (args.processStripeRefund !== false && order.stripePaymentIntentId) {\n        try {\n          const stripe = (await import('../../stripe')).stripe;\n          const refund = await stripe.refunds.create({\n            payment_intent: order.stripePaymentIntentId,\n            amount: refundAmount,\n            reason: 'requested_by_customer',\n          });\n          stripeRefundId = refund.id;\n        } catch (err) {\n          throw new Error('Stripe refund failed: ' + err.message);\n        }\n      }\n\n      // Update order status\n      const isFullRefund = refundAmount >= order.total;\n      const updated = await prisma.order.update({\n        where: { id: args.orderId },\n        data: {\n          status: isFullRefund ? 'REFUNDED' : order.status,\n          paymentStatus: isFullRefund ? 'REFUNDED' : 'PARTIALLY_REFUNDED',\n          internalNotes: (order.internalNotes ? order.internalNotes + '\\\\n' : '') +\n            '[' + new Date().toISOString() + '] REFUND: $' + (refundAmount / 100).toFixed(2) +\n            ' - ' + args.reason + (stripeRefundId ? ' (Stripe: ' + stripeRefundId + ')' : ''),\n        },\n      });\n\n      return {\n        success: true,\n        refund: {\n          orderId: updated.id,\n          orderNumber: updated.orderNumber,\n          amount: refundAmount,\n          isFullRefund,\n          stripeRefundId,\n          newPaymentStatus: updated.paymentStatus,\n        },\n      };\n    `,\n  },\n  {\n    name: 'order.getTracking',\n    description: 'Get tracking information for an order including shipment status and history.',\n    category: 'order',\n    tags: ['order', 'tracking', 'shipment', 'e-commerce'],\n    icon: 'Truck',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Order ID',\n        },\n        orderNumber: {\n          type: 'string',\n          description: 'Order number (alternative to orderId)',\n        },\n      },\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n\n      if (!args.orderId && !args.orderNumber) {\n        throw new Error('Either orderId or orderNumber is required');\n      }\n\n      const where = args.orderId\n        ? { id: args.orderId }\n        : { orderNumber: args.orderNumber };\n\n      const order = await prisma.order.findUnique({\n        where,\n        include: {\n          shipments: true,\n          progress: {\n            include: { stage: true },\n            orderBy: { enteredAt: 'desc' },\n          },\n          workflow: {\n            include: {\n              stages: { orderBy: { position: 'asc' } },\n            },\n          },\n        },\n      });\n\n      if (!order) {\n        return { success: false, error: 'Order not found' };\n      }\n\n      // Get current stage from workflow\n      const currentProgress = order.progress[0];\n      const stages = order.workflow?.stages || [];\n      const currentStageIndex = currentProgress\n        ? stages.findIndex(s => s.id === currentProgress.stageId)\n        : -1;\n\n      return {\n        success: true,\n        tracking: {\n          orderId: order.id,\n          orderNumber: order.orderNumber,\n          orderStatus: order.status,\n          shipments: order.shipments.map(s => ({\n            id: s.id,\n            carrier: s.carrier,\n            service: s.service,\n            trackingNumber: s.trackingNumber,\n            trackingUrl: s.trackingUrl,\n            status: s.status,\n            shippedAt: s.shippedAt,\n            deliveredAt: s.deliveredAt,\n          })),\n          workflow: order.workflow ? {\n            name: order.workflow.name,\n            currentStage: currentProgress?.stage ? {\n              name: currentProgress.stage.displayName,\n              message: currentProgress.stage.customerMessage,\n              icon: currentProgress.stage.icon,\n              color: currentProgress.stage.color,\n              enteredAt: currentProgress.enteredAt,\n            } : null,\n            stages: stages.map((s, i) => ({\n              name: s.displayName,\n              icon: s.icon,\n              color: s.color,\n              isComplete: i < currentStageIndex,\n              isCurrent: i === currentStageIndex,\n              isPending: i > currentStageIndex,\n            })),\n          } : null,\n          history: order.progress.map(p => ({\n            stage: p.stage.displayName,\n            enteredAt: p.enteredAt,\n            exitedAt: p.exitedAt,\n            source: p.source,\n          })),\n        },\n      };\n    `,\n  },\n  {\n    name: 'order.reorder',\n    description: 'Create a new order based on a previous order. Validates product availability and current prices.',\n    category: 'order',\n    tags: ['order', 'reorder', 'repeat', 'e-commerce'],\n    icon: 'Copy',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        orderId: {\n          type: 'string',\n          description: 'Original order ID to reorder from',\n        },\n        customerId: {\n          type: 'string',\n          description: 'Customer ID (uses original if not provided)',\n        },\n        email: {\n          type: 'string',\n          description: 'Email (uses original if not provided)',\n        },\n        shippingAddressId: {\n          type: 'string',\n          description: 'Shipping address (uses original if not provided)',\n        },\n        skipUnavailable: {\n          type: 'boolean',\n          description: 'Skip unavailable items instead of failing (default: false)',\n          default: false,\n        },\n      },\n      required: ['orderId'],\n    },\n    handler: `\n      const { prisma } = await import('../../db');\n      const { generateOrderNumber } = await import('../../orders');\n\n      const originalOrder = await prisma.order.findUnique({\n        where: { id: args.orderId },\n        include: { items: true },\n      });\n\n      if (!originalOrder) {\n        throw new Error('Original order not found');\n      }\n\n      // Validate items are still available\n      const validItems = [];\n      const unavailableItems = [];\n      let subtotal = 0;\n\n      for (const item of originalOrder.items) {\n        const product = await prisma.product.findUnique({\n          where: { id: item.productId },\n          include: { variants: true },\n        });\n\n        if (!product || product.status !== 'ACTIVE') {\n          unavailableItems.push({ title: item.title, reason: 'Product no longer available' });\n          continue;\n        }\n\n        const variant = item.variantId\n          ? product.variants.find(v => v.id === item.variantId)\n          : null;\n\n        if (item.variantId && !variant) {\n          unavailableItems.push({ title: item.title, reason: 'Variant no longer available' });\n          continue;\n        }\n\n        const currentPrice = variant?.price ?? product.price;\n        const itemTotal = currentPrice * item.quantity;\n        subtotal += itemTotal;\n\n        validItems.push({\n          productId: product.id,\n          variantId: variant?.id,\n          title: product.title,\n          variantTitle: variant?.title,\n          sku: variant?.sku || product.sku,\n          quantity: item.quantity,\n          price: currentPrice,\n          total: itemTotal,\n        });\n      }\n\n      if (validItems.length === 0) {\n        throw new Error('No items available for reorder');\n      }\n\n      if (unavailableItems.length > 0 && !args.skipUnavailable) {\n        return {\n          success: false,\n          error: 'Some items are unavailable',\n          unavailableItems,\n        };\n      }\n\n      // Create new order\n      const newOrder = await prisma.order.create({\n        data: {\n          orderNumber: await generateOrderNumber(),\n          customerId: args.customerId || originalOrder.customerId,\n          email: args.email || originalOrder.email,\n          status: 'PENDING',\n          subtotal,\n          total: subtotal,\n          shippingAddressId: args.shippingAddressId || originalOrder.shippingAddressId,\n          billingAddressId: originalOrder.billingAddressId,\n          items: {\n            create: validItems,\n          },\n        },\n        include: { items: true },\n      });\n\n      return {\n        success: true,\n        order: {\n          id: newOrder.id,\n          orderNumber: newOrder.orderNumber,\n          total: newOrder.total,\n          itemCount: newOrder.items.length,\n        },\n        originalOrderId: originalOrder.id,\n        unavailableItems: unavailableItems.length > 0 ? unavailableItems : undefined,\n      };\n    `,\n  },\n];\n","/**\n * Payment Primitives\n *\n * Primitives for payment processing: intents, checkout sessions, refunds, and customer management.\n * Uses Stripe integration from src/lib/stripe/\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const PAYMENT_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // PAYMENT PRIMITIVES\n  // ============================================================================\n  {\n    name: 'payment.createIntent',\n    description: 'Create a Stripe Payment Intent for custom payment flows. Returns client secret for frontend integration.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'intent', 'checkout'],\n    icon: 'CreditCard',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        amount: {\n          type: 'number',\n          description: 'Amount in cents (e.g., 1000 = $10.00)',\n        },\n        currency: {\n          type: 'string',\n          description: 'Currency code (default: USD)',\n          default: 'USD',\n        },\n        orderId: {\n          type: 'string',\n          description: 'Order ID to associate with payment',\n        },\n        customerId: {\n          type: 'string',\n          description: 'Stripe customer ID (optional)',\n        },\n        captureMethod: {\n          type: 'string',\n          description: 'Capture method',\n          enum: ['automatic', 'manual'],\n          default: 'automatic',\n        },\n        metadata: {\n          type: 'object',\n          description: 'Additional metadata to store with payment',\n        },\n      },\n      required: ['amount'],\n    },\n    handler: `\n      const { createPaymentIntent } = await import('../../stripe');\n\n      const result = await createPaymentIntent({\n        amount: args.amount,\n        currency: args.currency || 'USD',\n        orderId: args.orderId,\n        customerId: args.customerId,\n        captureMethod: args.captureMethod,\n        metadata: args.metadata,\n      });\n\n      return {\n        success: true,\n        paymentIntentId: result.paymentIntentId,\n        clientSecret: result.clientSecret,\n        status: result.status,\n      };\n    `,\n  },\n  {\n    name: 'payment.createCheckout',\n    description: 'Create a Stripe Checkout Session for hosted payment page. Returns URL to redirect customer.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'checkout', 'session'],\n    icon: 'ShoppingCart',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        items: {\n          type: 'array',\n          description: 'Line items for checkout',\n          items: {\n            type: 'object',\n            properties: {\n              name: { type: 'string' },\n              description: { type: 'string' },\n              price: { type: 'number', description: 'Price in cents' },\n              quantity: { type: 'number' },\n              images: { type: 'array', items: { type: 'string' } },\n              productId: { type: 'string' },\n              stripePriceId: { type: 'string' },\n            },\n            required: ['name', 'price', 'quantity'],\n          },\n        },\n        successUrl: {\n          type: 'string',\n          description: 'URL to redirect on success',\n        },\n        cancelUrl: {\n          type: 'string',\n          description: 'URL to redirect on cancel',\n        },\n        customerEmail: {\n          type: 'string',\n          description: 'Pre-fill customer email',\n        },\n        customerId: {\n          type: 'string',\n          description: 'Existing Stripe customer ID',\n        },\n        orderId: {\n          type: 'string',\n          description: 'Order ID to associate',\n        },\n        mode: {\n          type: 'string',\n          description: 'Checkout mode',\n          enum: ['payment', 'subscription', 'setup'],\n          default: 'payment',\n        },\n        allowPromotionCodes: {\n          type: 'boolean',\n          description: 'Allow promotion codes',\n          default: false,\n        },\n        shippingAddressCollection: {\n          type: 'boolean',\n          description: 'Collect shipping address',\n        },\n        shippingOptions: {\n          type: 'array',\n          description: 'Shipping rate options',\n          items: {\n            type: 'object',\n            properties: {\n              displayName: { type: 'string' },\n              amount: { type: 'number' },\n              deliveryEstimate: { type: 'object' },\n            },\n          },\n        },\n        metadata: {\n          type: 'object',\n          description: 'Additional metadata',\n        },\n      },\n      required: ['items', 'successUrl', 'cancelUrl'],\n    },\n    handler: `\n      const { createCheckoutSession } = await import('../../stripe');\n\n      const result = await createCheckoutSession({\n        items: args.items,\n        successUrl: args.successUrl,\n        cancelUrl: args.cancelUrl,\n        customerEmail: args.customerEmail,\n        customerId: args.customerId,\n        orderId: args.orderId,\n        mode: args.mode,\n        allowPromotionCodes: args.allowPromotionCodes,\n        shippingAddressCollection: args.shippingAddressCollection,\n        shippingOptions: args.shippingOptions,\n        metadata: args.metadata,\n      });\n\n      return {\n        success: true,\n        sessionId: result.sessionId,\n        url: result.url,\n      };\n    `,\n  },\n  {\n    name: 'payment.confirm',\n    description: 'Confirm and capture a payment intent (for manual capture mode).',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'capture', 'confirm'],\n    icon: 'CheckCircle',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        paymentIntentId: {\n          type: 'string',\n          description: 'Payment Intent ID to capture',\n        },\n        amount: {\n          type: 'number',\n          description: 'Amount to capture in cents (optional, captures full amount if not provided)',\n        },\n      },\n      required: ['paymentIntentId'],\n    },\n    handler: `\n      const { capturePaymentIntent } = await import('../../stripe');\n\n      const result = await capturePaymentIntent(args.paymentIntentId, args.amount);\n\n      return {\n        success: true,\n        paymentIntentId: result.paymentIntentId,\n        status: result.status,\n      };\n    `,\n  },\n  {\n    name: 'payment.refund',\n    description: 'Create a refund for a payment. Supports full or partial refunds.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'refund'],\n    icon: 'RotateCcw',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        paymentIntentId: {\n          type: 'string',\n          description: 'Payment Intent ID to refund',\n        },\n        amount: {\n          type: 'number',\n          description: 'Refund amount in cents (optional, full refund if not provided)',\n        },\n        reason: {\n          type: 'string',\n          description: 'Reason for refund',\n          enum: ['duplicate', 'fraudulent', 'requested_by_customer'],\n        },\n        metadata: {\n          type: 'object',\n          description: 'Additional metadata',\n        },\n      },\n      required: ['paymentIntentId'],\n    },\n    handler: `\n      const { createRefund } = await import('../../stripe');\n\n      const result = await createRefund({\n        paymentIntentId: args.paymentIntentId,\n        amount: args.amount,\n        reason: args.reason,\n        metadata: args.metadata,\n      });\n\n      return {\n        success: true,\n        refundId: result.refundId,\n        status: result.status,\n        amount: result.amount,\n        isFullRefund: !args.amount,\n      };\n    `,\n  },\n  {\n    name: 'payment.getPaymentMethods',\n    description: 'List saved payment methods for a Stripe customer.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'methods', 'customer'],\n    icon: 'Wallet',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        customerId: {\n          type: 'string',\n          description: 'Stripe customer ID',\n        },\n        type: {\n          type: 'string',\n          description: 'Payment method type',\n          enum: ['card', 'us_bank_account'],\n          default: 'card',\n        },\n      },\n      required: ['customerId'],\n    },\n    handler: `\n      const { listPaymentMethods } = await import('../../stripe');\n\n      const methods = await listPaymentMethods(args.customerId, args.type || 'card');\n\n      return {\n        success: true,\n        paymentMethods: methods.map(pm => ({\n          id: pm.id,\n          type: pm.type,\n          card: pm.card ? {\n            brand: pm.card.brand,\n            last4: pm.card.last4,\n            expMonth: pm.card.exp_month,\n            expYear: pm.card.exp_year,\n          } : null,\n          billingDetails: {\n            name: pm.billing_details?.name,\n            email: pm.billing_details?.email,\n          },\n        })),\n        count: methods.length,\n      };\n    `,\n  },\n  {\n    name: 'payment.createCustomer',\n    description: 'Create or get a Stripe customer. Returns customer ID for future payments.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'customer', 'create'],\n    icon: 'UserPlus',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        email: {\n          type: 'string',\n          description: 'Customer email address',\n        },\n        name: {\n          type: 'string',\n          description: 'Customer name',\n        },\n        phone: {\n          type: 'string',\n          description: 'Customer phone number',\n        },\n        address: {\n          type: 'object',\n          description: 'Customer address',\n          properties: {\n            line1: { type: 'string' },\n            line2: { type: 'string' },\n            city: { type: 'string' },\n            state: { type: 'string' },\n            postalCode: { type: 'string' },\n            country: { type: 'string' },\n          },\n        },\n        metadata: {\n          type: 'object',\n          description: 'Additional metadata',\n        },\n        getExisting: {\n          type: 'boolean',\n          description: 'Return existing customer if email matches (default: true)',\n          default: true,\n        },\n      },\n      required: ['email'],\n    },\n    handler: `\n      const { createCustomer, getOrCreateCustomer } = await import('../../stripe');\n\n      let customerId;\n\n      if (args.getExisting !== false) {\n        customerId = await getOrCreateCustomer(args.email, args.name);\n      } else {\n        customerId = await createCustomer({\n          email: args.email,\n          name: args.name,\n          phone: args.phone,\n          address: args.address,\n          metadata: args.metadata,\n        });\n      }\n\n      return {\n        success: true,\n        customerId,\n      };\n    `,\n  },\n  {\n    name: 'payment.getInvoices',\n    description: 'List invoices for a Stripe customer.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'invoices', 'billing'],\n    icon: 'FileText',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        customerId: {\n          type: 'string',\n          description: 'Stripe customer ID',\n        },\n        limit: {\n          type: 'number',\n          description: 'Max invoices to return (default: 10)',\n          default: 10,\n        },\n      },\n      required: ['customerId'],\n    },\n    handler: `\n      const { listInvoices } = await import('../../stripe');\n\n      const invoices = await listInvoices(args.customerId, args.limit || 10);\n\n      return {\n        success: true,\n        invoices: invoices.map(inv => ({\n          id: inv.id,\n          number: inv.number,\n          status: inv.status,\n          amountDue: inv.amount_due,\n          amountPaid: inv.amount_paid,\n          currency: inv.currency,\n          created: new Date(inv.created * 1000).toISOString(),\n          dueDate: inv.due_date ? new Date(inv.due_date * 1000).toISOString() : null,\n          pdfUrl: inv.invoice_pdf,\n          hostedUrl: inv.hosted_invoice_url,\n        })),\n        count: invoices.length,\n      };\n    `,\n  },\n  {\n    name: 'payment.createBillingPortal',\n    description: 'Create a Stripe Billing Portal session for customer self-service.',\n    category: 'payment',\n    tags: ['payment', 'stripe', 'portal', 'subscription'],\n    icon: 'Settings',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        customerId: {\n          type: 'string',\n          description: 'Stripe customer ID',\n        },\n        returnUrl: {\n          type: 'string',\n          description: 'URL to return to after portal session',\n        },\n      },\n      required: ['customerId', 'returnUrl'],\n    },\n    handler: `\n      const { createBillingPortalSession } = await import('../../stripe');\n\n      const url = await createBillingPortalSession(args.customerId, args.returnUrl);\n\n      return {\n        success: true,\n        url,\n      };\n    `,\n  },\n];\n","/**\n * Product Primitives\n *\n * AI-callable primitives for product catalog operations.\n * These enable store owners to build custom product displays via Puck.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const PRODUCT_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // PRODUCT LISTING\n  // ============================================================================\n  {\n    name: 'product.list',\n    description: 'List products with pagination, filtering, and sorting options',\n    category: 'product',\n    tags: ['product', 'catalog', 'list', 'storefront'],\n    icon: 'Package',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        page: {\n          type: 'number',\n          description: 'Page number (1-based)',\n          default: 1,\n          minimum: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n          minimum: 1,\n          maximum: 100,\n        },\n        categoryId: {\n          type: 'string',\n          description: 'Filter by category ID',\n        },\n        status: {\n          type: 'string',\n          description: 'Filter by status',\n          enum: ['ACTIVE', 'DRAFT', 'ARCHIVED'],\n        },\n        featured: {\n          type: 'boolean',\n          description: 'Filter to featured products only',\n        },\n        minPrice: {\n          type: 'number',\n          description: 'Minimum price filter',\n          minimum: 0,\n        },\n        maxPrice: {\n          type: 'number',\n          description: 'Maximum price filter',\n          minimum: 0,\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['name', 'price', 'createdAt', 'updatedAt'],\n          default: 'createdAt',\n        },\n        sortOrder: {\n          type: 'string',\n          description: 'Sort direction',\n          enum: ['asc', 'desc'],\n          default: 'desc',\n        },\n        includeVariants: {\n          type: 'boolean',\n          description: 'Include product variants in response',\n          default: false,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { page = 1, limit = 20, categoryId, status, featured, minPrice, maxPrice, sortBy = 'createdAt', sortOrder = 'desc', includeVariants = false } = input;\n\n      const where = { deletedAt: null };\n      if (categoryId) where.categoryId = categoryId;\n      if (status) where.status = status;\n      if (featured !== undefined) where.featured = featured;\n      if (minPrice !== undefined || maxPrice !== undefined) {\n        where.basePrice = {};\n        if (minPrice !== undefined) where.basePrice.gte = minPrice;\n        if (maxPrice !== undefined) where.basePrice.lte = maxPrice;\n      }\n\n      const [products, total] = await Promise.all([\n        prisma.product.findMany({\n          where,\n          include: {\n            category: { select: { id: true, name: true, slug: true } },\n            variants: includeVariants ? {\n              where: { deletedAt: null },\n              select: { id: true, name: true, sku: true, price: true, stock: true, options: true }\n            } : false,\n            images: { select: { id: true, url: true, alt: true }, orderBy: { order: 'asc' }, take: 1 },\n          },\n          orderBy: { [sortBy]: sortOrder },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.product.count({ where }),\n      ]);\n\n      return {\n        products: products.map(p => ({\n          id: p.id,\n          name: p.name,\n          slug: p.slug,\n          description: p.shortDescription || p.description?.substring(0, 200),\n          price: p.basePrice,\n          compareAtPrice: p.compareAtPrice,\n          featured: p.featured,\n          status: p.status,\n          category: p.category,\n          image: p.images[0] || null,\n          variants: p.variants || [],\n          variantCount: includeVariants ? p.variants?.length : undefined,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n          hasNext: page * limit < total,\n          hasPrev: page > 1,\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET SINGLE PRODUCT\n  // ============================================================================\n  {\n    name: 'product.get',\n    description: 'Get detailed product information by ID or slug',\n    category: 'product',\n    tags: ['product', 'catalog', 'detail', 'storefront'],\n    icon: 'PackageSearch',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        slug: {\n          type: 'string',\n          description: 'Product slug (alternative to ID)',\n        },\n        includeRelated: {\n          type: 'boolean',\n          description: 'Include related products',\n          default: false,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { productId, slug, includeRelated = false } = input;\n\n      if (!productId && !slug) {\n        throw new Error('Either productId or slug is required');\n      }\n\n      const where = productId ? { id: productId } : { slug };\n      where.deletedAt = null;\n\n      const product = await prisma.product.findFirst({\n        where,\n        include: {\n          category: true,\n          variants: {\n            where: { deletedAt: null },\n            include: {\n              images: { orderBy: { order: 'asc' } },\n            },\n            orderBy: { order: 'asc' },\n          },\n          images: { orderBy: { order: 'asc' } },\n          reviews: {\n            where: { status: 'APPROVED' },\n            take: 5,\n            orderBy: { createdAt: 'desc' },\n            include: { user: { select: { id: true, name: true } } },\n          },\n        },\n      });\n\n      if (!product) {\n        throw new Error('Product not found');\n      }\n\n      // Calculate average rating\n      const reviewStats = await prisma.productReview.aggregate({\n        where: { productId: product.id, status: 'APPROVED' },\n        _avg: { rating: true },\n        _count: { rating: true },\n      });\n\n      let related = [];\n      if (includeRelated && product.categoryId) {\n        related = await prisma.product.findMany({\n          where: {\n            categoryId: product.categoryId,\n            id: { not: product.id },\n            status: 'ACTIVE',\n            deletedAt: null,\n          },\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            basePrice: true,\n            images: { take: 1, orderBy: { order: 'asc' } },\n          },\n          take: 4,\n        });\n      }\n\n      return {\n        id: product.id,\n        name: product.name,\n        slug: product.slug,\n        description: product.description,\n        shortDescription: product.shortDescription,\n        price: product.basePrice,\n        compareAtPrice: product.compareAtPrice,\n        sku: product.sku,\n        featured: product.featured,\n        status: product.status,\n        category: product.category,\n        variants: product.variants.map(v => ({\n          id: v.id,\n          name: v.name,\n          sku: v.sku,\n          price: v.price,\n          compareAtPrice: v.compareAtPrice,\n          stock: v.stock,\n          options: v.options,\n          images: v.images,\n        })),\n        images: product.images,\n        reviews: product.reviews.map(r => ({\n          id: r.id,\n          rating: r.rating,\n          title: r.title,\n          content: r.content,\n          author: r.user?.name || 'Anonymous',\n          createdAt: r.createdAt,\n        })),\n        rating: {\n          average: reviewStats._avg.rating || 0,\n          count: reviewStats._count.rating || 0,\n        },\n        related,\n        metadata: product.metadata,\n        seo: {\n          title: product.seoTitle || product.name,\n          description: product.seoDescription || product.shortDescription,\n        },\n        createdAt: product.createdAt,\n        updatedAt: product.updatedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // SEARCH PRODUCTS\n  // ============================================================================\n  {\n    name: 'product.search',\n    description: 'Full-text search across products',\n    category: 'product',\n    tags: ['product', 'search', 'catalog', 'storefront'],\n    icon: 'Search',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'Search query',\n          minLength: 2,\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n          minimum: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n          minimum: 1,\n          maximum: 50,\n        },\n        categoryId: {\n          type: 'string',\n          description: 'Filter by category',\n        },\n        minPrice: {\n          type: 'number',\n          description: 'Minimum price',\n        },\n        maxPrice: {\n          type: 'number',\n          description: 'Maximum price',\n        },\n      },\n      required: ['query'],\n    },\n    handler: `\n      const { query, page = 1, limit = 20, categoryId, minPrice, maxPrice } = input;\n\n      const searchTerms = query.toLowerCase().split(/\\\\s+/).filter(t => t.length >= 2);\n\n      const where = {\n        status: 'ACTIVE',\n        deletedAt: null,\n        OR: [\n          { name: { contains: query, mode: 'insensitive' } },\n          { description: { contains: query, mode: 'insensitive' } },\n          { sku: { contains: query, mode: 'insensitive' } },\n          { tags: { hasSome: searchTerms } },\n        ],\n      };\n\n      if (categoryId) where.categoryId = categoryId;\n      if (minPrice !== undefined) where.basePrice = { ...where.basePrice, gte: minPrice };\n      if (maxPrice !== undefined) where.basePrice = { ...where.basePrice, lte: maxPrice };\n\n      const [products, total] = await Promise.all([\n        prisma.product.findMany({\n          where,\n          include: {\n            category: { select: { id: true, name: true, slug: true } },\n            images: { take: 1, orderBy: { order: 'asc' } },\n          },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.product.count({ where }),\n      ]);\n\n      return {\n        query,\n        results: products.map(p => ({\n          id: p.id,\n          name: p.name,\n          slug: p.slug,\n          description: p.shortDescription || p.description?.substring(0, 150),\n          price: p.basePrice,\n          compareAtPrice: p.compareAtPrice,\n          category: p.category,\n          image: p.images[0] || null,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n          hasNext: page * limit < total,\n          hasPrev: page > 1,\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET BY CATEGORY\n  // ============================================================================\n  {\n    name: 'product.getByCategory',\n    description: 'Get products by category with optional subcategory traversal',\n    category: 'product',\n    tags: ['product', 'category', 'catalog', 'storefront'],\n    icon: 'FolderTree',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        categoryId: {\n          type: 'string',\n          description: 'Category ID',\n        },\n        categorySlug: {\n          type: 'string',\n          description: 'Category slug (alternative to ID)',\n        },\n        includeSubcategories: {\n          type: 'boolean',\n          description: 'Include products from subcategories',\n          default: true,\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['name', 'price', 'createdAt', 'featured'],\n          default: 'createdAt',\n        },\n        sortOrder: {\n          type: 'string',\n          description: 'Sort direction',\n          enum: ['asc', 'desc'],\n          default: 'desc',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { categoryId, categorySlug, includeSubcategories = true, page = 1, limit = 20, sortBy = 'createdAt', sortOrder = 'desc' } = input;\n\n      if (!categoryId && !categorySlug) {\n        throw new Error('Either categoryId or categorySlug is required');\n      }\n\n      // Find category\n      const category = await prisma.productCategory.findFirst({\n        where: categoryId ? { id: categoryId } : { slug: categorySlug },\n        include: {\n          children: includeSubcategories ? { select: { id: true } } : false,\n        },\n      });\n\n      if (!category) {\n        throw new Error('Category not found');\n      }\n\n      // Build category IDs list\n      const categoryIds = [category.id];\n      if (includeSubcategories && category.children) {\n        categoryIds.push(...category.children.map(c => c.id));\n      }\n\n      const where = {\n        categoryId: { in: categoryIds },\n        status: 'ACTIVE',\n        deletedAt: null,\n      };\n\n      const [products, total] = await Promise.all([\n        prisma.product.findMany({\n          where,\n          include: {\n            category: { select: { id: true, name: true, slug: true } },\n            images: { take: 1, orderBy: { order: 'asc' } },\n          },\n          orderBy: sortBy === 'featured'\n            ? [{ featured: 'desc' }, { createdAt: 'desc' }]\n            : { [sortBy]: sortOrder },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.product.count({ where }),\n      ]);\n\n      return {\n        category: {\n          id: category.id,\n          name: category.name,\n          slug: category.slug,\n          description: category.description,\n        },\n        products: products.map(p => ({\n          id: p.id,\n          name: p.name,\n          slug: p.slug,\n          description: p.shortDescription,\n          price: p.basePrice,\n          compareAtPrice: p.compareAtPrice,\n          featured: p.featured,\n          category: p.category,\n          image: p.images[0] || null,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n          hasNext: page * limit < total,\n          hasPrev: page > 1,\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET VARIANTS\n  // ============================================================================\n  {\n    name: 'product.getVariants',\n    description: 'Get all variants for a product with pricing and stock info',\n    category: 'product',\n    tags: ['product', 'variants', 'catalog', 'storefront'],\n    icon: 'Layers',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        productSlug: {\n          type: 'string',\n          description: 'Product slug (alternative to ID)',\n        },\n        inStockOnly: {\n          type: 'boolean',\n          description: 'Only return variants in stock',\n          default: false,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { productId, productSlug, inStockOnly = false } = input;\n\n      if (!productId && !productSlug) {\n        throw new Error('Either productId or productSlug is required');\n      }\n\n      // Find product\n      const product = await prisma.product.findFirst({\n        where: productId\n          ? { id: productId, deletedAt: null }\n          : { slug: productSlug, deletedAt: null },\n        select: { id: true, name: true, slug: true, basePrice: true },\n      });\n\n      if (!product) {\n        throw new Error('Product not found');\n      }\n\n      const where = {\n        productId: product.id,\n        deletedAt: null,\n      };\n\n      if (inStockOnly) {\n        where.stock = { gt: 0 };\n      }\n\n      const variants = await prisma.productVariant.findMany({\n        where,\n        include: {\n          images: { orderBy: { order: 'asc' } },\n        },\n        orderBy: { order: 'asc' },\n      });\n\n      // Extract unique option types\n      const optionTypes = new Set();\n      variants.forEach(v => {\n        if (v.options && typeof v.options === 'object') {\n          Object.keys(v.options).forEach(k => optionTypes.add(k));\n        }\n      });\n\n      return {\n        product: {\n          id: product.id,\n          name: product.name,\n          slug: product.slug,\n          basePrice: product.basePrice,\n        },\n        variants: variants.map(v => ({\n          id: v.id,\n          name: v.name,\n          sku: v.sku,\n          price: v.price,\n          compareAtPrice: v.compareAtPrice,\n          stock: v.stock,\n          lowStockThreshold: v.lowStockThreshold,\n          inStock: v.stock > 0,\n          lowStock: v.stock > 0 && v.stock <= (v.lowStockThreshold || 5),\n          options: v.options,\n          images: v.images,\n          weight: v.weight,\n          dimensions: v.dimensions,\n        })),\n        optionTypes: Array.from(optionTypes),\n        totalVariants: variants.length,\n        inStockCount: variants.filter(v => v.stock > 0).length,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // CHECK STOCK\n  // ============================================================================\n  {\n    name: 'product.checkStock',\n    description: 'Check stock availability for a product or variant',\n    category: 'product',\n    tags: ['product', 'stock', 'inventory', 'storefront'],\n    icon: 'Package2',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        variantId: {\n          type: 'string',\n          description: 'Specific variant ID (optional)',\n        },\n        quantity: {\n          type: 'number',\n          description: 'Quantity to check availability for',\n          default: 1,\n          minimum: 1,\n        },\n      },\n      required: ['productId'],\n    },\n    handler: `\n      const { productId, variantId, quantity = 1 } = input;\n\n      if (variantId) {\n        // Check specific variant\n        const variant = await prisma.productVariant.findFirst({\n          where: { id: variantId, productId, deletedAt: null },\n          include: {\n            product: { select: { id: true, name: true, status: true } },\n          },\n        });\n\n        if (!variant) {\n          throw new Error('Variant not found');\n        }\n\n        if (variant.product.status !== 'ACTIVE') {\n          return {\n            available: false,\n            reason: 'Product is not available',\n            productId,\n            variantId,\n            requestedQuantity: quantity,\n          };\n        }\n\n        const available = variant.stock >= quantity;\n\n        return {\n          available,\n          reason: available ? null : 'Insufficient stock',\n          productId,\n          variantId,\n          variantName: variant.name,\n          sku: variant.sku,\n          requestedQuantity: quantity,\n          currentStock: variant.stock,\n          lowStock: variant.stock > 0 && variant.stock <= (variant.lowStockThreshold || 5),\n        };\n      } else {\n        // Check all variants for product\n        const product = await prisma.product.findFirst({\n          where: { id: productId, deletedAt: null },\n          include: {\n            variants: {\n              where: { deletedAt: null, stock: { gte: quantity } },\n              select: { id: true, name: true, sku: true, stock: true, price: true },\n            },\n          },\n        });\n\n        if (!product) {\n          throw new Error('Product not found');\n        }\n\n        if (product.status !== 'ACTIVE') {\n          return {\n            available: false,\n            reason: 'Product is not available',\n            productId,\n            requestedQuantity: quantity,\n            availableVariants: [],\n          };\n        }\n\n        return {\n          available: product.variants.length > 0,\n          reason: product.variants.length > 0 ? null : 'No variants with sufficient stock',\n          productId,\n          productName: product.name,\n          requestedQuantity: quantity,\n          availableVariants: product.variants.map(v => ({\n            id: v.id,\n            name: v.name,\n            sku: v.sku,\n            stock: v.stock,\n            price: v.price,\n          })),\n          totalAvailableVariants: product.variants.length,\n        };\n      }\n    `,\n  },\n\n  // ============================================================================\n  // GET CATEGORIES\n  // ============================================================================\n  {\n    name: 'product.getCategories',\n    description: 'Get product categories with optional hierarchy',\n    category: 'product',\n    tags: ['product', 'category', 'catalog', 'navigation'],\n    icon: 'FolderOpen',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        parentId: {\n          type: 'string',\n          description: 'Parent category ID (null for root categories)',\n        },\n        includeProductCount: {\n          type: 'boolean',\n          description: 'Include product count per category',\n          default: true,\n        },\n        includeChildren: {\n          type: 'boolean',\n          description: 'Include child categories',\n          default: true,\n        },\n        activeOnly: {\n          type: 'boolean',\n          description: 'Only return categories with active products',\n          default: false,\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { parentId, includeProductCount = true, includeChildren = true, activeOnly = false } = input;\n\n      const where = {};\n      if (parentId === null || parentId === undefined) {\n        where.parentId = null;\n      } else if (parentId) {\n        where.parentId = parentId;\n      }\n\n      const categories = await prisma.productCategory.findMany({\n        where,\n        include: {\n          children: includeChildren ? {\n            select: {\n              id: true,\n              name: true,\n              slug: true,\n              description: true,\n              image: true,\n              _count: includeProductCount ? {\n                select: { products: { where: { status: 'ACTIVE', deletedAt: null } } }\n              } : false,\n            },\n            orderBy: { order: 'asc' },\n          } : false,\n          _count: includeProductCount ? {\n            select: { products: { where: { status: 'ACTIVE', deletedAt: null } } }\n          } : false,\n        },\n        orderBy: { order: 'asc' },\n      });\n\n      let result = categories.map(c => ({\n        id: c.id,\n        name: c.name,\n        slug: c.slug,\n        description: c.description,\n        image: c.image,\n        productCount: c._count?.products || 0,\n        children: c.children?.map(child => ({\n          id: child.id,\n          name: child.name,\n          slug: child.slug,\n          description: child.description,\n          image: child.image,\n          productCount: child._count?.products || 0,\n        })) || [],\n      }));\n\n      if (activeOnly) {\n        result = result.filter(c => c.productCount > 0 || c.children.some(ch => ch.productCount > 0));\n      }\n\n      return {\n        categories: result,\n        total: result.length,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET FEATURED PRODUCTS\n  // ============================================================================\n  {\n    name: 'product.getFeatured',\n    description: 'Get featured products for homepage or promotional displays',\n    category: 'product',\n    tags: ['product', 'featured', 'homepage', 'storefront'],\n    icon: 'Star',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        limit: {\n          type: 'number',\n          description: 'Maximum number of products to return',\n          default: 8,\n          minimum: 1,\n          maximum: 24,\n        },\n        categoryId: {\n          type: 'string',\n          description: 'Filter by category',\n        },\n      },\n      required: [],\n    },\n    handler: `\n      const { limit = 8, categoryId } = input;\n\n      const where = {\n        featured: true,\n        status: 'ACTIVE',\n        deletedAt: null,\n      };\n\n      if (categoryId) {\n        where.categoryId = categoryId;\n      }\n\n      const products = await prisma.product.findMany({\n        where,\n        include: {\n          category: { select: { id: true, name: true, slug: true } },\n          images: { take: 1, orderBy: { order: 'asc' } },\n        },\n        orderBy: [{ updatedAt: 'desc' }],\n        take: limit,\n      });\n\n      return {\n        products: products.map(p => ({\n          id: p.id,\n          name: p.name,\n          slug: p.slug,\n          description: p.shortDescription,\n          price: p.basePrice,\n          compareAtPrice: p.compareAtPrice,\n          category: p.category,\n          image: p.images[0] || null,\n        })),\n        total: products.length,\n      };\n    `,\n  },\n];\n","/**\n * Review Primitives\n *\n * AI-callable primitives for product reviews and ratings.\n * Enables customers to leave reviews and store owners to manage them.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const REVIEW_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // CREATE REVIEW\n  // ============================================================================\n  {\n    name: 'review.create',\n    description: 'Create a new product review',\n    category: 'review',\n    tags: ['review', 'rating', 'feedback', 'storefront'],\n    icon: 'Star',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        orderId: {\n          type: 'string',\n          description: 'Order ID (for verified purchases)',\n        },\n        rating: {\n          type: 'number',\n          description: 'Rating (1-5)',\n          minimum: 1,\n          maximum: 5,\n        },\n        title: {\n          type: 'string',\n          description: 'Review title',\n          maxLength: 200,\n        },\n        content: {\n          type: 'string',\n          description: 'Review content',\n          maxLength: 5000,\n        },\n        pros: {\n          type: 'array',\n          description: 'List of pros',\n          items: { type: 'string' },\n        },\n        cons: {\n          type: 'array',\n          description: 'List of cons',\n          items: { type: 'string' },\n        },\n        images: {\n          type: 'array',\n          description: 'Image URLs',\n          items: { type: 'string' },\n        },\n      },\n      required: ['userId', 'productId', 'rating'],\n    },\n    handler: `\n      const { userId, productId, orderId, rating, title, content, pros, cons, images } = input;\n\n      // Verify product exists\n      const product = await prisma.product.findFirst({\n        where: { id: productId, deletedAt: null },\n      });\n\n      if (!product) {\n        throw new Error('Product not found');\n      }\n\n      // Check if user already reviewed this product\n      const existing = await prisma.productReview.findFirst({\n        where: { userId, productId },\n      });\n\n      if (existing) {\n        throw new Error('You have already reviewed this product');\n      }\n\n      // Check if verified purchase\n      let verifiedPurchase = false;\n      if (orderId) {\n        const order = await prisma.order.findFirst({\n          where: {\n            id: orderId,\n            userId,\n            items: { some: { productId } },\n            status: { in: ['DELIVERED', 'COMPLETED'] },\n          },\n        });\n        verifiedPurchase = !!order;\n      }\n\n      const review = await prisma.productReview.create({\n        data: {\n          userId,\n          productId,\n          orderId: orderId || null,\n          rating,\n          title: title || null,\n          content: content || null,\n          pros: pros || [],\n          cons: cons || [],\n          images: images || [],\n          verifiedPurchase,\n          status: 'PENDING', // Requires moderation\n        },\n      });\n\n      return {\n        id: review.id,\n        rating: review.rating,\n        title: review.title,\n        verifiedPurchase: review.verifiedPurchase,\n        status: review.status,\n        message: 'Review submitted for moderation',\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET PRODUCT REVIEWS\n  // ============================================================================\n  {\n    name: 'review.list',\n    description: 'Get reviews for a product',\n    category: 'review',\n    tags: ['review', 'rating', 'list', 'storefront'],\n    icon: 'MessageSquare',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 10,\n        },\n        sortBy: {\n          type: 'string',\n          description: 'Sort field',\n          enum: ['createdAt', 'rating', 'helpful'],\n          default: 'createdAt',\n        },\n        sortOrder: {\n          type: 'string',\n          description: 'Sort direction',\n          enum: ['asc', 'desc'],\n          default: 'desc',\n        },\n        rating: {\n          type: 'number',\n          description: 'Filter by specific rating',\n        },\n        verifiedOnly: {\n          type: 'boolean',\n          description: 'Only verified purchases',\n          default: false,\n        },\n      },\n      required: ['productId'],\n    },\n    handler: `\n      const { productId, page = 1, limit = 10, sortBy = 'createdAt', sortOrder = 'desc', rating, verifiedOnly = false } = input;\n\n      const where = {\n        productId,\n        status: 'APPROVED',\n      };\n\n      if (rating) where.rating = rating;\n      if (verifiedOnly) where.verifiedPurchase = true;\n\n      const orderBy = sortBy === 'helpful'\n        ? { helpfulCount: sortOrder }\n        : { [sortBy]: sortOrder };\n\n      const [reviews, total, stats] = await Promise.all([\n        prisma.productReview.findMany({\n          where,\n          include: {\n            user: { select: { id: true, name: true } },\n            _count: { select: { votes: true } },\n          },\n          orderBy,\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.productReview.count({ where }),\n        prisma.productReview.aggregate({\n          where: { productId, status: 'APPROVED' },\n          _avg: { rating: true },\n          _count: { rating: true },\n        }),\n      ]);\n\n      // Get rating distribution\n      const distribution = await prisma.productReview.groupBy({\n        by: ['rating'],\n        where: { productId, status: 'APPROVED' },\n        _count: { rating: true },\n      });\n\n      const ratingDist = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };\n      distribution.forEach(d => { ratingDist[d.rating] = d._count.rating; });\n\n      return {\n        reviews: reviews.map(r => ({\n          id: r.id,\n          rating: r.rating,\n          title: r.title,\n          content: r.content,\n          pros: r.pros,\n          cons: r.cons,\n          images: r.images,\n          author: r.user?.name || 'Anonymous',\n          verifiedPurchase: r.verifiedPurchase,\n          helpfulCount: r.helpfulCount,\n          response: r.response,\n          createdAt: r.createdAt,\n        })),\n        summary: {\n          averageRating: stats._avg.rating || 0,\n          totalReviews: stats._count.rating || 0,\n          distribution: ratingDist,\n        },\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET SINGLE REVIEW\n  // ============================================================================\n  {\n    name: 'review.get',\n    description: 'Get a single review by ID',\n    category: 'review',\n    tags: ['review', 'rating', 'detail'],\n    icon: 'FileText',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        reviewId: {\n          type: 'string',\n          description: 'Review ID',\n        },\n      },\n      required: ['reviewId'],\n    },\n    handler: `\n      const { reviewId } = input;\n\n      const review = await prisma.productReview.findFirst({\n        where: { id: reviewId },\n        include: {\n          user: { select: { id: true, name: true } },\n          product: { select: { id: true, name: true, slug: true } },\n        },\n      });\n\n      if (!review) {\n        throw new Error('Review not found');\n      }\n\n      return {\n        id: review.id,\n        rating: review.rating,\n        title: review.title,\n        content: review.content,\n        pros: review.pros,\n        cons: review.cons,\n        images: review.images,\n        author: review.user?.name || 'Anonymous',\n        authorId: review.userId,\n        product: review.product,\n        verifiedPurchase: review.verifiedPurchase,\n        helpfulCount: review.helpfulCount,\n        response: review.response,\n        respondedAt: review.respondedAt,\n        status: review.status,\n        createdAt: review.createdAt,\n        updatedAt: review.updatedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // VOTE REVIEW\n  // ============================================================================\n  {\n    name: 'review.vote',\n    description: 'Mark a review as helpful or not helpful',\n    category: 'review',\n    tags: ['review', 'vote', 'helpful', 'feedback'],\n    icon: 'ThumbsUp',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        reviewId: {\n          type: 'string',\n          description: 'Review ID',\n        },\n        userId: {\n          type: 'string',\n          description: 'Voter user ID',\n        },\n        helpful: {\n          type: 'boolean',\n          description: 'Is this review helpful?',\n        },\n      },\n      required: ['reviewId', 'userId', 'helpful'],\n    },\n    handler: `\n      const { reviewId, userId, helpful } = input;\n\n      const review = await prisma.productReview.findFirst({\n        where: { id: reviewId, status: 'APPROVED' },\n      });\n\n      if (!review) {\n        throw new Error('Review not found');\n      }\n\n      // Upsert vote\n      const existingVote = await prisma.reviewVote.findUnique({\n        where: { reviewId_oderId: { reviewId, oderId: oderId } },\n      });\n\n      if (existingVote) {\n        if (existingVote.helpful === helpful) {\n          // Remove vote if same\n          await prisma.reviewVote.delete({\n            where: { id: existingVote.id },\n          });\n\n          // Update helpful count\n          await prisma.productReview.update({\n            where: { id: reviewId },\n            data: { helpfulCount: { decrement: helpful ? 1 : 0 } },\n          });\n\n          return { voted: false, removed: true, reviewId };\n        } else {\n          // Change vote\n          await prisma.reviewVote.update({\n            where: { id: existingVote.id },\n            data: { helpful },\n          });\n\n          await prisma.productReview.update({\n            where: { id: reviewId },\n            data: { helpfulCount: { increment: helpful ? 1 : -1 } },\n          });\n\n          return { voted: true, helpful, changed: true, reviewId };\n        }\n      } else {\n        await prisma.reviewVote.create({\n          data: { reviewId, oderId: oderId, helpful },\n        });\n\n        if (helpful) {\n          await prisma.productReview.update({\n            where: { id: reviewId },\n            data: { helpfulCount: { increment: 1 } },\n          });\n        }\n\n        return { voted: true, helpful, reviewId };\n      }\n    `,\n  },\n\n  // ============================================================================\n  // RESPOND TO REVIEW\n  // ============================================================================\n  {\n    name: 'review.respond',\n    description: 'Store owner response to a review',\n    category: 'review',\n    tags: ['review', 'response', 'admin'],\n    icon: 'Reply',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        reviewId: {\n          type: 'string',\n          description: 'Review ID',\n        },\n        response: {\n          type: 'string',\n          description: 'Response text',\n          maxLength: 2000,\n        },\n      },\n      required: ['reviewId', 'response'],\n    },\n    handler: `\n      const { reviewId, response } = input;\n\n      const review = await prisma.productReview.findFirst({\n        where: { id: reviewId },\n      });\n\n      if (!review) {\n        throw new Error('Review not found');\n      }\n\n      const updated = await prisma.productReview.update({\n        where: { id: reviewId },\n        data: {\n          response,\n          respondedAt: new Date(),\n        },\n      });\n\n      return {\n        id: updated.id,\n        response: updated.response,\n        respondedAt: updated.respondedAt,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET PRODUCT RATING\n  // ============================================================================\n  {\n    name: 'review.getProductRating',\n    description: 'Get aggregate rating for a product',\n    category: 'review',\n    tags: ['review', 'rating', 'aggregate', 'storefront'],\n    icon: 'BarChart',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n      },\n      required: ['productId'],\n    },\n    handler: `\n      const { productId } = input;\n\n      const stats = await prisma.productReview.aggregate({\n        where: { productId, status: 'APPROVED' },\n        _avg: { rating: true },\n        _count: { rating: true },\n      });\n\n      const distribution = await prisma.productReview.groupBy({\n        by: ['rating'],\n        where: { productId, status: 'APPROVED' },\n        _count: { rating: true },\n      });\n\n      const ratingDist = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };\n      distribution.forEach(d => { ratingDist[d.rating] = d._count.rating; });\n\n      return {\n        productId,\n        averageRating: Math.round((stats._avg.rating || 0) * 10) / 10,\n        totalReviews: stats._count.rating || 0,\n        distribution: ratingDist,\n        hasReviews: stats._count.rating > 0,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET USER REVIEWS\n  // ============================================================================\n  {\n    name: 'review.getUserReviews',\n    description: 'Get all reviews by a user',\n    category: 'review',\n    tags: ['review', 'user', 'history'],\n    icon: 'User',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 10,\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, page = 1, limit = 10 } = input;\n\n      const [reviews, total] = await Promise.all([\n        prisma.productReview.findMany({\n          where: { userId },\n          include: {\n            product: {\n              select: {\n                id: true,\n                name: true,\n                slug: true,\n                images: { take: 1, orderBy: { order: 'asc' } },\n              },\n            },\n          },\n          orderBy: { createdAt: 'desc' },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.productReview.count({ where: { userId } }),\n      ]);\n\n      return {\n        reviews: reviews.map(r => ({\n          id: r.id,\n          rating: r.rating,\n          title: r.title,\n          content: r.content,\n          status: r.status,\n          helpfulCount: r.helpfulCount,\n          product: {\n            id: r.product.id,\n            name: r.product.name,\n            slug: r.product.slug,\n            image: r.product.images[0] || null,\n          },\n          createdAt: r.createdAt,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n];\n","/**\n * Shipping Primitives\n *\n * Primitives for shipping operations: rates, labels, tracking, and address validation.\n * Uses Shippo integration from src/lib/shippo/\n */\n\nimport type { CreatePrimitiveRequest } from '../types';\n\nexport const SHIPPING_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // SHIPPING PRIMITIVES\n  // ============================================================================\n  {\n    name: 'shipping.getRates',\n    description: 'Get shipping rates from multiple carriers (USPS, UPS, FedEx) for a shipment. Compares prices and delivery times.',\n    category: 'shipping',\n    tags: ['shipping', 'rates', 'carriers', 'shippo'],\n    icon: 'Truck',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        addressFrom: {\n          type: 'object',\n          description: 'Ship-from address (optional, uses default if not provided)',\n          properties: {\n            name: { type: 'string' },\n            company: { type: 'string' },\n            street1: { type: 'string' },\n            street2: { type: 'string' },\n            city: { type: 'string' },\n            state: { type: 'string' },\n            zip: { type: 'string' },\n            country: { type: 'string' },\n            phone: { type: 'string' },\n            email: { type: 'string' },\n          },\n        },\n        addressTo: {\n          type: 'object',\n          description: 'Ship-to address (required)',\n          properties: {\n            name: { type: 'string' },\n            company: { type: 'string' },\n            street1: { type: 'string' },\n            street2: { type: 'string' },\n            city: { type: 'string' },\n            state: { type: 'string' },\n            zip: { type: 'string' },\n            country: { type: 'string' },\n            phone: { type: 'string' },\n            email: { type: 'string' },\n          },\n          required: ['name', 'street1', 'city', 'state', 'zip', 'country'],\n        },\n        parcels: {\n          type: 'array',\n          description: 'Package dimensions and weight',\n          items: {\n            type: 'object',\n            properties: {\n              length: { type: 'number', description: 'Length in inches' },\n              width: { type: 'number', description: 'Width in inches' },\n              height: { type: 'number', description: 'Height in inches' },\n              weight: { type: 'number', description: 'Weight in ounces' },\n              massUnit: { type: 'string', default: 'oz' },\n              distanceUnit: { type: 'string', default: 'in' },\n            },\n            required: ['length', 'width', 'height', 'weight'],\n          },\n        },\n        signature: {\n          type: 'boolean',\n          description: 'Require signature confirmation',\n        },\n        insurance: {\n          type: 'object',\n          description: 'Insurance options',\n          properties: {\n            amount: { type: 'string' },\n            currency: { type: 'string', default: 'USD' },\n            content: { type: 'string' },\n          },\n        },\n      },\n      required: ['addressTo', 'parcels'],\n    },\n    handler: `\n      const { createShipment, getDefaultFromAddress } = await import('../../shippo');\n\n      // Use default from address if not provided\n      const addressFrom = args.addressFrom || await getDefaultFromAddress();\n\n      const shipment = await createShipment({\n        addressFrom,\n        addressTo: args.addressTo,\n        parcels: args.parcels,\n        extra: {\n          signature: args.signature,\n          insurance: args.insurance,\n        },\n      });\n\n      return {\n        success: true,\n        shipmentId: shipment.shipmentId,\n        rates: shipment.rates.map(rate => ({\n          rateId: rate.rateId,\n          carrier: rate.carrier,\n          service: rate.servicelevel.name,\n          price: parseFloat(rate.amount),\n          currency: rate.currency,\n          estimatedDays: rate.estimatedDays,\n          deliveryTerms: rate.durationTerms,\n        })),\n        cheapest: shipment.rates[0] ? {\n          carrier: shipment.rates[0].carrier,\n          service: shipment.rates[0].servicelevel.name,\n          price: parseFloat(shipment.rates[0].amount),\n        } : null,\n      };\n    `,\n  },\n  {\n    name: 'shipping.createLabel',\n    description: 'Purchase a shipping label for a selected rate. Returns label URL, tracking number, and tracking URL.',\n    category: 'shipping',\n    tags: ['shipping', 'label', 'purchase', 'shippo'],\n    icon: 'Tag',\n    timeout: 30000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        rateId: {\n          type: 'string',\n          description: 'Rate ID from shipping.getRates',\n        },\n        labelFormat: {\n          type: 'string',\n          description: 'Label format',\n          enum: ['PDF', 'PDF_4x6', 'PNG', 'ZPLII'],\n          default: 'PDF',\n        },\n        orderId: {\n          type: 'string',\n          description: 'Order ID to associate with this shipment',\n        },\n      },\n      required: ['rateId'],\n    },\n    handler: `\n      const { purchaseLabel } = await import('../../shippo');\n      const { prisma } = await import('../../db');\n\n      const label = await purchaseLabel({\n        rateId: args.rateId,\n        labelFormat: args.labelFormat || 'PDF',\n      });\n\n      // Create shipment record if order ID provided\n      if (args.orderId && label.status === 'SUCCESS') {\n        await prisma.shipment.create({\n          data: {\n            orderId: args.orderId,\n            carrier: label.rate.carrier,\n            service: label.rate.servicelevel.name,\n            trackingNumber: label.trackingNumber,\n            trackingUrl: label.trackingUrl,\n            labelUrl: label.labelUrl,\n            status: 'LABEL_CREATED',\n          },\n        });\n      }\n\n      return {\n        success: label.status === 'SUCCESS',\n        transactionId: label.transactionId,\n        trackingNumber: label.trackingNumber,\n        trackingUrl: label.trackingUrl,\n        labelUrl: label.labelUrl,\n        carrier: label.rate.carrier,\n        service: label.rate.servicelevel.name,\n        eta: label.eta,\n        messages: label.messages,\n      };\n    `,\n  },\n  {\n    name: 'shipping.getTracking',\n    description: 'Get tracking status and history for a shipment by tracking number.',\n    category: 'shipping',\n    tags: ['shipping', 'tracking', 'status', 'shippo'],\n    icon: 'MapPin',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        carrier: {\n          type: 'string',\n          description: 'Carrier name',\n          enum: ['usps', 'ups', 'fedex', 'dhl_express'],\n        },\n        trackingNumber: {\n          type: 'string',\n          description: 'Tracking number',\n        },\n      },\n      required: ['carrier', 'trackingNumber'],\n    },\n    handler: `\n      const { getTracking } = await import('../../shippo');\n\n      const tracking = await getTracking(args.carrier, args.trackingNumber);\n\n      return {\n        success: true,\n        carrier: tracking.carrier,\n        trackingNumber: tracking.trackingNumber,\n        eta: tracking.eta,\n        currentStatus: {\n          status: tracking.trackingStatus.status,\n          details: tracking.trackingStatus.statusDetails,\n          date: tracking.trackingStatus.statusDate,\n          location: tracking.trackingStatus.location,\n        },\n        isDelivered: tracking.trackingStatus.status === 'DELIVERED',\n        history: tracking.trackingHistory.map(event => ({\n          status: event.status,\n          details: event.statusDetails,\n          date: event.statusDate,\n          location: event.location,\n        })),\n      };\n    `,\n  },\n  {\n    name: 'shipping.validateAddress',\n    description: 'Validate and standardize a shipping address. Returns corrected address and validation messages.',\n    category: 'shipping',\n    tags: ['shipping', 'address', 'validation', 'shippo'],\n    icon: 'CheckCircle',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'Recipient name',\n        },\n        company: {\n          type: 'string',\n          description: 'Company name (optional)',\n        },\n        street1: {\n          type: 'string',\n          description: 'Street address line 1',\n        },\n        street2: {\n          type: 'string',\n          description: 'Street address line 2 (optional)',\n        },\n        city: {\n          type: 'string',\n          description: 'City',\n        },\n        state: {\n          type: 'string',\n          description: 'State/Province code',\n        },\n        zip: {\n          type: 'string',\n          description: 'Postal/ZIP code',\n        },\n        country: {\n          type: 'string',\n          description: 'Country code (e.g., US, CA)',\n          default: 'US',\n        },\n        phone: {\n          type: 'string',\n          description: 'Phone number',\n        },\n        email: {\n          type: 'string',\n          description: 'Email address',\n        },\n      },\n      required: ['name', 'street1', 'city', 'state', 'zip'],\n    },\n    handler: `\n      const { validateAddress } = await import('../../shippo');\n\n      const result = await validateAddress({\n        name: args.name,\n        company: args.company,\n        street1: args.street1,\n        street2: args.street2,\n        city: args.city,\n        state: args.state,\n        zip: args.zip,\n        country: args.country || 'US',\n        phone: args.phone,\n        email: args.email,\n      });\n\n      return {\n        success: true,\n        isValid: result.isValid,\n        address: {\n          name: result.name,\n          company: result.company,\n          street1: result.street1,\n          street2: result.street2,\n          city: result.city,\n          state: result.state,\n          zip: result.zip,\n          country: result.country,\n        },\n        messages: result.messages,\n        hasWarnings: result.messages?.some(m => m.type === 'warning') || false,\n        hasErrors: result.messages?.some(m => m.type === 'error') || false,\n      };\n    `,\n  },\n  {\n    name: 'shipping.refundLabel',\n    description: 'Request a refund for a purchased shipping label.',\n    category: 'shipping',\n    tags: ['shipping', 'refund', 'label', 'shippo'],\n    icon: 'RotateCcw',\n    timeout: 15000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        transactionId: {\n          type: 'string',\n          description: 'Transaction ID from label purchase',\n        },\n        shipmentId: {\n          type: 'string',\n          description: 'Optional: Database shipment ID to update',\n        },\n      },\n      required: ['transactionId'],\n    },\n    handler: `\n      const { refundLabel } = await import('../../shippo');\n      const { prisma } = await import('../../db');\n\n      const refund = await refundLabel(args.transactionId);\n\n      // Update shipment record if ID provided\n      if (args.shipmentId && refund.status !== 'ERROR') {\n        await prisma.shipment.update({\n          where: { id: args.shipmentId },\n          data: { status: 'REFUND_PENDING' },\n        });\n      }\n\n      return {\n        success: refund.status !== 'ERROR',\n        transactionId: refund.transactionId,\n        status: refund.status,\n      };\n    `,\n  },\n];\n","/**\n * Wishlist Primitives\n *\n * AI-callable primitives for wishlist/favorites functionality.\n * Enables customers to save products for later.\n */\n\nimport { CreatePrimitiveRequest } from '../types';\n\nexport const WISHLIST_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // GET WISHLIST\n  // ============================================================================\n  {\n    name: 'wishlist.get',\n    description: 'Get user wishlist with products',\n    category: 'wishlist',\n    tags: ['wishlist', 'favorites', 'customer', 'storefront'],\n    icon: 'Heart',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        wishlistId: {\n          type: 'string',\n          description: 'Specific wishlist ID (users can have multiple)',\n        },\n        page: {\n          type: 'number',\n          description: 'Page number',\n          default: 1,\n        },\n        limit: {\n          type: 'number',\n          description: 'Items per page',\n          default: 20,\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, wishlistId, page = 1, limit = 20 } = input;\n\n      // Get or create default wishlist\n      let wishlist;\n      if (wishlistId) {\n        wishlist = await prisma.wishlist.findFirst({\n          where: { id: wishlistId, userId },\n        });\n      } else {\n        wishlist = await prisma.wishlist.findFirst({\n          where: { userId, isDefault: true },\n        });\n\n        if (!wishlist) {\n          wishlist = await prisma.wishlist.create({\n            data: {\n              userId,\n              name: 'My Wishlist',\n              isDefault: true,\n            },\n          });\n        }\n      }\n\n      if (!wishlist) {\n        throw new Error('Wishlist not found');\n      }\n\n      const [items, total] = await Promise.all([\n        prisma.wishlistItem.findMany({\n          where: { wishlistId: wishlist.id },\n          include: {\n            product: {\n              include: {\n                images: { take: 1, orderBy: { order: 'asc' } },\n                variants: {\n                  where: { deletedAt: null },\n                  select: { id: true, price: true, stock: true },\n                  take: 1,\n                },\n              },\n            },\n            variant: {\n              select: { id: true, name: true, price: true, stock: true, options: true },\n            },\n          },\n          orderBy: { createdAt: 'desc' },\n          skip: (page - 1) * limit,\n          take: limit,\n        }),\n        prisma.wishlistItem.count({ where: { wishlistId: wishlist.id } }),\n      ]);\n\n      return {\n        id: wishlist.id,\n        name: wishlist.name,\n        isDefault: wishlist.isDefault,\n        isPublic: wishlist.isPublic,\n        shareToken: wishlist.isPublic ? wishlist.shareToken : null,\n        items: items.map(i => ({\n          id: i.id,\n          addedAt: i.createdAt,\n          note: i.note,\n          product: {\n            id: i.product.id,\n            name: i.product.name,\n            slug: i.product.slug,\n            price: i.variant?.price || i.product.basePrice,\n            compareAtPrice: i.product.compareAtPrice,\n            image: i.product.images[0] || null,\n            inStock: i.variant ? i.variant.stock > 0 : i.product.variants[0]?.stock > 0,\n            status: i.product.status,\n          },\n          variant: i.variant,\n        })),\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages: Math.ceil(total / limit),\n        },\n      };\n    `,\n  },\n\n  // ============================================================================\n  // ADD TO WISHLIST\n  // ============================================================================\n  {\n    name: 'wishlist.add',\n    description: 'Add a product to wishlist',\n    category: 'wishlist',\n    tags: ['wishlist', 'favorites', 'add', 'storefront'],\n    icon: 'HeartPlus',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        variantId: {\n          type: 'string',\n          description: 'Specific variant ID (optional)',\n        },\n        wishlistId: {\n          type: 'string',\n          description: 'Target wishlist ID (uses default if not specified)',\n        },\n        note: {\n          type: 'string',\n          description: 'Optional note',\n        },\n      },\n      required: ['userId', 'productId'],\n    },\n    handler: `\n      const { userId, productId, variantId, wishlistId, note } = input;\n\n      // Verify product exists\n      const product = await prisma.product.findFirst({\n        where: { id: productId, deletedAt: null },\n      });\n\n      if (!product) {\n        throw new Error('Product not found');\n      }\n\n      // Get or create wishlist\n      let wishlist;\n      if (wishlistId) {\n        wishlist = await prisma.wishlist.findFirst({\n          where: { id: wishlistId, userId },\n        });\n      } else {\n        wishlist = await prisma.wishlist.findFirst({\n          where: { userId, isDefault: true },\n        });\n\n        if (!wishlist) {\n          wishlist = await prisma.wishlist.create({\n            data: { userId, name: 'My Wishlist', isDefault: true },\n          });\n        }\n      }\n\n      if (!wishlist) {\n        throw new Error('Wishlist not found');\n      }\n\n      // Check if already in wishlist\n      const existing = await prisma.wishlistItem.findFirst({\n        where: {\n          wishlistId: wishlist.id,\n          productId,\n          variantId: variantId || null,\n        },\n      });\n\n      if (existing) {\n        return {\n          added: false,\n          alreadyExists: true,\n          itemId: existing.id,\n          wishlistId: wishlist.id,\n        };\n      }\n\n      const item = await prisma.wishlistItem.create({\n        data: {\n          wishlistId: wishlist.id,\n          productId,\n          variantId: variantId || null,\n          note: note || null,\n        },\n      });\n\n      return {\n        added: true,\n        itemId: item.id,\n        wishlistId: wishlist.id,\n        productId,\n        variantId,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // REMOVE FROM WISHLIST\n  // ============================================================================\n  {\n    name: 'wishlist.remove',\n    description: 'Remove a product from wishlist',\n    category: 'wishlist',\n    tags: ['wishlist', 'favorites', 'remove', 'storefront'],\n    icon: 'HeartOff',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        itemId: {\n          type: 'string',\n          description: 'Wishlist item ID',\n        },\n        productId: {\n          type: 'string',\n          description: 'Product ID (alternative to itemId)',\n        },\n        variantId: {\n          type: 'string',\n          description: 'Variant ID (when using productId)',\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, itemId, productId, variantId } = input;\n\n      if (!itemId && !productId) {\n        throw new Error('Either itemId or productId is required');\n      }\n\n      let item;\n\n      if (itemId) {\n        item = await prisma.wishlistItem.findFirst({\n          where: { id: itemId },\n          include: { wishlist: true },\n        });\n\n        if (!item || item.wishlist.userId !== userId) {\n          throw new Error('Item not found');\n        }\n      } else {\n        // Find by product in user's default wishlist\n        const wishlist = await prisma.wishlist.findFirst({\n          where: { userId, isDefault: true },\n        });\n\n        if (wishlist) {\n          item = await prisma.wishlistItem.findFirst({\n            where: {\n              wishlistId: wishlist.id,\n              productId,\n              variantId: variantId || null,\n            },\n          });\n        }\n\n        if (!item) {\n          return { removed: false, notFound: true };\n        }\n      }\n\n      await prisma.wishlistItem.delete({ where: { id: item.id } });\n\n      return {\n        removed: true,\n        itemId: item.id,\n        productId: item.productId,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // TOGGLE WISHLIST\n  // ============================================================================\n  {\n    name: 'wishlist.toggle',\n    description: 'Toggle product in wishlist (add if not present, remove if present)',\n    category: 'wishlist',\n    tags: ['wishlist', 'favorites', 'toggle', 'storefront'],\n    icon: 'Heart',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        productId: {\n          type: 'string',\n          description: 'Product ID',\n        },\n        variantId: {\n          type: 'string',\n          description: 'Variant ID (optional)',\n        },\n      },\n      required: ['userId', 'productId'],\n    },\n    handler: `\n      const { userId, productId, variantId } = input;\n\n      // Get or create default wishlist\n      let wishlist = await prisma.wishlist.findFirst({\n        where: { userId, isDefault: true },\n      });\n\n      if (!wishlist) {\n        wishlist = await prisma.wishlist.create({\n          data: { userId, name: 'My Wishlist', isDefault: true },\n        });\n      }\n\n      // Check if exists\n      const existing = await prisma.wishlistItem.findFirst({\n        where: {\n          wishlistId: wishlist.id,\n          productId,\n          variantId: variantId || null,\n        },\n      });\n\n      if (existing) {\n        await prisma.wishlistItem.delete({ where: { id: existing.id } });\n        return {\n          action: 'removed',\n          inWishlist: false,\n          productId,\n          variantId,\n        };\n      } else {\n        const item = await prisma.wishlistItem.create({\n          data: {\n            wishlistId: wishlist.id,\n            productId,\n            variantId: variantId || null,\n          },\n        });\n        return {\n          action: 'added',\n          inWishlist: true,\n          itemId: item.id,\n          productId,\n          variantId,\n        };\n      }\n    `,\n  },\n\n  // ============================================================================\n  // CHECK WISHLIST STATUS\n  // ============================================================================\n  {\n    name: 'wishlist.check',\n    description: 'Check if product(s) are in wishlist',\n    category: 'wishlist',\n    tags: ['wishlist', 'favorites', 'check', 'storefront'],\n    icon: 'HeartPulse',\n    timeout: 3000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        productIds: {\n          type: 'array',\n          description: 'Product IDs to check',\n          items: { type: 'string' },\n        },\n      },\n      required: ['userId', 'productIds'],\n    },\n    handler: `\n      const { userId, productIds } = input;\n\n      const wishlist = await prisma.wishlist.findFirst({\n        where: { userId, isDefault: true },\n      });\n\n      if (!wishlist) {\n        return {\n          items: productIds.map(id => ({ productId: id, inWishlist: false })),\n        };\n      }\n\n      const items = await prisma.wishlistItem.findMany({\n        where: {\n          wishlistId: wishlist.id,\n          productId: { in: productIds },\n        },\n        select: { productId: true, variantId: true, id: true },\n      });\n\n      const itemMap = new Map(items.map(i => [i.productId, i]));\n\n      return {\n        items: productIds.map(id => ({\n          productId: id,\n          inWishlist: itemMap.has(id),\n          itemId: itemMap.get(id)?.id,\n          variantId: itemMap.get(id)?.variantId,\n        })),\n      };\n    `,\n  },\n\n  // ============================================================================\n  // SHARE WISHLIST\n  // ============================================================================\n  {\n    name: 'wishlist.share',\n    description: 'Generate a shareable link for wishlist',\n    category: 'wishlist',\n    tags: ['wishlist', 'share', 'social'],\n    icon: 'Share2',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        userId: {\n          type: 'string',\n          description: 'User ID',\n        },\n        wishlistId: {\n          type: 'string',\n          description: 'Wishlist ID',\n        },\n        makePublic: {\n          type: 'boolean',\n          description: 'Make wishlist public',\n          default: true,\n        },\n      },\n      required: ['userId'],\n    },\n    handler: `\n      const { userId, wishlistId, makePublic = true } = input;\n\n      let wishlist;\n      if (wishlistId) {\n        wishlist = await prisma.wishlist.findFirst({\n          where: { id: wishlistId, userId },\n        });\n      } else {\n        wishlist = await prisma.wishlist.findFirst({\n          where: { userId, isDefault: true },\n        });\n      }\n\n      if (!wishlist) {\n        throw new Error('Wishlist not found');\n      }\n\n      // Generate share token if needed\n      let shareToken = wishlist.shareToken;\n      if (!shareToken && makePublic) {\n        shareToken = Math.random().toString(36).substring(2) + Date.now().toString(36);\n      }\n\n      const updated = await prisma.wishlist.update({\n        where: { id: wishlist.id },\n        data: {\n          isPublic: makePublic,\n          shareToken: makePublic ? shareToken : null,\n        },\n      });\n\n      return {\n        wishlistId: updated.id,\n        isPublic: updated.isPublic,\n        shareToken: updated.shareToken,\n        shareUrl: updated.isPublic ? '/wishlist/shared/' + updated.shareToken : null,\n      };\n    `,\n  },\n\n  // ============================================================================\n  // GET SHARED WISHLIST\n  // ============================================================================\n  {\n    name: 'wishlist.getShared',\n    description: 'Get a publicly shared wishlist',\n    category: 'wishlist',\n    tags: ['wishlist', 'share', 'public'],\n    icon: 'ExternalLink',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        shareToken: {\n          type: 'string',\n          description: 'Share token from URL',\n        },\n      },\n      required: ['shareToken'],\n    },\n    handler: `\n      const { shareToken } = input;\n\n      const wishlist = await prisma.wishlist.findFirst({\n        where: { shareToken, isPublic: true },\n        include: {\n          user: { select: { name: true } },\n          items: {\n            include: {\n              product: {\n                include: {\n                  images: { take: 1, orderBy: { order: 'asc' } },\n                },\n              },\n              variant: { select: { name: true, price: true } },\n            },\n            orderBy: { createdAt: 'desc' },\n          },\n        },\n      });\n\n      if (!wishlist) {\n        throw new Error('Wishlist not found or not public');\n      }\n\n      return {\n        id: wishlist.id,\n        name: wishlist.name,\n        ownerName: wishlist.user?.name || 'Anonymous',\n        items: wishlist.items.map(i => ({\n          product: {\n            id: i.product.id,\n            name: i.product.name,\n            slug: i.product.slug,\n            price: i.variant?.price || i.product.basePrice,\n            image: i.product.images[0] || null,\n          },\n          variant: i.variant,\n          note: i.note,\n        })),\n        itemCount: wishlist.items.length,\n      };\n    `,\n  },\n];\n","/**\n * Domain Primitives Index\n *\n * Aggregates all domain-specific primitive definitions.\n * Each domain file exports a *_PRIMITIVES array.\n */\n\n// Core e-commerce primitives\nexport { AI_PRIMITIVES } from './ai';\nexport { ANALYTICS_PRIMITIVES } from './analytics';\nexport { BLOG_PRIMITIVES } from './blog';\nexport { CART_PRIMITIVES } from './cart';\nexport { CUSTOMER_PRIMITIVES } from './customer';\nexport { DISCOUNT_PRIMITIVES } from './discount';\nexport { EMAIL_PRIMITIVES } from './email';\nexport { GIFTCARD_PRIMITIVES } from './giftcard';\nexport { MEDIA_PRIMITIVES } from './media';\nexport { NOTIFICATION_PRIMITIVES } from './notification';\nexport { ORDER_PRIMITIVES } from './order';\nexport { PAYMENT_PRIMITIVES } from './payment';\nexport { PRODUCT_PRIMITIVES } from './product';\nexport { REVIEW_PRIMITIVES } from './review';\nexport { SHIPPING_PRIMITIVES } from './shipping';\nexport { WISHLIST_PRIMITIVES } from './wishlist';\n\n// Import all for aggregation\nimport { AI_PRIMITIVES } from './ai';\nimport { ANALYTICS_PRIMITIVES } from './analytics';\nimport { BLOG_PRIMITIVES } from './blog';\nimport { CART_PRIMITIVES } from './cart';\nimport { CUSTOMER_PRIMITIVES } from './customer';\nimport { DISCOUNT_PRIMITIVES } from './discount';\nimport { EMAIL_PRIMITIVES } from './email';\nimport { GIFTCARD_PRIMITIVES } from './giftcard';\nimport { MEDIA_PRIMITIVES } from './media';\nimport { NOTIFICATION_PRIMITIVES } from './notification';\nimport { ORDER_PRIMITIVES } from './order';\nimport { PAYMENT_PRIMITIVES } from './payment';\nimport { PRODUCT_PRIMITIVES } from './product';\nimport { REVIEW_PRIMITIVES } from './review';\nimport { SHIPPING_PRIMITIVES } from './shipping';\nimport { WISHLIST_PRIMITIVES } from './wishlist';\n\nimport type { CreatePrimitiveRequest } from '../types';\n\n/**\n * All domain primitives combined\n */\nexport const DOMAIN_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  ...AI_PRIMITIVES,\n  ...ANALYTICS_PRIMITIVES,\n  ...BLOG_PRIMITIVES,\n  ...CART_PRIMITIVES,\n  ...CUSTOMER_PRIMITIVES,\n  ...DISCOUNT_PRIMITIVES,\n  ...EMAIL_PRIMITIVES,\n  ...GIFTCARD_PRIMITIVES,\n  ...MEDIA_PRIMITIVES,\n  ...NOTIFICATION_PRIMITIVES,\n  ...ORDER_PRIMITIVES,\n  ...PAYMENT_PRIMITIVES,\n  ...PRODUCT_PRIMITIVES,\n  ...REVIEW_PRIMITIVES,\n  ...SHIPPING_PRIMITIVES,\n  ...WISHLIST_PRIMITIVES,\n];\n\n/**\n * Get primitives by category/domain\n */\nexport function getPrimitivesByDomain(domain: string): Array<CreatePrimitiveRequest & { builtIn: true }> {\n  switch (domain) {\n    case 'ai':\n      return AI_PRIMITIVES;\n    case 'analytics':\n      return ANALYTICS_PRIMITIVES;\n    case 'blog':\n      return BLOG_PRIMITIVES;\n    case 'cart':\n      return CART_PRIMITIVES;\n    case 'customer':\n      return CUSTOMER_PRIMITIVES;\n    case 'discount':\n      return DISCOUNT_PRIMITIVES;\n    case 'email':\n      return EMAIL_PRIMITIVES;\n    case 'giftcard':\n      return GIFTCARD_PRIMITIVES;\n    case 'media':\n      return MEDIA_PRIMITIVES;\n    case 'notification':\n      return NOTIFICATION_PRIMITIVES;\n    case 'order':\n      return ORDER_PRIMITIVES;\n    case 'payment':\n      return PAYMENT_PRIMITIVES;\n    case 'product':\n      return PRODUCT_PRIMITIVES;\n    case 'review':\n      return REVIEW_PRIMITIVES;\n    case 'shipping':\n      return SHIPPING_PRIMITIVES;\n    case 'wishlist':\n      return WISHLIST_PRIMITIVES;\n    default:\n      return [];\n  }\n}\n\n/**\n * List available domains\n */\nexport const AVAILABLE_DOMAINS = [\n  'ai',\n  'analytics',\n  'blog',\n  'cart',\n  'customer',\n  'discount',\n  'email',\n  'giftcard',\n  'media',\n  'notification',\n  'order',\n  'payment',\n  'product',\n  'review',\n  'shipping',\n  'wishlist',\n] as const;\n\nexport type PrimitiveDomain = typeof AVAILABLE_DOMAINS[number];\n","/**\n * Built-in Primitives\n *\n * System primitives that come pre-installed with the CMS.\n * These provide essential functionality and serve as examples.\n */\n\nimport { prisma } from '../db';\nimport type { CreatePrimitiveRequest, JSONSchema } from './types';\nimport { getPluginRegistry } from './registry';\nimport { DOMAIN_PRIMITIVES } from './primitives';\n\n/**\n * Core utility primitives (data, text, math, logic, datetime)\n */\nconst CORE_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  // ============================================================================\n  // DATA PRIMITIVES\n  // ============================================================================\n  {\n    name: 'transform_json',\n    description: 'Transform JSON data using a JavaScript expression. Useful for mapping, filtering, and reshaping data.',\n    category: 'data',\n    tags: ['data', 'transform', 'json'],\n    icon: 'Braces',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        data: {\n          type: 'object',\n          description: 'The input data to transform',\n        },\n        expression: {\n          type: 'string',\n          description: 'JavaScript expression to transform the data. Use `data` to reference input.',\n        },\n      },\n      required: ['data', 'expression'],\n    },\n    handler: `\n      // Transform JSON data using expression\n      const result = eval(args.expression);\n      return result;\n    `,\n  },\n  {\n    name: 'validate_data',\n    description: 'Validate data against a JSON Schema and return validation results.',\n    category: 'data',\n    tags: ['data', 'validation', 'schema'],\n    icon: 'CheckCircle',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        data: {\n          type: 'object',\n          description: 'The data to validate',\n        },\n        schema: {\n          type: 'object',\n          description: 'JSON Schema to validate against',\n        },\n      },\n      required: ['data', 'schema'],\n    },\n    handler: `\n      const errors = [];\n      const schema = args.schema;\n      const data = args.data;\n\n      // Check required fields\n      if (schema.required) {\n        for (const field of schema.required) {\n          if (!(field in data)) {\n            errors.push({ field, message: 'Required field missing' });\n          }\n        }\n      }\n\n      // Check types\n      if (schema.properties) {\n        for (const [key, prop] of Object.entries(schema.properties)) {\n          if (key in data) {\n            const value = data[key];\n            const expectedType = prop.type;\n            const actualType = Array.isArray(value) ? 'array' : typeof value;\n\n            if (expectedType !== actualType && !(expectedType === 'null' && value === null)) {\n              errors.push({ field: key, message: 'Type mismatch: expected ' + expectedType + ', got ' + actualType });\n            }\n          }\n        }\n      }\n\n      return {\n        valid: errors.length === 0,\n        errors,\n        data: errors.length === 0 ? data : undefined\n      };\n    `,\n  },\n\n  // ============================================================================\n  // TEXT PRIMITIVES\n  // ============================================================================\n  {\n    name: 'format_text',\n    description: 'Format text using template literals. Supports variable interpolation.',\n    category: 'text',\n    tags: ['text', 'template', 'format'],\n    icon: 'FileText',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        template: {\n          type: 'string',\n          description: 'Template string with {{variable}} placeholders',\n        },\n        variables: {\n          type: 'object',\n          description: 'Variables to interpolate into the template',\n        },\n      },\n      required: ['template', 'variables'],\n    },\n    handler: `\n      let result = args.template;\n      for (const [key, value] of Object.entries(args.variables)) {\n        result = result.replace(new RegExp('{{' + key + '}}', 'g'), String(value));\n      }\n      return result;\n    `,\n  },\n  {\n    name: 'parse_csv',\n    description: 'Parse CSV text into an array of objects.',\n    category: 'text',\n    tags: ['text', 'csv', 'parse'],\n    icon: 'Table',\n    timeout: 10000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        csv: {\n          type: 'string',\n          description: 'CSV text to parse',\n        },\n        delimiter: {\n          type: 'string',\n          description: 'Column delimiter (default: comma)',\n          default: ',',\n        },\n        hasHeader: {\n          type: 'boolean',\n          description: 'First row is header (default: true)',\n          default: true,\n        },\n      },\n      required: ['csv'],\n    },\n    handler: `\n      const delimiter = args.delimiter || ',';\n      const hasHeader = args.hasHeader !== false;\n      const lines = args.csv.trim().split('\\\\n');\n\n      if (lines.length === 0) return [];\n\n      const headers = hasHeader\n        ? lines[0].split(delimiter).map(h => h.trim())\n        : lines[0].split(delimiter).map((_, i) => 'column' + i);\n\n      const dataLines = hasHeader ? lines.slice(1) : lines;\n\n      return dataLines.map(line => {\n        const values = line.split(delimiter);\n        const obj = {};\n        headers.forEach((header, i) => {\n          obj[header] = values[i]?.trim() || '';\n        });\n        return obj;\n      });\n    `,\n  },\n\n  // ============================================================================\n  // MATH PRIMITIVES\n  // ============================================================================\n  {\n    name: 'calculate',\n    description: 'Evaluate a mathematical expression safely.',\n    category: 'math',\n    tags: ['math', 'calculate', 'expression'],\n    icon: 'Calculator',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        expression: {\n          type: 'string',\n          description: 'Mathematical expression to evaluate (e.g., \"2 + 2 * 3\")',\n        },\n        variables: {\n          type: 'object',\n          description: 'Variables to use in the expression',\n        },\n      },\n      required: ['expression'],\n    },\n    handler: `\n      // Safe math evaluation - only allows numbers and math operators\n      let expr = args.expression;\n\n      // Replace variables\n      if (args.variables) {\n        for (const [key, value] of Object.entries(args.variables)) {\n          expr = expr.replace(new RegExp('\\\\\\\\b' + key + '\\\\\\\\b', 'g'), String(value));\n        }\n      }\n\n      // Validate expression contains only safe characters\n      if (!/^[\\\\d\\\\s+\\\\-*/().]+$/.test(expr)) {\n        throw new Error('Invalid expression: only numbers and math operators allowed');\n      }\n\n      return eval(expr);\n    `,\n  },\n  {\n    name: 'aggregate',\n    description: 'Aggregate an array of numbers (sum, avg, min, max, count).',\n    category: 'math',\n    tags: ['math', 'aggregate', 'statistics'],\n    icon: 'BarChart',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        values: {\n          type: 'array',\n          description: 'Array of numbers to aggregate',\n        },\n        operations: {\n          type: 'array',\n          description: 'Operations to perform: sum, avg, min, max, count',\n          default: ['sum', 'avg', 'min', 'max', 'count'],\n        },\n      },\n      required: ['values'],\n    },\n    handler: `\n      const nums = args.values.filter(v => typeof v === 'number');\n      const ops = args.operations || ['sum', 'avg', 'min', 'max', 'count'];\n      const result = {};\n\n      if (ops.includes('sum')) result.sum = nums.reduce((a, b) => a + b, 0);\n      if (ops.includes('avg')) result.avg = nums.length ? nums.reduce((a, b) => a + b, 0) / nums.length : 0;\n      if (ops.includes('min')) result.min = nums.length ? Math.min(...nums) : null;\n      if (ops.includes('max')) result.max = nums.length ? Math.max(...nums) : null;\n      if (ops.includes('count')) result.count = nums.length;\n\n      return result;\n    `,\n  },\n\n  // ============================================================================\n  // LOGIC PRIMITIVES\n  // ============================================================================\n  {\n    name: 'conditional',\n    description: 'Evaluate a condition and return different values based on result.',\n    category: 'logic',\n    tags: ['logic', 'condition', 'if-else'],\n    icon: 'GitBranch',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        condition: {\n          type: 'string',\n          description: 'JavaScript expression that evaluates to boolean',\n        },\n        context: {\n          type: 'object',\n          description: 'Variables available in the condition',\n        },\n        thenValue: {\n          description: 'Value to return if condition is true',\n        },\n        elseValue: {\n          description: 'Value to return if condition is false',\n        },\n      },\n      required: ['condition'],\n    },\n    handler: `\n      // Build context for eval\n      const ctx = args.context || {};\n      const contextKeys = Object.keys(ctx);\n      const contextValues = Object.values(ctx);\n\n      // Create function with context variables\n      const evalFn = new Function(...contextKeys, 'return ' + args.condition);\n      const result = evalFn(...contextValues);\n\n      return result ? args.thenValue : args.elseValue;\n    `,\n  },\n  {\n    name: 'switch_case',\n    description: 'Match a value against multiple cases and return the corresponding result.',\n    category: 'logic',\n    tags: ['logic', 'switch', 'match'],\n    icon: 'Route',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        value: {\n          description: 'Value to match against cases',\n        },\n        cases: {\n          type: 'object',\n          description: 'Object mapping case values to results',\n        },\n        default: {\n          description: 'Default value if no case matches',\n        },\n      },\n      required: ['value', 'cases'],\n    },\n    handler: `\n      const value = String(args.value);\n      if (value in args.cases) {\n        return args.cases[value];\n      }\n      return args.default;\n    `,\n  },\n\n  // ============================================================================\n  // DATE/TIME PRIMITIVES\n  // ============================================================================\n  {\n    name: 'format_date',\n    description: 'Format a date using a format string.',\n    category: 'datetime',\n    tags: ['date', 'time', 'format'],\n    icon: 'Calendar',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        date: {\n          type: 'string',\n          description: 'Date string or timestamp to format',\n        },\n        format: {\n          type: 'string',\n          description: 'Format string (YYYY, MM, DD, HH, mm, ss)',\n          default: 'YYYY-MM-DD',\n        },\n        timezone: {\n          type: 'string',\n          description: 'Timezone (e.g., \"America/New_York\")',\n        },\n      },\n      required: ['date'],\n    },\n    handler: `\n      const d = new Date(args.date);\n      const format = args.format || 'YYYY-MM-DD';\n\n      const pad = (n) => String(n).padStart(2, '0');\n\n      return format\n        .replace('YYYY', d.getFullYear())\n        .replace('MM', pad(d.getMonth() + 1))\n        .replace('DD', pad(d.getDate()))\n        .replace('HH', pad(d.getHours()))\n        .replace('mm', pad(d.getMinutes()))\n        .replace('ss', pad(d.getSeconds()));\n    `,\n  },\n  {\n    name: 'date_diff',\n    description: 'Calculate the difference between two dates.',\n    category: 'datetime',\n    tags: ['date', 'time', 'difference'],\n    icon: 'Clock',\n    timeout: 5000,\n    builtIn: true,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        startDate: {\n          type: 'string',\n          description: 'Start date',\n        },\n        endDate: {\n          type: 'string',\n          description: 'End date',\n        },\n        unit: {\n          type: 'string',\n          description: 'Unit: days, hours, minutes, seconds',\n          enum: ['days', 'hours', 'minutes', 'seconds'],\n          default: 'days',\n        },\n      },\n      required: ['startDate', 'endDate'],\n    },\n    handler: `\n      const start = new Date(args.startDate);\n      const end = new Date(args.endDate);\n      const diffMs = end - start;\n\n      const unit = args.unit || 'days';\n      const divisors = {\n        days: 86400000,\n        hours: 3600000,\n        minutes: 60000,\n        seconds: 1000,\n      };\n\n      return Math.floor(diffMs / divisors[unit]);\n    `,\n  },\n];\n\n/**\n * All built-in primitives (core utilities + domain-specific)\n */\nconst BUILT_IN_PRIMITIVES: Array<CreatePrimitiveRequest & { builtIn: true }> = [\n  ...CORE_PRIMITIVES,\n  ...DOMAIN_PRIMITIVES,\n];\n\n// Export for external use\nexport { BUILT_IN_PRIMITIVES, CORE_PRIMITIVES, DOMAIN_PRIMITIVES };\n\n/**\n * Load built-in primitives into the database\n */\nexport async function loadBuiltInPrimitives(): Promise<{\n  loaded: number;\n  skipped: number;\n  errors: string[];\n}> {\n  let loaded = 0;\n  let skipped = 0;\n  const errors: string[] = [];\n\n  for (const primitive of BUILT_IN_PRIMITIVES) {\n    try {\n      // Check if already exists\n      const existing = await prisma.primitive.findUnique({\n        where: { name: primitive.name },\n      });\n\n      if (existing) {\n        // Update if version changed\n        if (existing.builtIn) {\n          skipped++;\n          continue;\n        }\n      }\n\n      // Create or update\n      await prisma.primitive.upsert({\n        where: { name: primitive.name },\n        create: {\n          name: primitive.name,\n          description: primitive.description,\n          inputSchema: primitive.inputSchema as object,\n          handler: primitive.handler,\n          category: primitive.category,\n          tags: primitive.tags || [],\n          icon: primitive.icon,\n          timeout: primitive.timeout || 30000,\n          enabled: true,\n          builtIn: true,\n        },\n        update: {\n          description: primitive.description,\n          inputSchema: primitive.inputSchema as object,\n          handler: primitive.handler,\n          category: primitive.category,\n          tags: primitive.tags || [],\n          icon: primitive.icon,\n          timeout: primitive.timeout || 30000,\n        },\n      });\n\n      loaded++;\n    } catch (e) {\n      errors.push(`Failed to load ${primitive.name}: ${e instanceof Error ? e.message : String(e)}`);\n    }\n  }\n\n  // Initialize registry after loading\n  const registry = getPluginRegistry();\n  await registry.initialize();\n\n  return { loaded, skipped, errors };\n}\n\n/**\n * Get list of built-in primitive names\n */\nexport function getBuiltInPrimitiveNames(): string[] {\n  return BUILT_IN_PRIMITIVES.map(p => p.name);\n}\n","/**\n * Product Reviews Service\n *\n * Handles review submission, moderation, voting, and statistics\n */\n\nimport { prisma } from '../db';\nimport { sendEmail } from '../email';\nimport { getEmailSettings } from '../settings';\nimport type { ReviewStatus, Prisma } from '@prisma/client';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ReviewSubmission {\n  productId: string;\n  customerId?: string;\n  orderId?: string;\n  reviewerName: string;\n  reviewerEmail: string;\n  rating: number; // 1-5\n  title?: string;\n  content: string;\n  pros?: string;\n  cons?: string;\n  images?: string[];\n  ipAddress?: string;\n  userAgent?: string;\n}\n\nexport interface ReviewFilters {\n  productId?: string;\n  status?: ReviewStatus;\n  rating?: number;\n  minRating?: number;\n  maxRating?: number;\n  isVerifiedPurchase?: boolean;\n  search?: string;\n}\n\nexport interface ReviewSort {\n  field: 'createdAt' | 'rating' | 'helpfulCount';\n  direction: 'asc' | 'desc';\n}\n\nexport interface ReviewStats {\n  averageRating: number;\n  totalReviews: number;\n  ratingDistribution: {\n    1: number;\n    2: number;\n    3: number;\n    4: number;\n    5: number;\n  };\n  verifiedPurchaseCount: number;\n  withImagesCount: number;\n}\n\nexport interface PaginatedReviews {\n  reviews: Array<Awaited<ReturnType<typeof getReviewWithVotes>>>;\n  total: number;\n  page: number;\n  pageSize: number;\n  totalPages: number;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nasync function getReviewWithVotes(reviewId: string) {\n  return prisma.productReview.findUnique({\n    where: { id: reviewId },\n    include: {\n      product: {\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n          images: {\n            take: 1,\n            include: {\n              media: {\n                select: { url: true },\n              },\n            },\n          },\n        },\n      },\n      customer: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n        },\n      },\n    },\n  });\n}\n\n// ============================================================================\n// Review CRUD\n// ============================================================================\n\n/**\n * Get reviews with pagination and filtering\n */\nexport async function getReviews(\n  filters: ReviewFilters = {},\n  sort: ReviewSort = { field: 'createdAt', direction: 'desc' },\n  page: number = 1,\n  pageSize: number = 10\n): Promise<PaginatedReviews> {\n  const where: Prisma.ProductReviewWhereInput = {};\n\n  if (filters.productId) {\n    where.productId = filters.productId;\n  }\n\n  if (filters.status) {\n    where.status = filters.status;\n  }\n\n  if (filters.rating) {\n    where.rating = filters.rating;\n  }\n\n  if (filters.minRating) {\n    where.rating = { ...where.rating as object, gte: filters.minRating };\n  }\n\n  if (filters.maxRating) {\n    where.rating = { ...where.rating as object, lte: filters.maxRating };\n  }\n\n  if (filters.isVerifiedPurchase !== undefined) {\n    where.isVerifiedPurchase = filters.isVerifiedPurchase;\n  }\n\n  if (filters.search) {\n    where.OR = [\n      { title: { contains: filters.search, mode: 'insensitive' } },\n      { content: { contains: filters.search, mode: 'insensitive' } },\n      { reviewerName: { contains: filters.search, mode: 'insensitive' } },\n    ];\n  }\n\n  const [reviews, total] = await Promise.all([\n    prisma.productReview.findMany({\n      where,\n      orderBy: { [sort.field]: sort.direction },\n      skip: (page - 1) * pageSize,\n      take: pageSize,\n      include: {\n        product: {\n          select: {\n            id: true,\n            title: true,\n            slug: true,\n            images: {\n              take: 1,\n              include: {\n                media: {\n                  select: { url: true },\n                },\n              },\n            },\n          },\n        },\n        customer: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n          },\n        },\n      },\n    }),\n    prisma.productReview.count({ where }),\n  ]);\n\n  return {\n    reviews,\n    total,\n    page,\n    pageSize,\n    totalPages: Math.ceil(total / pageSize),\n  };\n}\n\n/**\n * Get reviews for a specific product (public-facing)\n */\nexport async function getProductReviews(\n  productId: string,\n  page: number = 1,\n  pageSize: number = 10,\n  sort: ReviewSort = { field: 'helpfulCount', direction: 'desc' }\n): Promise<PaginatedReviews> {\n  return getReviews(\n    { productId, status: 'APPROVED' },\n    sort,\n    page,\n    pageSize\n  );\n}\n\n/**\n * Get a single review by ID\n */\nexport async function getReviewById(reviewId: string) {\n  return getReviewWithVotes(reviewId);\n}\n\n/**\n * Submit a new review\n */\nexport async function submitReview(data: ReviewSubmission) {\n  // Validate rating\n  if (data.rating < 1 || data.rating > 5) {\n    throw new Error('Rating must be between 1 and 5');\n  }\n\n  // Check if product exists\n  const product = await prisma.product.findUnique({\n    where: { id: data.productId },\n  });\n\n  if (!product) {\n    throw new Error('Product not found');\n  }\n\n  // Check for verified purchase\n  let isVerifiedPurchase = false;\n  if (data.orderId) {\n    const orderItem = await prisma.orderItem.findFirst({\n      where: {\n        order: {\n          id: data.orderId,\n          paymentStatus: 'PAID',\n        },\n        productId: data.productId,\n      },\n    });\n    isVerifiedPurchase = !!orderItem;\n  } else if (data.customerId) {\n    // Check if user has purchased this product\n    const orderItem = await prisma.orderItem.findFirst({\n      where: {\n        order: {\n          customerId: data.customerId,\n          paymentStatus: 'PAID',\n        },\n        productId: data.productId,\n      },\n    });\n    isVerifiedPurchase = !!orderItem;\n  }\n\n  // Check for duplicate review (same customer/email + product)\n  const existingReview = await prisma.productReview.findFirst({\n    where: {\n      productId: data.productId,\n      OR: [\n        ...(data.customerId ? [{ customerId: data.customerId }] : []),\n        { reviewerEmail: data.reviewerEmail },\n      ],\n    },\n  });\n\n  if (existingReview) {\n    throw new Error('You have already reviewed this product');\n  }\n\n  // Create the review\n  const review = await prisma.productReview.create({\n    data: {\n      productId: data.productId,\n      customerId: data.customerId,\n      orderId: data.orderId,\n      reviewerName: data.reviewerName,\n      reviewerEmail: data.reviewerEmail,\n      rating: data.rating,\n      title: data.title,\n      content: data.content,\n      pros: data.pros,\n      cons: data.cons,\n      images: data.images || [],\n      isVerifiedPurchase,\n      status: 'PENDING', // Requires moderation\n      ipAddress: data.ipAddress,\n      userAgent: data.userAgent,\n    },\n    include: {\n      product: {\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n        },\n      },\n    },\n  });\n\n  return review;\n}\n\n/**\n * Update a review (admin moderation)\n */\nexport async function updateReview(\n  reviewId: string,\n  data: {\n    status?: ReviewStatus;\n    responseContent?: string;\n    respondedById?: string;\n  }\n) {\n  const updateData: Prisma.ProductReviewUpdateInput = {};\n\n  if (data.status) {\n    updateData.status = data.status;\n    if (data.status === 'APPROVED') {\n      updateData.publishedAt = new Date();\n    }\n  }\n\n  if (data.responseContent !== undefined) {\n    updateData.responseContent = data.responseContent;\n    updateData.responseAt = new Date();\n    updateData.respondedById = data.respondedById;\n  }\n\n  return prisma.productReview.update({\n    where: { id: reviewId },\n    data: updateData,\n    include: {\n      product: {\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n        },\n      },\n    },\n  });\n}\n\n/**\n * Delete a review\n */\nexport async function deleteReview(reviewId: string) {\n  return prisma.productReview.delete({\n    where: { id: reviewId },\n  });\n}\n\n/**\n * Approve a pending review\n */\nexport async function approveReview(reviewId: string) {\n  return updateReview(reviewId, { status: 'APPROVED' });\n}\n\n/**\n * Reject a review\n */\nexport async function rejectReview(reviewId: string) {\n  return updateReview(reviewId, { status: 'REJECTED' });\n}\n\n/**\n * Flag a review for further review\n */\nexport async function flagReview(reviewId: string) {\n  return updateReview(reviewId, { status: 'FLAGGED' });\n}\n\n/**\n * Add store response to a review\n */\nexport async function respondToReview(\n  reviewId: string,\n  responseContent: string,\n  respondedById: string\n) {\n  return updateReview(reviewId, {\n    responseContent,\n    respondedById,\n  });\n}\n\n// ============================================================================\n// Voting\n// ============================================================================\n\n/**\n * Vote on a review (helpful/unhelpful)\n */\nexport async function voteReview(\n  reviewId: string,\n  helpful: boolean,\n  userId?: string,\n  email?: string\n) {\n  if (!userId && !email) {\n    throw new Error('User ID or email is required to vote');\n  }\n\n  // Check if already voted\n  const existingVote = await prisma.reviewVote.findFirst({\n    where: {\n      reviewId,\n      OR: [\n        ...(userId ? [{ userId }] : []),\n        ...(email ? [{ email }] : []),\n      ],\n    },\n  });\n\n  if (existingVote) {\n    // Update existing vote if different\n    if (existingVote.helpful !== helpful) {\n      await prisma.$transaction([\n        prisma.reviewVote.update({\n          where: { id: existingVote.id },\n          data: { helpful },\n        }),\n        prisma.productReview.update({\n          where: { id: reviewId },\n          data: {\n            helpfulCount: helpful ? { increment: 1 } : { decrement: 1 },\n            unhelpfulCount: helpful ? { decrement: 1 } : { increment: 1 },\n          },\n        }),\n      ]);\n    }\n    return { updated: true };\n  }\n\n  // Create new vote\n  await prisma.$transaction([\n    prisma.reviewVote.create({\n      data: {\n        reviewId,\n        userId,\n        email,\n        helpful,\n      },\n    }),\n    prisma.productReview.update({\n      where: { id: reviewId },\n      data: {\n        helpfulCount: helpful ? { increment: 1 } : undefined,\n        unhelpfulCount: helpful ? undefined : { increment: 1 },\n      },\n    }),\n  ]);\n\n  return { created: true };\n}\n\n// ============================================================================\n// Statistics\n// ============================================================================\n\n/**\n * Get review statistics for a product\n */\nexport async function getProductReviewStats(productId: string): Promise<ReviewStats> {\n  const reviews = await prisma.productReview.findMany({\n    where: {\n      productId,\n      status: 'APPROVED',\n    },\n    select: {\n      rating: true,\n      isVerifiedPurchase: true,\n      images: true,\n    },\n  });\n\n  const totalReviews = reviews.length;\n\n  if (totalReviews === 0) {\n    return {\n      averageRating: 0,\n      totalReviews: 0,\n      ratingDistribution: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },\n      verifiedPurchaseCount: 0,\n      withImagesCount: 0,\n    };\n  }\n\n  const ratingDistribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };\n  let ratingSum = 0;\n  let verifiedPurchaseCount = 0;\n  let withImagesCount = 0;\n\n  for (const review of reviews) {\n    ratingDistribution[review.rating as keyof typeof ratingDistribution]++;\n    ratingSum += review.rating;\n    if (review.isVerifiedPurchase) verifiedPurchaseCount++;\n    if (review.images && Array.isArray(review.images) && review.images.length > 0) {\n      withImagesCount++;\n    }\n  }\n\n  return {\n    averageRating: Math.round((ratingSum / totalReviews) * 10) / 10,\n    totalReviews,\n    ratingDistribution,\n    verifiedPurchaseCount,\n    withImagesCount,\n  };\n}\n\n/**\n * Get overall review statistics (admin dashboard)\n */\nexport async function getReviewDashboardStats() {\n  const [total, pending, approved, rejected, flagged, avgRating] = await Promise.all([\n    prisma.productReview.count(),\n    prisma.productReview.count({ where: { status: 'PENDING' } }),\n    prisma.productReview.count({ where: { status: 'APPROVED' } }),\n    prisma.productReview.count({ where: { status: 'REJECTED' } }),\n    prisma.productReview.count({ where: { status: 'FLAGGED' } }),\n    prisma.productReview.aggregate({\n      where: { status: 'APPROVED' },\n      _avg: { rating: true },\n    }),\n  ]);\n\n  return {\n    total,\n    pending,\n    approved,\n    rejected,\n    flagged,\n    averageRating: Math.round((avgRating._avg.rating || 0) * 10) / 10,\n  };\n}\n\n// ============================================================================\n// Eligibility\n// ============================================================================\n\n/**\n * Check if a customer can review a product\n */\nexport async function canCustomerReviewProduct(\n  productId: string,\n  customerId?: string,\n  email?: string\n): Promise<{\n  canReview: boolean;\n  reason?: string;\n  isVerifiedPurchaser: boolean;\n}> {\n  if (!customerId && !email) {\n    return {\n      canReview: true,\n      isVerifiedPurchaser: false,\n    };\n  }\n\n  // Check for existing review\n  const existingReview = await prisma.productReview.findFirst({\n    where: {\n      productId,\n      OR: [\n        ...(customerId ? [{ customerId }] : []),\n        ...(email ? [{ reviewerEmail: email }] : []),\n      ],\n    },\n  });\n\n  if (existingReview) {\n    return {\n      canReview: false,\n      reason: 'You have already reviewed this product',\n      isVerifiedPurchaser: existingReview.isVerifiedPurchase,\n    };\n  }\n\n  // Check if customer has purchased\n  let isVerifiedPurchaser = false;\n  if (customerId) {\n    const purchase = await prisma.orderItem.findFirst({\n      where: {\n        order: {\n          customerId,\n          paymentStatus: 'PAID',\n        },\n        productId,\n      },\n    });\n    isVerifiedPurchaser = !!purchase;\n  }\n\n  return {\n    canReview: true,\n    isVerifiedPurchaser,\n  };\n}\n\n// ============================================================================\n// Review Request Emails\n// ============================================================================\n\n/**\n * Get orders eligible for review requests\n * (delivered orders without review requests sent)\n */\nexport async function getOrdersForReviewRequest(\n  daysAfterDelivery: number = 7,\n  limit: number = 50\n) {\n  const cutoffDate = new Date();\n  cutoffDate.setDate(cutoffDate.getDate() - daysAfterDelivery);\n\n  // Find delivered orders within the timeframe\n  // We'll filter out already-sent review requests by checking internalNotes\n  const orders = await prisma.order.findMany({\n    where: {\n      status: 'DELIVERED',\n      paymentStatus: 'PAID',\n      // Filter out orders that already have review request sent (stored in internalNotes)\n      NOT: {\n        internalNotes: { contains: '[REVIEW_REQUEST_SENT]' },\n      },\n      // Find orders with shipments delivered around the cutoff\n      shipments: {\n        some: {\n          deliveredAt: {\n            lte: cutoffDate,\n            gte: new Date(cutoffDate.getTime() - 24 * 60 * 60 * 1000), // Within 1 day window\n          },\n        },\n      },\n    },\n    include: {\n      items: {\n        include: {\n          product: {\n            select: {\n              id: true,\n              title: true,\n              slug: true,\n              images: {\n                take: 1,\n                include: {\n                  media: {\n                    select: { url: true },\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n      customer: {\n        select: {\n          firstName: true,\n          lastName: true,\n        },\n      },\n      shippingAddress: true,\n    },\n    take: limit,\n  });\n\n  return orders;\n}\n\n/**\n * Send review request email for an order\n */\nexport async function sendReviewRequestEmail(orderId: string): Promise<{\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}> {\n  try {\n    const order = await prisma.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: {\n          include: {\n            product: {\n              select: {\n                id: true,\n                title: true,\n                slug: true,\n                images: {\n                  take: 1,\n                  include: {\n                    media: {\n                      select: { url: true },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n        customer: {\n          select: {\n            firstName: true,\n            lastName: true,\n          },\n        },\n        shippingAddress: true,\n      },\n    });\n\n    if (!order || !order.email) {\n      return { success: false, error: 'Order not found or no email' };\n    }\n\n    const settings = await getEmailSettings();\n    const storeUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n    const storeName = settings.fromName || 'Our Store';\n\n    // Filter products that haven't been reviewed yet by this customer\n    const productsToReview = [];\n    for (const item of order.items) {\n      const existingReview = await prisma.productReview.findFirst({\n        where: {\n          productId: item.productId,\n          reviewerEmail: order.email,\n        },\n      });\n      if (!existingReview && item.product) {\n        productsToReview.push(item);\n      }\n    }\n\n    if (productsToReview.length === 0) {\n      // All products already reviewed\n      await markReviewRequestSent(orderId);\n      return { success: true, messageId: 'skipped-already-reviewed' };\n    }\n\n    const customerName = order.shippingAddress\n      ? `${order.shippingAddress.firstName} ${order.shippingAddress.lastName}`.trim()\n      : order.customer ? [order.customer.firstName, order.customer.lastName].filter(Boolean).join(' ') || 'Valued Customer' : 'Valued Customer';\n\n    // Generate email HTML\n    const emailHtml = generateReviewRequestEmail({\n      storeName,\n      storeUrl,\n      customerName,\n      orderNumber: order.orderNumber,\n      products: productsToReview.map((item) => ({\n        id: item.product!.id,\n        name: item.product!.title,\n        slug: item.product!.slug,\n        imageUrl: item.product!.images[0]?.media?.url,\n      })),\n    });\n\n    // Send email\n    const result = await sendEmail({\n      to: { email: order.email, name: customerName },\n      subject: `How was your purchase? Leave a review!`,\n      html: emailHtml,\n    });\n\n    if (result.success) {\n      await markReviewRequestSent(orderId);\n    }\n\n    return result;\n  } catch (error) {\n    console.error('Send review request email error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to send email',\n    };\n  }\n}\n\n/**\n * Mark order as having review request sent\n * Uses internalNotes to track this since Order doesn't have metadata\n */\nasync function markReviewRequestSent(orderId: string) {\n  const order = await prisma.order.findUnique({\n    where: { id: orderId },\n    select: { internalNotes: true },\n  });\n\n  const currentNotes = order?.internalNotes || '';\n  const timestamp = new Date().toISOString();\n  const marker = `[REVIEW_REQUEST_SENT:${timestamp}]`;\n\n  await prisma.order.update({\n    where: { id: orderId },\n    data: {\n      internalNotes: currentNotes ? `${currentNotes}\\n${marker}` : marker,\n    },\n  });\n}\n\n/**\n * Generate review request email HTML\n */\nfunction generateReviewRequestEmail(data: {\n  storeName: string;\n  storeUrl: string;\n  customerName: string;\n  orderNumber: string;\n  products: Array<{\n    id: string;\n    name: string;\n    slug: string;\n    imageUrl?: string;\n  }>;\n}): string {\n  const productBlocks = data.products\n    .map(\n      (product) => `\n    <tr>\n      <td style=\"padding: 16px 0; border-bottom: 1px solid #e4e4e7;\">\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n          <tr>\n            ${\n              product.imageUrl\n                ? `\n            <td width=\"80\" valign=\"middle\" style=\"padding-right: 16px;\">\n              <img src=\"${product.imageUrl}\" alt=\"${product.name}\" width=\"80\" height=\"80\" style=\"border-radius: 8px; object-fit: cover;\">\n            </td>\n            `\n                : ''\n            }\n            <td valign=\"middle\">\n              <p style=\"margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #18181b;\">${product.name}</p>\n              <a href=\"${data.storeUrl}/products/${product.slug}?review=true#reviews\" style=\"display: inline-block; padding: 8px 16px; background-color: #18181b; color: #ffffff; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 500;\">Write a Review</a>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  `\n    )\n    .join('');\n\n  return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Review Your Purchase</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f4f4f5;\">\n  <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #f4f4f5;\">\n    <tr>\n      <td style=\"padding: 40px 20px;\">\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"600\" style=\"margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden;\">\n          <!-- Header -->\n          <tr>\n            <td style=\"padding: 32px 40px; background-color: #18181b; text-align: center;\">\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 24px; font-weight: 700;\">${data.storeName}</h1>\n            </td>\n          </tr>\n\n          <!-- Content -->\n          <tr>\n            <td style=\"padding: 40px;\">\n              <!-- Star Rating Icon -->\n              <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin-bottom: 24px;\">\n                <tr>\n                  <td align=\"center\">\n                    <div style=\"font-size: 48px;\">\n                      <span style=\"color: #fbbf24;\">&#9733;</span>\n                      <span style=\"color: #fbbf24;\">&#9733;</span>\n                      <span style=\"color: #fbbf24;\">&#9733;</span>\n                      <span style=\"color: #fbbf24;\">&#9733;</span>\n                      <span style=\"color: #fbbf24;\">&#9733;</span>\n                    </div>\n                  </td>\n                </tr>\n              </table>\n\n              <h2 style=\"margin: 0 0 16px 0; font-size: 24px; font-weight: 700; color: #18181b; text-align: center;\">How was your purchase?</h2>\n\n              <p style=\"margin: 0 0 24px 0; font-size: 16px; color: #52525b; line-height: 1.6; text-align: center;\">\n                Hi ${data.customerName},<br><br>\n                We hope you're enjoying your recent purchase from order #${data.orderNumber}! Your feedback helps other shoppers make informed decisions and helps us improve.\n              </p>\n\n              <p style=\"margin: 0 0 24px 0; font-size: 16px; color: #52525b; line-height: 1.6; text-align: center;\">\n                <strong>Would you take a moment to share your experience?</strong>\n              </p>\n\n              <!-- Products to Review -->\n              <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"margin: 24px 0;\">\n                ${productBlocks}\n              </table>\n\n              <p style=\"margin: 24px 0 0 0; font-size: 14px; color: #71717a; line-height: 1.6; text-align: center;\">\n                Your honest review, whether positive or constructive, is valuable to us and our community.\n              </p>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"padding: 24px 40px; background-color: #f4f4f5; text-align: center;\">\n              <p style=\"margin: 0 0 8px 0; font-size: 14px; color: #71717a;\">\n                Thank you for shopping with ${data.storeName}\n              </p>\n              <p style=\"margin: 0; font-size: 12px; color: #a1a1aa;\">\n                <a href=\"${data.storeUrl}\" style=\"color: #71717a; text-decoration: underline;\">Visit our store</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n  `.trim();\n}\n\n// ============================================================================\n// Bulk Operations (Admin)\n// ============================================================================\n\n/**\n * Bulk approve reviews\n */\nexport async function bulkApproveReviews(reviewIds: string[]) {\n  return prisma.productReview.updateMany({\n    where: { id: { in: reviewIds } },\n    data: {\n      status: 'APPROVED',\n      publishedAt: new Date(),\n    },\n  });\n}\n\n/**\n * Bulk reject reviews\n */\nexport async function bulkRejectReviews(reviewIds: string[]) {\n  return prisma.productReview.updateMany({\n    where: { id: { in: reviewIds } },\n    data: { status: 'REJECTED' },\n  });\n}\n\n/**\n * Bulk delete reviews\n */\nexport async function bulkDeleteReviews(reviewIds: string[]) {\n  return prisma.productReview.deleteMany({\n    where: { id: { in: reviewIds } },\n  });\n}\n","/**\n * SEO Types and Configurations\n */\n\nimport type { Metadata } from 'next'\n\n// Base SEO configuration\nexport interface SeoConfig {\n  siteName: string\n  siteUrl: string\n  defaultTitle: string\n  titleTemplate: string // e.g., \"%s | Site Name\"\n  defaultDescription: string\n  defaultImage?: string\n  twitterHandle?: string\n  locale: string\n  themeColor?: string\n  keywords?: string[]\n}\n\n// Page-specific SEO data\nexport interface PageSeo {\n  title?: string\n  description?: string\n  keywords?: string[]\n  image?: string\n  noIndex?: boolean\n  noFollow?: boolean\n  canonical?: string\n  publishedTime?: string\n  modifiedTime?: string\n  author?: string\n  section?: string\n  tags?: string[]\n}\n\n// Product SEO data\nexport interface ProductSeo extends PageSeo {\n  price?: number\n  currency?: string\n  availability?: 'InStock' | 'OutOfStock' | 'PreOrder'\n  sku?: string\n  brand?: string\n  category?: string\n  reviewCount?: number\n  ratingValue?: number\n}\n\n// Article SEO data\nexport interface ArticleSeo extends PageSeo {\n  type?: 'article' | 'blog' | 'news'\n}\n\n// Open Graph types\nexport type OgType =\n  | 'website'\n  | 'article'\n  | 'product'\n  | 'profile'\n  | 'book'\n  | 'video.movie'\n  | 'video.episode'\n  | 'video.tv_show'\n  | 'video.other'\n  | 'music.song'\n  | 'music.album'\n\n// Structured data types\nexport type StructuredDataType =\n  | 'Organization'\n  | 'WebSite'\n  | 'WebPage'\n  | 'Product'\n  | 'Article'\n  | 'BlogPosting'\n  | 'BreadcrumbList'\n  | 'FAQPage'\n  | 'LocalBusiness'\n  | 'Person'\n  | 'Event'\n  | 'Review'\n  | 'HowTo'\n  | 'Recipe'\n  | 'VideoObject'\n\n// Breadcrumb item\nexport interface BreadcrumbItem {\n  name: string\n  url: string\n}\n\n// Organization data for structured data\nexport interface OrganizationData {\n  name: string\n  url: string\n  logo?: string\n  description?: string\n  sameAs?: string[] // Social profiles\n  contactPoint?: {\n    type: string\n    telephone?: string\n    email?: string\n    areaServed?: string\n    availableLanguage?: string[]\n  }\n}\n\n// Local business data\nexport interface LocalBusinessData extends OrganizationData {\n  address?: {\n    streetAddress: string\n    addressLocality: string\n    addressRegion: string\n    postalCode: string\n    addressCountry: string\n  }\n  geo?: {\n    latitude: number\n    longitude: number\n  }\n  openingHours?: string[]\n  priceRange?: string\n}\n\n// FAQ item\nexport interface FaqItem {\n  question: string\n  answer: string\n}\n\n// Default SEO config\nexport const DEFAULT_SEO_CONFIG: SeoConfig = {\n  siteName: 'My Store',\n  siteUrl: process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',\n  defaultTitle: 'My Store',\n  titleTemplate: '%s | My Store',\n  defaultDescription: 'Welcome to our store',\n  locale: 'en_US',\n  themeColor: '#000000',\n}\n\n// Robots configurations\nexport const ROBOTS_CONFIGS = {\n  default: {\n    index: true,\n    follow: true,\n    googleBot: {\n      index: true,\n      follow: true,\n      'max-video-preview': -1,\n      'max-image-preview': 'large' as const,\n      'max-snippet': -1,\n    },\n  },\n  noIndex: {\n    index: false,\n    follow: true,\n  },\n  noFollow: {\n    index: true,\n    follow: false,\n  },\n  none: {\n    index: false,\n    follow: false,\n  },\n}\n","/**\n * SEO Utilities Library\n *\n * Provides metadata generation, structured data, and SEO helpers\n */\n\nimport type { Metadata, Viewport } from 'next'\nimport { prisma } from '../db'\nimport type {\n  SeoConfig,\n  PageSeo,\n  ProductSeo,\n  ArticleSeo,\n  BreadcrumbItem,\n  OrganizationData,\n  LocalBusinessData,\n  FaqItem,\n  OgType,\n} from './types'\nimport { DEFAULT_SEO_CONFIG } from './types'\n\n// Cache for SEO settings\nlet seoConfigCache: SeoConfig | null = null\nlet seoConfigCacheTime = 0\nconst SEO_CACHE_TTL = 60 * 1000 // 1 minute\n\n/**\n * Get SEO configuration from database\n */\nexport async function getSeoConfig(): Promise<SeoConfig> {\n  const now = Date.now()\n  if (seoConfigCache && now - seoConfigCacheTime < SEO_CACHE_TTL) {\n    return seoConfigCache\n  }\n\n  const settings = await prisma.setting.findMany({\n    where: { key: { startsWith: 'seo.' } },\n  })\n\n  const config: SeoConfig = { ...DEFAULT_SEO_CONFIG }\n\n  for (const setting of settings) {\n    const key = setting.key.replace('seo.', '')\n    switch (key) {\n      case 'siteName':\n        config.siteName = setting.value\n        break\n      case 'siteUrl':\n        config.siteUrl = setting.value\n        break\n      case 'defaultTitle':\n        config.defaultTitle = setting.value\n        break\n      case 'titleTemplate':\n        config.titleTemplate = setting.value\n        break\n      case 'defaultDescription':\n        config.defaultDescription = setting.value\n        break\n      case 'defaultImage':\n        config.defaultImage = setting.value\n        break\n      case 'twitterHandle':\n        config.twitterHandle = setting.value\n        break\n      case 'locale':\n        config.locale = setting.value\n        break\n      case 'themeColor':\n        config.themeColor = setting.value\n        break\n      case 'keywords':\n        config.keywords = JSON.parse(setting.value)\n        break\n    }\n  }\n\n  seoConfigCache = config\n  seoConfigCacheTime = now\n\n  return config\n}\n\n/**\n * Clear SEO config cache\n */\nexport function clearSeoConfigCache(): void {\n  seoConfigCache = null\n  seoConfigCacheTime = 0\n}\n\n/**\n * Generate Next.js Metadata for a page\n */\nexport async function generateMetadata(\n  pageSeo: PageSeo = {},\n  type: OgType = 'website'\n): Promise<Metadata> {\n  const config = await getSeoConfig()\n\n  const title = pageSeo.title || config.defaultTitle\n  const description = pageSeo.description || config.defaultDescription\n  const image = pageSeo.image || config.defaultImage\n  const url = pageSeo.canonical || config.siteUrl\n\n  const metadata: Metadata = {\n    title: pageSeo.title\n      ? config.titleTemplate.replace('%s', pageSeo.title)\n      : config.defaultTitle,\n    description,\n    keywords: pageSeo.keywords || config.keywords,\n    authors: pageSeo.author ? [{ name: pageSeo.author }] : undefined,\n    metadataBase: new URL(config.siteUrl),\n    alternates: {\n      canonical: pageSeo.canonical,\n    },\n    openGraph: {\n      title,\n      description,\n      url,\n      siteName: config.siteName,\n      locale: config.locale,\n      type: type as 'website' | 'article',\n      images: image\n        ? [\n            {\n              url: image,\n              width: 1200,\n              height: 630,\n              alt: title,\n            },\n          ]\n        : undefined,\n    },\n    twitter: {\n      card: 'summary_large_image',\n      title,\n      description,\n      images: image ? [image] : undefined,\n      creator: config.twitterHandle,\n      site: config.twitterHandle,\n    },\n    robots: {\n      index: !pageSeo.noIndex,\n      follow: !pageSeo.noFollow,\n      googleBot: {\n        index: !pageSeo.noIndex,\n        follow: !pageSeo.noFollow,\n        'max-video-preview': -1,\n        'max-image-preview': 'large',\n        'max-snippet': -1,\n      },\n    },\n  }\n\n  return metadata\n}\n\n/**\n * Generate metadata for a product page\n */\nexport async function generateProductMetadata(product: ProductSeo): Promise<Metadata> {\n  const baseMetadata = await generateMetadata(product, 'product')\n\n  // Add product-specific Open Graph data\n  if (baseMetadata.openGraph && product.price) {\n    (baseMetadata.openGraph as any).price = {\n      amount: product.price.toString(),\n      currency: product.currency || 'USD',\n    }\n  }\n\n  return baseMetadata\n}\n\n/**\n * Generate metadata for an article/blog post\n */\nexport async function generateArticleMetadata(article: ArticleSeo): Promise<Metadata> {\n  const metadata = await generateMetadata(article, 'article')\n\n  if (metadata.openGraph) {\n    const og = metadata.openGraph as any\n    og.type = 'article'\n    if (article.publishedTime) {\n      og.publishedTime = article.publishedTime\n    }\n    if (article.modifiedTime) {\n      og.modifiedTime = article.modifiedTime\n    }\n    if (article.author) {\n      og.authors = [article.author]\n    }\n    if (article.section) {\n      og.section = article.section\n    }\n    if (article.tags) {\n      og.tags = article.tags\n    }\n  }\n\n  return metadata\n}\n\n/**\n * Generate viewport configuration\n */\nexport function generateViewport(): Viewport {\n  return {\n    width: 'device-width',\n    initialScale: 1,\n    maximumScale: 5,\n    themeColor: [\n      { media: '(prefers-color-scheme: light)', color: '#ffffff' },\n      { media: '(prefers-color-scheme: dark)', color: '#000000' },\n    ],\n  }\n}\n\n// ============================================================================\n// STRUCTURED DATA (JSON-LD)\n// ============================================================================\n\n/**\n * Generate Organization structured data\n */\nexport function generateOrganizationSchema(org: OrganizationData): object {\n  return {\n    '@context': 'https://schema.org',\n    '@type': 'Organization',\n    name: org.name,\n    url: org.url,\n    logo: org.logo,\n    description: org.description,\n    sameAs: org.sameAs,\n    contactPoint: org.contactPoint\n      ? {\n          '@type': 'ContactPoint',\n          contactType: org.contactPoint.type,\n          telephone: org.contactPoint.telephone,\n          email: org.contactPoint.email,\n          areaServed: org.contactPoint.areaServed,\n          availableLanguage: org.contactPoint.availableLanguage,\n        }\n      : undefined,\n  }\n}\n\n/**\n * Generate LocalBusiness structured data\n */\nexport function generateLocalBusinessSchema(business: LocalBusinessData): object {\n  return {\n    '@context': 'https://schema.org',\n    '@type': 'LocalBusiness',\n    name: business.name,\n    url: business.url,\n    logo: business.logo,\n    description: business.description,\n    sameAs: business.sameAs,\n    address: business.address\n      ? {\n          '@type': 'PostalAddress',\n          streetAddress: business.address.streetAddress,\n          addressLocality: business.address.addressLocality,\n          addressRegion: business.address.addressRegion,\n          postalCode: business.address.postalCode,\n          addressCountry: business.address.addressCountry,\n        }\n      : undefined,\n    geo: business.geo\n      ? {\n          '@type': 'GeoCoordinates',\n          latitude: business.geo.latitude,\n          longitude: business.geo.longitude,\n        }\n      : undefined,\n    openingHoursSpecification: business.openingHours,\n    priceRange: business.priceRange,\n  }\n}\n\n/**\n * Generate WebSite structured data with search action\n */\nexport async function generateWebsiteSchema(searchPath = '/search'): Promise<object> {\n  const config = await getSeoConfig()\n\n  return {\n    '@context': 'https://schema.org',\n    '@type': 'WebSite',\n    name: config.siteName,\n    url: config.siteUrl,\n    potentialAction: {\n      '@type': 'SearchAction',\n      target: {\n        '@type': 'EntryPoint',\n        urlTemplate: `${config.siteUrl}${searchPath}?q={search_term_string}`,\n      },\n      'query-input': 'required name=search_term_string',\n    },\n  }\n}\n\n/**\n * Generate BreadcrumbList structured data\n */\nexport async function generateBreadcrumbSchema(items: BreadcrumbItem[]): Promise<object> {\n  const config = await getSeoConfig()\n\n  return {\n    '@context': 'https://schema.org',\n    '@type': 'BreadcrumbList',\n    itemListElement: items.map((item, index) => ({\n      '@type': 'ListItem',\n      position: index + 1,\n      name: item.name,\n      item: item.url.startsWith('http') ? item.url : `${config.siteUrl}${item.url}`,\n    })),\n  }\n}\n\n/**\n * Generate Product structured data\n */\nexport async function generateProductSchema(product: {\n  name: string\n  description?: string\n  image?: string | string[]\n  sku?: string\n  brand?: string\n  price: number\n  currency?: string\n  availability?: 'InStock' | 'OutOfStock' | 'PreOrder'\n  url?: string\n  reviewCount?: number\n  ratingValue?: number\n}): Promise<object> {\n  const config = await getSeoConfig()\n\n  const schema: any = {\n    '@context': 'https://schema.org',\n    '@type': 'Product',\n    name: product.name,\n    description: product.description,\n    image: product.image,\n    sku: product.sku,\n    brand: product.brand\n      ? {\n          '@type': 'Brand',\n          name: product.brand,\n        }\n      : undefined,\n    offers: {\n      '@type': 'Offer',\n      price: product.price,\n      priceCurrency: product.currency || 'USD',\n      availability: `https://schema.org/${product.availability || 'InStock'}`,\n      url: product.url || config.siteUrl,\n    },\n  }\n\n  if (product.reviewCount && product.ratingValue) {\n    schema.aggregateRating = {\n      '@type': 'AggregateRating',\n      ratingValue: product.ratingValue,\n      reviewCount: product.reviewCount,\n    }\n  }\n\n  return schema\n}\n\n/**\n * Generate Article/BlogPosting structured data\n */\nexport async function generateArticleSchema(article: {\n  headline: string\n  description?: string\n  image?: string\n  datePublished: string\n  dateModified?: string\n  author?: string\n  url?: string\n}): Promise<object> {\n  const config = await getSeoConfig()\n\n  return {\n    '@context': 'https://schema.org',\n    '@type': 'Article',\n    headline: article.headline,\n    description: article.description,\n    image: article.image,\n    datePublished: article.datePublished,\n    dateModified: article.dateModified || article.datePublished,\n    author: article.author\n      ? {\n          '@type': 'Person',\n          name: article.author,\n        }\n      : undefined,\n    publisher: {\n      '@type': 'Organization',\n      name: config.siteName,\n      logo: config.defaultImage\n        ? {\n            '@type': 'ImageObject',\n            url: config.defaultImage,\n          }\n        : undefined,\n    },\n    mainEntityOfPage: {\n      '@type': 'WebPage',\n      '@id': article.url || config.siteUrl,\n    },\n  }\n}\n\n/**\n * Generate FAQ structured data\n */\nexport function generateFaqSchema(faqs: FaqItem[]): object {\n  return {\n    '@context': 'https://schema.org',\n    '@type': 'FAQPage',\n    mainEntity: faqs.map((faq) => ({\n      '@type': 'Question',\n      name: faq.question,\n      acceptedAnswer: {\n        '@type': 'Answer',\n        text: faq.answer,\n      },\n    })),\n  }\n}\n\n/**\n * Render JSON-LD script tag\n */\nexport function renderJsonLd(data: object | object[]): string {\n  const jsonLd = Array.isArray(data) ? data : [data]\n  return `<script type=\"application/ld+json\">${JSON.stringify(jsonLd)}</script>`\n}\n\nexport * from './types'\n","/**\n * Site Settings Service\n *\n * Provides functions to fetch and manage global site settings\n * including header, footer, and announcement bar configurations.\n */\n\nimport { prisma } from '../db';\nimport { cache } from 'react';\n\nconst DEFAULT_SITE_SETTINGS_ID = 'default';\n\nexport interface SiteSettingsData {\n  id: string;\n  header: Record<string, unknown> | null;\n  footer: Record<string, unknown> | null;\n  announcementBar: Record<string, unknown> | null;\n  showAnnouncementBar: boolean;\n  siteName: string | null;\n  siteTagline: string | null;\n  logoUrl: string | null;\n  logoAlt: string | null;\n  faviconUrl: string | null;\n  socialLinks: Record<string, unknown>[] | null;\n  defaultMetaTitle: string | null;\n  defaultMetaDescription: string | null;\n  defaultOgImage: string | null;\n  contactEmail: string | null;\n  contactPhone: string | null;\n  businessAddress: Record<string, unknown> | null;\n  googleAnalyticsId: string | null;\n  facebookPixelId: string | null;\n}\n\n/**\n * Get site settings (cached per request)\n */\nexport const getSiteSettings = cache(async (): Promise<SiteSettingsData | null> => {\n  try {\n    const settings = await prisma.siteSettings.findUnique({\n      where: { id: DEFAULT_SITE_SETTINGS_ID },\n    });\n\n    if (!settings) {\n      return null;\n    }\n\n    return {\n      id: settings.id,\n      header: settings.header as Record<string, unknown> | null,\n      footer: settings.footer as Record<string, unknown> | null,\n      announcementBar: settings.announcementBar as Record<string, unknown> | null,\n      showAnnouncementBar: settings.showAnnouncementBar,\n      siteName: settings.siteName,\n      siteTagline: settings.siteTagline,\n      logoUrl: settings.logoUrl,\n      logoAlt: settings.logoAlt,\n      faviconUrl: settings.faviconUrl,\n      socialLinks: settings.socialLinks as Record<string, unknown>[] | null,\n      defaultMetaTitle: settings.defaultMetaTitle,\n      defaultMetaDescription: settings.defaultMetaDescription,\n      defaultOgImage: settings.defaultOgImage,\n      contactEmail: settings.contactEmail,\n      contactPhone: settings.contactPhone,\n      businessAddress: settings.businessAddress as Record<string, unknown> | null,\n      googleAnalyticsId: settings.googleAnalyticsId,\n      facebookPixelId: settings.facebookPixelId,\n    };\n  } catch (error) {\n    console.error('Error fetching site settings:', error);\n    return null;\n  }\n});\n\n/**\n * Get or create default site settings\n */\nexport async function getOrCreateSiteSettings(): Promise<SiteSettingsData> {\n  let settings = await getSiteSettings();\n\n  if (!settings) {\n    // Create default settings\n    const created = await prisma.siteSettings.create({\n      data: {\n        id: DEFAULT_SITE_SETTINGS_ID,\n        showAnnouncementBar: false,\n      },\n    });\n\n    settings = {\n      id: created.id,\n      header: null,\n      footer: null,\n      announcementBar: null,\n      showAnnouncementBar: created.showAnnouncementBar,\n      siteName: null,\n      siteTagline: null,\n      logoUrl: null,\n      logoAlt: null,\n      faviconUrl: null,\n      socialLinks: null,\n      defaultMetaTitle: null,\n      defaultMetaDescription: null,\n      defaultOgImage: null,\n      contactEmail: null,\n      contactPhone: null,\n      businessAddress: null,\n      googleAnalyticsId: null,\n      facebookPixelId: null,\n    };\n  }\n\n  return settings;\n}\n\n/**\n * Update site settings\n */\nexport async function updateSiteSettings(\n  data: Partial<Omit<SiteSettingsData, 'id'>>\n): Promise<SiteSettingsData> {\n  // Convert data to Prisma-compatible format\n  const prismaData = {\n    ...(data.header !== undefined && { header: data.header as object }),\n    ...(data.footer !== undefined && { footer: data.footer as object }),\n    ...(data.announcementBar !== undefined && { announcementBar: data.announcementBar as object }),\n    ...(data.showAnnouncementBar !== undefined && { showAnnouncementBar: data.showAnnouncementBar }),\n    ...(data.siteName !== undefined && { siteName: data.siteName }),\n    ...(data.siteTagline !== undefined && { siteTagline: data.siteTagline }),\n    ...(data.logoUrl !== undefined && { logoUrl: data.logoUrl }),\n    ...(data.logoAlt !== undefined && { logoAlt: data.logoAlt }),\n    ...(data.faviconUrl !== undefined && { faviconUrl: data.faviconUrl }),\n    ...(data.socialLinks !== undefined && { socialLinks: data.socialLinks as object }),\n    ...(data.defaultMetaTitle !== undefined && { defaultMetaTitle: data.defaultMetaTitle }),\n    ...(data.defaultMetaDescription !== undefined && { defaultMetaDescription: data.defaultMetaDescription }),\n    ...(data.defaultOgImage !== undefined && { defaultOgImage: data.defaultOgImage }),\n    ...(data.contactEmail !== undefined && { contactEmail: data.contactEmail }),\n    ...(data.contactPhone !== undefined && { contactPhone: data.contactPhone }),\n    ...(data.businessAddress !== undefined && { businessAddress: data.businessAddress as object }),\n    ...(data.googleAnalyticsId !== undefined && { googleAnalyticsId: data.googleAnalyticsId }),\n    ...(data.facebookPixelId !== undefined && { facebookPixelId: data.facebookPixelId }),\n  };\n\n  const updated = await prisma.siteSettings.upsert({\n    where: { id: DEFAULT_SITE_SETTINGS_ID },\n    create: {\n      id: DEFAULT_SITE_SETTINGS_ID,\n      ...prismaData,\n    },\n    update: prismaData,\n  });\n\n  return {\n    id: updated.id,\n    header: updated.header as Record<string, unknown> | null,\n    footer: updated.footer as Record<string, unknown> | null,\n    announcementBar: updated.announcementBar as Record<string, unknown> | null,\n    showAnnouncementBar: updated.showAnnouncementBar,\n    siteName: updated.siteName,\n    siteTagline: updated.siteTagline,\n    logoUrl: updated.logoUrl,\n    logoAlt: updated.logoAlt,\n    faviconUrl: updated.faviconUrl,\n    socialLinks: updated.socialLinks as Record<string, unknown>[] | null,\n    defaultMetaTitle: updated.defaultMetaTitle,\n    defaultMetaDescription: updated.defaultMetaDescription,\n    defaultOgImage: updated.defaultOgImage,\n    contactEmail: updated.contactEmail,\n    contactPhone: updated.contactPhone,\n    businessAddress: updated.businessAddress as Record<string, unknown> | null,\n    googleAnalyticsId: updated.googleAnalyticsId,\n    facebookPixelId: updated.facebookPixelId,\n  };\n}\n\n/**\n * Update header configuration\n */\nexport async function updateHeaderConfig(\n  headerData: Record<string, unknown>\n): Promise<SiteSettingsData> {\n  return updateSiteSettings({ header: headerData });\n}\n\n/**\n * Update footer configuration\n */\nexport async function updateFooterConfig(\n  footerData: Record<string, unknown>\n): Promise<SiteSettingsData> {\n  return updateSiteSettings({ footer: footerData });\n}\n\n/**\n * Update announcement bar configuration\n */\nexport async function updateAnnouncementBarConfig(\n  announcementData: Record<string, unknown>,\n  showAnnouncementBar: boolean\n): Promise<SiteSettingsData> {\n  return updateSiteSettings({\n    announcementBar: announcementData,\n    showAnnouncementBar,\n  });\n}\n","/**\n * Event Bus System\n *\n * Pub/sub event system for triggering workflows based on system events.\n * Supports event filtering, priority-based handlers, and async execution.\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { prisma } from '../db';\nimport type {\n  WorkflowEvent,\n  WorkflowEventType,\n  EventSubscription,\n} from './types';\n\n// =============================================================================\n// EVENT BUS SINGLETON\n// =============================================================================\n\nclass EventBus {\n  private subscriptions: Map<string, EventSubscription[]> = new Map();\n  private eventHistory: WorkflowEvent[] = [];\n  private maxHistorySize = 1000;\n\n  /**\n   * Subscribe to events\n   */\n  subscribe(subscription: Omit<EventSubscription, 'id'>): string {\n    const id = uuidv4();\n    const fullSubscription: EventSubscription = { ...subscription, id };\n\n    const eventTypes = Array.isArray(subscription.eventType)\n      ? subscription.eventType\n      : [subscription.eventType];\n\n    for (const eventType of eventTypes) {\n      const existing = this.subscriptions.get(eventType) || [];\n      existing.push(fullSubscription);\n      // Sort by priority (higher first)\n      existing.sort((a, b) => (b.priority || 0) - (a.priority || 0));\n      this.subscriptions.set(eventType, existing);\n    }\n\n    return id;\n  }\n\n  /**\n   * Unsubscribe from events\n   */\n  unsubscribe(subscriptionId: string): boolean {\n    let found = false;\n\n    for (const [eventType, subs] of this.subscriptions.entries()) {\n      const filtered = subs.filter((s) => s.id !== subscriptionId);\n      if (filtered.length !== subs.length) {\n        found = true;\n        this.subscriptions.set(eventType, filtered);\n      }\n    }\n\n    return found;\n  }\n\n  /**\n   * Emit an event\n   */\n  async emit<T = unknown>(\n    type: WorkflowEventType,\n    data: T,\n    metadata?: WorkflowEvent['metadata']\n  ): Promise<void> {\n    const event: WorkflowEvent<T> = {\n      id: uuidv4(),\n      type,\n      timestamp: new Date(),\n      data,\n      metadata,\n    };\n\n    // Add to history\n    this.eventHistory.push(event as WorkflowEvent);\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory = this.eventHistory.slice(-this.maxHistorySize);\n    }\n\n    // Get subscribers for this event type\n    const subscribers = this.subscriptions.get(type) || [];\n    const wildcardSubscribers = this.subscriptions.get('*') || [];\n    const allSubscribers = [...subscribers, ...wildcardSubscribers];\n\n    // Execute handlers\n    for (const subscription of allSubscribers) {\n      try {\n        // Apply filter if present\n        if (subscription.filter && !subscription.filter(event as WorkflowEvent)) {\n          continue;\n        }\n\n        await subscription.handler(event as WorkflowEvent);\n      } catch (error) {\n        console.error(`[EventBus] Handler error for ${type}:`, error);\n      }\n    }\n\n    // Trigger workflows configured for this event\n    await this.triggerEventWorkflows(event as WorkflowEvent);\n  }\n\n  /**\n   * Emit event without waiting for handlers (fire-and-forget)\n   */\n  emitAsync<T = unknown>(\n    type: WorkflowEventType,\n    data: T,\n    metadata?: WorkflowEvent['metadata']\n  ): void {\n    this.emit(type, data, metadata).catch((error) => {\n      console.error(`[EventBus] Async emit error for ${type}:`, error);\n    });\n  }\n\n  /**\n   * Get recent events\n   */\n  getHistory(limit = 100): WorkflowEvent[] {\n    return this.eventHistory.slice(-limit);\n  }\n\n  /**\n   * Get subscriptions for debugging\n   */\n  getSubscriptions(): Map<string, EventSubscription[]> {\n    return new Map(this.subscriptions);\n  }\n\n  /**\n   * Clear all subscriptions (for testing)\n   */\n  clearSubscriptions(): void {\n    this.subscriptions.clear();\n  }\n\n  /**\n   * Trigger workflows configured for EVENT trigger type\n   */\n  private async triggerEventWorkflows(event: WorkflowEvent): Promise<void> {\n    try {\n      // Find enabled workflows with EVENT trigger that match this event type\n      const workflows = await prisma.workflow.findMany({\n        where: {\n          enabled: true,\n          triggerType: 'EVENT',\n        },\n      });\n\n      for (const workflow of workflows) {\n        const triggerConfig = workflow.triggerConfig as Record<string, unknown> | null;\n        if (!triggerConfig) continue;\n\n        const eventTypes = triggerConfig.eventTypes as string[] | undefined;\n        if (!eventTypes || !eventTypes.includes(event.type)) continue;\n\n        // Check event filter if present\n        const filter = triggerConfig.filter as Record<string, unknown> | undefined;\n        if (filter && !this.matchesFilter(event.data, filter)) continue;\n\n        // Queue workflow execution (import dynamically to avoid circular deps)\n        const { executeWorkflow } = await import('./engine');\n        executeWorkflow(workflow.id, {\n          triggeredBy: 'event',\n          eventData: event,\n        }).catch((error) => {\n          console.error(`[EventBus] Workflow execution error for ${workflow.id}:`, error);\n        });\n      }\n    } catch (error) {\n      console.error('[EventBus] Error triggering event workflows:', error);\n    }\n  }\n\n  /**\n   * Check if data matches a filter object\n   */\n  private matchesFilter(data: unknown, filter: Record<string, unknown>): boolean {\n    if (!data || typeof data !== 'object') return false;\n\n    const dataObj = data as Record<string, unknown>;\n\n    for (const [key, value] of Object.entries(filter)) {\n      const dataValue = this.getNestedValue(dataObj, key);\n\n      if (typeof value === 'object' && value !== null) {\n        // Handle operators like $eq, $gt, $in, etc.\n        const ops = value as Record<string, unknown>;\n        if ('$eq' in ops && dataValue !== ops.$eq) return false;\n        if ('$neq' in ops && dataValue === ops.$neq) return false;\n        if ('$gt' in ops && (typeof dataValue !== 'number' || dataValue <= (ops.$gt as number))) return false;\n        if ('$gte' in ops && (typeof dataValue !== 'number' || dataValue < (ops.$gte as number))) return false;\n        if ('$lt' in ops && (typeof dataValue !== 'number' || dataValue >= (ops.$lt as number))) return false;\n        if ('$lte' in ops && (typeof dataValue !== 'number' || dataValue > (ops.$lte as number))) return false;\n        if ('$in' in ops && !Array.isArray(ops.$in)) return false;\n        if ('$in' in ops && !(ops.$in as unknown[]).includes(dataValue)) return false;\n        if ('$contains' in ops && (typeof dataValue !== 'string' || !dataValue.includes(ops.$contains as string))) return false;\n        if ('$exists' in ops && (ops.$exists ? dataValue === undefined : dataValue !== undefined)) return false;\n      } else {\n        // Simple equality check\n        if (dataValue !== value) return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Get nested value from object using dot notation\n   */\n  private getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n    return path.split('.').reduce((current: unknown, key) => {\n      if (current && typeof current === 'object') {\n        return (current as Record<string, unknown>)[key];\n      }\n      return undefined;\n    }, obj);\n  }\n}\n\n// =============================================================================\n// SINGLETON INSTANCE\n// =============================================================================\n\nexport const eventBus = new EventBus();\n\n// =============================================================================\n// HELPER FUNCTIONS\n// =============================================================================\n\n/**\n * Emit an event (convenience function)\n */\nexport function emit<T = unknown>(\n  type: WorkflowEventType,\n  data: T,\n  metadata?: WorkflowEvent['metadata']\n): Promise<void> {\n  return eventBus.emit(type, data, metadata);\n}\n\n/**\n * Emit an event without waiting (convenience function)\n */\nexport function emitAsync<T = unknown>(\n  type: WorkflowEventType,\n  data: T,\n  metadata?: WorkflowEvent['metadata']\n): void {\n  eventBus.emitAsync(type, data, metadata);\n}\n\n/**\n * Subscribe to events (convenience function)\n */\nexport function subscribe(subscription: Omit<EventSubscription, 'id'>): string {\n  return eventBus.subscribe(subscription);\n}\n\n/**\n * Unsubscribe from events (convenience function)\n */\nexport function unsubscribe(subscriptionId: string): boolean {\n  return eventBus.unsubscribe(subscriptionId);\n}\n\n// =============================================================================\n// PREDEFINED EVENT EMITTERS\n// =============================================================================\n\nexport const events = {\n  // Order events\n  order: {\n    created: (order: unknown) => emit('order.created', order),\n    paid: (order: unknown) => emit('order.paid', order),\n    shipped: (order: unknown, shipment?: unknown) => emit('order.shipped', { order, shipment }),\n    delivered: (order: unknown) => emit('order.delivered', order),\n    cancelled: (order: unknown, reason?: string) => emit('order.cancelled', { order, reason }),\n    refunded: (order: unknown, refund?: unknown) => emit('order.refunded', { order, refund }),\n  },\n\n  // User events\n  user: {\n    created: (user: unknown) => emit('user.created', user),\n    updated: (user: unknown, changes?: unknown) => emit('user.updated', { user, changes }),\n    deleted: (userId: string) => emit('user.deleted', { userId }),\n    subscribed: (user: unknown, list?: string) => emit('user.subscribed', { user, list }),\n    unsubscribed: (user: unknown, list?: string) => emit('user.unsubscribed', { user, list }),\n  },\n\n  // Product events\n  product: {\n    created: (product: unknown) => emit('product.created', product),\n    updated: (product: unknown, changes?: unknown) => emit('product.updated', { product, changes }),\n    deleted: (productId: string) => emit('product.deleted', { productId }),\n    lowStock: (product: unknown, threshold: number) => emit('product.low_stock', { product, threshold }),\n    outOfStock: (product: unknown) => emit('product.out_of_stock', product),\n  },\n\n  // Content events\n  content: {\n    pageCreated: (page: unknown) => emit('page.created', page),\n    pagePublished: (page: unknown) => emit('page.published', page),\n    pageUpdated: (page: unknown) => emit('page.updated', page),\n    blogCreated: (post: unknown) => emit('blog.created', post),\n    blogPublished: (post: unknown) => emit('blog.published', post),\n    blogUpdated: (post: unknown) => emit('blog.updated', post),\n  },\n\n  // Payment events\n  payment: {\n    succeeded: (payment: unknown) => emit('payment.succeeded', payment),\n    failed: (payment: unknown, error?: string) => emit('payment.failed', { payment, error }),\n    subscriptionCreated: (subscription: unknown) => emit('subscription.created', subscription),\n    subscriptionCancelled: (subscription: unknown) => emit('subscription.cancelled', subscription),\n  },\n\n  // Form events\n  form: {\n    submitted: (form: unknown, data: unknown) => emit('form.submitted', { form, data }),\n    contactCreated: (contact: unknown) => emit('contact.created', contact),\n  },\n\n  // Webhook events\n  webhook: {\n    received: (source: string, payload: unknown) => emit('webhook.received', { source, payload }),\n  },\n\n  // Custom events\n  custom: (eventType: string, data: unknown) => emit(eventType, data),\n};\n","/**\n * React Flow Integration\n *\n * Utilities for integrating workflows with React Flow visual editor.\n * Handles node/edge conversion, validation, and workflow serialization.\n */\n\n// React Flow types (defined locally to avoid hard dependency)\n// These match the reactflow package types for compatibility\nexport interface XYPosition {\n  x: number;\n  y: number;\n}\n\nexport interface Viewport {\n  x: number;\n  y: number;\n  zoom: number;\n}\n\nexport interface Node<T = unknown> {\n  id: string;\n  type?: string;\n  position: XYPosition;\n  data: T;\n  width?: number;\n  height?: number;\n  selected?: boolean;\n  dragging?: boolean;\n  hidden?: boolean;\n}\n\nexport interface Edge<T = unknown> {\n  id: string;\n  source: string;\n  target: string;\n  sourceHandle?: string | null;\n  targetHandle?: string | null;\n  type?: string;\n  animated?: boolean;\n  hidden?: boolean;\n  data?: T;\n  label?: string;\n  selected?: boolean;\n}\n\nimport type {\n  WorkflowTemplateNode,\n  WorkflowTemplateEdge,\n  WorkflowNodeType,\n  WorkflowNodeConfig,\n  WorkflowCondition,\n} from './types';\n\n// =============================================================================\n// NODE TYPES FOR REACT FLOW\n// =============================================================================\n\nexport interface WorkflowNodeData {\n  label: string;\n  nodeType: WorkflowNodeType;\n  primitiveId?: string;\n  primitiveName?: string;\n  primitiveIcon?: string;\n  config?: WorkflowNodeConfig;\n  // UI state\n  isExecuting?: boolean;\n  isCompleted?: boolean;\n  hasError?: boolean;\n  errorMessage?: string;\n  executionTime?: number;\n}\n\nexport interface WorkflowEdgeData {\n  condition?: WorkflowCondition;\n  label?: string;\n}\n\nexport type WorkflowReactFlowNode = Node<WorkflowNodeData>;\nexport type WorkflowReactFlowEdge = Edge<WorkflowEdgeData>;\n\n// =============================================================================\n// NODE DEFINITIONS\n// =============================================================================\n\nexport interface NodeTypeDefinition {\n  type: WorkflowNodeType;\n  label: string;\n  description: string;\n  icon: string;\n  color: string;\n  category: 'trigger' | 'action' | 'control' | 'output';\n  handles: {\n    inputs: number;\n    outputs: number;\n    conditionalOutputs?: string[];\n  };\n  defaultConfig?: WorkflowNodeConfig;\n}\n\nexport const nodeTypeDefinitions: Record<WorkflowNodeType, NodeTypeDefinition> = {\n  trigger: {\n    type: 'trigger',\n    label: 'Trigger',\n    description: 'Starting point of the workflow',\n    icon: 'Zap',\n    color: '#f59e0b',\n    category: 'trigger',\n    handles: { inputs: 0, outputs: 1 },\n  },\n  primitive: {\n    type: 'primitive',\n    label: 'Action',\n    description: 'Execute a primitive action',\n    icon: 'Play',\n    color: '#3b82f6',\n    category: 'action',\n    handles: { inputs: 1, outputs: 1 },\n  },\n  condition: {\n    type: 'condition',\n    label: 'Condition',\n    description: 'Branch based on conditions',\n    icon: 'GitBranch',\n    color: '#8b5cf6',\n    category: 'control',\n    handles: { inputs: 1, outputs: 2, conditionalOutputs: ['true', 'false'] },\n  },\n  loop: {\n    type: 'loop',\n    label: 'Loop',\n    description: 'Iterate over a collection',\n    icon: 'Repeat',\n    color: '#10b981',\n    category: 'control',\n    handles: { inputs: 1, outputs: 2, conditionalOutputs: ['body', 'complete'] },\n  },\n  delay: {\n    type: 'delay',\n    label: 'Delay',\n    description: 'Wait for a specified duration',\n    icon: 'Clock',\n    color: '#6b7280',\n    category: 'control',\n    handles: { inputs: 1, outputs: 1 },\n  },\n  parallel: {\n    type: 'parallel',\n    label: 'Parallel',\n    description: 'Execute multiple branches simultaneously',\n    icon: 'GitMerge',\n    color: '#ec4899',\n    category: 'control',\n    handles: { inputs: 1, outputs: 4 },\n  },\n  output: {\n    type: 'output',\n    label: 'Output',\n    description: 'Workflow output/result',\n    icon: 'Flag',\n    color: '#14b8a6',\n    category: 'output',\n    handles: { inputs: 1, outputs: 0 },\n  },\n};\n\n// =============================================================================\n// CONVERSION UTILITIES\n// =============================================================================\n\n/**\n * Convert workflow template nodes to React Flow nodes\n */\nexport function toReactFlowNodes(\n  templateNodes: WorkflowTemplateNode[]\n): WorkflowReactFlowNode[] {\n  return templateNodes.map((node) => ({\n    id: node.id,\n    type: getReactFlowNodeType(node.data.nodeType),\n    position: node.position,\n    data: {\n      label: node.data.label,\n      nodeType: node.data.nodeType,\n      primitiveId: node.data.primitiveId,\n      config: node.data.config,\n    },\n  }));\n}\n\n/**\n * Convert workflow template edges to React Flow edges\n */\nexport function toReactFlowEdges(\n  templateEdges: WorkflowTemplateEdge[]\n): WorkflowReactFlowEdge[] {\n  return templateEdges.map((edge) => ({\n    id: edge.id,\n    source: edge.source,\n    target: edge.target,\n    sourceHandle: edge.sourceHandle,\n    targetHandle: edge.targetHandle,\n    type: edge.data?.condition ? 'conditional' : 'default',\n    animated: false,\n    data: edge.data,\n  }));\n}\n\n/**\n * Convert React Flow nodes back to workflow template format\n */\nexport function fromReactFlowNodes(\n  nodes: WorkflowReactFlowNode[]\n): WorkflowTemplateNode[] {\n  return nodes.map((node) => ({\n    id: node.id,\n    type: node.data.nodeType,\n    position: node.position,\n    data: {\n      label: node.data.label,\n      nodeType: node.data.nodeType,\n      primitiveId: node.data.primitiveId,\n      config: node.data.config,\n    },\n  }));\n}\n\n/**\n * Convert React Flow edges back to workflow template format\n */\nexport function fromReactFlowEdges(\n  edges: WorkflowReactFlowEdge[]\n): WorkflowTemplateEdge[] {\n  return edges.map((edge) => ({\n    id: edge.id,\n    source: edge.source,\n    target: edge.target,\n    sourceHandle: edge.sourceHandle ?? undefined,\n    targetHandle: edge.targetHandle ?? undefined,\n    data: edge.data,\n  }));\n}\n\n/**\n * Get React Flow node type from workflow node type\n */\nfunction getReactFlowNodeType(nodeType: WorkflowNodeType): string {\n  // Map to custom node types if you have them registered\n  return `workflow-${nodeType}`;\n}\n\n// =============================================================================\n// WORKFLOW VALIDATION\n// =============================================================================\n\nexport interface WorkflowValidationResult {\n  valid: boolean;\n  errors: WorkflowValidationError[];\n  warnings: WorkflowValidationWarning[];\n}\n\nexport interface WorkflowValidationError {\n  type: 'error';\n  code: string;\n  message: string;\n  nodeId?: string;\n  edgeId?: string;\n}\n\nexport interface WorkflowValidationWarning {\n  type: 'warning';\n  code: string;\n  message: string;\n  nodeId?: string;\n}\n\n/**\n * Validate a workflow graph\n */\nexport function validateWorkflow(\n  nodes: WorkflowReactFlowNode[],\n  edges: WorkflowReactFlowEdge[]\n): WorkflowValidationResult {\n  const errors: WorkflowValidationError[] = [];\n  const warnings: WorkflowValidationWarning[] = [];\n\n  // Check for trigger node\n  const triggerNodes = nodes.filter((n) => n.data.nodeType === 'trigger');\n  if (triggerNodes.length === 0) {\n    errors.push({\n      type: 'error',\n      code: 'NO_TRIGGER',\n      message: 'Workflow must have at least one trigger node',\n    });\n  }\n  if (triggerNodes.length > 1) {\n    warnings.push({\n      type: 'warning',\n      code: 'MULTIPLE_TRIGGERS',\n      message: 'Workflow has multiple trigger nodes',\n    });\n  }\n\n  // Check for disconnected nodes\n  const connectedNodeIds = new Set<string>();\n  edges.forEach((edge) => {\n    connectedNodeIds.add(edge.source);\n    connectedNodeIds.add(edge.target);\n  });\n\n  nodes.forEach((node) => {\n    // Trigger nodes don't need incoming connections\n    if (node.data.nodeType === 'trigger') {\n      if (!edges.some((e) => e.source === node.id)) {\n        warnings.push({\n          type: 'warning',\n          code: 'DEAD_END_TRIGGER',\n          message: `Trigger node \"${node.data.label}\" has no outgoing connections`,\n          nodeId: node.id,\n        });\n      }\n      return;\n    }\n\n    // Other nodes should have incoming connections\n    if (!edges.some((e) => e.target === node.id)) {\n      errors.push({\n        type: 'error',\n        code: 'DISCONNECTED_NODE',\n        message: `Node \"${node.data.label}\" has no incoming connections`,\n        nodeId: node.id,\n      });\n    }\n  });\n\n  // Check primitive nodes have primitiveId\n  nodes\n    .filter((n) => n.data.nodeType === 'primitive')\n    .forEach((node) => {\n      if (!node.data.primitiveId) {\n        errors.push({\n          type: 'error',\n          code: 'MISSING_PRIMITIVE',\n          message: `Action node \"${node.data.label}\" has no primitive assigned`,\n          nodeId: node.id,\n        });\n      }\n    });\n\n  // Check condition nodes have conditions\n  nodes\n    .filter((n) => n.data.nodeType === 'condition')\n    .forEach((node) => {\n      if (!node.data.config?.condition) {\n        warnings.push({\n          type: 'warning',\n          code: 'MISSING_CONDITION',\n          message: `Condition node \"${node.data.label}\" has no condition configured`,\n          nodeId: node.id,\n        });\n      }\n    });\n\n  // Check for cycles (simplified - just check direct self-loops)\n  edges.forEach((edge) => {\n    if (edge.source === edge.target) {\n      errors.push({\n        type: 'error',\n        code: 'SELF_LOOP',\n        message: 'Edge creates a self-loop',\n        edgeId: edge.id,\n      });\n    }\n  });\n\n  return {\n    valid: errors.length === 0,\n    errors,\n    warnings,\n  };\n}\n\n// =============================================================================\n// LAYOUT UTILITIES\n// =============================================================================\n\n/**\n * Auto-layout nodes in a hierarchical fashion\n */\nexport function autoLayoutNodes(\n  nodes: WorkflowReactFlowNode[],\n  edges: WorkflowReactFlowEdge[],\n  options?: {\n    direction?: 'TB' | 'LR';\n    nodeSpacingX?: number;\n    nodeSpacingY?: number;\n  }\n): WorkflowReactFlowNode[] {\n  const direction = options?.direction || 'TB';\n  const spacingX = options?.nodeSpacingX || 200;\n  const spacingY = options?.nodeSpacingY || 100;\n\n  // Build adjacency list\n  const children = new Map<string, string[]>();\n  const parents = new Map<string, string[]>();\n\n  nodes.forEach((node) => {\n    children.set(node.id, []);\n    parents.set(node.id, []);\n  });\n\n  edges.forEach((edge) => {\n    children.get(edge.source)?.push(edge.target);\n    parents.get(edge.target)?.push(edge.source);\n  });\n\n  // Find root nodes (no parents or trigger nodes)\n  const rootNodes = nodes.filter(\n    (n) =>\n      n.data.nodeType === 'trigger' || parents.get(n.id)?.length === 0\n  );\n\n  // Calculate levels using BFS\n  const levels = new Map<string, number>();\n  const queue: { id: string; level: number }[] = rootNodes.map((n) => ({\n    id: n.id,\n    level: 0,\n  }));\n\n  while (queue.length > 0) {\n    const { id, level } = queue.shift()!;\n\n    if (levels.has(id)) continue;\n    levels.set(id, level);\n\n    const nodeChildren = children.get(id) || [];\n    nodeChildren.forEach((childId) => {\n      queue.push({ id: childId, level: level + 1 });\n    });\n  }\n\n  // Group nodes by level\n  const levelGroups = new Map<number, string[]>();\n  levels.forEach((level, nodeId) => {\n    if (!levelGroups.has(level)) {\n      levelGroups.set(level, []);\n    }\n    levelGroups.get(level)!.push(nodeId);\n  });\n\n  // Position nodes\n  const nodeMap = new Map(nodes.map((n) => [n.id, n]));\n\n  return nodes.map((node) => {\n    const level = levels.get(node.id) || 0;\n    const nodesAtLevel = levelGroups.get(level) || [];\n    const indexAtLevel = nodesAtLevel.indexOf(node.id);\n\n    const totalWidth = (nodesAtLevel.length - 1) * spacingX;\n    const startX = -totalWidth / 2;\n\n    let position: XYPosition;\n    if (direction === 'TB') {\n      position = {\n        x: startX + indexAtLevel * spacingX,\n        y: level * spacingY,\n      };\n    } else {\n      position = {\n        x: level * spacingX,\n        y: startX + indexAtLevel * spacingY,\n      };\n    }\n\n    return {\n      ...node,\n      position,\n    };\n  });\n}\n\n// =============================================================================\n// NODE CREATION HELPERS\n// =============================================================================\n\nlet nodeIdCounter = 0;\n\n/**\n * Generate a unique node ID\n */\nexport function generateNodeId(): string {\n  return `node_${Date.now()}_${++nodeIdCounter}`;\n}\n\n/**\n * Generate a unique edge ID\n */\nexport function generateEdgeId(source: string, target: string): string {\n  return `edge_${source}_${target}_${++nodeIdCounter}`;\n}\n\n/**\n * Create a new trigger node\n */\nexport function createTriggerNode(\n  position: XYPosition,\n  triggerType: 'manual' | 'schedule' | 'webhook' | 'event'\n): WorkflowReactFlowNode {\n  return {\n    id: generateNodeId(),\n    type: 'workflow-trigger',\n    position,\n    data: {\n      label: `${triggerType.charAt(0).toUpperCase() + triggerType.slice(1)} Trigger`,\n      nodeType: 'trigger',\n      config: {},\n    },\n  };\n}\n\n/**\n * Create a new primitive/action node\n */\nexport function createPrimitiveNode(\n  position: XYPosition,\n  primitiveId: string,\n  primitiveName: string,\n  primitiveIcon?: string\n): WorkflowReactFlowNode {\n  return {\n    id: generateNodeId(),\n    type: 'workflow-primitive',\n    position,\n    data: {\n      label: primitiveName,\n      nodeType: 'primitive',\n      primitiveId,\n      primitiveName,\n      primitiveIcon,\n      config: {\n        inputMapping: {},\n      },\n    },\n  };\n}\n\n/**\n * Create a new condition node\n */\nexport function createConditionNode(\n  position: XYPosition,\n  label = 'Condition'\n): WorkflowReactFlowNode {\n  return {\n    id: generateNodeId(),\n    type: 'workflow-condition',\n    position,\n    data: {\n      label,\n      nodeType: 'condition',\n      config: {\n        condition: {\n          type: 'simple',\n          field: '',\n          operator: 'eq',\n          value: '',\n        },\n      },\n    },\n  };\n}\n\n/**\n * Create a new output node\n */\nexport function createOutputNode(\n  position: XYPosition,\n  label = 'Output'\n): WorkflowReactFlowNode {\n  return {\n    id: generateNodeId(),\n    type: 'workflow-output',\n    position,\n    data: {\n      label,\n      nodeType: 'output',\n      config: {\n        inputMapping: {},\n      },\n    },\n  };\n}\n\n// =============================================================================\n// SERIALIZATION\n// =============================================================================\n\nexport interface WorkflowGraphData {\n  nodes: WorkflowTemplateNode[];\n  edges: WorkflowTemplateEdge[];\n  viewport?: Viewport;\n}\n\n/**\n * Serialize workflow for storage\n */\nexport function serializeWorkflow(\n  nodes: WorkflowReactFlowNode[],\n  edges: WorkflowReactFlowEdge[],\n  viewport?: Viewport\n): WorkflowGraphData {\n  return {\n    nodes: fromReactFlowNodes(nodes),\n    edges: fromReactFlowEdges(edges),\n    viewport,\n  };\n}\n\n/**\n * Deserialize workflow for React Flow\n */\nexport function deserializeWorkflow(data: WorkflowGraphData): {\n  nodes: WorkflowReactFlowNode[];\n  edges: WorkflowReactFlowEdge[];\n  viewport?: Viewport;\n} {\n  return {\n    nodes: toReactFlowNodes(data.nodes),\n    edges: toReactFlowEdges(data.edges),\n    viewport: data.viewport,\n  };\n}\n","/**\n * Built-in Workflow Actions\n *\n * Pre-built actions that can be used in workflows without creating primitives.\n * These handle common operations like HTTP requests, data transformation,\n * notifications, and integrations.\n */\n\nimport type { ActionDefinition, WorkflowContext } from '../types';\n\n// =============================================================================\n// ACTION REGISTRY\n// =============================================================================\n\nconst actionRegistry = new Map<string, ActionDefinition>();\n\n/**\n * Register an action\n */\nexport function registerAction(action: ActionDefinition): void {\n  actionRegistry.set(action.name, action);\n}\n\n/**\n * Get an action by name\n */\nexport function getAction(name: string): ActionDefinition | undefined {\n  return actionRegistry.get(name);\n}\n\n/**\n * Get all registered actions\n */\nexport function getAllActions(): ActionDefinition[] {\n  return Array.from(actionRegistry.values());\n}\n\n/**\n * Get actions by category\n */\nexport function getActionsByCategory(category: string): ActionDefinition[] {\n  return getAllActions().filter((a) => a.category === category);\n}\n\n/**\n * Execute a built-in action\n */\nexport async function executeAction(\n  name: string,\n  input: Record<string, unknown>,\n  context: WorkflowContext\n): Promise<unknown> {\n  const action = getAction(name);\n  if (!action) {\n    throw new Error(`Action not found: ${name}`);\n  }\n\n  return action.handler(input, context);\n}\n\n// =============================================================================\n// HTTP ACTIONS\n// =============================================================================\n\nregisterAction({\n  name: 'http.request',\n  description: 'Make an HTTP request',\n  category: 'http',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      url: { type: 'string', description: 'Request URL' },\n      method: { type: 'string', enum: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'] },\n      headers: { type: 'object', description: 'Request headers' },\n      body: { description: 'Request body' },\n      timeout: { type: 'number', description: 'Timeout in ms' },\n    },\n    required: ['url'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { url, method = 'GET', headers = {}, body, timeout = 30000 } = input;\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout as number);\n\n    try {\n      const response = await fetch(url as string, {\n        method: method as string,\n        headers: headers as HeadersInit,\n        body: body ? JSON.stringify(body) : undefined,\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      const contentType = response.headers.get('content-type');\n      let data: unknown;\n\n      if (contentType?.includes('application/json')) {\n        data = await response.json();\n      } else {\n        data = await response.text();\n      }\n\n      return {\n        status: response.status,\n        statusText: response.statusText,\n        headers: Object.fromEntries(response.headers.entries()),\n        data,\n        ok: response.ok,\n      };\n    } catch (error) {\n      clearTimeout(timeoutId);\n      throw error;\n    }\n  },\n});\n\nregisterAction({\n  name: 'http.webhook',\n  description: 'Send a webhook notification',\n  category: 'http',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      url: { type: 'string', description: 'Webhook URL' },\n      payload: { type: 'object', description: 'Webhook payload' },\n      secret: { type: 'string', description: 'Webhook secret for signing' },\n    },\n    required: ['url', 'payload'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { url, payload, secret } = input;\n\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n    };\n\n    // Add signature if secret provided\n    if (secret) {\n      const crypto = await import('crypto');\n      const signature = crypto\n        .createHmac('sha256', secret as string)\n        .update(JSON.stringify(payload))\n        .digest('hex');\n      headers['X-Webhook-Signature'] = signature;\n    }\n\n    const response = await fetch(url as string, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(payload),\n    });\n\n    return {\n      status: response.status,\n      success: response.ok,\n    };\n  },\n});\n\n// =============================================================================\n// DATA TRANSFORMATION ACTIONS\n// =============================================================================\n\nregisterAction({\n  name: 'data.transform',\n  description: 'Transform data using a mapping',\n  category: 'data',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      input: { description: 'Input data to transform' },\n      mapping: { type: 'object', description: 'Field mapping' },\n    },\n    required: ['input', 'mapping'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { input: data, mapping } = input;\n\n    if (!data || typeof data !== 'object') {\n      return data;\n    }\n\n    const dataObj = data as Record<string, unknown>;\n    const result: Record<string, unknown> = {};\n\n    for (const [targetKey, sourceKey] of Object.entries(mapping as Record<string, string>)) {\n      const value = sourceKey.split('.').reduce((obj: unknown, key) => {\n        if (obj && typeof obj === 'object') {\n          return (obj as Record<string, unknown>)[key];\n        }\n        return undefined;\n      }, dataObj);\n\n      result[targetKey] = value;\n    }\n\n    return result;\n  },\n});\n\nregisterAction({\n  name: 'data.filter',\n  description: 'Filter array data',\n  category: 'data',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      array: { type: 'array', description: 'Array to filter' },\n      field: { type: 'string', description: 'Field to check' },\n      operator: { type: 'string', enum: ['eq', 'neq', 'gt', 'gte', 'lt', 'lte', 'contains'] },\n      value: { description: 'Value to compare' },\n    },\n    required: ['array', 'field', 'operator', 'value'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { array, field, operator, value } = input;\n\n    if (!Array.isArray(array)) {\n      return [];\n    }\n\n    return array.filter((item) => {\n      const fieldValue = (item as Record<string, unknown>)[field as string];\n\n      switch (operator) {\n        case 'eq':\n          return fieldValue === value;\n        case 'neq':\n          return fieldValue !== value;\n        case 'gt':\n          return typeof fieldValue === 'number' && fieldValue > (value as number);\n        case 'gte':\n          return typeof fieldValue === 'number' && fieldValue >= (value as number);\n        case 'lt':\n          return typeof fieldValue === 'number' && fieldValue < (value as number);\n        case 'lte':\n          return typeof fieldValue === 'number' && fieldValue <= (value as number);\n        case 'contains':\n          return typeof fieldValue === 'string' && fieldValue.includes(value as string);\n        default:\n          return true;\n      }\n    });\n  },\n});\n\nregisterAction({\n  name: 'data.map',\n  description: 'Map array data to new structure',\n  category: 'data',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      array: { type: 'array', description: 'Array to map' },\n      mapping: { type: 'object', description: 'Field mapping for each item' },\n    },\n    required: ['array', 'mapping'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { array, mapping } = input;\n\n    if (!Array.isArray(array)) {\n      return [];\n    }\n\n    return array.map((item) => {\n      const result: Record<string, unknown> = {};\n      const itemObj = item as Record<string, unknown>;\n\n      for (const [targetKey, sourceKey] of Object.entries(mapping as Record<string, string>)) {\n        result[targetKey] = itemObj[sourceKey];\n      }\n\n      return result;\n    });\n  },\n});\n\nregisterAction({\n  name: 'data.aggregate',\n  description: 'Aggregate array data',\n  category: 'data',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      array: { type: 'array', description: 'Array to aggregate' },\n      operation: { type: 'string', enum: ['sum', 'avg', 'min', 'max', 'count'] },\n      field: { type: 'string', description: 'Field to aggregate (for sum, avg, min, max)' },\n    },\n    required: ['array', 'operation'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { array, operation, field } = input;\n\n    if (!Array.isArray(array)) {\n      return null;\n    }\n\n    const values = field\n      ? array.map((item) => (item as Record<string, unknown>)[field as string]).filter((v): v is number => typeof v === 'number')\n      : array.filter((v): v is number => typeof v === 'number');\n\n    switch (operation) {\n      case 'sum':\n        return values.reduce((a, b) => a + b, 0);\n      case 'avg':\n        return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : 0;\n      case 'min':\n        return values.length > 0 ? Math.min(...values) : null;\n      case 'max':\n        return values.length > 0 ? Math.max(...values) : null;\n      case 'count':\n        return array.length;\n      default:\n        return null;\n    }\n  },\n});\n\n// =============================================================================\n// LOGIC ACTIONS\n// =============================================================================\n\nregisterAction({\n  name: 'logic.switch',\n  description: 'Switch/case logic',\n  category: 'logic',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      value: { description: 'Value to switch on' },\n      cases: { type: 'object', description: 'Case mappings (value -> result)' },\n      default: { description: 'Default result if no case matches' },\n    },\n    required: ['value', 'cases'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { value, cases, default: defaultValue } = input;\n    const casesObj = cases as Record<string, unknown>;\n\n    const key = String(value);\n    if (key in casesObj) {\n      return casesObj[key];\n    }\n\n    return defaultValue;\n  },\n});\n\nregisterAction({\n  name: 'logic.coalesce',\n  description: 'Return first non-null value',\n  category: 'logic',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      values: { type: 'array', description: 'Array of values to check' },\n    },\n    required: ['values'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { values } = input;\n\n    if (!Array.isArray(values)) {\n      return null;\n    }\n\n    return values.find((v) => v !== null && v !== undefined) ?? null;\n  },\n});\n\n// =============================================================================\n// STRING ACTIONS\n// =============================================================================\n\nregisterAction({\n  name: 'string.template',\n  description: 'Render a string template',\n  category: 'string',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      template: { type: 'string', description: 'Template string with {{placeholders}}' },\n      data: { type: 'object', description: 'Data for placeholders' },\n    },\n    required: ['template', 'data'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { template, data } = input;\n    const dataObj = data as Record<string, unknown>;\n\n    return (template as string).replace(/\\{\\{([^}]+)\\}\\}/g, (_, key) => {\n      const value = dataObj[key.trim()];\n      return value !== undefined && value !== null ? String(value) : '';\n    });\n  },\n});\n\nregisterAction({\n  name: 'string.format',\n  description: 'Format values (number, date, currency)',\n  category: 'string',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      value: { description: 'Value to format' },\n      type: { type: 'string', enum: ['number', 'date', 'currency', 'percent'] },\n      locale: { type: 'string', description: 'Locale for formatting' },\n      options: { type: 'object', description: 'Format options' },\n    },\n    required: ['value', 'type'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { value, type, locale = 'en-US', options = {} } = input;\n\n    switch (type) {\n      case 'number':\n        return new Intl.NumberFormat(locale as string, options as Intl.NumberFormatOptions).format(value as number);\n      case 'date':\n        return new Intl.DateTimeFormat(locale as string, options as Intl.DateTimeFormatOptions).format(new Date(value as string));\n      case 'currency':\n        return new Intl.NumberFormat(locale as string, {\n          style: 'currency',\n          currency: 'USD',\n          ...(options as Intl.NumberFormatOptions),\n        }).format(value as number);\n      case 'percent':\n        return new Intl.NumberFormat(locale as string, {\n          style: 'percent',\n          ...(options as Intl.NumberFormatOptions),\n        }).format(value as number);\n      default:\n        return String(value);\n    }\n  },\n});\n\n// =============================================================================\n// VARIABLE ACTIONS\n// =============================================================================\n\nregisterAction({\n  name: 'variable.set',\n  description: 'Set a workflow variable',\n  category: 'variable',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', description: 'Variable name' },\n      value: { description: 'Variable value' },\n    },\n    required: ['name', 'value'],\n  },\n  handler: async (input: Record<string, unknown>, context: WorkflowContext) => {\n    const { name, value } = input;\n    context.variables[name as string] = value;\n    return value;\n  },\n});\n\nregisterAction({\n  name: 'variable.get',\n  description: 'Get a workflow variable',\n  category: 'variable',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', description: 'Variable name' },\n      default: { description: 'Default value if not found' },\n    },\n    required: ['name'],\n  },\n  handler: async (input: Record<string, unknown>, context: WorkflowContext) => {\n    const { name, default: defaultValue } = input;\n    return context.variables[name as string] ?? defaultValue;\n  },\n});\n\n// =============================================================================\n// UTILITY ACTIONS\n// =============================================================================\n\nregisterAction({\n  name: 'util.log',\n  description: 'Log a message (for debugging)',\n  category: 'utility',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      message: { type: 'string', description: 'Log message' },\n      data: { description: 'Additional data to log' },\n      level: { type: 'string', enum: ['info', 'warn', 'error', 'debug'] },\n    },\n    required: ['message'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { message, data, level = 'info' } = input;\n\n    const logFn = console[level as 'info' | 'warn' | 'error' | 'debug'] || console.log;\n    logFn(`[Workflow] ${message}`, data || '');\n\n    return { logged: true, message, level };\n  },\n});\n\nregisterAction({\n  name: 'util.wait',\n  description: 'Wait for a specified duration',\n  category: 'utility',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      duration: { type: 'number', description: 'Duration in milliseconds' },\n    },\n    required: ['duration'],\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { duration } = input;\n    await new Promise((resolve) => setTimeout(resolve, duration as number));\n    return { waited: duration };\n  },\n});\n\nregisterAction({\n  name: 'util.timestamp',\n  description: 'Get current timestamp',\n  category: 'utility',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      format: { type: 'string', enum: ['iso', 'unix', 'date'] },\n    },\n  },\n  handler: async (input: Record<string, unknown>) => {\n    const { format = 'iso' } = input;\n    const now = new Date();\n\n    switch (format) {\n      case 'unix':\n        return Math.floor(now.getTime() / 1000);\n      case 'date':\n        return now.toDateString();\n      default:\n        return now.toISOString();\n    }\n  },\n});\n\nregisterAction({\n  name: 'util.uuid',\n  description: 'Generate a UUID',\n  category: 'utility',\n  inputSchema: {\n    type: 'object',\n    properties: {},\n  },\n  handler: async () => {\n    const { v4: uuidv4 } = await import('uuid');\n    return uuidv4();\n  },\n});\n\n// =============================================================================\n// EXPORT ACTION CATEGORIES\n// =============================================================================\n\nexport const actionCategories = [\n  { id: 'http', label: 'HTTP', icon: 'Globe' },\n  { id: 'data', label: 'Data', icon: 'Database' },\n  { id: 'logic', label: 'Logic', icon: 'GitBranch' },\n  { id: 'string', label: 'String', icon: 'Type' },\n  { id: 'variable', label: 'Variables', icon: 'Variable' },\n  { id: 'utility', label: 'Utility', icon: 'Wrench' },\n];\n","/**\n * Workflow Template Service\n *\n * Manages pre-built workflow templates that can be installed and customized.\n * Provides one-click installation of common e-commerce automation patterns.\n */\n\nimport { prisma } from '../../db'\nimport type {\n  WorkflowTemplate as PrismaWorkflowTemplate,\n  WorkflowTemplateCategory,\n  Workflow,\n  WorkflowTrigger,\n  WorkflowStep\n} from '@prisma/client'\nimport { generateNodeId, generateEdgeId, autoLayoutNodes } from '../react-flow'\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\nexport interface WorkflowTemplateWithDetails extends PrismaWorkflowTemplate {\n  workflowCount?: number\n}\n\nexport interface TemplateStepDefinition {\n  name: string\n  type: string\n  order: number\n  config?: Record<string, unknown>\n  conditions?: Record<string, unknown>\n}\n\nexport interface InstallTemplateOptions {\n  /** Custom name for the workflow (defaults to template name) */\n  name?: string\n  /** Enable the workflow immediately after install */\n  enabled?: boolean\n  /** Custom configuration overrides */\n  configOverrides?: Record<string, unknown>\n  /** Link to a plugin */\n  pluginId?: string\n}\n\nexport interface InstallResult {\n  success: boolean\n  workflow?: Workflow\n  steps?: WorkflowStep[]\n  error?: string\n}\n\n// =============================================================================\n// TEMPLATE QUERIES\n// =============================================================================\n\n/**\n * Get all available workflow templates\n */\nexport async function getWorkflowTemplates(options?: {\n  category?: WorkflowTemplateCategory\n  search?: string\n  onlyActive?: boolean\n  includeWorkflowCount?: boolean\n}): Promise<WorkflowTemplateWithDetails[]> {\n  const {\n    category,\n    search,\n    onlyActive = true,\n    includeWorkflowCount = false\n  } = options ?? {}\n\n  const templates = await prisma.workflowTemplate.findMany({\n    where: {\n      ...(onlyActive && { isActive: true }),\n      ...(category && { category }),\n      ...(search && {\n        OR: [\n          { name: { contains: search, mode: 'insensitive' } },\n          { description: { contains: search, mode: 'insensitive' } },\n          { tags: { has: search.toLowerCase() } }\n        ]\n      })\n    },\n    orderBy: [\n      { category: 'asc' },\n      { name: 'asc' }\n    ]\n  })\n\n  if (includeWorkflowCount) {\n    const templateIds = templates.map(t => t.id)\n    const workflowCounts = await prisma.workflow.groupBy({\n      by: ['templateId'],\n      where: { templateId: { in: templateIds } },\n      _count: true\n    })\n\n    const countMap = new Map(workflowCounts.map(wc => [wc.templateId, wc._count]))\n\n    return templates.map(template => ({\n      ...template,\n      workflowCount: countMap.get(template.id) ?? 0\n    }))\n  }\n\n  return templates\n}\n\n/**\n * Get a single workflow template by ID or slug\n */\nexport async function getWorkflowTemplate(\n  idOrSlug: string\n): Promise<WorkflowTemplateWithDetails | null> {\n  const template = await prisma.workflowTemplate.findFirst({\n    where: {\n      OR: [\n        { id: idOrSlug },\n        { slug: idOrSlug }\n      ]\n    }\n  })\n\n  if (!template) return null\n\n  const workflowCount = await prisma.workflow.count({\n    where: { templateId: template.id }\n  })\n\n  return {\n    ...template,\n    workflowCount\n  }\n}\n\n/**\n * Get templates by category with counts\n */\nexport async function getTemplatesByCategory(): Promise<\n  Record<WorkflowTemplateCategory, WorkflowTemplateWithDetails[]>\n> {\n  const templates = await getWorkflowTemplates({\n    includeWorkflowCount: true\n  })\n\n  const byCategory = templates.reduce((acc, template) => {\n    if (!acc[template.category]) {\n      acc[template.category] = []\n    }\n    acc[template.category].push(template)\n    return acc\n  }, {} as Record<WorkflowTemplateCategory, WorkflowTemplateWithDetails[]>)\n\n  return byCategory\n}\n\n/**\n * Get popular templates (most installed)\n */\nexport async function getPopularTemplates(limit = 5): Promise<WorkflowTemplateWithDetails[]> {\n  const templates = await getWorkflowTemplates({\n    includeWorkflowCount: true\n  })\n\n  return templates\n    .sort((a, b) => (b.workflowCount ?? 0) - (a.workflowCount ?? 0))\n    .slice(0, limit)\n}\n\n/**\n * Get recommended templates based on what's not yet installed\n */\nexport async function getRecommendedTemplates(limit = 4): Promise<WorkflowTemplateWithDetails[]> {\n  // Get all installed template IDs\n  const installedTemplates = await prisma.workflow.findMany({\n    where: { templateId: { not: null } },\n    select: { templateId: true },\n    distinct: ['templateId']\n  })\n\n  const installedIds = installedTemplates\n    .map(w => w.templateId)\n    .filter((id): id is string => id !== null)\n\n  // Get templates that aren't installed yet\n  const templates = await prisma.workflowTemplate.findMany({\n    where: {\n      isActive: true,\n      id: { notIn: installedIds },\n      tags: { has: 'essential' }\n    },\n    orderBy: { name: 'asc' },\n    take: limit\n  })\n\n  return templates\n}\n\n// =============================================================================\n// TEMPLATE INSTALLATION\n// =============================================================================\n\n/**\n * Install a workflow template as a new workflow\n */\nexport async function installWorkflowTemplate(\n  templateIdOrSlug: string,\n  options?: InstallTemplateOptions\n): Promise<InstallResult> {\n  try {\n    // Fetch the template\n    const template = await getWorkflowTemplate(templateIdOrSlug)\n\n    if (!template) {\n      return {\n        success: false,\n        error: `Template not found: ${templateIdOrSlug}`\n      }\n    }\n\n    // Generate unique slug\n    const baseSlug = `${template.slug}-copy`\n    let slug = baseSlug\n    let counter = 1\n\n    while (await prisma.workflow.findUnique({ where: { slug } })) {\n      slug = `${baseSlug}-${counter++}`\n    }\n\n    // Parse step definitions from template\n    const stepDefs = template.steps as unknown as TemplateStepDefinition[]\n\n    // Convert step definitions to React Flow nodes/edges\n    const { nodes, edges } = convertStepsToReactFlow(stepDefs, options?.configOverrides)\n\n    // Create the workflow\n    const workflow = await prisma.workflow.create({\n      data: {\n        name: options?.name ?? template.name,\n        slug,\n        description: template.description,\n        nodes,\n        edges,\n        viewport: { x: 0, y: 0, zoom: 1 },\n        triggerType: template.trigger,\n        triggerConfig: (template.triggerConfig as object ?? {}) as never,\n        config: (options?.configOverrides ?? {}) as never,\n        enabled: options?.enabled ?? false,\n        templateId: template.id,\n        pluginId: options?.pluginId\n      }\n    })\n\n    // Create workflow steps for easier querying\n    const steps = await Promise.all(\n      stepDefs.map((step, index) =>\n        prisma.workflowStep.create({\n          data: {\n            workflowId: workflow.id,\n            name: step.name,\n            type: step.type as any,\n            order: step.order ?? index,\n            config: (step.config ?? {}) as never,\n            conditions: (step.conditions ?? {}) as never,\n            enabled: true\n          }\n        })\n      )\n    )\n\n    return {\n      success: true,\n      workflow,\n      steps\n    }\n  } catch (error) {\n    console.error('Failed to install workflow template:', error)\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error'\n    }\n  }\n}\n\n/**\n * Convert template step definitions to React Flow format\n */\nfunction convertStepsToReactFlow(\n  steps: TemplateStepDefinition[],\n  configOverrides?: Record<string, unknown>\n): { nodes: object[]; edges: object[] } {\n  const nodes: object[] = []\n  const edges: object[] = []\n\n  // Sort steps by order\n  const sortedSteps = [...steps].sort((a, b) => a.order - b.order)\n\n  // Create nodes for each step\n  sortedSteps.forEach((step, index) => {\n    const nodeId = generateNodeId()\n\n    // Map step type to React Flow node type\n    const nodeType = mapStepTypeToNodeType(step.type)\n\n    nodes.push({\n      id: nodeId,\n      type: nodeType,\n      position: { x: 250, y: index * 150 },\n      data: {\n        label: step.name,\n        stepType: step.type,\n        config: {\n          ...step.config,\n          ...getConfigOverridesForStep(step.name, configOverrides)\n        },\n        conditions: step.conditions\n      }\n    })\n\n    // Create edge to next step (if not the last step)\n    if (index < sortedSteps.length - 1) {\n      edges.push({\n        id: generateEdgeId(nodeId, 'placeholder'),\n        source: nodeId,\n        target: '', // Will be filled in after all nodes are created\n        sourceHandle: 'output',\n        targetHandle: 'input'\n      })\n    }\n  })\n\n  // Fix edge targets now that we have all node IDs\n  edges.forEach((edge: any, index) => {\n    if (index < nodes.length - 1) {\n      edge.target = (nodes[index + 1] as any).id\n    }\n  })\n\n  // Auto-layout the nodes for better visualization\n  const layoutedNodes = autoLayoutNodes(nodes as any, edges as any)\n\n  return {\n    nodes: layoutedNodes,\n    edges\n  }\n}\n\n/**\n * Map workflow step type to React Flow node type\n */\nfunction mapStepTypeToNodeType(stepType: string): string {\n  const typeMap: Record<string, string> = {\n    TRIGGER: 'trigger',\n    ACTION: 'primitive',\n    CONDITION: 'condition',\n    DELAY: 'delay',\n    LOOP: 'loop',\n    TRANSFORM: 'transform',\n    HTTP: 'http',\n    DATABASE: 'database',\n    NOTIFICATION: 'notification',\n    END: 'output'\n  }\n\n  return typeMap[stepType] ?? 'primitive'\n}\n\n/**\n * Get config overrides for a specific step\n */\nfunction getConfigOverridesForStep(\n  stepName: string,\n  overrides?: Record<string, unknown>\n): Record<string, unknown> {\n  if (!overrides) return {}\n\n  // Check for step-specific overrides\n  const stepKey = stepName.toLowerCase().replace(/\\s+/g, '_')\n  return (overrides[stepKey] as Record<string, unknown>) ?? {}\n}\n\n// =============================================================================\n// TEMPLATE MANAGEMENT\n// =============================================================================\n\n/**\n * Create a new custom template from an existing workflow\n */\nexport async function createTemplateFromWorkflow(\n  workflowId: string,\n  templateData: {\n    name: string\n    slug: string\n    description?: string\n    category: WorkflowTemplateCategory\n    icon?: string\n    color?: string\n    tags?: string[]\n    documentation?: string\n    exampleUseCase?: string\n  }\n): Promise<PrismaWorkflowTemplate> {\n  const workflow = await prisma.workflow.findUnique({\n    where: { id: workflowId },\n    include: { steps: { orderBy: { order: 'asc' } } }\n  })\n\n  if (!workflow) {\n    throw new Error(`Workflow not found: ${workflowId}`)\n  }\n\n  // Convert workflow steps to template step format\n  const steps: TemplateStepDefinition[] = workflow.steps.map(step => ({\n    name: step.name,\n    type: step.type,\n    order: step.order,\n    config: step.config as Record<string, unknown> ?? {},\n    conditions: step.conditions as Record<string, unknown> ?? {}\n  }))\n\n  return prisma.workflowTemplate.create({\n    data: {\n      name: templateData.name,\n      slug: templateData.slug,\n      description: templateData.description ?? workflow.description,\n      category: templateData.category,\n      trigger: workflow.triggerType,\n      triggerConfig: (workflow.triggerConfig ?? {}) as never,\n      steps: steps as never,\n      icon: templateData.icon,\n      color: templateData.color,\n      tags: templateData.tags ?? [],\n      documentation: templateData.documentation,\n      exampleUseCase: templateData.exampleUseCase,\n      isSystem: false,\n      isActive: true\n    }\n  })\n}\n\n/**\n * Update a custom template (system templates cannot be modified)\n */\nexport async function updateTemplate(\n  templateId: string,\n  data: Partial<{\n    name: string\n    description: string\n    category: WorkflowTemplateCategory\n    icon: string\n    color: string\n    tags: string[]\n    documentation: string\n    exampleUseCase: string\n    isActive: boolean\n  }>\n): Promise<PrismaWorkflowTemplate> {\n  const template = await prisma.workflowTemplate.findUnique({\n    where: { id: templateId }\n  })\n\n  if (!template) {\n    throw new Error(`Template not found: ${templateId}`)\n  }\n\n  if (template.isSystem) {\n    throw new Error('System templates cannot be modified')\n  }\n\n  return prisma.workflowTemplate.update({\n    where: { id: templateId },\n    data\n  })\n}\n\n/**\n * Delete a custom template\n */\nexport async function deleteTemplate(templateId: string): Promise<void> {\n  const template = await prisma.workflowTemplate.findUnique({\n    where: { id: templateId }\n  })\n\n  if (!template) {\n    throw new Error(`Template not found: ${templateId}`)\n  }\n\n  if (template.isSystem) {\n    throw new Error('System templates cannot be deleted')\n  }\n\n  // Remove templateId from any workflows using this template\n  await prisma.workflow.updateMany({\n    where: { templateId },\n    data: { templateId: null }\n  })\n\n  await prisma.workflowTemplate.delete({\n    where: { id: templateId }\n  })\n}\n\n// =============================================================================\n// TEMPLATE STATISTICS\n// =============================================================================\n\n/**\n * Get template usage statistics\n */\nexport async function getTemplateStats(templateId: string): Promise<{\n  totalInstalls: number\n  activeInstalls: number\n  totalExecutions: number\n  successfulExecutions: number\n  failedExecutions: number\n  averageExecutionTime: number\n}> {\n  const workflows = await prisma.workflow.findMany({\n    where: { templateId },\n    select: {\n      id: true,\n      enabled: true,\n      executionCount: true,\n      successCount: true,\n      failureCount: true\n    }\n  })\n\n  const workflowIds = workflows.map(w => w.id)\n\n  // Calculate average execution time from recent executions\n  const recentExecutions = await prisma.workflowExecution.findMany({\n    where: {\n      workflowId: { in: workflowIds },\n      status: 'COMPLETED',\n      completedAt: { not: null }\n    },\n    select: {\n      startedAt: true,\n      completedAt: true\n    },\n    orderBy: { startedAt: 'desc' },\n    take: 100\n  })\n\n  const executionTimes = recentExecutions\n    .filter(e => e.completedAt)\n    .map(e => e.completedAt!.getTime() - e.startedAt.getTime())\n\n  const avgTime = executionTimes.length > 0\n    ? executionTimes.reduce((a, b) => a + b, 0) / executionTimes.length\n    : 0\n\n  return {\n    totalInstalls: workflows.length,\n    activeInstalls: workflows.filter(w => w.enabled).length,\n    totalExecutions: workflows.reduce((sum, w) => sum + w.executionCount, 0),\n    successfulExecutions: workflows.reduce((sum, w) => sum + w.successCount, 0),\n    failedExecutions: workflows.reduce((sum, w) => sum + w.failureCount, 0),\n    averageExecutionTime: Math.round(avgTime)\n  }\n}\n\n/**\n * Get category statistics\n */\nexport async function getCategoryStats(): Promise<\n  Record<WorkflowTemplateCategory, {\n    templateCount: number\n    workflowCount: number\n  }>\n> {\n  const templates = await prisma.workflowTemplate.groupBy({\n    by: ['category'],\n    _count: true\n  })\n\n  const workflows = await prisma.workflow.findMany({\n    where: { templateId: { not: null } },\n    select: { template: { select: { category: true } } }\n  })\n\n  const stats: Record<string, { templateCount: number; workflowCount: number }> = {}\n\n  templates.forEach(t => {\n    stats[t.category] = {\n      templateCount: t._count,\n      workflowCount: 0\n    }\n  })\n\n  workflows.forEach(w => {\n    if (w.template?.category && stats[w.template.category]) {\n      stats[w.template.category].workflowCount++\n    }\n  })\n\n  return stats as Record<WorkflowTemplateCategory, { templateCount: number; workflowCount: number }>\n}\n","/**\n * Workflow Toggle Service\n *\n * Manages workflow enabled/disabled states with validation,\n * event subscription management, and execution tracking.\n */\n\nimport { prisma } from '../db'\nimport type { Workflow, WorkflowTrigger } from '@prisma/client'\nimport { eventBus, subscribe, unsubscribe } from './event-bus'\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\nexport interface ToggleResult {\n  success: boolean\n  workflow?: Workflow\n  error?: string\n  message?: string\n}\n\nexport interface BulkToggleResult {\n  success: boolean\n  results: Array<{\n    workflowId: string\n    success: boolean\n    enabled?: boolean\n    error?: string\n  }>\n  enabledCount: number\n  disabledCount: number\n  errorCount: number\n}\n\nexport interface WorkflowStatus {\n  id: string\n  name: string\n  slug: string\n  enabled: boolean\n  triggerType: WorkflowTrigger\n  lastRunAt: Date | null\n  executionCount: number\n  successCount: number\n  failureCount: number\n  successRate: number\n}\n\n// Track active event subscriptions for cleanup\nconst activeSubscriptions = new Map<string, () => void>()\n\n// =============================================================================\n// SINGLE WORKFLOW TOGGLE\n// =============================================================================\n\n/**\n * Enable a workflow\n */\nexport async function enableWorkflow(workflowId: string): Promise<ToggleResult> {\n  return setWorkflowEnabled(workflowId, true)\n}\n\n/**\n * Disable a workflow\n */\nexport async function disableWorkflow(workflowId: string): Promise<ToggleResult> {\n  return setWorkflowEnabled(workflowId, false)\n}\n\n/**\n * Toggle a workflow's enabled state\n */\nexport async function toggleWorkflow(workflowId: string): Promise<ToggleResult> {\n  const workflow = await prisma.workflow.findUnique({\n    where: { id: workflowId }\n  })\n\n  if (!workflow) {\n    return {\n      success: false,\n      error: `Workflow not found: ${workflowId}`\n    }\n  }\n\n  return setWorkflowEnabled(workflowId, !workflow.enabled)\n}\n\n/**\n * Set workflow enabled state with validation\n */\nasync function setWorkflowEnabled(\n  workflowId: string,\n  enabled: boolean\n): Promise<ToggleResult> {\n  try {\n    const workflow = await prisma.workflow.findUnique({\n      where: { id: workflowId },\n      include: {\n        workflowNodes: true\n      }\n    })\n\n    if (!workflow) {\n      return {\n        success: false,\n        error: `Workflow not found: ${workflowId}`\n      }\n    }\n\n    // If enabling, validate workflow is ready\n    if (enabled) {\n      const validation = validateWorkflowForEnable(workflow)\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: `Cannot enable workflow: ${validation.errors.join(', ')}`\n        }\n      }\n    }\n\n    // Update the workflow\n    const updatedWorkflow = await prisma.workflow.update({\n      where: { id: workflowId },\n      data: { enabled }\n    })\n\n    // Handle event subscriptions based on trigger type\n    if (enabled) {\n      await activateWorkflowTrigger(updatedWorkflow)\n    } else {\n      await deactivateWorkflowTrigger(updatedWorkflow)\n    }\n\n    return {\n      success: true,\n      workflow: updatedWorkflow,\n      message: `Workflow ${enabled ? 'enabled' : 'disabled'} successfully`\n    }\n  } catch (error) {\n    console.error('Failed to toggle workflow:', error)\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error'\n    }\n  }\n}\n\n// =============================================================================\n// BULK OPERATIONS\n// =============================================================================\n\n/**\n * Enable multiple workflows\n */\nexport async function enableWorkflows(workflowIds: string[]): Promise<BulkToggleResult> {\n  return bulkSetEnabled(workflowIds, true)\n}\n\n/**\n * Disable multiple workflows\n */\nexport async function disableWorkflows(workflowIds: string[]): Promise<BulkToggleResult> {\n  return bulkSetEnabled(workflowIds, false)\n}\n\n/**\n * Disable all workflows (emergency stop)\n */\nexport async function disableAllWorkflows(): Promise<BulkToggleResult> {\n  const enabledWorkflows = await prisma.workflow.findMany({\n    where: { enabled: true },\n    select: { id: true }\n  })\n\n  const workflowIds = enabledWorkflows.map(w => w.id)\n\n  if (workflowIds.length === 0) {\n    return {\n      success: true,\n      results: [],\n      enabledCount: 0,\n      disabledCount: 0,\n      errorCount: 0\n    }\n  }\n\n  return bulkSetEnabled(workflowIds, false)\n}\n\n/**\n * Enable all workflows by category\n */\nexport async function enableWorkflowsByCategory(\n  templateCategory: string\n): Promise<BulkToggleResult> {\n  const workflows = await prisma.workflow.findMany({\n    where: {\n      template: { category: templateCategory as any }\n    },\n    select: { id: true }\n  })\n\n  return bulkSetEnabled(workflows.map(w => w.id), true)\n}\n\n/**\n * Disable all workflows by trigger type\n */\nexport async function disableWorkflowsByTrigger(\n  triggerType: WorkflowTrigger\n): Promise<BulkToggleResult> {\n  const workflows = await prisma.workflow.findMany({\n    where: { triggerType, enabled: true },\n    select: { id: true }\n  })\n\n  return bulkSetEnabled(workflows.map(w => w.id), false)\n}\n\n/**\n * Bulk set enabled state for multiple workflows\n */\nasync function bulkSetEnabled(\n  workflowIds: string[],\n  enabled: boolean\n): Promise<BulkToggleResult> {\n  const results: BulkToggleResult['results'] = []\n  let enabledCount = 0\n  let disabledCount = 0\n  let errorCount = 0\n\n  for (const workflowId of workflowIds) {\n    const result = await setWorkflowEnabled(workflowId, enabled)\n\n    if (result.success) {\n      if (enabled) enabledCount++\n      else disabledCount++\n    } else {\n      errorCount++\n    }\n\n    results.push({\n      workflowId,\n      success: result.success,\n      enabled: result.workflow?.enabled,\n      error: result.error\n    })\n  }\n\n  return {\n    success: errorCount === 0,\n    results,\n    enabledCount,\n    disabledCount,\n    errorCount\n  }\n}\n\n// =============================================================================\n// VALIDATION\n// =============================================================================\n\ninterface ValidationResult {\n  valid: boolean\n  errors: string[]\n  warnings: string[]\n}\n\n/**\n * Validate that a workflow is ready to be enabled\n */\nfunction validateWorkflowForEnable(workflow: any): ValidationResult {\n  const errors: string[] = []\n  const warnings: string[] = []\n\n  // Check for trigger node\n  const nodes = workflow.nodes as any[]\n  const hasTrigger = nodes.some(\n    node => node.type === 'trigger' || node.data?.stepType === 'TRIGGER'\n  )\n\n  if (!hasTrigger) {\n    errors.push('Workflow must have a trigger node')\n  }\n\n  // Check for at least one action\n  const hasAction = nodes.some(\n    node => node.type === 'primitive' ||\n           node.type === 'action' ||\n           node.data?.stepType === 'ACTION'\n  )\n\n  if (!hasAction) {\n    warnings.push('Workflow has no action nodes')\n  }\n\n  // Check trigger configuration for scheduled/event workflows\n  if (workflow.triggerType === 'SCHEDULE') {\n    const triggerConfig = workflow.triggerConfig as any\n    if (!triggerConfig?.cron) {\n      errors.push('Scheduled workflow must have a cron expression')\n    }\n  }\n\n  if (workflow.triggerType === 'EVENT') {\n    const triggerConfig = workflow.triggerConfig as any\n    if (!triggerConfig?.eventType) {\n      errors.push('Event workflow must specify an event type')\n    }\n  }\n\n  if (workflow.triggerType === 'WEBHOOK') {\n    const triggerConfig = workflow.triggerConfig as any\n    if (!triggerConfig?.path) {\n      errors.push('Webhook workflow must specify a path')\n    }\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n    warnings\n  }\n}\n\n/**\n * Check if a workflow can be enabled\n */\nexport async function canEnableWorkflow(workflowId: string): Promise<{\n  canEnable: boolean\n  validation: ValidationResult\n}> {\n  const workflow = await prisma.workflow.findUnique({\n    where: { id: workflowId },\n    include: { workflowNodes: true }\n  })\n\n  if (!workflow) {\n    return {\n      canEnable: false,\n      validation: {\n        valid: false,\n        errors: ['Workflow not found'],\n        warnings: []\n      }\n    }\n  }\n\n  const validation = validateWorkflowForEnable(workflow)\n\n  return {\n    canEnable: validation.valid,\n    validation\n  }\n}\n\n// =============================================================================\n// TRIGGER MANAGEMENT\n// =============================================================================\n\n/**\n * Activate a workflow's trigger (subscribe to events, register webhook, etc.)\n */\nasync function activateWorkflowTrigger(workflow: Workflow): Promise<void> {\n  const triggerConfig = workflow.triggerConfig as Record<string, any> ?? {}\n\n  switch (workflow.triggerType) {\n    case 'EVENT':\n      await activateEventTrigger(workflow, triggerConfig)\n      break\n\n    case 'SCHEDULE':\n      // Scheduled workflows are handled by a cron job that checks getScheduledWorkflows()\n      // No additional activation needed\n      break\n\n    case 'WEBHOOK':\n      // Webhook workflows are handled by the webhook API route\n      // No additional activation needed, but log for debugging\n      console.log(`Activated webhook workflow: ${workflow.slug} at path ${triggerConfig.path}`)\n      break\n\n    case 'MANUAL':\n      // Manual workflows are triggered by user action\n      // No activation needed\n      break\n\n    case 'AI_AGENT':\n      // AI agent workflows are triggered by the AI system\n      // No additional activation needed\n      break\n  }\n}\n\n/**\n * Deactivate a workflow's trigger\n */\nasync function deactivateWorkflowTrigger(workflow: Workflow): Promise<void> {\n  // Remove event subscription if exists\n  const unsubscribeFn = activeSubscriptions.get(workflow.id)\n  if (unsubscribeFn) {\n    unsubscribeFn()\n    activeSubscriptions.delete(workflow.id)\n  }\n}\n\n/**\n * Activate an event-based trigger\n */\nasync function activateEventTrigger(\n  workflow: Workflow,\n  triggerConfig: Record<string, any>\n): Promise<void> {\n  const eventType = triggerConfig.eventType\n\n  if (!eventType) {\n    console.warn(`Event workflow ${workflow.id} has no eventType configured`)\n    return\n  }\n\n  // Subscribe to the event\n  const subscriptionId = subscribe({\n    eventType,\n    handler: async (event) => {\n      try {\n        // Import executeWorkflow dynamically to avoid circular dependency\n        const { executeWorkflow } = await import('./engine')\n\n        // Check event filters if configured\n        if (triggerConfig.filters) {\n          const matches = matchEventFilters(event.data as Record<string, unknown>, triggerConfig.filters)\n          if (!matches) return\n        }\n\n        // Execute the workflow\n        await executeWorkflow(workflow.id, {\n          triggeredBy: 'event',\n          eventData: {\n            type: eventType,\n            data: event.data,\n            timestamp: event.timestamp\n          }\n        })\n      } catch (error) {\n        console.error(`Failed to execute workflow ${workflow.id} for event ${eventType}:`, error)\n      }\n    }\n  })\n\n  // Store the unsubscribe function for cleanup\n  activeSubscriptions.set(workflow.id, () => unsubscribe(subscriptionId))\n\n  console.log(`Activated event trigger for workflow ${workflow.slug}: ${eventType}`)\n}\n\n/**\n * Check if event data matches configured filters\n */\nfunction matchEventFilters(\n  eventData: Record<string, any>,\n  filters: Record<string, any>\n): boolean {\n  for (const [key, value] of Object.entries(filters)) {\n    const eventValue = getNestedValue(eventData, key)\n\n    if (typeof value === 'object' && value !== null) {\n      // Handle operators like { $gt: 100, $lt: 200 }\n      for (const [op, opValue] of Object.entries(value as Record<string, any>)) {\n        switch (op) {\n          case '$eq':\n            if (eventValue !== opValue) return false\n            break\n          case '$ne':\n            if (eventValue === opValue) return false\n            break\n          case '$gt':\n            if (!(eventValue > opValue)) return false\n            break\n          case '$gte':\n            if (!(eventValue >= opValue)) return false\n            break\n          case '$lt':\n            if (!(eventValue < opValue)) return false\n            break\n          case '$lte':\n            if (!(eventValue <= opValue)) return false\n            break\n          case '$in':\n            if (!Array.isArray(opValue) || !opValue.includes(eventValue)) return false\n            break\n          case '$nin':\n            if (!Array.isArray(opValue) || opValue.includes(eventValue)) return false\n            break\n          case '$contains':\n            if (typeof eventValue !== 'string' || !eventValue.includes(opValue)) return false\n            break\n        }\n      }\n    } else {\n      // Simple equality check\n      if (eventValue !== value) return false\n    }\n  }\n\n  return true\n}\n\n/**\n * Get nested value from object using dot notation\n */\nfunction getNestedValue(obj: Record<string, any>, path: string): any {\n  return path.split('.').reduce((current, key) => current?.[key], obj)\n}\n\n// =============================================================================\n// STATUS QUERIES\n// =============================================================================\n\n/**\n * Get workflow status summary\n */\nexport async function getWorkflowStatus(workflowId: string): Promise<WorkflowStatus | null> {\n  const workflow = await prisma.workflow.findUnique({\n    where: { id: workflowId }\n  })\n\n  if (!workflow) return null\n\n  const successRate = workflow.executionCount > 0\n    ? (workflow.successCount / workflow.executionCount) * 100\n    : 0\n\n  return {\n    id: workflow.id,\n    name: workflow.name,\n    slug: workflow.slug,\n    enabled: workflow.enabled,\n    triggerType: workflow.triggerType,\n    lastRunAt: workflow.lastRunAt,\n    executionCount: workflow.executionCount,\n    successCount: workflow.successCount,\n    failureCount: workflow.failureCount,\n    successRate: Math.round(successRate * 100) / 100\n  }\n}\n\n/**\n * Get all workflow statuses\n */\nexport async function getAllWorkflowStatuses(): Promise<WorkflowStatus[]> {\n  const workflows = await prisma.workflow.findMany({\n    orderBy: [\n      { enabled: 'desc' },\n      { name: 'asc' }\n    ]\n  })\n\n  return workflows.map(workflow => {\n    const successRate = workflow.executionCount > 0\n      ? (workflow.successCount / workflow.executionCount) * 100\n      : 0\n\n    return {\n      id: workflow.id,\n      name: workflow.name,\n      slug: workflow.slug,\n      enabled: workflow.enabled,\n      triggerType: workflow.triggerType,\n      lastRunAt: workflow.lastRunAt,\n      executionCount: workflow.executionCount,\n      successCount: workflow.successCount,\n      failureCount: workflow.failureCount,\n      successRate: Math.round(successRate * 100) / 100\n    }\n  })\n}\n\n/**\n * Get enabled workflows count by trigger type\n */\nexport async function getEnabledWorkflowCounts(): Promise<Record<WorkflowTrigger, number>> {\n  const counts = await prisma.workflow.groupBy({\n    by: ['triggerType'],\n    where: { enabled: true },\n    _count: true\n  })\n\n  const result: Record<string, number> = {\n    MANUAL: 0,\n    SCHEDULE: 0,\n    WEBHOOK: 0,\n    EVENT: 0,\n    AI_AGENT: 0\n  }\n\n  counts.forEach(c => {\n    result[c.triggerType] = c._count\n  })\n\n  return result as Record<WorkflowTrigger, number>\n}\n\n// =============================================================================\n// INITIALIZATION\n// =============================================================================\n\n/**\n * Initialize all enabled event-based workflows on app startup\n */\nexport async function initializeEventWorkflows(): Promise<void> {\n  const eventWorkflows = await prisma.workflow.findMany({\n    where: {\n      enabled: true,\n      triggerType: 'EVENT'\n    }\n  })\n\n  console.log(`Initializing ${eventWorkflows.length} event workflows...`)\n\n  for (const workflow of eventWorkflows) {\n    try {\n      await activateWorkflowTrigger(workflow)\n    } catch (error) {\n      console.error(`Failed to initialize workflow ${workflow.id}:`, error)\n    }\n  }\n\n  console.log('Event workflow initialization complete')\n}\n\n/**\n * Cleanup all active subscriptions (for shutdown)\n */\nexport function cleanupAllSubscriptions(): void {\n  console.log(`Cleaning up ${activeSubscriptions.size} workflow subscriptions...`)\n\n  for (const [workflowId, unsubscribeFn] of activeSubscriptions) {\n    try {\n      unsubscribeFn()\n    } catch (error) {\n      console.error(`Failed to cleanup subscription for workflow ${workflowId}:`, error)\n    }\n  }\n\n  activeSubscriptions.clear()\n  console.log('Workflow subscription cleanup complete')\n}\n","/**\n * Shippo Shipping Service Layer\n *\n * Core integration with Shippo API for:\n * - Address validation\n * - Rate shopping (USPS, UPS, FedEx)\n * - Label generation (PDF/PNG)\n * - Tracking updates\n * - Refunds\n *\n * Configuration is read from:\n * 1. Database (settings table -> shipping group) - preferred\n * 2. Environment variables - fallback\n */\n\nimport { Shippo } from 'shippo'\nimport { prisma } from '../db'\nimport { safeDecrypt } from '../encryption'\nimport type {\n  ShippingAddress,\n  ValidatedAddress,\n  Parcel,\n  ShippingRate,\n  CreateShipmentRequest,\n  ShipmentResponse,\n  PurchaseLabelRequest,\n  LabelResponse,\n  LabelFormat,\n  TrackingStatus,\n  RefundResponse,\n  CarrierType,\n  ShippingSettings,\n} from './types'\n\n// Cache for shipping settings to avoid repeated DB queries\nlet cachedSettings: ShippingSettings | null = null\nlet cacheExpiry: number = 0\nconst CACHE_TTL = 60000 // 1 minute cache\n\n/**\n * Fetch shipping settings from the database\n * Falls back to environment variables if database settings are not available\n * API key always falls back to env var if not in database (for easier setup)\n */\nexport async function getShippingSettings(): Promise<ShippingSettings> {\n  // Return cached settings if still valid\n  if (cachedSettings && Date.now() < cacheExpiry) {\n    return cachedSettings\n  }\n\n  // Start with env-based defaults\n  const envApiKey = process.env.SHIPPO_API_KEY\n  const envWebhookSecret = process.env.SHIPPO_WEBHOOK_SECRET\n\n  try {\n    // Fetch all shipping-related settings from the database\n    const settings = await prisma.setting.findMany({\n      where: { group: 'shipping' },\n    })\n\n    if (settings.length > 0) {\n      // Build settings object from database records\n      // Decrypt encrypted values\n      const settingsMap: Record<string, string> = {}\n      for (const setting of settings) {\n        // Decrypt if marked as encrypted\n        settingsMap[setting.key] = setting.encrypted\n          ? safeDecrypt(setting.value)\n          : setting.value\n      }\n\n      const dbSettings: ShippingSettings = {\n        enabled: settingsMap['shipping.enabled'] === 'true',\n        // Always fall back to env var for API key - makes setup easier\n        shippoApiKey: settingsMap['shipping.shippoApiKey'] || envApiKey,\n        shippoWebhookSecret: settingsMap['shipping.shippoWebhookSecret'] || envWebhookSecret,\n        testMode: settingsMap['shipping.testMode'] === 'true',\n        useElements: settingsMap['shipping.useElements'] !== 'false', // Default to true\n        fromName: settingsMap['shipping.fromName'],\n        fromCompany: settingsMap['shipping.fromCompany'],\n        fromStreet1: settingsMap['shipping.fromStreet1'],\n        fromStreet2: settingsMap['shipping.fromStreet2'],\n        fromCity: settingsMap['shipping.fromCity'],\n        fromState: settingsMap['shipping.fromState'],\n        fromZip: settingsMap['shipping.fromZip'],\n        fromCountry: settingsMap['shipping.fromCountry'] || 'US',\n        fromPhone: settingsMap['shipping.fromPhone'],\n        fromEmail: settingsMap['shipping.fromEmail'],\n        enabledCarriers: settingsMap['shipping.enabledCarriers']\n          ? JSON.parse(settingsMap['shipping.enabledCarriers'])\n          : ['usps', 'ups', 'fedex'],\n        defaultLabelFormat: settingsMap['shipping.defaultLabelFormat'] as LabelFormat || 'PDF',\n        defaultPackageWeight: settingsMap['shipping.defaultPackageWeight']\n          ? parseInt(settingsMap['shipping.defaultPackageWeight'])\n          : 16,\n        requireSignature: settingsMap['shipping.requireSignature'] === 'true',\n      }\n\n      // If shipping is enabled (either explicitly or API key present in env), use db settings\n      // This allows using env var for API key while still customizing other settings in DB\n      if (dbSettings.enabled || (dbSettings.shippoApiKey && settingsMap['shipping.enabled'] === undefined)) {\n        // If enabled wasn't explicitly set but we have an API key, auto-enable\n        if (settingsMap['shipping.enabled'] === undefined && dbSettings.shippoApiKey) {\n          dbSettings.enabled = true\n        }\n        cachedSettings = dbSettings\n        cacheExpiry = Date.now() + CACHE_TTL\n        return dbSettings\n      }\n    }\n  } catch (error) {\n    console.warn('Could not fetch shipping settings from database, using env vars:', error)\n  }\n\n  // Fall back to environment variables entirely\n  // Auto-enable if API key is present\n  const envSettings: ShippingSettings = {\n    enabled: !!envApiKey, // Auto-enable if API key exists\n    shippoApiKey: envApiKey,\n    shippoWebhookSecret: envWebhookSecret,\n    testMode: process.env.NODE_ENV !== 'production',\n    useElements: true, // Default to using Shippo Elements\n    fromName: process.env.SHIP_FROM_NAME,\n    fromCompany: process.env.SHIP_FROM_COMPANY,\n    fromStreet1: process.env.SHIP_FROM_STREET,\n    fromStreet2: process.env.SHIP_FROM_STREET2,\n    fromCity: process.env.SHIP_FROM_CITY,\n    fromState: process.env.SHIP_FROM_STATE,\n    fromZip: process.env.SHIP_FROM_ZIP,\n    fromCountry: process.env.SHIP_FROM_COUNTRY || 'US',\n    fromPhone: process.env.SHIP_FROM_PHONE,\n    fromEmail: process.env.SHIP_FROM_EMAIL,\n    enabledCarriers: ['usps', 'ups', 'fedex'],\n    defaultLabelFormat: 'PDF',\n    defaultPackageWeight: 16,\n    requireSignature: false,\n  }\n\n  cachedSettings = envSettings\n  cacheExpiry = Date.now() + CACHE_TTL\n  return envSettings\n}\n\n/**\n * Clear the settings cache (useful after settings are updated)\n */\nexport function clearShippingSettingsCache(): void {\n  cachedSettings = null\n  cacheExpiry = 0\n}\n\n/**\n * Get the Shippo API key from database or environment\n */\nasync function getShippoApiKey(): Promise<string> {\n  const settings = await getShippingSettings()\n  const apiKey = settings.shippoApiKey || process.env.SHIPPO_API_KEY\n\n  if (!apiKey) {\n    throw new Error('Shippo API key is not configured. Set it in Settings > Shipping or SHIPPO_API_KEY env var.')\n  }\n\n  return apiKey\n}\n\n/**\n * Initialize Shippo client with API key from database or environment\n */\nasync function getShippoClientAsync(): Promise<Shippo> {\n  const apiKey = await getShippoApiKey()\n  return new Shippo({ apiKeyHeader: apiKey })\n}\n\n// Synchronous version for backwards compatibility (uses env var only)\nconst getShippoClient = (): Shippo => {\n  const apiKey = process.env.SHIPPO_API_KEY\n  if (!apiKey) {\n    throw new Error('SHIPPO_API_KEY environment variable is not set')\n  }\n  return new Shippo({ apiKeyHeader: apiKey })\n}\n\n/**\n * Get default ship-from address from database or environment variables\n */\nexport async function getDefaultFromAddress(): Promise<ShippingAddress> {\n  const settings = await getShippingSettings()\n\n  return {\n    name: settings.fromName || process.env.SHIP_FROM_NAME || '',\n    company: settings.fromCompany || process.env.SHIP_FROM_COMPANY,\n    street1: settings.fromStreet1 || process.env.SHIP_FROM_STREET || '',\n    street2: settings.fromStreet2 || process.env.SHIP_FROM_STREET2,\n    city: settings.fromCity || process.env.SHIP_FROM_CITY || '',\n    state: settings.fromState || process.env.SHIP_FROM_STATE || '',\n    zip: settings.fromZip || process.env.SHIP_FROM_ZIP || '',\n    country: settings.fromCountry || process.env.SHIP_FROM_COUNTRY || 'US',\n    phone: settings.fromPhone || process.env.SHIP_FROM_PHONE,\n    email: settings.fromEmail || process.env.SHIP_FROM_EMAIL,\n  }\n}\n\n/**\n * Validate a shipping address\n * Returns validated/standardized address with any messages\n */\nexport async function validateAddress(address: ShippingAddress): Promise<ValidatedAddress> {\n  const shippo = await getShippoClientAsync()\n\n  try {\n    const response = await shippo.addresses.create({\n      name: address.name,\n      company: address.company,\n      street1: address.street1,\n      street2: address.street2,\n      city: address.city,\n      state: address.state,\n      zip: address.zip,\n      country: address.country,\n      phone: address.phone,\n      email: address.email,\n      validate: true,\n    })\n\n    const isValid = response.validationResults?.isValid ?? false\n    const messages = response.validationResults?.messages?.map((msg: { source?: string; code?: string; text?: string; type?: string }) => ({\n      source: msg.source || 'shippo',\n      code: msg.code || '',\n      text: msg.text || '',\n      type: (msg.type as 'error' | 'warning' | 'info') || 'info',\n    })) || []\n\n    return {\n      ...address,\n      name: response.name || address.name,\n      street1: response.street1 || address.street1,\n      street2: response.street2,\n      city: response.city || address.city,\n      state: response.state || address.state,\n      zip: response.zip || address.zip,\n      country: response.country || address.country,\n      isValid,\n      messages,\n    }\n  } catch (error) {\n    console.error('Address validation error:', error)\n    return {\n      ...address,\n      isValid: false,\n      messages: [{\n        source: 'shippo',\n        code: 'VALIDATION_ERROR',\n        text: error instanceof Error ? error.message : 'Address validation failed',\n        type: 'error',\n      }],\n    }\n  }\n}\n\n/**\n * Create a shipment and get rates from all carriers\n */\nexport async function createShipment(request: CreateShipmentRequest): Promise<ShipmentResponse> {\n  const shippo = await getShippoClientAsync()\n\n  try {\n    const shipment = await shippo.shipments.create({\n      addressFrom: {\n        name: request.addressFrom.name,\n        company: request.addressFrom.company,\n        street1: request.addressFrom.street1,\n        street2: request.addressFrom.street2,\n        city: request.addressFrom.city,\n        state: request.addressFrom.state,\n        zip: request.addressFrom.zip,\n        country: request.addressFrom.country,\n        phone: request.addressFrom.phone,\n        email: request.addressFrom.email,\n      },\n      addressTo: {\n        name: request.addressTo.name,\n        company: request.addressTo.company,\n        street1: request.addressTo.street1,\n        street2: request.addressTo.street2,\n        city: request.addressTo.city,\n        state: request.addressTo.state,\n        zip: request.addressTo.zip,\n        country: request.addressTo.country,\n        phone: request.addressTo.phone,\n        email: request.addressTo.email,\n      },\n      parcels: request.parcels.map((parcel) => ({\n        length: String(parcel.length),\n        width: String(parcel.width),\n        height: String(parcel.height),\n        weight: String(parcel.weight),\n        massUnit: parcel.massUnit || 'oz',\n        distanceUnit: parcel.distanceUnit || 'in',\n      })),\n      extra: request.extra ? {\n        signatureConfirmation: request.extra.signature,\n        insurance: request.extra.insurance ? {\n          amount: request.extra.insurance.amount,\n          currency: request.extra.insurance.currency,\n          content: request.extra.insurance.content,\n        } : undefined,\n        reference1: request.extra.reference1,\n        reference2: request.extra.reference2,\n        saturdayDelivery: request.extra.saturdayDelivery,\n      } : undefined,\n      async: false,\n    })\n\n    // Map rates to our format\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const rates: ShippingRate[] = (shipment.rates || []).map((rate: any) => ({\n      rateId: rate.objectId || '',\n      carrier: mapCarrier(rate.provider || ''),\n      carrierAccount: rate.carrierAccount || '',\n      servicelevel: {\n        name: rate.servicelevel?.name || '',\n        token: rate.servicelevel?.token || '',\n        terms: rate.servicelevel?.terms,\n      },\n      amount: rate.amount || '0',\n      currency: rate.currency || 'USD',\n      amountLocal: rate.amountLocal,\n      currencyLocal: rate.currencyLocal,\n      estimatedDays: rate.estimatedDays,\n      durationTerms: rate.durationTerms,\n      zone: rate.zone,\n      attributes: rate.attributes,\n      provider: rate.provider,\n      arrivesBy: rate.arrivesBy,\n    }))\n\n    // Sort rates by price\n    rates.sort((a, b) => parseFloat(a.amount) - parseFloat(b.amount))\n\n    return {\n      shipmentId: shipment.objectId || '',\n      status: (shipment.status as ShipmentResponse['status']) || 'ERROR',\n      rates,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      messages: shipment.messages?.map((msg: any) => ({\n        source: msg.source || '',\n        code: msg.code || '',\n        text: msg.text || '',\n      })),\n    }\n  } catch (error) {\n    console.error('Create shipment error:', error)\n    throw new Error(error instanceof Error ? error.message : 'Failed to create shipment')\n  }\n}\n\n/**\n * Get rates for an existing shipment\n */\nexport async function getRates(shipmentId: string): Promise<ShippingRate[]> {\n  const shippo = await getShippoClientAsync()\n\n  try {\n    const shipment = await shippo.shipments.get(shipmentId)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const rates: ShippingRate[] = (shipment.rates || []).map((rate: any) => ({\n      rateId: rate.objectId || '',\n      carrier: mapCarrier(rate.provider || ''),\n      carrierAccount: rate.carrierAccount || '',\n      servicelevel: {\n        name: rate.servicelevel?.name || '',\n        token: rate.servicelevel?.token || '',\n        terms: rate.servicelevel?.terms,\n      },\n      amount: rate.amount || '0',\n      currency: rate.currency || 'USD',\n      amountLocal: rate.amountLocal,\n      currencyLocal: rate.currencyLocal,\n      estimatedDays: rate.estimatedDays,\n      durationTerms: rate.durationTerms,\n      zone: rate.zone,\n      attributes: rate.attributes,\n      provider: rate.provider,\n      arrivesBy: rate.arrivesBy,\n    }))\n\n    return rates.sort((a, b) => parseFloat(a.amount) - parseFloat(b.amount))\n  } catch (error) {\n    console.error('Get rates error:', error)\n    throw new Error(error instanceof Error ? error.message : 'Failed to get rates')\n  }\n}\n\n/**\n * Purchase a shipping label\n */\nexport async function purchaseLabel(request: PurchaseLabelRequest): Promise<LabelResponse> {\n  const shippo = await getShippoClientAsync()\n\n  try {\n    const transaction = await shippo.transactions.create({\n      rate: request.rateId,\n      labelFileType: mapLabelFormat(request.labelFormat || 'PDF'),\n      async: request.async ?? false,\n    })\n\n    // Handle rate being either a string ID or CoreRate object\n    const rateData = typeof transaction.rate === 'string'\n      ? { objectId: transaction.rate }\n      : transaction.rate\n\n    return {\n      transactionId: transaction.objectId || '',\n      status: (transaction.status as LabelResponse['status']) || 'ERROR',\n      rate: {\n        rateId: rateData?.objectId || request.rateId,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        carrier: mapCarrier((rateData as any)?.provider || ''),\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        carrierAccount: (rateData as any)?.carrierAccount || '',\n        servicelevel: {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          name: (rateData as any)?.servicelevel?.name || '',\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          token: (rateData as any)?.servicelevel?.token || '',\n        },\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        amount: (rateData as any)?.amount || '0',\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        currency: (rateData as any)?.currency || 'USD',\n      },\n      trackingNumber: transaction.trackingNumber || '',\n      trackingUrl: transaction.trackingUrlProvider || '',\n      labelUrl: transaction.labelUrl || '',\n      commercialInvoiceUrl: transaction.commercialInvoiceUrl,\n      eta: transaction.eta,\n      messages: transaction.messages?.map((msg: { source?: string; code?: string; text?: string }) => ({\n        source: msg.source || '',\n        code: msg.code || '',\n        text: msg.text || '',\n      })),\n    }\n  } catch (error) {\n    console.error('Purchase label error:', error)\n    throw new Error(error instanceof Error ? error.message : 'Failed to purchase label')\n  }\n}\n\n/**\n * Get tracking status for a shipment\n */\nexport async function getTracking(carrier: CarrierType, trackingNumber: string): Promise<TrackingStatus> {\n  const shippo = await getShippoClientAsync()\n\n  try {\n    const tracking = await shippo.trackingStatus.get(carrier, trackingNumber)\n\n    // Helper to convert Date to ISO string\n    const toIsoString = (date: Date | string | undefined): string | undefined => {\n      if (!date) return undefined\n      return date instanceof Date ? date.toISOString() : date\n    }\n\n    return {\n      carrier,\n      trackingNumber: tracking.trackingNumber || trackingNumber,\n      eta: toIsoString(tracking.eta),\n      servicelevel: tracking.servicelevel ? {\n        name: tracking.servicelevel.name || '',\n        token: tracking.servicelevel.token || '',\n      } : undefined,\n      addressFrom: tracking.addressFrom ? {\n        city: tracking.addressFrom.city,\n        state: tracking.addressFrom.state,\n        zip: tracking.addressFrom.zip,\n        country: tracking.addressFrom.country,\n      } : undefined,\n      addressTo: tracking.addressTo ? {\n        city: tracking.addressTo.city,\n        state: tracking.addressTo.state,\n        zip: tracking.addressTo.zip,\n        country: tracking.addressTo.country,\n      } : undefined,\n      trackingStatus: {\n        status: mapTrackingStatus(tracking.trackingStatus?.status || 'UNKNOWN'),\n        statusDetails: tracking.trackingStatus?.statusDetails || '',\n        statusDate: toIsoString(tracking.trackingStatus?.statusDate) || new Date().toISOString(),\n        location: tracking.trackingStatus?.location ? {\n          city: tracking.trackingStatus.location.city,\n          state: tracking.trackingStatus.location.state,\n          zip: tracking.trackingStatus.location.zip,\n          country: tracking.trackingStatus.location.country,\n        } : undefined,\n      },\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      trackingHistory: (tracking.trackingHistory || []).map((event: any) => ({\n        status: mapTrackingStatus(event.status || 'UNKNOWN'),\n        statusDetails: event.statusDetails || '',\n        statusDate: toIsoString(event.statusDate) || '',\n        location: event.location ? {\n          city: event.location.city,\n          state: event.location.state,\n          zip: event.location.zip,\n          country: event.location.country,\n        } : undefined,\n      })),\n    }\n  } catch (error) {\n    console.error('Get tracking error:', error)\n    throw new Error(error instanceof Error ? error.message : 'Failed to get tracking')\n  }\n}\n\n/**\n * Request a refund for a label\n */\nexport async function refundLabel(transactionId: string): Promise<RefundResponse> {\n  const shippo = await getShippoClientAsync()\n\n  try {\n    const refund = await shippo.refunds.create({\n      transaction: transactionId,\n    })\n\n    return {\n      transactionId,\n      status: (refund.status as 'PENDING' | 'SUCCESS' | 'ERROR') || 'PENDING',\n    }\n  } catch (error) {\n    console.error('Refund label error:', error)\n    throw new Error(error instanceof Error ? error.message : 'Failed to refund label')\n  }\n}\n\n/**\n * Register a webhook for tracking updates\n */\nexport async function registerTrackingWebhook(webhookUrl: string): Promise<void> {\n  const apiKey = await getShippoApiKey()\n\n  try {\n    const response = await fetch('https://api.goshippo.com/webhooks/', {\n      method: 'POST',\n      headers: {\n        'Authorization': `ShippoToken ${apiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        url: webhookUrl,\n        event: 'track_updated',\n        is_test: process.env.NODE_ENV !== 'production',\n      }),\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`Failed to register webhook: ${error}`)\n    }\n  } catch (error) {\n    console.error('Register webhook error:', error)\n    throw new Error(error instanceof Error ? error.message : 'Failed to register webhook')\n  }\n}\n\n// Helper functions\nfunction mapCarrier(provider: string): CarrierType {\n  const lower = provider.toLowerCase()\n  if (lower.includes('usps')) return 'usps'\n  if (lower.includes('ups')) return 'ups'\n  if (lower.includes('fedex')) return 'fedex'\n  return 'usps' // Default\n}\n\nfunction mapLabelFormat(format: LabelFormat): 'PDF' | 'PNG' | 'ZPLII' {\n  if (format.startsWith('PDF')) return 'PDF'\n  if (format === 'PNG') return 'PNG'\n  if (format === 'ZPLII') return 'ZPLII'\n  return 'PDF'\n}\n\nfunction mapTrackingStatus(status: string): TrackingStatus['trackingStatus']['status'] {\n  const statusMap: Record<string, TrackingStatus['trackingStatus']['status']> = {\n    'UNKNOWN': 'UNKNOWN',\n    'PRE_TRANSIT': 'PRE_TRANSIT',\n    'TRANSIT': 'TRANSIT',\n    'DELIVERED': 'DELIVERED',\n    'RETURNED': 'RETURNED',\n    'FAILURE': 'FAILURE',\n  }\n  return statusMap[status] || 'UNKNOWN'\n}\n\n// Export types\nexport * from './types'\n","/**\n * Shippo Integration Types\n *\n * TypeScript interfaces for working with Shippo shipping API.\n */\n\n// Address Types\nexport interface ShippingAddress {\n  name: string\n  company?: string\n  street1: string\n  street2?: string\n  city: string\n  state: string\n  zip: string\n  country: string\n  phone?: string\n  email?: string\n  isResidential?: boolean\n}\n\nexport interface ValidatedAddress extends ShippingAddress {\n  isValid: boolean\n  messages?: AddressValidationMessage[]\n  suggestedAddress?: ShippingAddress\n}\n\nexport interface AddressValidationMessage {\n  source: string\n  code: string\n  text: string\n  type: 'error' | 'warning' | 'info'\n}\n\n// Parcel Types\nexport interface Parcel {\n  length: number // inches\n  width: number // inches\n  height: number // inches\n  weight: number // ounces\n  massUnit?: 'oz' | 'lb' | 'g' | 'kg'\n  distanceUnit?: 'in' | 'cm'\n}\n\nexport interface ParcelTemplate {\n  name: string\n  carrier: CarrierType\n  token: string // Shippo parcel template token\n  dimensions: {\n    length: number\n    width: number\n    height: number\n  }\n}\n\n// Rate Types\nexport interface ShippingRate {\n  rateId: string\n  carrier: CarrierType\n  carrierAccount: string\n  servicelevel: {\n    name: string\n    token: string\n    terms?: string\n  }\n  amount: string\n  currency: string\n  amountLocal?: string\n  currencyLocal?: string\n  estimatedDays?: number\n  durationTerms?: string\n  zone?: string\n  attributes?: string[]\n  provider?: string\n  arrivesBy?: string\n}\n\n// Carrier Types\nexport type CarrierType = 'usps' | 'ups' | 'fedex'\n\nexport interface CarrierAccount {\n  id: string\n  carrier: CarrierType\n  accountId: string\n  isActive: boolean\n  test: boolean\n}\n\n// Shipment Types\nexport interface CreateShipmentRequest {\n  addressFrom: ShippingAddress\n  addressTo: ShippingAddress\n  parcels: Parcel[]\n  customsDeclaration?: CustomsDeclaration\n  extra?: ShipmentExtras\n}\n\nexport interface ShipmentExtras {\n  signature?: 'STANDARD' | 'ADULT' | 'CERTIFIED' | 'INDIRECT' | 'CARRIER_CONFIRMATION'\n  insurance?: {\n    amount: string\n    currency: string\n    content?: string\n  }\n  reference1?: string\n  reference2?: string\n  containsAlcohol?: boolean\n  saturdayDelivery?: boolean\n}\n\nexport interface CustomsDeclaration {\n  contentsType: 'DOCUMENTS' | 'GIFT' | 'SAMPLE' | 'MERCHANDISE' | 'HUMANITARIAN_DONATION' | 'RETURN_MERCHANDISE' | 'OTHER'\n  contentsExplanation?: string\n  items: CustomsItem[]\n  nonDeliveryOption?: 'ABANDON' | 'RETURN'\n  certify?: boolean\n  certifySigner?: string\n  incoterm?: 'DDP' | 'DDU'\n}\n\nexport interface CustomsItem {\n  description: string\n  quantity: number\n  netWeight: string\n  massUnit: 'oz' | 'lb' | 'g' | 'kg'\n  valueAmount: string\n  valueCurrency: string\n  originCountry: string\n  tariffNumber?: string\n}\n\nexport interface ShipmentResponse {\n  shipmentId: string\n  status: 'QUEUED' | 'WAITING' | 'SUCCESS' | 'ERROR'\n  rates: ShippingRate[]\n  messages?: ShipmentMessage[]\n}\n\nexport interface ShipmentMessage {\n  source: string\n  code: string\n  text: string\n}\n\n// Transaction (Label) Types\nexport type LabelFormat = 'PDF' | 'PNG' | 'PDF_4x6' | 'PDF_A4' | 'PDF_A6' | 'PNG_2.3x7.5' | 'ZPLII'\n\nexport interface PurchaseLabelRequest {\n  rateId: string\n  labelFormat?: LabelFormat\n  labelFileType?: 'PDF' | 'PNG' | 'ZPLII'\n  async?: boolean\n}\n\nexport interface LabelResponse {\n  transactionId: string\n  status: 'QUEUED' | 'WAITING' | 'SUCCESS' | 'ERROR' | 'REFUNDED' | 'REFUNDPENDING' | 'REFUNDREJECTED'\n  rate: ShippingRate\n  trackingNumber: string\n  trackingUrl: string\n  labelUrl: string\n  commercialInvoiceUrl?: string\n  eta?: string\n  messages?: ShipmentMessage[]\n}\n\n// Tracking Types\nexport interface TrackingStatus {\n  carrier: CarrierType\n  trackingNumber: string\n  eta?: string\n  servicelevel?: {\n    name: string\n    token: string\n  }\n  addressFrom?: Partial<ShippingAddress>\n  addressTo?: Partial<ShippingAddress>\n  trackingStatus: TrackingEvent\n  trackingHistory: TrackingEvent[]\n}\n\nexport interface TrackingEvent {\n  status: TrackingStatusType\n  statusDetails: string\n  statusDate: string\n  location?: {\n    city?: string\n    state?: string\n    zip?: string\n    country?: string\n  }\n  substatus?: {\n    code: string\n    text: string\n    actionRequired: boolean\n  }\n}\n\nexport type TrackingStatusType =\n  | 'UNKNOWN'\n  | 'PRE_TRANSIT'\n  | 'TRANSIT'\n  | 'DELIVERED'\n  | 'RETURNED'\n  | 'FAILURE'\n\n// Refund Types\nexport interface RefundRequest {\n  transactionId: string\n}\n\nexport interface RefundResponse {\n  transactionId: string\n  status: 'PENDING' | 'SUCCESS' | 'ERROR'\n}\n\n// Webhook Types\nexport interface ShippoWebhookPayload {\n  event: string\n  test: boolean\n  data: {\n    carrier: string\n    tracking_number: string\n    tracking_status: TrackingEvent\n    tracking_history: TrackingEvent[]\n  }\n}\n\n// Configuration Types\nexport interface ShippoConfig {\n  apiKey: string\n  webhookSecret?: string\n  defaultFromAddress: ShippingAddress\n  carriers: CarrierType[]\n  testMode: boolean\n}\n\nexport interface ShippingSettings {\n  enabled?: boolean\n  shippoApiKey?: string\n  shippoWebhookSecret?: string\n  testMode?: boolean\n  /** Use Shippo Shipping Elements (embedded widget) instead of custom API integration */\n  useElements?: boolean\n  fromName?: string\n  fromCompany?: string\n  fromStreet1?: string\n  fromStreet2?: string\n  fromCity?: string\n  fromState?: string\n  fromZip?: string\n  fromCountry?: string\n  fromPhone?: string\n  fromEmail?: string\n  enabledCarriers?: CarrierType[]\n  defaultLabelFormat?: LabelFormat\n  defaultPackageWeight?: number\n  requireSignature?: boolean\n}\n\n// Shippo Elements Types\nexport interface ShippoElementsAuthResponse {\n  token: string\n  expiresAt: string\n  organizationId: string\n}\n\nexport interface ShippoElementsLabel {\n  transactionId: string\n  trackingNumber: string\n  trackingUrl: string\n  labelUrl: string\n  rate: {\n    carrier: string\n    service: string\n    amount: string\n    currency: string\n  }\n}\n\n// Status Constants\nexport interface ShipmentStatusOption {\n  value: 'pending' | 'label_purchased' | 'in_transit' | 'delivered' | 'exception' | 'refunded'\n  label: string\n}\n\nexport const SHIPMENT_STATUSES: ShipmentStatusOption[] = [\n  { value: 'pending', label: 'Pending' },\n  { value: 'label_purchased', label: 'Label Purchased' },\n  { value: 'in_transit', label: 'In Transit' },\n  { value: 'delivered', label: 'Delivered' },\n  { value: 'exception', label: 'Exception' },\n  { value: 'refunded', label: 'Refunded' },\n]\n\nexport const CARRIER_OPTIONS = [\n  { value: 'usps', label: 'USPS' },\n  { value: 'ups', label: 'UPS' },\n  { value: 'fedex', label: 'FedEx' },\n] as const\n\nexport const LABEL_FORMAT_OPTIONS = [\n  { value: 'PDF', label: 'PDF (Standard)' },\n  { value: 'PDF_4x6', label: 'PDF 4x6 (Thermal)' },\n  { value: 'PNG', label: 'PNG' },\n] as const\n","/**\n * Customer Dashboard Configuration Types\n *\n * Defines the structure for configurable, modular dashboards\n * that can be customized for different business types:\n * - E-commerce: Orders, shipping, payment methods\n * - Consulting: Projects, invoices, scheduling\n * - Services: Bookings, subscriptions, usage\n * - General: Profile, addresses, notifications\n */\n\n/**\n * Available dashboard widget types\n */\nexport type DashboardWidgetType =\n  // Core widgets (all dashboard types)\n  | 'profile-overview'\n  | 'quick-actions'\n  | 'notifications'\n  | 'support'\n  // E-commerce widgets\n  | 'recent-orders'\n  | 'order-tracking'\n  | 'payment-methods'\n  | 'addresses'\n  | 'wishlist'\n  | 'loyalty-points'\n  | 'subscriptions'\n  // Consulting/Services widgets\n  | 'active-projects'\n  | 'project-milestones'\n  | 'invoices'\n  | 'upcoming-meetings'\n  | 'time-tracking'\n  | 'documents'\n  // Bookings/Appointments\n  | 'upcoming-bookings'\n  | 'booking-history'\n  | 'available-services'\n  // Usage-based\n  | 'usage-stats'\n  | 'billing-summary'\n  | 'api-keys';\n\n/**\n * Dashboard preset types\n */\nexport type DashboardPreset =\n  | 'ecommerce'\n  | 'consulting'\n  | 'services'\n  | 'booking'\n  | 'saas'\n  | 'custom';\n\n/**\n * Widget configuration\n */\nexport interface DashboardWidget {\n  id: string;\n  type: DashboardWidgetType;\n  title: string;\n  description?: string;\n  enabled: boolean;\n  /** Grid column span (1-4) */\n  colSpan?: 1 | 2 | 3 | 4;\n  /** Sort order (lower = first) */\n  order: number;\n  /** Widget-specific settings */\n  settings?: Record<string, unknown>;\n}\n\n/**\n * Dashboard tab configuration\n */\nexport interface DashboardTab {\n  id: string;\n  label: string;\n  icon?: string;\n  slug: string;\n  enabled: boolean;\n  order: number;\n  widgets: DashboardWidget[];\n}\n\n/**\n * Full dashboard configuration\n */\nexport interface DashboardConfig {\n  /** Preset type for quick configuration */\n  preset: DashboardPreset;\n  /** Dashboard title shown to customers */\n  title: string;\n  /** Whether to show the main overview tab */\n  showOverview: boolean;\n  /** Tabs configuration */\n  tabs: DashboardTab[];\n  /** Theme customization */\n  theme?: {\n    primaryColor?: string;\n    accentColor?: string;\n    borderRadius?: 'none' | 'sm' | 'md' | 'lg';\n    cardStyle?: 'flat' | 'bordered' | 'elevated';\n  };\n}\n\n/**\n * Default widget configurations by type\n */\nexport const DEFAULT_WIDGETS: Record<DashboardWidgetType, Partial<DashboardWidget>> = {\n  // Core\n  'profile-overview': { title: 'Profile', colSpan: 2 },\n  'quick-actions': { title: 'Quick Actions', colSpan: 2 },\n  'notifications': { title: 'Notifications', colSpan: 1 },\n  'support': { title: 'Need Help?', colSpan: 1 },\n  // E-commerce\n  'recent-orders': { title: 'Recent Orders', colSpan: 4 },\n  'order-tracking': { title: 'Track Your Order', colSpan: 2 },\n  'payment-methods': { title: 'Payment Methods', colSpan: 2 },\n  'addresses': { title: 'Addresses', colSpan: 2 },\n  'wishlist': { title: 'Wishlist', colSpan: 2 },\n  'loyalty-points': { title: 'Rewards', colSpan: 1 },\n  'subscriptions': { title: 'Subscriptions', colSpan: 2 },\n  // Consulting\n  'active-projects': { title: 'Active Projects', colSpan: 4 },\n  'project-milestones': { title: 'Milestones', colSpan: 2 },\n  'invoices': { title: 'Invoices', colSpan: 2 },\n  'upcoming-meetings': { title: 'Upcoming Meetings', colSpan: 2 },\n  'time-tracking': { title: 'Time Tracking', colSpan: 2 },\n  'documents': { title: 'Documents', colSpan: 2 },\n  // Bookings\n  'upcoming-bookings': { title: 'Upcoming Bookings', colSpan: 4 },\n  'booking-history': { title: 'Past Bookings', colSpan: 4 },\n  'available-services': { title: 'Book a Service', colSpan: 2 },\n  // SaaS\n  'usage-stats': { title: 'Usage', colSpan: 2 },\n  'billing-summary': { title: 'Billing', colSpan: 2 },\n  'api-keys': { title: 'API Keys', colSpan: 2 },\n};\n\n/**\n * Preset configurations\n */\nexport const DASHBOARD_PRESETS: Record<DashboardPreset, Partial<DashboardConfig>> = {\n  ecommerce: {\n    title: 'My Account',\n    showOverview: true,\n    tabs: [\n      {\n        id: 'orders',\n        label: 'Orders',\n        slug: 'orders',\n        icon: 'package',\n        enabled: true,\n        order: 1,\n        widgets: [\n          { id: 'recent-orders', type: 'recent-orders', title: 'Orders', enabled: true, order: 1 },\n        ],\n      },\n      {\n        id: 'addresses',\n        label: 'Addresses',\n        slug: 'addresses',\n        icon: 'map-pin',\n        enabled: true,\n        order: 2,\n        widgets: [\n          { id: 'addresses', type: 'addresses', title: 'Addresses', enabled: true, order: 1 },\n        ],\n      },\n      {\n        id: 'payments',\n        label: 'Payment Methods',\n        slug: 'payments',\n        icon: 'credit-card',\n        enabled: true,\n        order: 3,\n        widgets: [\n          { id: 'payment-methods', type: 'payment-methods', title: 'Payment Methods', enabled: true, order: 1 },\n        ],\n      },\n    ],\n  },\n  consulting: {\n    title: 'Client Portal',\n    showOverview: true,\n    tabs: [\n      {\n        id: 'projects',\n        label: 'Projects',\n        slug: 'projects',\n        icon: 'briefcase',\n        enabled: true,\n        order: 1,\n        widgets: [\n          { id: 'active-projects', type: 'active-projects', title: 'Your Projects', enabled: true, order: 1 },\n        ],\n      },\n      {\n        id: 'billing',\n        label: 'Billing',\n        slug: 'billing',\n        icon: 'file-text',\n        enabled: true,\n        order: 2,\n        widgets: [\n          { id: 'invoices', type: 'invoices', title: 'Invoices', enabled: true, order: 1 },\n        ],\n      },\n      {\n        id: 'meetings',\n        label: 'Meetings',\n        slug: 'meetings',\n        icon: 'calendar',\n        enabled: true,\n        order: 3,\n        widgets: [\n          { id: 'upcoming-meetings', type: 'upcoming-meetings', title: 'Upcoming Meetings', enabled: true, order: 1 },\n        ],\n      },\n      {\n        id: 'documents',\n        label: 'Documents',\n        slug: 'documents',\n        icon: 'folder',\n        enabled: true,\n        order: 4,\n        widgets: [\n          { id: 'documents', type: 'documents', title: 'Shared Documents', enabled: true, order: 1 },\n        ],\n      },\n    ],\n  },\n  services: {\n    title: 'My Account',\n    showOverview: true,\n    tabs: [\n      {\n        id: 'bookings',\n        label: 'My Bookings',\n        slug: 'bookings',\n        icon: 'calendar-check',\n        enabled: true,\n        order: 1,\n        widgets: [\n          { id: 'upcoming-bookings', type: 'upcoming-bookings', title: 'Upcoming', enabled: true, order: 1 },\n          { id: 'booking-history', type: 'booking-history', title: 'History', enabled: true, order: 2 },\n        ],\n      },\n      {\n        id: 'services',\n        label: 'Book',\n        slug: 'book',\n        icon: 'plus-circle',\n        enabled: true,\n        order: 2,\n        widgets: [\n          { id: 'available-services', type: 'available-services', title: 'Book a Service', enabled: true, order: 1 },\n        ],\n      },\n    ],\n  },\n  booking: {\n    title: 'My Reservations',\n    showOverview: true,\n    tabs: [\n      {\n        id: 'reservations',\n        label: 'Reservations',\n        slug: 'reservations',\n        icon: 'calendar',\n        enabled: true,\n        order: 1,\n        widgets: [\n          { id: 'upcoming-bookings', type: 'upcoming-bookings', title: 'Upcoming', enabled: true, order: 1 },\n        ],\n      },\n    ],\n  },\n  saas: {\n    title: 'Dashboard',\n    showOverview: true,\n    tabs: [\n      {\n        id: 'usage',\n        label: 'Usage',\n        slug: 'usage',\n        icon: 'bar-chart',\n        enabled: true,\n        order: 1,\n        widgets: [\n          { id: 'usage-stats', type: 'usage-stats', title: 'Usage Statistics', enabled: true, order: 1 },\n        ],\n      },\n      {\n        id: 'billing',\n        label: 'Billing',\n        slug: 'billing',\n        icon: 'credit-card',\n        enabled: true,\n        order: 2,\n        widgets: [\n          { id: 'billing-summary', type: 'billing-summary', title: 'Billing', enabled: true, order: 1 },\n          { id: 'invoices', type: 'invoices', title: 'Invoices', enabled: true, order: 2 },\n        ],\n      },\n      {\n        id: 'api',\n        label: 'API',\n        slug: 'api',\n        icon: 'code',\n        enabled: true,\n        order: 3,\n        widgets: [\n          { id: 'api-keys', type: 'api-keys', title: 'API Keys', enabled: true, order: 1 },\n        ],\n      },\n    ],\n  },\n  custom: {\n    title: 'My Account',\n    showOverview: true,\n    tabs: [],\n  },\n};\n\n/**\n * Get default dashboard configuration for a preset\n */\nexport function getDefaultDashboardConfig(preset: DashboardPreset = 'ecommerce'): DashboardConfig {\n  const presetConfig = DASHBOARD_PRESETS[preset];\n  return {\n    preset,\n    title: presetConfig.title || 'My Account',\n    showOverview: presetConfig.showOverview ?? true,\n    tabs: presetConfig.tabs || [],\n    theme: {\n      borderRadius: 'md',\n      cardStyle: 'bordered',\n    },\n  };\n}\n","/**\n * Customer Dashboard Configuration\n *\n * Functions for managing configurable customer dashboards.\n * Configuration is stored in the settings table under the 'dashboard' group.\n */\n\nimport { prisma } from '../db';\nimport {\n  type DashboardConfig,\n  type DashboardPreset,\n  type DashboardTab,\n  type DashboardWidget,\n  getDefaultDashboardConfig,\n  DASHBOARD_PRESETS,\n} from './types';\n\n// Re-export types\nexport * from './types';\n\nconst DASHBOARD_SETTINGS_KEY = 'dashboard.config';\n\n/**\n * Get the current dashboard configuration\n */\nexport async function getDashboardConfig(): Promise<DashboardConfig> {\n  try {\n    const setting = await prisma.setting.findUnique({\n      where: { key: DASHBOARD_SETTINGS_KEY },\n    });\n\n    if (setting?.value) {\n      const config = JSON.parse(setting.value) as DashboardConfig;\n      // Merge with defaults to ensure new fields are present\n      return {\n        ...getDefaultDashboardConfig(config.preset),\n        ...config,\n      };\n    }\n  } catch (error) {\n    console.error('Error loading dashboard config:', error);\n  }\n\n  // Return default e-commerce config\n  return getDefaultDashboardConfig('ecommerce');\n}\n\n/**\n * Save dashboard configuration\n */\nexport async function saveDashboardConfig(config: Partial<DashboardConfig>): Promise<DashboardConfig> {\n  const currentConfig = await getDashboardConfig();\n  const newConfig: DashboardConfig = {\n    ...currentConfig,\n    ...config,\n  };\n\n  await prisma.setting.upsert({\n    where: { key: DASHBOARD_SETTINGS_KEY },\n    create: {\n      key: DASHBOARD_SETTINGS_KEY,\n      value: JSON.stringify(newConfig),\n      group: 'dashboard',\n      encrypted: false,\n    },\n    update: {\n      value: JSON.stringify(newConfig),\n    },\n  });\n\n  return newConfig;\n}\n\n/**\n * Apply a preset configuration\n */\nexport async function applyDashboardPreset(preset: DashboardPreset): Promise<DashboardConfig> {\n  const presetConfig = getDefaultDashboardConfig(preset);\n  return saveDashboardConfig(presetConfig);\n}\n\n/**\n * Enable or disable a tab\n */\nexport async function toggleTab(tabId: string, enabled: boolean): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n  const tabIndex = config.tabs.findIndex((t) => t.id === tabId);\n\n  if (tabIndex >= 0) {\n    config.tabs[tabIndex].enabled = enabled;\n    return saveDashboardConfig(config);\n  }\n\n  return config;\n}\n\n/**\n * Add a new tab\n */\nexport async function addTab(tab: Omit<DashboardTab, 'order'>): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n  const maxOrder = Math.max(...config.tabs.map((t) => t.order), 0);\n\n  config.tabs.push({\n    ...tab,\n    order: maxOrder + 1,\n  });\n\n  return saveDashboardConfig(config);\n}\n\n/**\n * Remove a tab\n */\nexport async function removeTab(tabId: string): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n  config.tabs = config.tabs.filter((t) => t.id !== tabId);\n  return saveDashboardConfig(config);\n}\n\n/**\n * Reorder tabs\n */\nexport async function reorderTabs(tabIds: string[]): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n\n  config.tabs = tabIds\n    .map((id, index) => {\n      const tab = config.tabs.find((t) => t.id === id);\n      if (tab) {\n        return { ...tab, order: index + 1 };\n      }\n      return null;\n    })\n    .filter((t): t is DashboardTab => t !== null);\n\n  return saveDashboardConfig(config);\n}\n\n/**\n * Add a widget to a tab\n */\nexport async function addWidget(\n  tabId: string,\n  widget: Omit<DashboardWidget, 'order'>\n): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n  const tabIndex = config.tabs.findIndex((t) => t.id === tabId);\n\n  if (tabIndex >= 0) {\n    const maxOrder = Math.max(...config.tabs[tabIndex].widgets.map((w) => w.order), 0);\n    config.tabs[tabIndex].widgets.push({\n      ...widget,\n      order: maxOrder + 1,\n    });\n    return saveDashboardConfig(config);\n  }\n\n  return config;\n}\n\n/**\n * Remove a widget from a tab\n */\nexport async function removeWidget(tabId: string, widgetId: string): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n  const tabIndex = config.tabs.findIndex((t) => t.id === tabId);\n\n  if (tabIndex >= 0) {\n    config.tabs[tabIndex].widgets = config.tabs[tabIndex].widgets.filter(\n      (w) => w.id !== widgetId\n    );\n    return saveDashboardConfig(config);\n  }\n\n  return config;\n}\n\n/**\n * Toggle a widget's enabled state\n */\nexport async function toggleWidget(\n  tabId: string,\n  widgetId: string,\n  enabled: boolean\n): Promise<DashboardConfig> {\n  const config = await getDashboardConfig();\n  const tabIndex = config.tabs.findIndex((t) => t.id === tabId);\n\n  if (tabIndex >= 0) {\n    const widgetIndex = config.tabs[tabIndex].widgets.findIndex((w) => w.id === widgetId);\n    if (widgetIndex >= 0) {\n      config.tabs[tabIndex].widgets[widgetIndex].enabled = enabled;\n      return saveDashboardConfig(config);\n    }\n  }\n\n  return config;\n}\n\n/**\n * Get available presets with their descriptions\n */\nexport function getAvailablePresets(): Array<{\n  id: DashboardPreset;\n  name: string;\n  description: string;\n}> {\n  return [\n    {\n      id: 'ecommerce',\n      name: 'E-commerce',\n      description: 'Orders, shipping tracking, payment methods, addresses, and wishlist',\n    },\n    {\n      id: 'consulting',\n      name: 'Consulting / Agency',\n      description: 'Projects, milestones, invoices, meetings, and shared documents',\n    },\n    {\n      id: 'services',\n      name: 'Service Business',\n      description: 'Appointment booking, service history, and scheduling',\n    },\n    {\n      id: 'booking',\n      name: 'Reservations',\n      description: 'Simple booking and reservation management',\n    },\n    {\n      id: 'saas',\n      name: 'SaaS Platform',\n      description: 'Usage statistics, billing, subscriptions, and API keys',\n    },\n    {\n      id: 'custom',\n      name: 'Custom',\n      description: 'Start from scratch and build your own dashboard layout',\n    },\n  ];\n}\n","/**\n * Route Configuration Utilities\n *\n * Handles fetching and resolving route configurations.\n */\n\nimport { prisma } from '../db'\nimport { cache } from 'react'\n\nexport type { RouteType } from '@prisma/client'\n\nexport interface ResolvedRoute {\n  type: 'PUCK' | 'CUSTOM' | 'REDIRECT' | 'NOT_FOUND'\n  // For PUCK\n  pageId?: string\n  pageContent?: unknown\n  pageTitle?: string\n  pageSlug?: string\n  pageMetaTitle?: string | null\n  pageMetaDescription?: string | null\n  // For CUSTOM\n  componentKey?: string\n  // For REDIRECT\n  redirectUrl?: string\n  redirectCode?: number\n}\n\n/**\n * Get route configuration for a given slug\n * Cached per request using React cache\n */\nexport const getRouteConfig = cache(async (slug: string): Promise<ResolvedRoute> => {\n  // Normalize slug\n  const normalizedSlug = slug.startsWith('/') ? slug : `/${slug}`\n\n  const routeConfig = await prisma.routeConfig.findUnique({\n    where: { slug: normalizedSlug },\n    include: {\n      page: {\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n          status: true,\n          content: true,\n          metaTitle: true,\n          metaDescription: true,\n        },\n      },\n    },\n  })\n\n  if (!routeConfig || !routeConfig.isActive) {\n    return { type: 'NOT_FOUND' }\n  }\n\n  switch (routeConfig.type) {\n    case 'PUCK':\n      if (!routeConfig.page) {\n        return { type: 'NOT_FOUND' }\n      }\n      // Only show published pages\n      if (routeConfig.page.status !== 'PUBLISHED') {\n        return { type: 'NOT_FOUND' }\n      }\n      return {\n        type: 'PUCK',\n        pageId: routeConfig.page.id,\n        pageContent: routeConfig.page.content,\n        pageTitle: routeConfig.page.title,\n        pageSlug: routeConfig.page.slug,\n        pageMetaTitle: routeConfig.page.metaTitle,\n        pageMetaDescription: routeConfig.page.metaDescription,\n      }\n\n    case 'CUSTOM':\n      if (!routeConfig.componentKey) {\n        return { type: 'NOT_FOUND' }\n      }\n      return {\n        type: 'CUSTOM',\n        componentKey: routeConfig.componentKey,\n      }\n\n    case 'REDIRECT':\n      if (!routeConfig.redirectUrl) {\n        return { type: 'NOT_FOUND' }\n      }\n      return {\n        type: 'REDIRECT',\n        redirectUrl: routeConfig.redirectUrl,\n        redirectCode: routeConfig.redirectCode || 307,\n      }\n\n    default:\n      return { type: 'NOT_FOUND' }\n  }\n})\n\n/**\n * Check if a slug is reserved by a route config\n */\nexport async function isSlugReserved(slug: string): Promise<boolean> {\n  const normalizedSlug = slug.startsWith('/') ? slug : `/${slug}`\n\n  const existing = await prisma.routeConfig.findUnique({\n    where: { slug: normalizedSlug },\n    select: { id: true },\n  })\n\n  return !!existing\n}\n\n/**\n * Get all route configurations (for admin)\n */\nexport async function getAllRouteConfigs() {\n  return prisma.routeConfig.findMany({\n    include: {\n      page: {\n        select: {\n          id: true,\n          title: true,\n          slug: true,\n          status: true,\n        },\n      },\n    },\n    orderBy: { slug: 'asc' },\n  })\n}\n"],"mappings":"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","names":["cart","Stripe","settingsCache","settingsCacheTime","SETTINGS_CACHE_TTL","stripeClient","getStripeClient","Stripe","_a","_a","db","executeWorkflow","uuidv4","_a","_b","_c","executeWorkflow","getNestedValue","_a","cache"]}