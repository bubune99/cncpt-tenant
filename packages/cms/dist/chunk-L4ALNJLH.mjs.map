{"version":3,"sources":["../src/hooks/use-mobile.ts","../src/hooks/usePermissions.ts","../src/exports/hooks.ts"],"sourcesContent":["import * as React from \"react\"\r\n\r\nconst MOBILE_BREAKPOINT = 768\r\n\r\nexport function useIsMobile() {\r\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\r\n\r\n  React.useEffect(() => {\r\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\r\n    const onChange = () => {\r\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\r\n    }\r\n    mql.addEventListener(\"change\", onChange)\r\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\r\n    return () => mql.removeEventListener(\"change\", onChange)\r\n  }, [])\r\n\r\n  return !!isMobile\r\n}\r\n","'use client'\n\n/**\n * Client-side permission hook\n * Fetches and caches user permissions for UI rendering\n */\n\nimport { useState, useEffect, useCallback, useMemo } from 'react'\n\ninterface PermissionData {\n  userId: string\n  email: string\n  name: string | null\n  roles: Array<{\n    id: string\n    name: string\n    displayName: string\n  }>\n  permissions: string[]\n  isSuperAdmin: boolean\n}\n\ninterface UsePermissionsReturn {\n  // Data\n  permissions: string[]\n  roles: PermissionData['roles']\n  isSuperAdmin: boolean\n  isLoading: boolean\n  error: Error | null\n\n  // Permission checks\n  can: (permission: string) => boolean\n  canAny: (permissions: string[]) => boolean\n  canAll: (permissions: string[]) => boolean\n  hasRole: (roleName: string) => boolean\n\n  // Refresh\n  refresh: () => Promise<void>\n}\n\n/**\n * Check if a permission matches (including wildcards)\n */\nfunction permissionMatches(userPermission: string, requiredPermission: string): boolean {\n  if (userPermission === requiredPermission) return true\n  if (userPermission === '*') return true\n\n  if (userPermission.endsWith('.*')) {\n    const resource = userPermission.slice(0, -2)\n    return requiredPermission.startsWith(resource + '.')\n  }\n\n  return false\n}\n\nexport function usePermissions(): UsePermissionsReturn {\n  const [data, setData] = useState<PermissionData | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<Error | null>(null)\n\n  const fetchPermissions = useCallback(async () => {\n    try {\n      setIsLoading(true)\n      setError(null)\n\n      const response = await fetch('/api/auth/permissions')\n\n      if (!response.ok) {\n        if (response.status === 401) {\n          // Not authenticated - that's ok, just no permissions\n          setData(null)\n          return\n        }\n        throw new Error('Failed to fetch permissions')\n      }\n\n      const permData = await response.json()\n      setData(permData)\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error('Unknown error'))\n    } finally {\n      setIsLoading(false)\n    }\n  }, [])\n\n  useEffect(() => {\n    fetchPermissions()\n  }, [fetchPermissions])\n\n  // Permission check functions\n  const can = useCallback(\n    (permission: string): boolean => {\n      if (!data) return false\n      if (data.isSuperAdmin) return true\n\n      return data.permissions.some((p) => permissionMatches(p, permission))\n    },\n    [data]\n  )\n\n  const canAny = useCallback(\n    (permissions: string[]): boolean => {\n      return permissions.some((p) => can(p))\n    },\n    [can]\n  )\n\n  const canAll = useCallback(\n    (permissions: string[]): boolean => {\n      return permissions.every((p) => can(p))\n    },\n    [can]\n  )\n\n  const hasRole = useCallback(\n    (roleName: string): boolean => {\n      if (!data) return false\n      return data.roles.some((r) => r.name === roleName)\n    },\n    [data]\n  )\n\n  return useMemo(\n    () => ({\n      permissions: data?.permissions ?? [],\n      roles: data?.roles ?? [],\n      isSuperAdmin: data?.isSuperAdmin ?? false,\n      isLoading,\n      error,\n      can,\n      canAny,\n      canAll,\n      hasRole,\n      refresh: fetchPermissions,\n    }),\n    [data, isLoading, error, can, canAny, canAll, hasRole, fetchPermissions]\n  )\n}\n\n/**\n * Permission gate component\n * Renders children only if user has the required permission\n */\ninterface PermissionGateProps {\n  permission?: string\n  permissions?: string[]\n  requireAll?: boolean\n  fallback?: React.ReactNode\n  children: React.ReactNode\n}\n\nexport function PermissionGate({\n  permission,\n  permissions,\n  requireAll = false,\n  fallback = null,\n  children,\n}: PermissionGateProps): React.ReactNode {\n  const { can, canAny, canAll, isLoading } = usePermissions()\n\n  if (isLoading) {\n    return fallback\n  }\n\n  // Single permission check\n  if (permission) {\n    return can(permission) ? children : fallback\n  }\n\n  // Multiple permissions check\n  if (permissions && permissions.length > 0) {\n    const hasAccess = requireAll\n      ? canAll(permissions)\n      : canAny(permissions)\n\n    return hasAccess ? children : fallback\n  }\n\n  // No permission specified - render children\n  return children\n}\n\nexport default usePermissions\n","/**\r\n * Hooks exports\r\n */\r\n\r\nexport { useAuth } from '../hooks/use-auth'\r\nexport { useIsMobile } from '../hooks/use-mobile'\r\nexport { useMediaUpload } from '../hooks/use-media-upload'\r\nexport { usePermissions } from '../hooks/usePermissions'\r\n\r\n// CMS Config context and hook for multi-tenant support\r\nexport { useCMSConfig, CMSConfigProvider } from '../contexts/CMSConfigContext'\r\nexport type { CMSConfig } from '../contexts/CMSConfigContext'\r\n\r\n// Re-export debounce hooks from usehooks-ts\r\nexport { useDebounceValue, useDebounceCallback } from 'usehooks-ts'\r\n"],"mappings":"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","names":["useState","useEffect"]}