{"version":3,"sources":["../src/lib/media/types.ts"],"sourcesContent":["/**\n * Media Library Types\n *\n * Standalone type definitions that don't depend on Prisma client\n * until the database schema is applied and client is regenerated.\n */\n\n// =============================================================================\n// STORAGE PROVIDER (mirrors Prisma enum)\n// =============================================================================\n\nexport type StorageProvider = 'LOCAL' | 'S3' | 'R2' | 'GCS'\n\n// =============================================================================\n// BASE TYPES (mirrors Prisma models)\n// =============================================================================\n\nexport interface MediaBase {\n  id: string\n  filename: string\n  originalName: string\n  mimeType: string\n  size: number\n  url: string\n  width: number | null\n  height: number | null\n  title: string | null\n  alt: string | null\n  caption: string | null\n  description: string | null\n  folderId: string | null\n  provider: StorageProvider\n  bucket: string | null\n  key: string | null\n  uploadedById: string | null\n  deletedAt: Date | null\n  createdAt: Date\n  updatedAt: Date\n}\n\nexport interface MediaFolderBase {\n  id: string\n  name: string\n  slug: string\n  description: string | null\n  color: string | null\n  icon: string | null\n  parentId: string | null\n  path: string\n  depth: number\n  position: number\n  isPublic: boolean\n  createdAt: Date\n  updatedAt: Date\n}\n\nexport interface MediaTagBase {\n  id: string\n  name: string\n  slug: string\n  color: string | null\n  createdAt: Date\n}\n\nexport interface MediaUsageBase {\n  id: string\n  mediaId: string\n  entityType: string\n  entityId: string\n  fieldName: string | null\n  createdAt: Date\n}\n\n// =============================================================================\n// MEDIA TYPES\n// =============================================================================\n\nexport type MediaType = 'image' | 'video' | 'audio' | 'document' | 'other'\n\nexport type ViewMode = 'grid' | 'list'\n\nexport type SortField = 'name' | 'createdAt' | 'size' | 'type'\nexport type SortOrder = 'asc' | 'desc'\n\nexport interface MediaFilters {\n  folderId?: string | null\n  type?: MediaType\n  search?: string\n  tagIds?: string[]\n  includeDeleted?: boolean\n  page?: number\n  limit?: number\n  sortBy?: SortField\n  sortOrder?: SortOrder\n}\n\nexport interface MediaWithRelations extends MediaBase {\n  folder?: MediaFolderBase | null\n  tags?: Array<{ tag: MediaTagBase }>\n  usages?: MediaUsageBase[]\n  uploadedBy?: { id: string; name: string | null; email: string } | null\n  _count?: {\n    usages: number\n  }\n}\n\nexport interface MediaListResponse {\n  media: MediaWithRelations[]\n  total: number\n  page: number\n  limit: number\n  hasMore: boolean\n}\n\nexport interface MediaCreateInput {\n  filename: string\n  originalName: string\n  mimeType: string\n  size: number\n  url: string\n  width?: number\n  height?: number\n  title?: string\n  alt?: string\n  caption?: string\n  description?: string\n  folderId?: string\n  provider?: StorageProvider\n  bucket?: string\n  key?: string\n  uploadedById?: string\n  tagIds?: string[]\n}\n\nexport interface MediaUpdateInput {\n  filename?: string\n  title?: string\n  alt?: string\n  caption?: string\n  description?: string\n  folderId?: string | null\n  tagIds?: string[]\n}\n\n// =============================================================================\n// FOLDER TYPES\n// =============================================================================\n\nexport interface FolderWithRelations extends MediaFolderBase {\n  parent?: MediaFolderBase | null\n  children?: MediaFolderBase[]\n  _count?: {\n    media: number\n    children: number\n  }\n}\n\nexport interface FolderTree extends MediaFolderBase {\n  children: FolderTree[]\n  mediaCount: number\n}\n\nexport interface FolderCreateInput {\n  name: string\n  slug?: string\n  description?: string\n  color?: string\n  icon?: string\n  parentId?: string | null\n  isPublic?: boolean\n}\n\nexport interface FolderUpdateInput {\n  name?: string\n  slug?: string\n  description?: string\n  color?: string\n  icon?: string\n  parentId?: string | null\n  position?: number\n  isPublic?: boolean\n}\n\n// =============================================================================\n// TAG TYPES\n// =============================================================================\n\nexport interface TagWithCount extends MediaTagBase {\n  _count?: {\n    media: number\n  }\n}\n\nexport interface TagCreateInput {\n  name: string\n  slug?: string\n  color?: string\n}\n\nexport interface TagUpdateInput {\n  name?: string\n  slug?: string\n  color?: string\n}\n\n// =============================================================================\n// USAGE TYPES\n// =============================================================================\n\nexport type EntityType = 'product' | 'blog_post' | 'page' | 'category' | 'email_campaign'\n\nexport interface UsageInfo {\n  id: string\n  entityType: EntityType\n  entityId: string\n  entityTitle: string\n  fieldName: string | null\n  url: string\n  createdAt: Date\n}\n\n// =============================================================================\n// UPLOAD TYPES\n// =============================================================================\n\nexport interface UploadOptions {\n  folderId?: string\n  tagIds?: string[]\n  alt?: string\n  caption?: string\n  title?: string\n}\n\nexport interface UploadProgress {\n  id: string\n  filename: string\n  progress: number\n  status: 'pending' | 'uploading' | 'processing' | 'complete' | 'error'\n  error?: string\n  size?: number\n  url?: string\n  media?: MediaWithRelations\n}\n\nexport interface PresignedUrlResponse {\n  uploadUrl: string\n  key: string\n  bucket: string\n  provider: StorageProvider\n  publicUrl: string\n}\n\n// =============================================================================\n// BULK OPERATIONS\n// =============================================================================\n\nexport type BulkOperation = 'delete' | 'move' | 'tag' | 'untag' | 'restore'\n\nexport interface BulkOperationInput {\n  operation: BulkOperation\n  mediaIds: string[]\n  folderId?: string | null\n  tagIds?: string[]\n  hardDelete?: boolean\n}\n\nexport interface BulkOperationResult {\n  success: boolean\n  affected: number\n  errors?: Array<{ id: string; error: string }>\n}\n\n// =============================================================================\n// HELPERS\n// =============================================================================\n\n/**\n * Get media type from MIME type\n */\nexport function getMediaType(mimeType: string): MediaType {\n  if (mimeType.startsWith('image/')) return 'image'\n  if (mimeType.startsWith('video/')) return 'video'\n  if (mimeType.startsWith('audio/')) return 'audio'\n  if (\n    mimeType === 'application/pdf' ||\n    mimeType.includes('document') ||\n    mimeType.includes('spreadsheet') ||\n    mimeType.includes('presentation') ||\n    mimeType === 'text/plain' ||\n    mimeType === 'text/csv' ||\n    mimeType.includes('word') ||\n    mimeType.includes('excel') ||\n    mimeType.includes('powerpoint')\n  ) {\n    return 'document'\n  }\n  return 'other'\n}\n\n/**\n * Get file extension from filename\n */\nexport function getFileExtension(filename: string): string {\n  const parts = filename.split('.')\n  return parts.length > 1 ? parts.pop()!.toLowerCase() : ''\n}\n\n/**\n * Format file size for display\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes'\n  const k = 1024\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n}\n\n/**\n * Generate slug from name\n */\nexport function generateSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n}\n\n/**\n * Get MIME type icon name (Lucide icon)\n */\nexport function getMediaTypeIcon(mimeType: string): string {\n  const type = getMediaType(mimeType)\n  switch (type) {\n    case 'image':\n      return 'Image'\n    case 'video':\n      return 'Video'\n    case 'audio':\n      return 'Music'\n    case 'document':\n      if (mimeType === 'application/pdf') return 'FileText'\n      if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return 'FileSpreadsheet'\n      if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return 'Presentation'\n      return 'FileText'\n    default:\n      return 'File'\n  }\n}\n\n/**\n * Check if file type is allowed\n */\nexport function isAllowedFileType(mimeType: string, allowedTypes: string[]): boolean {\n  return allowedTypes.some((allowed) => {\n    if (allowed.endsWith('/*')) {\n      const prefix = allowed.slice(0, -2)\n      return mimeType.startsWith(prefix)\n    }\n    return mimeType === allowed\n  })\n}\n\n/**\n * Default allowed file types\n */\nexport const DEFAULT_ALLOWED_TYPES = [\n  'image/*',\n  'video/*',\n  'audio/*',\n  'application/pdf',\n  'application/msword',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'application/vnd.ms-excel',\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  'application/vnd.ms-powerpoint',\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  'text/plain',\n  'text/csv',\n]\n\n/**\n * Default max file size (50MB)\n */\nexport const DEFAULT_MAX_FILE_SIZE = 50 * 1024 * 1024\n\n// =============================================================================\n// R2/S3 CORS CONFIGURATION\n// =============================================================================\n\nexport interface CorsRule {\n  AllowedOrigins: string[]\n  AllowedMethods: string[]\n  AllowedHeaders: string[]\n  ExposeHeaders?: string[]\n  MaxAgeSeconds?: number\n}\n\n/**\n * Generate recommended CORS configuration for R2/S3 bucket\n * This configuration is required for browser-based presigned URL uploads\n */\nexport function generateCorsConfig(allowedOrigins: string[]): CorsRule[] {\n  return [\n    {\n      AllowedOrigins: allowedOrigins,\n      AllowedMethods: ['GET', 'PUT', 'HEAD', 'DELETE'],\n      AllowedHeaders: [\n        'Content-Type',\n        'Content-Length',\n        'x-amz-acl',\n        'x-amz-content-sha256',\n        'x-amz-date',\n        'x-amz-user-agent',\n        'authorization',\n      ],\n      ExposeHeaders: ['ETag', 'Content-Length', 'Content-Type'],\n      MaxAgeSeconds: 3600,\n    },\n  ]\n}\n\n/**\n * Get CORS configuration as JSON string for copying to Cloudflare dashboard\n */\nexport function getCorsConfigJson(allowedOrigins: string[]): string {\n  return JSON.stringify(generateCorsConfig(allowedOrigins), null, 2)\n}\n"],"mappings":";AAuRO,SAAS,aAAa,UAA6B;AACxD,MAAI,SAAS,WAAW,QAAQ,EAAG,QAAO;AAC1C,MAAI,SAAS,WAAW,QAAQ,EAAG,QAAO;AAC1C,MAAI,SAAS,WAAW,QAAQ,EAAG,QAAO;AAC1C,MACE,aAAa,qBACb,SAAS,SAAS,UAAU,KAC5B,SAAS,SAAS,aAAa,KAC/B,SAAS,SAAS,cAAc,KAChC,aAAa,gBACb,aAAa,cACb,SAAS,SAAS,MAAM,KACxB,SAAS,SAAS,OAAO,KACzB,SAAS,SAAS,YAAY,GAC9B;AACA,WAAO;AAAA,EACT;AACA,SAAO;AACT;AAKO,SAAS,iBAAiB,UAA0B;AACzD,QAAM,QAAQ,SAAS,MAAM,GAAG;AAChC,SAAO,MAAM,SAAS,IAAI,MAAM,IAAI,EAAG,YAAY,IAAI;AACzD;AAKO,SAAS,eAAe,OAAuB;AACpD,MAAI,UAAU,EAAG,QAAO;AACxB,QAAM,IAAI;AACV,QAAM,QAAQ,CAAC,SAAS,MAAM,MAAM,MAAM,IAAI;AAC9C,QAAM,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC,CAAC;AAClD,SAAO,YAAY,QAAQ,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,MAAM,MAAM,CAAC;AACxE;AAKO,SAAS,aAAa,MAAsB;AACjD,SAAO,KACJ,YAAY,EACZ,QAAQ,eAAe,GAAG,EAC1B,QAAQ,YAAY,EAAE;AAC3B;AAKO,SAAS,iBAAiB,UAA0B;AACzD,QAAM,OAAO,aAAa,QAAQ;AAClC,UAAQ,MAAM;AAAA,IACZ,KAAK;AACH,aAAO;AAAA,IACT,KAAK;AACH,aAAO;AAAA,IACT,KAAK;AACH,aAAO;AAAA,IACT,KAAK;AACH,UAAI,aAAa,kBAAmB,QAAO;AAC3C,UAAI,SAAS,SAAS,aAAa,KAAK,SAAS,SAAS,OAAO,EAAG,QAAO;AAC3E,UAAI,SAAS,SAAS,cAAc,KAAK,SAAS,SAAS,YAAY,EAAG,QAAO;AACjF,aAAO;AAAA,IACT;AACE,aAAO;AAAA,EACX;AACF;AAKO,SAAS,kBAAkB,UAAkB,cAAiC;AACnF,SAAO,aAAa,KAAK,CAAC,YAAY;AACpC,QAAI,QAAQ,SAAS,IAAI,GAAG;AAC1B,YAAM,SAAS,QAAQ,MAAM,GAAG,EAAE;AAClC,aAAO,SAAS,WAAW,MAAM;AAAA,IACnC;AACA,WAAO,aAAa;AAAA,EACtB,CAAC;AACH;AAKO,IAAM,wBAAwB;AAAA,EACnC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAKO,IAAM,wBAAwB,KAAK,OAAO;AAkB1C,SAAS,mBAAmB,gBAAsC;AACvE,SAAO;AAAA,IACL;AAAA,MACE,gBAAgB;AAAA,MAChB,gBAAgB,CAAC,OAAO,OAAO,QAAQ,QAAQ;AAAA,MAC/C,gBAAgB;AAAA,QACd;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,MACA,eAAe,CAAC,QAAQ,kBAAkB,cAAc;AAAA,MACxD,eAAe;AAAA,IACjB;AAAA,EACF;AACF;AAKO,SAAS,kBAAkB,gBAAkC;AAClE,SAAO,KAAK,UAAU,mBAAmB,cAAc,GAAG,MAAM,CAAC;AACnE;","names":[]}